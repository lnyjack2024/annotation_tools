{"ast":null,"code":"var _jsxFileName = \"/Users/qzheng/Documents/webroot/annotation_tools/src/components/multi-channel/components/Validator/index.tsx\";\nimport React from 'react';\nimport { observer } from 'mobx-react';\nimport CommonValidator from '../../../common/tabs-menu/Validator';\nimport i18n from '../../locales';\nimport rootStore from '../../store/RootStore';\nimport { ValidationType, ReviewResult } from '../../types';\nimport './index.scss';\nclass Validator extends React.Component {\n  constructor(...args) {\n    super(...args);\n    this.handleSync = async () => {\n      await this.props.triggerValidation();\n    };\n    this.handleAction = warning => {\n      const {\n        id\n      } = warning;\n      const instance = rootStore.instance.getInstanceById(id);\n      const iStart = warning.start || instance.start;\n      if (iStart !== undefined) {\n        rootStore.instance.setSelectedInstance(id);\n      }\n    };\n    this.warningMoreHandleAction = (key, warning) => {\n      if (key === ReviewResult.REJECT) return;\n      const {\n        id\n      } = warning;\n      const review = {\n        instanceId: id,\n        result: key\n      };\n      if (key === 'delete') {\n        rootStore.review.deleteReviewById(id);\n      } else {\n        rootStore.review.setReview(review);\n      }\n    };\n  }\n  // eslint-disable-next-line class-methods-use-this\n  getCategoryByWarning(warning) {\n    if (warning.warningType === ValidationType.GLOBAL_ERROR) return false;\n    const {\n      id\n    } = warning;\n    const instance = rootStore.instance.getInstanceById(id);\n    return warning.isMissing || instance;\n  }\n  // eslint-disable-next-line class-methods-use-this\n  renderWarningTitle(warning) {\n    var _instance$channelInde, _categories$channel;\n    if (warning.warningType === ValidationType.GLOBAL_ERROR) return i18n.translate('VALIDATION_TYPE_GLOBAL');\n    if (warning.warningType === ValidationType.CHANNEL_ERROR) return i18n.translate('VALIDATION_TYPE_CHANNEL');\n    const {\n      id,\n      channelIndex,\n      start\n    } = warning;\n    const {\n      instance: {\n        displayInstances,\n        getInstanceById\n      },\n      ontology: {\n        categories,\n        categoryLabelVisible\n      }\n    } = rootStore;\n    const instance = getInstanceById(id);\n    const channel = (_instance$channelInde = instance === null || instance === void 0 ? void 0 : instance.channelIndex) !== null && _instance$channelInde !== void 0 ? _instance$channelInde : channelIndex;\n    const category = (instance === null || instance === void 0 ? void 0 : instance.category) || channel !== undefined && ((_categories$channel = categories[channel]) === null || _categories$channel === void 0 ? void 0 : _categories$channel.className);\n    const startTime = (instance === null || instance === void 0 ? void 0 : instance.start) !== undefined ? instance === null || instance === void 0 ? void 0 : instance.start : start;\n    if (startTime !== undefined && category) {\n      const instanceNum = displayInstances.findIndex(i => i.id === id);\n      return `${categoryLabelVisible ? `${category}-` : ''}${instance && instanceNum >= 0 ? instanceNum + 1 : ''}`;\n    }\n    return i18n.translate('VALIDATION_NO_INSTANCE');\n  }\n  render() {\n    const ValidationTypeTitle = {\n      [ValidationType.OVERLAP]: i18n.translate('VALIDATION_TYPE_OVERLAP'),\n      [ValidationType.ATTR_EMPTY]: i18n.translate('VALIDATION_TYPE_ATTR_EMPTY'),\n      [ValidationType.CUSTOM]: i18n.translate('VALIDATION_TYPE_CUSTOM'),\n      [ValidationType.QUALITY]: i18n.translate('VALIDATION_TYPE_QUALITY'),\n      [ValidationType.GLOBAL_ERROR]: i18n.translate('VALIDATION_TYPE_GLOBAL'),\n      [ValidationType.CHANNEL_ERROR]: i18n.translate('VALIDATION_TYPE_CHANNEL'),\n      [ValidationType.SCRIPT]: i18n.translate('VALIDATION_TYPE_SCRIPT'),\n      [ValidationType.DURATION_ILLEGAL]: i18n.translate('REGION_DURATON_ERROR')\n    };\n    return /*#__PURE__*/React.createElement(CommonValidator, {\n      isEnabled: rootStore.review.isEnabled,\n      validationTypes: ValidationTypeTitle,\n      warnings: rootStore.review.warnings,\n      errors: rootStore.review.errors,\n      menuItems: rootStore.review.reviewResultTypes,\n      titleFormatter: count => i18n.translate('VALIDATION_TITLE', {\n        values: {\n          count\n        }\n      }),\n      checkingMsgFormatter: () => i18n.translate('VALIDATION_CHECKING'),\n      onValidate: this.handleSync,\n      renderWarningTitle: warning => this.renderWarningTitle(warning),\n      showWarningAction: warning => !!this.getCategoryByWarning(warning),\n      onWarningAction: warning => this.handleAction(warning),\n      onMoreHandleAction: this.warningMoreHandleAction,\n      formatMessage: i18n.translate,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 81,\n        columnNumber: 7\n      }\n    });\n  }\n}\nexport default observer(Validator);","map":{"version":3,"names":["React","observer","CommonValidator","i18n","rootStore","ValidationType","ReviewResult","Validator","Component","constructor","args","handleSync","props","triggerValidation","handleAction","warning","id","instance","getInstanceById","iStart","start","undefined","setSelectedInstance","warningMoreHandleAction","key","REJECT","review","instanceId","result","deleteReviewById","setReview","getCategoryByWarning","warningType","GLOBAL_ERROR","isMissing","renderWarningTitle","_instance$channelInde","_categories$channel","translate","CHANNEL_ERROR","channelIndex","displayInstances","ontology","categories","categoryLabelVisible","channel","category","className","startTime","instanceNum","findIndex","i","render","ValidationTypeTitle","OVERLAP","ATTR_EMPTY","CUSTOM","QUALITY","SCRIPT","DURATION_ILLEGAL","createElement","isEnabled","validationTypes","warnings","errors","menuItems","reviewResultTypes","titleFormatter","count","values","checkingMsgFormatter","onValidate","showWarningAction","onWarningAction","onMoreHandleAction","formatMessage","__self","__source","fileName","_jsxFileName","lineNumber","columnNumber"],"sources":["/Users/qzheng/Documents/webroot/annotation_tools/src/components/multi-channel/components/Validator/index.tsx"],"sourcesContent":["import React from 'react';\nimport { observer } from 'mobx-react';\nimport CommonValidator, { IWarning } from '../../../common/tabs-menu/Validator';\nimport i18n from '../../locales';\nimport rootStore from '../../store/RootStore';\nimport { ValidationType, ReviewResult, Review, Warning } from '../../types';\nimport './index.scss';\n\ninterface ValidatorProps {\n  triggerValidation: () => Promise<boolean>;\n}\n\nclass Validator extends React.Component<ValidatorProps> {\n  // eslint-disable-next-line class-methods-use-this\n  getCategoryByWarning(warning: Warning) {\n    if (warning.warningType === ValidationType.GLOBAL_ERROR) return false;\n    const { id } = warning;\n    const instance = rootStore.instance.getInstanceById(id);\n    return (warning.isMissing) || instance;\n  }\n\n  handleSync = async () => {\n    await this.props.triggerValidation();\n  };\n\n  handleAction = (warning: IWarning) => {\n    const { id } = warning;\n    const instance = rootStore.instance.getInstanceById(id);\n    const iStart = (warning as any).start || instance.start;\n    if (iStart !== undefined) {\n      rootStore.instance.setSelectedInstance(id);\n    }\n  };\n\n  // eslint-disable-next-line class-methods-use-this\n  renderWarningTitle(warning: Warning) {\n    if (warning.warningType === ValidationType.GLOBAL_ERROR) return i18n.translate('VALIDATION_TYPE_GLOBAL');\n    if (warning.warningType === ValidationType.CHANNEL_ERROR) return i18n.translate('VALIDATION_TYPE_CHANNEL');\n    const { id, channelIndex, start } = warning;\n    const {\n      instance: { displayInstances, getInstanceById },\n      ontology: { categories, categoryLabelVisible },\n    } = rootStore;\n    const instance = getInstanceById(id);\n    const channel = instance?.channelIndex ?? channelIndex;\n    const category = instance?.category || (channel !== undefined && categories[channel]?.className);\n    const startTime = instance?.start !== undefined ? instance?.start : start;\n    if (startTime !== undefined && category) {\n      const instanceNum = displayInstances.findIndex((i) => i.id === id);\n      return `${categoryLabelVisible ? `${category}-` : ''}${instance && instanceNum >= 0 ? instanceNum + 1 : ''}`;\n    }\n    return i18n.translate('VALIDATION_NO_INSTANCE');\n  }\n\n  warningMoreHandleAction = (key: string, warning: IWarning) => {\n    if (key === ReviewResult.REJECT) return;\n    const { id } = warning;\n    const review: Review = {\n      instanceId: id,\n      result: key as ReviewResult\n    };\n    if (key === 'delete') {\n      rootStore.review.deleteReviewById(id);\n    } else {\n      rootStore.review.setReview(review);\n    }\n  };\n\n  render() {\n    const ValidationTypeTitle = {\n      [ValidationType.OVERLAP]: i18n.translate('VALIDATION_TYPE_OVERLAP'),\n      [ValidationType.ATTR_EMPTY]: i18n.translate('VALIDATION_TYPE_ATTR_EMPTY'),\n      [ValidationType.CUSTOM]: i18n.translate('VALIDATION_TYPE_CUSTOM'),\n      [ValidationType.QUALITY]: i18n.translate('VALIDATION_TYPE_QUALITY'),\n      [ValidationType.GLOBAL_ERROR]: i18n.translate('VALIDATION_TYPE_GLOBAL'),\n      [ValidationType.CHANNEL_ERROR]: i18n.translate('VALIDATION_TYPE_CHANNEL'),\n      [ValidationType.SCRIPT]: i18n.translate('VALIDATION_TYPE_SCRIPT'),\n      [ValidationType.DURATION_ILLEGAL]: i18n.translate('REGION_DURATON_ERROR'),\n    };\n    return (\n      <CommonValidator\n        isEnabled={rootStore.review.isEnabled}\n        validationTypes={ValidationTypeTitle}\n        warnings={rootStore.review.warnings as IWarning[]}\n        errors={rootStore.review.errors}\n        menuItems={rootStore.review.reviewResultTypes}\n        titleFormatter={(count) => i18n.translate('VALIDATION_TITLE', { values: { count } })}\n        checkingMsgFormatter={() => i18n.translate('VALIDATION_CHECKING')}\n        onValidate={this.handleSync}\n        renderWarningTitle={(warning) => this.renderWarningTitle(warning as IWarning)}\n        showWarningAction={(warning) => !!this.getCategoryByWarning(warning)}\n        onWarningAction={(warning) => this.handleAction(warning as IWarning)}\n        onMoreHandleAction={this.warningMoreHandleAction}\n        formatMessage={i18n.translate}\n      />\n    );\n  }\n}\n\nexport default observer(Validator);\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}