{"ast":null,"code":"import{makeAutoObservable,runInAction,toJS}from'mobx';import{v4 as uuidv4}from'uuid';import{Modal,message}from'antd';import{validate as validateForm}from'@appen-china/easy-form/es/utils';import{Base64}from'js-base64';import i18n from'./locales';import MAnswer from'./models/Answer';import ValidationStore from'./validationStore';import{ReviewMode}from'./types';import{ContentItemType,LLMModel,RankingType}from'../common/llm/types';import{contentToPlainText,isContentEmpty,parseContent}from'../common/llm/helper';import{InputType}from'../common/llm/input/InputWrapper';import{ToolMode,isAnnotationReadonly,isPreview,isReviewEditable,isRework,isTemplatePreview}from'../../utils/tool-mode';class Store{get hasError(){return this._hasError||this.hasRankError||this.hasItemAttrError;}set hasError(val){this._hasError=val;if(!val){this.hasRankError=val;this.hasItemAttrError=val;}}/**\n   * item rank has error\n   */ /**\n   * can add answer\n   */get canAddAnswer(){if(this.readonly||!this.addible){return false;}return true;}/**\n   * is tool readonly (annotate not allowed)\n   */get readonly(){return isAnnotationReadonly(this.jobProxy.toolMode)||this.reviewMode===ReviewMode.REVIEW;}/**\n   * is tool annotate allowed\n   */get annotatable(){return!isAnnotationReadonly(this.jobProxy.toolMode);}/**\n   * is tool review enabled\n   */get reviewable(){return isReviewEditable(this.jobProxy.toolMode);}/**\n   * is tool in labeling mode or template preview mode\n   */get isLabeling(){return this.jobProxy.toolMode===ToolMode.LABELING||this.isTemplatePreview;}/**\n   * is tool in rework mode\n   */get isRework(){return isRework(this.jobProxy.toolMode);}/**\n   * is tool in preview mode\n   */get isPreview(){return isPreview(this.jobProxy.toolMode);}/**\n   * is tool in template preview mode\n   */get isTemplatePreview(){return isTemplatePreview(this.jobProxy.toolMode);}isOriginalAnswer(val){let forceToolModeCheck=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;if(forceToolModeCheck&&this.isLabeling){return true;}return typeof val==='boolean'?val:this.isLabeling;}constructor(){/**\n   * job proxy\n   */this.jobProxy=void 0;/**\n   * is tool initialized\n   */this.initialized=false;/**\n   * labeling or review mode\n   */this.reviewMode=ReviewMode.LABELING;/**\n   * instruction\n   */this.instruction=[];/**\n   * question\n   */this.question=[];/**\n   * answers\n   */this.answers=[];/**\n   * subject\n   */this.subject=void 0;/**\n   * [config] global rank\n   */this.attributes=void 0;/**\n   * [config] global rank config\n   */this.attributesConfig='';/**\n   * [config] item attributes  config\n   */this.itemAttributesConfig=void 0;/**\n   * current selected answer\n   */this.selectedAnswer=void 0;/**\n   * is editing answer\n   */this.isEditingAnswer=false;/**\n   * is adding answer\n   */this.isAddingAnswer=false;/**\n   * is adding answer by real-time api\n   */this.isAddingAnswerByAPI=false;/**\n   * is ranking answer\n   */this.isRankingAnswer=false;/**\n   * is dragging answer\n   */this.isDraggingAnswer=false;/**\n   * is attributes editing\n   */this.isItemAttributesEditing=false;/**\n   * has error\n   */this._hasError=false;this.hasRankError=false;/**\n   * item attributes has error\n   */this.hasItemAttrError=false;/**\n   * [config] options for subject selection\n   */this.subjectOptions=[];/**\n   * [config] answers rank\n   */this.ranking=false;/**\n   * [config] ranking type (score / mark)\n   */this.rankingType=RankingType.SCORE;/**\n   * [config] options for ranking\n   */this.rankingOptions=[];/**\n   * [config] answers sortable\n   */this.sortable=false;/**\n   * [config] answers editable (only control original answers)\n   */this.editable=false;/**\n   * [config] can add new answers\n   */this.addible=false;/**\n   * [config] model used when add answer\n   */this.addModel=LLMModel.NONUSE;/**\n   * validation\n   */this.validation=void 0;/**\n * validation config\n */this.validationConfig={script:false};/**\n   * submit check\n   */this.submitCheck=false;/**\n   * editor types\n   */this.editorTypes=[InputType.DEFAULT];this.validateResult=()=>{// 1) check answer value\n// 2) check answer rank\n// 3) check answer item attributes\n// 4) check answer limit\nlet newlyAddedAnswersCount=0;this.answers.forEach(answer=>{if(!answer.original){newlyAddedAnswersCount+=1;if(isContentEmpty(answer.value)){this.selectedAnswer=answer;this.isEditingAnswer=true;this.hasError=true;throw new Error(i18n.translate('CHAT_ITEM_EMPTY_ERROR'));}}if(this.ranking&&this.rankingType===RankingType.SCORE&&this.rankingOptions.some(o=>{var _answer$rank,_answer$rank$scores;return((_answer$rank=answer.rank)===null||_answer$rank===void 0?void 0:(_answer$rank$scores=_answer$rank.scores)===null||_answer$rank$scores===void 0?void 0:_answer$rank$scores[o])===undefined;})){this.selectedAnswer=answer;this.isRankingAnswer=true;this.hasError=true;throw new Error(i18n.translate('CHAT_ITEM_RANK_EMPTY_ERROR'));}if(this.itemAttributesConfig){const{attributes}=answer;if(attributes){const validateRes=validateForm(this.itemAttributesConfig,attributes);if(!validateRes){this.selectedAnswer=answer;this.isItemAttributesEditing=true;this.hasItemAttrError=true;throw new Error(i18n.translate('CHAT_ITEM_ATTR_EMPTY_ERROR'));}}}});};this.setSubject=subject=>{this.subject=subject;};this.setAttributesConfig=attributes=>{this.attributes=attributes;};this.validate=()=>{if(this.isAddingAnswer||this.isAddingAnswerByAPI){this.catchSaveError();throw new Error('should finish adding');}if(this.selectedAnswer){if(this.isRankingAnswer&&this.rankingType===RankingType.SCORE&&this.rankingOptions.some(o=>{var _this$selectedAnswer,_this$selectedAnswer$,_this$selectedAnswer$2;return((_this$selectedAnswer=this.selectedAnswer)===null||_this$selectedAnswer===void 0?void 0:(_this$selectedAnswer$=_this$selectedAnswer.rank)===null||_this$selectedAnswer$===void 0?void 0:(_this$selectedAnswer$2=_this$selectedAnswer$.scores)===null||_this$selectedAnswer$2===void 0?void 0:_this$selectedAnswer$2[o])===undefined;})){this.catchRankError();throw new Error('should finish ranking');}if(this.isItemAttributesEditing&&this.itemAttributesConfig){const{attributes}=this.selectedAnswer;if(attributes){const validateRes=validateForm(this.itemAttributesConfig,attributes);if(!validateRes){this.catchItemAttributesError();throw new Error('should finish the item attributes form');}}}}};this.validateItem=()=>{try{this.validate();this.hasError=false;this.isRankingAnswer=false;this.isItemAttributesEditing=false;}catch(e){// validate failed\n}};this.selectAnswer=answer=>{var _this$selectedAnswer2;if(((_this$selectedAnswer2=this.selectedAnswer)===null||_this$selectedAnswer2===void 0?void 0:_this$selectedAnswer2.id)===answer.id){return;}try{this.validate();this.hasError=false;this.selectedAnswer=answer;this.isEditingAnswer=false;this.isRankingAnswer=false;this.isItemAttributesEditing=false;}catch(e){// validate failed\n}};this.getQuestionItemContent=()=>{if(this.question){const content=contentToPlainText(this.question);return[{role:'user',content}];}return null;};// addAnswerByAPI = () => {\n//   if (this.readonly || !this.canAddAnswer) {\n//     return;\n//   }\n//   try {\n//     this.validate();\n//     this.hasError = false;\n//     this.selectedAnswer = undefined;\n//     this.isEditingAnswer = false;\n//     this.isRankingAnswer = false;\n//     this.isItemAttributesEditing = false;\n//     this.isAddingAnswerByAPI = true;\n//   } catch (e) {\n//     // validate failed\n//   }\n//   const messages = this.getQuestionItemContent();\n//   if (!messages) {\n//     message.error(i18n.translate('CHAT_ITEM_GENERATE_NO_QUESTION'));\n//     return;\n//   }\n//   const data = {\n//     messages,\n//     stream: false,\n//     temperature: 0.5,\n//     presence_penalty: 0,\n//     frequency_penalty: 0,\n//   };\n//   const apiForwardType = {\n//     [LLMModel.CHAT_GPT]: APIForwardType.CHAT_GPT,\n//     [LLMModel.CHAT_GPT_4]: APIForwardType.CHAT_GPT_4,\n//   };\n//   this.jobProxy?.forwardAPI(apiForwardType[(this.addModel as LLMModel.CHAT_GPT | LLMModel.CHAT_GPT_4)], data).then((res) => {\n//     if (!res || res.error) {\n//       message.error(res?.msg || i18n.translate('CHAT_ITEM_GENERATE_FAIL'));\n//       this.cancelSaveAnswerByAPI();\n//       return;\n//     }\n//     if (res && Array.isArray(res) && res.length > 0) {\n//       this.generateAnswerItem(res[0].message.content);\n//     }\n//   });\n// };\nthis.generateAnswerItem=value=>{if(this.readonly){return;}this.hasError=false;if(this.isAddingAnswerByAPI){// add new answer\nconst newAnswer=new MAnswer({id:uuidv4(),original:false,value:[{type:ContentItemType.UNSTYLED,content:value}],originalValue:[{type:ContentItemType.UNSTYLED,content:value}],model:this.addModel});this.answers.push(newAnswer);this.selectedAnswer=newAnswer;if(!this.readonly&&this.ranking){this.isRankingAnswer=true;}}this.cancelSaveAnswerByAPI();};this.cancelSaveAnswerByAPI=()=>{this.isAddingAnswerByAPI=false;};this.addAnswer=()=>{if(this.readonly||!this.canAddAnswer){return;}try{this.validate();this.hasError=false;this.selectedAnswer=undefined;this.isEditingAnswer=false;this.isRankingAnswer=false;this.isItemAttributesEditing=false;this.isAddingAnswer=true;}catch(e){// validate failed\n}};this.editAnswer=answer=>{var _this$selectedAnswer3;if(this.readonly||answer.original&&!this.editable){return;}if(((_this$selectedAnswer3=this.selectedAnswer)===null||_this$selectedAnswer3===void 0?void 0:_this$selectedAnswer3.id)===answer.id){this.isEditingAnswer=true;return;}try{this.validate();this.hasError=false;this.selectedAnswer=answer;this.isRankingAnswer=false;this.isItemAttributesEditing=false;this.isEditingAnswer=true;}catch(e){// validate failed\n}};this.saveAnswer=value=>{if(this.readonly){return;}if(this.isAddingAnswer){// add new answer\nconst newAnswer=new MAnswer({id:uuidv4(),original:false,value});this.answers.push(newAnswer);this.selectedAnswer=newAnswer;if(!this.readonly&&this.ranking){this.isRankingAnswer=true;}}else if(this.isEditingAnswer&&this.selectedAnswer){// update answer\nthis.selectedAnswer.value=value;}this.cancelSaveAnswer();};this.updateAnswer=(answer,value)=>{if(this.readonly||this.isAddingAnswer||this.isEditingAnswer){return;}answer.value=value;};this.cancelSaveAnswer=()=>{this.isEditingAnswer=false;this.isAddingAnswer=false;};this.catchSaveError=msg=>{this.hasError=true;message.error(msg||i18n.translate('CHAT_ITEM_EMPTY_ERROR'));};this.rankAnswer=answer=>{if(this.readonly||!this.ranking){return;}try{var _this$selectedAnswer4;this.validate();this.hasError=false;if(((_this$selectedAnswer4=this.selectedAnswer)===null||_this$selectedAnswer4===void 0?void 0:_this$selectedAnswer4.id)!==answer.id){this.isItemAttributesEditing=false;}this.selectedAnswer=answer;this.isEditingAnswer=false;this.isRankingAnswer=true;}catch(e){// validate failed\n}};this.saveRank=(answer,rank)=>{var _this$selectedAnswer5;if(this.readonly){return;}if(((_this$selectedAnswer5=this.selectedAnswer)===null||_this$selectedAnswer5===void 0?void 0:_this$selectedAnswer5.id)!==answer.id){try{this.validate();this.hasError=false;this.isItemAttributesEditing=false;}catch(e){// validate failed\nreturn;}}this.isRankingAnswer=true;this.selectedAnswer=answer;this.selectedAnswer.rank=rank;};this.catchRankError=msg=>{this.hasRankError=true;message.error(msg||i18n.translate('CHAT_ITEM_RANK_EMPTY_ERROR'));};this.onItemAttributesEdit=answer=>{var _this$selectedAnswer6;if(this.readonly||!this.itemAttributesConfig){return;}try{this.validate();this.hasError=false;}catch(e){// validate failed\nreturn;}if(((_this$selectedAnswer6=this.selectedAnswer)===null||_this$selectedAnswer6===void 0?void 0:_this$selectedAnswer6.id)!==answer.id){this.isRankingAnswer=false;}this.selectedAnswer=answer;this.isEditingAnswer=false;this.isItemAttributesEditing=true;};this.setItemAttributes=(answer,attributes)=>{var _this$selectedAnswer7;if(this.readonly){return;}if(((_this$selectedAnswer7=this.selectedAnswer)===null||_this$selectedAnswer7===void 0?void 0:_this$selectedAnswer7.id)!==answer.id){try{this.validate();this.hasError=false;}catch(e){// validate failed\nreturn;}}this.selectedAnswer=answer;this.selectedAnswer.attributes=attributes;};this.deleteItemAttributes=answer=>{Modal.confirm({title:i18n.translate('CHAT_ITEM_DEL_TITLE'),okText:i18n.translate('CHAT_ITEM_DEL_OK'),cancelText:i18n.translate('CHAT_ITEM_DEL_CANCEL'),onOk:()=>{this.setItemAttributes(answer,undefined);this.isItemAttributesEditing=false;}});};this.saveItemAttributes=(answer,attributes)=>{this.setItemAttributes(answer,attributes);this.isItemAttributesEditing=true;};this.catchItemAttributesError=msg=>{this.hasItemAttrError=true;message.error(msg||i18n.translate('CHAT_ITEM_ATTR_EMPTY_ERROR'));};this.updateAnswerOrder=(source,destination)=>{if(destination===undefined){return;}const currIndex=this.answers.findIndex(i=>i.id===source);if(currIndex<0||currIndex===destination){return;}const currAnswer=this.answers[currIndex];this.answers.splice(currIndex,1);this.answers.splice(destination,0,currAnswer);this.isDraggingAnswer=false;};makeAutoObservable(this,{jobProxy:false});}async init(payload){this.initConfig(payload);this.initValidate();try{await this.loadResult();}catch(e){// load error\n}runInAction(()=>{if(this.question.length===0&&payload.question){// no question loaded, try get question from payload\nthis.question=[{type:ContentItemType.UNSTYLED,content:payload.question}];}this.initialized=true;});}initValidate(){this.validation=new ValidationStore(this);}initConfig(payload){// subject\nif(typeof payload.subjects==='string'){const subjectsSplits=payload.subjects.split(',').map(i=>i.trim()).filter(i=>!!i);if(subjectsSplits.length>0){this.subjectOptions=Array.from(new Set(subjectsSplits));}}// attributes_config\nif(typeof payload.attributes_config==='string'){this.attributesConfig=payload.attributes_config;}// item_attributes_config\nif(typeof payload.item_attributes_config==='string'){const configStr=Base64.decode(payload.item_attributes_config||'');if(configStr){try{const parsedConfig=JSON.parse(configStr);this.itemAttributesConfig=parsedConfig;}catch(error){// parse error\n}}}// ranking\nthis.ranking=payload.ranking===true||payload.ranking==='true';if(this.ranking){if(Object.values(RankingType).includes(payload.ranking_type)){this.rankingType=payload.ranking_type;}if(typeof payload.ranking_options==='string'){const optionsSplits=payload.ranking_options.split(',').map(i=>i.trim()).filter(i=>!!i);if(optionsSplits.length>0){this.rankingOptions=[...optionsSplits];}}}// sortable\nthis.sortable=payload.sortable===true||payload.sortable==='true';// editable\nthis.editable=payload.editable===true||payload.editable==='true';// addible\nthis.addible=payload.addible===true||payload.addible==='true';if(this.addible){if(Object.values(LLMModel).includes(payload.add_model)){this.addModel=payload.add_model;}}}async loadResult(){const savedResult=await this.jobProxy.loadSavedResult();const reviewFromResult=await this.jobProxy.loadReviewFrom();const result=savedResult||reviewFromResult;if(!result){return;}if(result.auditId){this.jobProxy.setAuditId(result.auditId);}// parse result\nconst{desc,input,output,attributes,instruction}=result;if(typeof desc==='string'&&desc){this.subject=desc;}if(attributes){this.attributes=attributes;}this.instruction=parseContent(instruction);this.question=parseContent(input);if(Array.isArray(output)&&output.length>0){const answers=[];output.forEach(o=>{if(typeof o==='string'){answers.push(new MAnswer({id:uuidv4(),original:this.isLabeling,value:[{type:ContentItemType.UNSTYLED,content:o}],...(this.isLabeling&&{originalValue:[{type:ContentItemType.UNSTYLED,content:o}]})}));}else if(typeof o==='object'){const original=this.isOriginalAnswer(o.original,!savedResult);const value=parseContent(o.value);let originalValue;if(o.originalValue){originalValue=parseContent(o.originalValue);}else if(original){originalValue=value;}answers.push(new MAnswer({id:o.id||uuidv4(),original,value,originalValue,rank:o.rank,attributes:o.attributes,model:o.model,sourceModelId:o.sourceModelId}));}});this.answers=answers;}}async saveResult(){let submit=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;if(submit&&this.annotatable){this.validateResult();}return this.jobProxy.saveResult({instruction:toJS(this.instruction),attributes:toJS(this.attributes),desc:this.subject,input:toJS(this.question),output:this.answers.map(answer=>answer.toJSON()),modelInput:this.generateModelInput(),auditId:this.jobProxy.auditId,templateConfig:this.jobProxy.templateConfig},submit);}saveReviews(){let submit=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;}// TODO:\ngenerateModelInput(){return{desc:this.subject,input:contentToPlainText(this.question),output:this.answers.map(answer=>({value:contentToPlainText(answer.value),rank:toJS(answer.rank),attributes:toJS(answer.attributes),sourceModelId:answer.sourceModelId}))};}}export default new Store();","map":{"version":3,"names":["makeAutoObservable","runInAction","toJS","v4","uuidv4","Modal","message","validate","validateForm","Base64","i18n","MAnswer","ValidationStore","ReviewMode","ContentItemType","LLMModel","RankingType","contentToPlainText","isContentEmpty","parseContent","InputType","ToolMode","isAnnotationReadonly","isPreview","isReviewEditable","isRework","isTemplatePreview","Store","hasError","_hasError","hasRankError","hasItemAttrError","val","canAddAnswer","readonly","addible","jobProxy","toolMode","reviewMode","REVIEW","annotatable","reviewable","isLabeling","LABELING","isOriginalAnswer","forceToolModeCheck","arguments","length","undefined","constructor","initialized","instruction","question","answers","subject","attributes","attributesConfig","itemAttributesConfig","selectedAnswer","isEditingAnswer","isAddingAnswer","isAddingAnswerByAPI","isRankingAnswer","isDraggingAnswer","isItemAttributesEditing","subjectOptions","ranking","rankingType","SCORE","rankingOptions","sortable","editable","addModel","NONUSE","validation","validationConfig","script","submitCheck","editorTypes","DEFAULT","validateResult","newlyAddedAnswersCount","forEach","answer","original","value","Error","translate","some","o","_answer$rank","_answer$rank$scores","rank","scores","validateRes","setSubject","setAttributesConfig","catchSaveError","_this$selectedAnswer","_this$selectedAnswer$","_this$selectedAnswer$2","catchRankError","catchItemAttributesError","validateItem","e","selectAnswer","_this$selectedAnswer2","id","getQuestionItemContent","content","role","generateAnswerItem","newAnswer","type","UNSTYLED","originalValue","model","push","cancelSaveAnswerByAPI","addAnswer","editAnswer","_this$selectedAnswer3","saveAnswer","cancelSaveAnswer","updateAnswer","msg","error","rankAnswer","_this$selectedAnswer4","saveRank","_this$selectedAnswer5","onItemAttributesEdit","_this$selectedAnswer6","setItemAttributes","_this$selectedAnswer7","deleteItemAttributes","confirm","title","okText","cancelText","onOk","saveItemAttributes","updateAnswerOrder","source","destination","currIndex","findIndex","i","currAnswer","splice","init","payload","initConfig","initValidate","loadResult","subjects","subjectsSplits","split","map","trim","filter","Array","from","Set","attributes_config","item_attributes_config","configStr","decode","parsedConfig","JSON","parse","Object","values","includes","ranking_type","ranking_options","optionsSplits","add_model","savedResult","loadSavedResult","reviewFromResult","loadReviewFrom","result","auditId","setAuditId","desc","input","output","isArray","sourceModelId","saveResult","submit","toJSON","modelInput","generateModelInput","templateConfig","saveReviews"],"sources":["/Users/qzheng/Documents/webroot/annotation_tools/src/components/question-answering/store.ts"],"sourcesContent":["import { makeAutoObservable, runInAction, toJS } from 'mobx';\nimport { v4 as uuidv4 } from 'uuid';\nimport { Modal, message } from 'antd';\nimport { validate as validateForm } from '@appen-china/easy-form/es/utils';\nimport { FormConfig } from '@appen-china/easy-form/es/types';\nimport { Base64 } from 'js-base64';\nimport i18n from './locales';\nimport MAnswer from './models/Answer';\nimport ValidationStore from './validationStore';\nimport { Payload, ReviewMode } from './types';\nimport { Content, ContentItemType, LLMModel, Rank, RankingType } from '../common/llm/types';\nimport { contentToPlainText, isContentEmpty, parseContent } from '../common/llm/helper';\nimport { InputType } from '../common/llm/input/InputWrapper';\nimport JobProxy from '../../libs/JobProxy';\nimport { ToolMode, isAnnotationReadonly, isPreview, isReviewEditable, isRework, isTemplatePreview } from '../../utils/tool-mode';\n\nclass Store {\n  /**\n   * job proxy\n   */\n  jobProxy?: JobProxy;\n\n  /**\n   * is tool initialized\n   */\n  initialized = false;\n\n  /**\n   * labeling or review mode\n   */\n  reviewMode = ReviewMode.LABELING;\n\n  /**\n   * instruction\n   */\n  instruction: Content = [];\n\n  /**\n   * question\n   */\n  question: Content = [];\n\n  /**\n   * answers\n   */\n  answers: MAnswer[] = [];\n\n  /**\n   * subject\n   */\n  subject?: string;\n\n  /**\n   * [config] global rank\n   */\n  attributes: { [key: string]: any; } | undefined;\n\n  /**\n   * [config] global rank config\n   */\n  attributesConfig = '';\n\n  /**\n   * [config] item attributes  config\n   */\n  itemAttributesConfig?: FormConfig;\n\n  /**\n   * current selected answer\n   */\n  selectedAnswer?: MAnswer;\n\n  /**\n   * is editing answer\n   */\n  isEditingAnswer = false;\n\n  /**\n   * is adding answer\n   */\n  isAddingAnswer = false;\n\n  /**\n   * is adding answer by real-time api\n   */\n  isAddingAnswerByAPI = false;\n\n  /**\n   * is ranking answer\n   */\n  isRankingAnswer = false;\n\n  /**\n   * is dragging answer\n   */\n  isDraggingAnswer = false;\n\n  /**\n   * is attributes editing\n   */\n  isItemAttributesEditing = false;\n\n  /**\n   * has error\n   */\n  _hasError = false;\n\n  get hasError() {\n    return this._hasError || this.hasRankError || this.hasItemAttrError;\n  }\n\n  set hasError(val: boolean) {\n    this._hasError = val;\n    if (!val) {\n      this.hasRankError = val;\n      this.hasItemAttrError = val;\n    }\n  }\n\n  /**\n   * item rank has error\n   */\n  hasRankError = false;\n\n  /**\n   * item attributes has error\n   */\n  hasItemAttrError = false;\n\n  /**\n   * [config] options for subject selection\n   */\n  subjectOptions: string[] = [];\n\n  /**\n   * [config] answers rank\n   */\n  ranking = false;\n\n  /**\n   * [config] ranking type (score / mark)\n   */\n  rankingType = RankingType.SCORE;\n\n  /**\n   * [config] options for ranking\n   */\n  rankingOptions: string[] = [];\n\n  /**\n   * [config] answers sortable\n   */\n  sortable = false;\n\n  /**\n   * [config] answers editable (only control original answers)\n   */\n  editable = false;\n\n  /**\n   * [config] can add new answers\n   */\n  addible = false;\n\n  /**\n   * [config] model used when add answer\n   */\n  addModel = LLMModel.NONUSE;\n\n  /**\n   * validation\n   */\n  validation: ValidationStore | undefined;\n\n  /**\n * validation config\n */\n  validationConfig = { script: false };\n\n  /**\n   * submit check\n   */\n  submitCheck = false;\n\n  /**\n   * editor types\n   */\n  editorTypes = [InputType.DEFAULT];\n\n  /**\n   * can add answer\n   */\n  get canAddAnswer() {\n    if (this.readonly || !this.addible) {\n      return false;\n    }\n\n    return true;\n  }\n\n  /**\n   * is tool readonly (annotate not allowed)\n   */\n  get readonly() {\n    return isAnnotationReadonly(this.jobProxy!.toolMode) || this.reviewMode === ReviewMode.REVIEW;\n  }\n\n  /**\n   * is tool annotate allowed\n   */\n  get annotatable() {\n    return !isAnnotationReadonly(this.jobProxy!.toolMode);\n  }\n\n  /**\n   * is tool review enabled\n   */\n  get reviewable() {\n    return isReviewEditable(this.jobProxy!.toolMode);\n  }\n\n  /**\n   * is tool in labeling mode or template preview mode\n   */\n  get isLabeling() {\n    return this.jobProxy!.toolMode === ToolMode.LABELING || this.isTemplatePreview;\n  }\n\n  /**\n   * is tool in rework mode\n   */\n  get isRework() {\n    return isRework(this.jobProxy!.toolMode);\n  }\n\n  /**\n   * is tool in preview mode\n   */\n  get isPreview() {\n    return isPreview(this.jobProxy!.toolMode);\n  }\n\n  /**\n   * is tool in template preview mode\n   */\n  get isTemplatePreview() {\n    return isTemplatePreview(this.jobProxy!.toolMode);\n  }\n\n  isOriginalAnswer(val: unknown, forceToolModeCheck = false) {\n    if (forceToolModeCheck && this.isLabeling) {\n      return true;\n    }\n    return typeof val === 'boolean' ? val : this.isLabeling;\n  }\n\n  constructor() {\n    makeAutoObservable(this, {\n      jobProxy: false,\n    });\n  }\n\n  async init(payload: Payload) {\n    this.initConfig(payload);\n    this.initValidate();\n    try {\n      await this.loadResult();\n    } catch (e) {\n      // load error\n    }\n\n    runInAction(() => {\n      if (this.question.length === 0 && payload.question) {\n        // no question loaded, try get question from payload\n        this.question = [{\n          type: ContentItemType.UNSTYLED,\n          content: payload.question,\n        }];\n      }\n      this.initialized = true;\n    });\n  }\n\n  initValidate() {\n    this.validation = new ValidationStore(this);\n  }\n\n  initConfig(payload: Payload) {\n    // subject\n    if (typeof payload.subjects === 'string') {\n      const subjectsSplits = payload.subjects.split(',').map((i) => i.trim()).filter((i) => !!i);\n      if (subjectsSplits.length > 0) {\n        this.subjectOptions = Array.from(new Set(subjectsSplits));\n      }\n    }\n\n    // attributes_config\n    if (typeof payload.attributes_config === 'string') {\n      this.attributesConfig = payload.attributes_config;\n    }\n\n    // item_attributes_config\n    if (typeof payload.item_attributes_config === 'string') {\n      const configStr = Base64.decode(payload.item_attributes_config || '');\n      if (configStr) {\n        try {\n          const parsedConfig = JSON.parse(configStr);\n          this.itemAttributesConfig = parsedConfig;\n        } catch (error) {\n          // parse error\n        }\n      }\n    }\n\n    // ranking\n    this.ranking = payload.ranking === true || payload.ranking === 'true';\n    if (this.ranking) {\n      if (Object.values(RankingType).includes(payload.ranking_type as RankingType)) {\n        this.rankingType = payload.ranking_type as RankingType;\n      }\n      if (typeof payload.ranking_options === 'string') {\n        const optionsSplits = payload.ranking_options.split(',').map((i) => i.trim()).filter((i) => !!i);\n        if (optionsSplits.length > 0) {\n          this.rankingOptions = [...optionsSplits];\n        }\n      }\n    }\n\n    // sortable\n    this.sortable = payload.sortable === true || payload.sortable === 'true';\n\n    // editable\n    this.editable = payload.editable === true || payload.editable === 'true';\n\n    // addible\n    this.addible = payload.addible === true || payload.addible === 'true';\n    if (this.addible) {\n      if (Object.values(LLMModel).includes(payload.add_model as LLMModel)) {\n        this.addModel = payload.add_model as LLMModel;\n      }\n    }\n  }\n\n  async loadResult() {\n    const savedResult = await this.jobProxy!.loadSavedResult();\n    const reviewFromResult = await this.jobProxy!.loadReviewFrom();\n\n    const result = savedResult || reviewFromResult;\n    if (!result) {\n      return;\n    }\n    if (result.auditId) {\n      this.jobProxy!.setAuditId(result.auditId);\n    }\n\n    // parse result\n    const { desc, input, output, attributes, instruction } = result;\n    if (typeof desc === 'string' && desc) {\n      this.subject = desc;\n    }\n\n    if (attributes) {\n      this.attributes = attributes;\n    }\n    this.instruction = parseContent(instruction);\n    this.question = parseContent(input);\n    if (Array.isArray(output) && output.length > 0) {\n      const answers: MAnswer[] = [];\n      output.forEach((o) => {\n        if (typeof o === 'string') {\n          answers.push(new MAnswer({\n            id: uuidv4(),\n            original: this.isLabeling,\n            value: [{\n              type: ContentItemType.UNSTYLED,\n              content: o,\n            }],\n            ...this.isLabeling && {\n              originalValue: [{\n                type: ContentItemType.UNSTYLED,\n                content: o,\n              }],\n            },\n          }));\n        } else if (typeof o === 'object') {\n          const original = this.isOriginalAnswer(o.original, !savedResult);\n          const value = parseContent(o.value);\n          let originalValue;\n          if (o.originalValue) {\n            originalValue = parseContent(o.originalValue);\n          } else if (original) {\n            originalValue = value;\n          }\n          answers.push(new MAnswer({\n            id: o.id || uuidv4(),\n            original,\n            value,\n            originalValue,\n            rank: o.rank,\n            attributes: o.attributes,\n            model: o.model,\n            sourceModelId: o.sourceModelId,\n          }));\n        }\n      });\n      this.answers = answers;\n    }\n  }\n\n  async saveResult(submit = false) {\n    if (submit && this.annotatable) {\n      this.validateResult();\n    }\n    return this.jobProxy!.saveResult({\n      instruction: toJS(this.instruction),\n      attributes: toJS(this.attributes),\n      desc: this.subject,\n      input: toJS(this.question),\n      output: this.answers.map((answer) => answer.toJSON()),\n      modelInput: this.generateModelInput(),\n      auditId: this.jobProxy!.auditId,\n      templateConfig: this.jobProxy!.templateConfig,\n    }, submit);\n  }\n\n  saveReviews(submit = false) {\n    // TODO:\n  }\n\n  generateModelInput() {\n    return {\n      desc: this.subject,\n      input: contentToPlainText(this.question),\n      output: this.answers.map((answer) => ({\n        value: contentToPlainText(answer.value),\n        rank: toJS(answer.rank),\n        attributes: toJS(answer.attributes),\n        sourceModelId: answer.sourceModelId,\n      })),\n    };\n  }\n\n  validateResult = () => {\n    // 1) check answer value\n    // 2) check answer rank\n    // 3) check answer item attributes\n    // 4) check answer limit\n    let newlyAddedAnswersCount = 0;\n    this.answers.forEach((answer) => {\n      if (!answer.original) {\n        newlyAddedAnswersCount += 1;\n        if (isContentEmpty(answer.value)) {\n          this.selectedAnswer = answer;\n          this.isEditingAnswer = true;\n          this.hasError = true;\n          throw new Error(i18n.translate('CHAT_ITEM_EMPTY_ERROR'));\n        }\n      }\n      if (this.ranking && this.rankingType === RankingType.SCORE\n        && this.rankingOptions.some((o) => answer.rank?.scores?.[o] === undefined)) {\n        this.selectedAnswer = answer;\n        this.isRankingAnswer = true;\n        this.hasError = true;\n        throw new Error(i18n.translate('CHAT_ITEM_RANK_EMPTY_ERROR'));\n      }\n      if (this.itemAttributesConfig) {\n        const { attributes } = answer;\n        if (attributes) {\n          const validateRes = validateForm(this.itemAttributesConfig, attributes);\n          if (!validateRes) {\n            this.selectedAnswer = answer;\n            this.isItemAttributesEditing = true;\n            this.hasItemAttrError = true;\n            throw new Error(i18n.translate('CHAT_ITEM_ATTR_EMPTY_ERROR'));\n          }\n        }\n      }\n    });\n  };\n\n  setSubject = (subject: string) => {\n    this.subject = subject;\n  };\n\n  setAttributesConfig = (attributes: any) => {\n    this.attributes = attributes;\n  };\n\n  validate = () => {\n    if (this.isAddingAnswer || this.isAddingAnswerByAPI) {\n      this.catchSaveError();\n      throw new Error('should finish adding');\n    }\n    if (this.selectedAnswer) {\n      if (this.isRankingAnswer && this.rankingType === RankingType.SCORE\n        && this.rankingOptions.some((o) => this.selectedAnswer?.rank?.scores?.[o] === undefined)) {\n        this.catchRankError();\n        throw new Error('should finish ranking');\n      }\n      if (this.isItemAttributesEditing && this.itemAttributesConfig) {\n        const { attributes } = this.selectedAnswer;\n        if (attributes) {\n          const validateRes = validateForm(this.itemAttributesConfig, attributes);\n          if (!validateRes) {\n            this.catchItemAttributesError();\n            throw new Error('should finish the item attributes form');\n          }\n        }\n      }\n    }\n  };\n\n  validateItem = () => {\n    try {\n      this.validate();\n      this.hasError = false;\n      this.isRankingAnswer = false;\n      this.isItemAttributesEditing = false;\n    } catch (e) {\n      // validate failed\n    }\n  };\n\n  selectAnswer = (answer: MAnswer) => {\n    if (this.selectedAnswer?.id === answer.id) {\n      return;\n    }\n    try {\n      this.validate();\n      this.hasError = false;\n      this.selectedAnswer = answer;\n      this.isEditingAnswer = false;\n      this.isRankingAnswer = false;\n      this.isItemAttributesEditing = false;\n    } catch (e) {\n      // validate failed\n    }\n  };\n\n  getQuestionItemContent = () => {\n    if (this.question) {\n      const content = contentToPlainText(this.question);\n      return [\n        {\n          role: 'user',\n          content,\n        }\n      ];\n    }\n    return null;\n  };\n\n  // addAnswerByAPI = () => {\n  //   if (this.readonly || !this.canAddAnswer) {\n  //     return;\n  //   }\n  //   try {\n  //     this.validate();\n  //     this.hasError = false;\n  //     this.selectedAnswer = undefined;\n  //     this.isEditingAnswer = false;\n  //     this.isRankingAnswer = false;\n  //     this.isItemAttributesEditing = false;\n  //     this.isAddingAnswerByAPI = true;\n  //   } catch (e) {\n  //     // validate failed\n  //   }\n  //   const messages = this.getQuestionItemContent();\n  //   if (!messages) {\n  //     message.error(i18n.translate('CHAT_ITEM_GENERATE_NO_QUESTION'));\n  //     return;\n  //   }\n  //   const data = {\n  //     messages,\n  //     stream: false,\n  //     temperature: 0.5,\n  //     presence_penalty: 0,\n  //     frequency_penalty: 0,\n  //   };\n  //   const apiForwardType = {\n  //     [LLMModel.CHAT_GPT]: APIForwardType.CHAT_GPT,\n  //     [LLMModel.CHAT_GPT_4]: APIForwardType.CHAT_GPT_4,\n  //   };\n  //   this.jobProxy?.forwardAPI(apiForwardType[(this.addModel as LLMModel.CHAT_GPT | LLMModel.CHAT_GPT_4)], data).then((res) => {\n  //     if (!res || res.error) {\n  //       message.error(res?.msg || i18n.translate('CHAT_ITEM_GENERATE_FAIL'));\n  //       this.cancelSaveAnswerByAPI();\n  //       return;\n  //     }\n  //     if (res && Array.isArray(res) && res.length > 0) {\n  //       this.generateAnswerItem(res[0].message.content);\n  //     }\n  //   });\n  // };\n\n  generateAnswerItem = (value: string) => {\n    if (this.readonly) {\n      return;\n    }\n    this.hasError = false;\n\n    if (this.isAddingAnswerByAPI) {\n      // add new answer\n      const newAnswer = new MAnswer({\n        id: uuidv4(),\n        original: false,\n        value: [{\n          type: ContentItemType.UNSTYLED,\n          content: value,\n        }],\n        originalValue: [{\n          type: ContentItemType.UNSTYLED,\n          content: value,\n        }],\n        model: this.addModel,\n      });\n      this.answers.push(newAnswer);\n      this.selectedAnswer = newAnswer;\n      if (!this.readonly && this.ranking) {\n        this.isRankingAnswer = true;\n      }\n    }\n    this.cancelSaveAnswerByAPI();\n  };\n\n  cancelSaveAnswerByAPI = () => {\n    this.isAddingAnswerByAPI = false;\n  };\n\n  addAnswer = () => {\n    if (this.readonly || !this.canAddAnswer) {\n      return;\n    }\n    try {\n      this.validate();\n      this.hasError = false;\n      this.selectedAnswer = undefined;\n      this.isEditingAnswer = false;\n      this.isRankingAnswer = false;\n      this.isItemAttributesEditing = false;\n      this.isAddingAnswer = true;\n    } catch (e) {\n      // validate failed\n    }\n  };\n\n  editAnswer = (answer: MAnswer) => {\n    if (this.readonly || (answer.original && !this.editable)) {\n      return;\n    }\n    if (this.selectedAnswer?.id === answer.id) {\n      this.isEditingAnswer = true;\n      return;\n    }\n    try {\n      this.validate();\n      this.hasError = false;\n      this.selectedAnswer = answer;\n      this.isRankingAnswer = false;\n      this.isItemAttributesEditing = false;\n      this.isEditingAnswer = true;\n    } catch (e) {\n      // validate failed\n    }\n  };\n\n  saveAnswer = (value: Content) => {\n    if (this.readonly) {\n      return;\n    }\n    if (this.isAddingAnswer) {\n      // add new answer\n      const newAnswer = new MAnswer({\n        id: uuidv4(),\n        original: false,\n        value,\n      });\n      this.answers.push(newAnswer);\n      this.selectedAnswer = newAnswer;\n      if (!this.readonly && this.ranking) {\n        this.isRankingAnswer = true;\n      }\n    } else if (this.isEditingAnswer && this.selectedAnswer) {\n      // update answer\n      this.selectedAnswer.value = value;\n    }\n    this.cancelSaveAnswer();\n  };\n\n  updateAnswer = (answer: MAnswer, value: Content) => {\n    if (this.readonly || this.isAddingAnswer || this.isEditingAnswer) {\n      return;\n    }\n    answer.value = value;\n  };\n\n  cancelSaveAnswer = () => {\n    this.isEditingAnswer = false;\n    this.isAddingAnswer = false;\n  };\n\n  catchSaveError = (msg?: string) => {\n    this.hasError = true;\n    message.error(msg || i18n.translate('CHAT_ITEM_EMPTY_ERROR'));\n  };\n\n  rankAnswer = (answer: MAnswer) => {\n    if (this.readonly || !this.ranking) {\n      return;\n    }\n    try {\n      this.validate();\n      this.hasError = false;\n      if (this.selectedAnswer?.id !== answer.id) {\n        this.isItemAttributesEditing = false;\n      }\n      this.selectedAnswer = answer;\n      this.isEditingAnswer = false;\n      this.isRankingAnswer = true;\n    } catch (e) {\n      // validate failed\n    }\n  };\n\n  saveRank = (answer: MAnswer, rank: Rank) => {\n    if (this.readonly) {\n      return;\n    }\n    if (this.selectedAnswer?.id !== answer.id) {\n      try {\n        this.validate();\n        this.hasError = false;\n        this.isItemAttributesEditing = false;\n      } catch (e) {\n        // validate failed\n        return;\n      }\n    }\n    this.isRankingAnswer = true;\n    this.selectedAnswer = answer;\n    this.selectedAnswer.rank = rank;\n  };\n\n  catchRankError = (msg?: string) => {\n    this.hasRankError = true;\n    message.error(msg || i18n.translate('CHAT_ITEM_RANK_EMPTY_ERROR'));\n  };\n\n  onItemAttributesEdit = (answer: MAnswer) => {\n    if (this.readonly || !this.itemAttributesConfig) {\n      return;\n    }\n    try {\n      this.validate();\n      this.hasError = false;\n    } catch (e) {\n      // validate failed\n      return;\n    }\n    if (this.selectedAnswer?.id !== answer.id) {\n      this.isRankingAnswer = false;\n    }\n    this.selectedAnswer = answer;\n    this.isEditingAnswer = false;\n    this.isItemAttributesEditing = true;\n  };\n\n  setItemAttributes = (answer: MAnswer, attributes: any) => {\n    if (this.readonly) {\n      return;\n    }\n    if (this.selectedAnswer?.id !== answer.id) {\n      try {\n        this.validate();\n        this.hasError = false;\n      } catch (e) {\n        // validate failed\n        return;\n      }\n    }\n    this.selectedAnswer = answer;\n    this.selectedAnswer.attributes = attributes;\n  };\n\n  deleteItemAttributes = (answer: MAnswer) => {\n    Modal.confirm({\n      title: i18n.translate('CHAT_ITEM_DEL_TITLE'),\n      okText: i18n.translate('CHAT_ITEM_DEL_OK'),\n      cancelText: i18n.translate('CHAT_ITEM_DEL_CANCEL'),\n      onOk: () => {\n        this.setItemAttributes(answer, undefined);\n        this.isItemAttributesEditing = false;\n      }\n    });\n  };\n\n  saveItemAttributes = (answer: MAnswer, attributes: any) => {\n    this.setItemAttributes(answer, attributes);\n    this.isItemAttributesEditing = true;\n  };\n\n  catchItemAttributesError = (msg?: string) => {\n    this.hasItemAttrError = true;\n    message.error(msg || i18n.translate('CHAT_ITEM_ATTR_EMPTY_ERROR'));\n  };\n\n  updateAnswerOrder = (source: string, destination?: number) => {\n    if (destination === undefined) {\n      return;\n    }\n\n    const currIndex = this.answers.findIndex((i) => i.id === source);\n    if (currIndex < 0 || currIndex === destination) {\n      return;\n    }\n\n    const currAnswer = this.answers[currIndex];\n    this.answers.splice(currIndex, 1);\n    this.answers.splice(destination, 0, currAnswer);\n\n    this.isDraggingAnswer = false;\n  };\n}\n\nexport default new Store();\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}