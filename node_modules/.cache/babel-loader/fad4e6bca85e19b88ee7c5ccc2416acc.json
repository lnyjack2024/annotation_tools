{"ast":null,"code":"var _jsxFileName = \"/Users/qzheng/Documents/webroot/annotation_tools/src/components/multi-channel/components/Validator/index.tsx\";\nimport React from 'react';\nimport { observer } from 'mobx-react';\nimport CommonValidator from '../../../common/tabs-menu/Validator';\nimport i18n from '../../locales';\nimport rootStore from '../../store/RootStore';\nimport { ValidationType, ReviewResult } from '../../types';\nimport './index.scss';\nclass Validator extends React.Component {\n  constructor(...args) {\n    super(...args);\n    this.handleSync = async () => {\n      await this.props.triggerValidation();\n    };\n    this.handleAction = warning => {\n      const {\n        id\n      } = warning;\n      const instance = rootStore.instance.getInstanceById(id);\n      const iStart = warning.start || instance.start;\n      if (iStart !== undefined) {\n        rootStore.instance.setSelectedInstance(id);\n      }\n    };\n    this.warningMoreHandleAction = (key, warning) => {\n      if (key === ReviewResult.REJECT) return;\n      const {\n        id\n      } = warning;\n      const review = {\n        instanceId: id,\n        result: key\n      };\n      if (key === 'delete') {\n        rootStore.review.deleteReviewById(id);\n      } else {\n        rootStore.review.setReview(review);\n      }\n    };\n  }\n  // eslint-disable-next-line class-methods-use-this\n  getCategoryByWarning(warning) {\n    if (warning.warningType === ValidationType.GLOBAL_ERROR) return false;\n    const {\n      id\n    } = warning;\n    const instance = rootStore.instance.getInstanceById(id);\n    return warning.isMissing || instance;\n  }\n  // eslint-disable-next-line class-methods-use-this\n  renderWarningTitle(warning) {\n    if (warning.warningType === ValidationType.GLOBAL_ERROR) return i18n.translate('VALIDATION_TYPE_GLOBAL');\n    const {\n      id,\n      channelIndex,\n      start\n    } = warning;\n    const {\n      instance: {\n        displayInstances,\n        getInstanceById\n      },\n      ontology: {\n        categories\n      }\n    } = rootStore;\n    const instance = getInstanceById(id);\n    const category = (instance === null || instance === void 0 ? void 0 : instance.category) || channelIndex !== undefined && categories[channelIndex].className;\n    const startTime = (instance === null || instance === void 0 ? void 0 : instance.start) !== undefined ? instance === null || instance === void 0 ? void 0 : instance.start : start;\n    if (startTime !== undefined && category) {\n      const instanceNum = displayInstances.findIndex(i => i.id === id);\n      return `${category} ${instance && instanceNum >= 0 ? instanceNum + 1 : ''}`;\n    }\n    return '';\n  }\n  render() {\n    const ValidationTypeTitle = {\n      [ValidationType.OVERLAP]: i18n.translate('VALIDATION_TYPE_OVERLAP'),\n      [ValidationType.ATTR_EMPTY]: i18n.translate('VALIDATION_TYPE_ATTR_EMPTY'),\n      [ValidationType.CUSTOM]: i18n.translate('VALIDATION_TYPE_CUSTOM'),\n      [ValidationType.QUALITY]: i18n.translate('VALIDATION_TYPE_QUALITY'),\n      [ValidationType.GLOBAL_ERROR]: i18n.translate('VALIDATION_TYPE_GLOBAL')\n    };\n    return /*#__PURE__*/React.createElement(CommonValidator, {\n      isEnabled: rootStore.review.isEnabled,\n      validationTypes: ValidationTypeTitle,\n      warnings: rootStore.review.warnings,\n      errors: rootStore.review.errors,\n      titleFormatter: count => i18n.translate('VALIDATION_TITLE', {\n        values: {\n          count\n        }\n      }),\n      checkingMsgFormatter: () => i18n.translate('VALIDATION_CHECKING'),\n      onValidate: this.handleSync,\n      renderWarningTitle: warning => this.renderWarningTitle(warning),\n      showWarningAction: warning => !!this.getCategoryByWarning(warning),\n      onWarningAction: warning => this.handleAction(warning),\n      onMoreHandleAction: this.warningMoreHandleAction,\n      formatMessage: i18n.translate,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 76,\n        columnNumber: 7\n      }\n    });\n  }\n}\nexport default observer(Validator);","map":{"version":3,"names":["React","observer","CommonValidator","i18n","rootStore","ValidationType","ReviewResult","Validator","Component","constructor","args","handleSync","props","triggerValidation","handleAction","warning","id","instance","getInstanceById","iStart","start","undefined","setSelectedInstance","warningMoreHandleAction","key","REJECT","review","instanceId","result","deleteReviewById","setReview","getCategoryByWarning","warningType","GLOBAL_ERROR","isMissing","renderWarningTitle","translate","channelIndex","displayInstances","ontology","categories","category","className","startTime","instanceNum","findIndex","i","render","ValidationTypeTitle","OVERLAP","ATTR_EMPTY","CUSTOM","QUALITY","createElement","isEnabled","validationTypes","warnings","errors","titleFormatter","count","values","checkingMsgFormatter","onValidate","showWarningAction","onWarningAction","onMoreHandleAction","formatMessage","__self","__source","fileName","_jsxFileName","lineNumber","columnNumber"],"sources":["/Users/qzheng/Documents/webroot/annotation_tools/src/components/multi-channel/components/Validator/index.tsx"],"sourcesContent":["import React from 'react';\nimport { observer } from 'mobx-react';\nimport CommonValidator, { IWarning } from '../../../common/tabs-menu/Validator';\nimport i18n from '../../locales';\nimport rootStore from '../../store/RootStore';\nimport { ValidationType, ReviewResult, Review, Warning } from '../../types';\nimport './index.scss';\n\ninterface ValidatorProps {\n  triggerValidation: () => Promise<boolean>;\n}\n\nclass Validator extends React.Component<ValidatorProps> {\n  // eslint-disable-next-line class-methods-use-this\n  getCategoryByWarning(warning: Warning) {\n    if (warning.warningType === ValidationType.GLOBAL_ERROR) return false;\n    const { id } = warning;\n    const instance = rootStore.instance.getInstanceById(id);\n    return (warning.isMissing) || instance;\n  }\n\n  handleSync = async () => {\n    await this.props.triggerValidation();\n  };\n\n  handleAction = (warning: IWarning) => {\n    const { id } = warning;\n    const instance = rootStore.instance.getInstanceById(id);\n    const iStart = (warning as any).start || instance.start;\n    if (iStart !== undefined) {\n      rootStore.instance.setSelectedInstance(id);\n    }\n  };\n\n  // eslint-disable-next-line class-methods-use-this\n  renderWarningTitle(warning: Warning) {\n    if (warning.warningType === ValidationType.GLOBAL_ERROR) return i18n.translate('VALIDATION_TYPE_GLOBAL');\n    const { id, channelIndex, start } = warning;\n    const {\n      instance: { displayInstances, getInstanceById },\n      ontology: { categories },\n    } = rootStore;\n    const instance = getInstanceById(id);\n    const category = instance?.category || (channelIndex !== undefined && categories[channelIndex].className);\n    const startTime = instance?.start !== undefined ? instance?.start : start;\n    if (startTime !== undefined && category) {\n      const instanceNum = displayInstances.findIndex((i) => i.id === id);\n      return `${category} ${instance && instanceNum >= 0 ? instanceNum + 1 : ''}`;\n    }\n    return '';\n  }\n\n  warningMoreHandleAction = (key: string, warning: IWarning) => {\n    if (key === ReviewResult.REJECT) return;\n    const { id } = warning;\n    const review: Review = {\n      instanceId: id,\n      result: key as ReviewResult\n    };\n    if (key === 'delete') {\n      rootStore.review.deleteReviewById(id);\n    } else {\n      rootStore.review.setReview(review);\n    }\n  };\n\n  render() {\n    const ValidationTypeTitle = {\n      [ValidationType.OVERLAP]: i18n.translate('VALIDATION_TYPE_OVERLAP'),\n      [ValidationType.ATTR_EMPTY]: i18n.translate('VALIDATION_TYPE_ATTR_EMPTY'),\n      [ValidationType.CUSTOM]: i18n.translate('VALIDATION_TYPE_CUSTOM'),\n      [ValidationType.QUALITY]: i18n.translate('VALIDATION_TYPE_QUALITY'),\n      [ValidationType.GLOBAL_ERROR]: i18n.translate('VALIDATION_TYPE_GLOBAL'),\n    };\n    return (\n      <CommonValidator\n        isEnabled={rootStore.review.isEnabled}\n        validationTypes={ValidationTypeTitle}\n        warnings={rootStore.review.warnings as IWarning[]}\n        errors={rootStore.review.errors}\n        titleFormatter={(count) => i18n.translate('VALIDATION_TITLE', { values: { count } })}\n        checkingMsgFormatter={() => i18n.translate('VALIDATION_CHECKING')}\n        onValidate={this.handleSync}\n        renderWarningTitle={(warning) => this.renderWarningTitle(warning as IWarning)}\n        showWarningAction={(warning) => !!this.getCategoryByWarning(warning)}\n        onWarningAction={(warning) => this.handleAction(warning as IWarning)}\n        onMoreHandleAction={this.warningMoreHandleAction}\n        formatMessage={i18n.translate}\n      />\n    );\n  }\n}\n\nexport default observer(Validator);\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}