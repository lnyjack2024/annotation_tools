{"ast":null,"code":"import React,{createRef}from'react';import{connect}from'react-redux';import{CellMeasurer,CellMeasurerCache,List,AutoSizer}from'react-virtualized';import SegmentAbstractItem from'./SegmentAbstractItem/SegmentAbstractItem';import'./SegmentAbstract.scss';const cache=new CellMeasurerCache({// defaultHeight: 72,\nfixedWidth:true});class SegmentAbstract extends React.Component{constructor(props){super(props);this.rowHeights={};this.getRowHeight=_ref=>{let{index}=_ref;return this.rowHeights[index]||72;};this.onUpdate=(index,rowHeight)=>{cache.clear(index,0);this.rowHeights[index]=rowHeight;// this.listRef?.recomputeRowHeights(index);\n};this.listRef=createRef();}// TODO: slider bar\nrender(){this.segmentAbstractItems=[];const{currentVideo,results,setCurrentSegment,loading}=this.props;if(loading){return null;}return/*#__PURE__*/ (// eslint-disable-next-line react/jsx-filename-extension\nReact.createElement(\"div\",{className:\"segment-abstract-container\",id:\"segment-abstract-container\",ref:r=>{this.segmentAbstractBox=r;}},/*#__PURE__*/React.createElement(AutoSizer,{onResize:()=>cache.clearAll()},_ref2=>{let{width,height}=_ref2;return/*#__PURE__*/React.createElement(List,{ref:r=>{this.listRef=r;},style:{outline:'none'},width:width,height:height,deferredMeasurementCache:cache,rowCount:results[currentVideo].length,rowHeight:this.getRowHeight,rowRenderer:_ref3=>{let{index,key,parent,style}=_ref3;return/*#__PURE__*/React.createElement(CellMeasurer,{cache:cache,columnIndex:0,key:key,parent:parent,rowIndex:index},/*#__PURE__*/React.createElement(\"div\",{style:style},/*#__PURE__*/React.createElement(SegmentAbstractItem,{ref:r=>{this.segmentAbstractItems[index]=r;},segmentIndex:index,segment:results[currentVideo][index],setCurrentSegment:setCurrentSegment,onUpdate:rowHeight=>{this.onUpdate(index,rowHeight);}})));}});})));}}const mapStateToProps=state=>({results:state.results,ontology:state.ontology,segmentConfig:state.segmentConfig,lineConfig:state.lineConfig,currentVideo:state.currentVideo,currentSegment:state.currentSegment,videos:state.videos,loading:state.loading});const mapDispatchToProps={};export default connect(mapStateToProps,mapDispatchToProps,null,{forwardRef:true})(SegmentAbstract);","map":{"version":3,"names":["React","createRef","connect","CellMeasurer","CellMeasurerCache","List","AutoSizer","SegmentAbstractItem","cache","fixedWidth","SegmentAbstract","Component","constructor","props","rowHeights","getRowHeight","_ref","index","onUpdate","rowHeight","clear","listRef","render","segmentAbstractItems","currentVideo","results","setCurrentSegment","loading","createElement","className","id","ref","r","segmentAbstractBox","onResize","clearAll","_ref2","width","height","style","outline","deferredMeasurementCache","rowCount","length","rowRenderer","_ref3","key","parent","columnIndex","rowIndex","segmentIndex","segment","mapStateToProps","state","ontology","segmentConfig","lineConfig","currentSegment","videos","mapDispatchToProps","forwardRef"],"sources":["/Users/qzheng/Documents/webroot/annotation_tools/src/components/long-audio/components/SegmentAbstract/SegmentAbstract.jsx"],"sourcesContent":["import React, { createRef } from 'react';\nimport { connect } from 'react-redux';\nimport { CellMeasurer, CellMeasurerCache, List, AutoSizer } from 'react-virtualized';\nimport SegmentAbstractItem from './SegmentAbstractItem/SegmentAbstractItem';\nimport './SegmentAbstract.scss';\n\nconst cache = new CellMeasurerCache({\n  // defaultHeight: 72,\n  fixedWidth: true,\n});\n\nclass SegmentAbstract extends React.Component {\n  constructor(props) {\n    super(props);\n    this.listRef = createRef();\n  }\n\n  rowHeights = {};\n\n  getRowHeight = ({ index }) => this.rowHeights[index] || 72;\n\n  onUpdate = (index, rowHeight) => {\n    cache.clear(index, 0);\n    this.rowHeights[index] = rowHeight;\n    // this.listRef?.recomputeRowHeights(index);\n  };\n\n  // TODO: slider bar\n  render() {\n    this.segmentAbstractItems = [];\n    const { currentVideo, results, setCurrentSegment, loading } = this.props;\n\n    if (loading) {\n      return null;\n    }\n\n    return (\n      // eslint-disable-next-line react/jsx-filename-extension\n      <div\n        className=\"segment-abstract-container\"\n        id=\"segment-abstract-container\"\n        ref={(r) => { this.segmentAbstractBox = r; }}\n      >\n        <AutoSizer onResize={() => cache.clearAll()}>\n          {({ width, height }) => (\n            <List\n              ref={(r) => { this.listRef = r; }}\n              style={{ outline: 'none' }}\n              width={width}\n              height={height}\n              deferredMeasurementCache={cache}\n              rowCount={results[currentVideo].length}\n              rowHeight={this.getRowHeight}\n              rowRenderer={({ index, key, parent, style }) => (\n                <CellMeasurer\n                  cache={cache}\n                  columnIndex={0}\n                  key={key}\n                  parent={parent}\n                  rowIndex={index}\n                >\n                  <div style={style}>\n                    <SegmentAbstractItem\n                      ref={(r) => { this.segmentAbstractItems[index] = r; }}\n                      segmentIndex={index}\n                      segment={results[currentVideo][index]}\n                      setCurrentSegment={setCurrentSegment}\n                      onUpdate={(rowHeight) => { this.onUpdate(index, rowHeight); }}\n                    />\n                  </div>\n                </CellMeasurer>\n              )}\n            />\n          )}\n        </AutoSizer>\n      </div>\n    );\n  }\n}\n\nconst mapStateToProps = (state) => ({\n  results: state.results,\n  ontology: state.ontology,\n  segmentConfig: state.segmentConfig,\n  lineConfig: state.lineConfig,\n  currentVideo: state.currentVideo,\n  currentSegment: state.currentSegment,\n  videos: state.videos,\n  loading: state.loading,\n});\nconst mapDispatchToProps = {\n};\nexport default connect(mapStateToProps, mapDispatchToProps, null, { forwardRef: true })(SegmentAbstract);\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}