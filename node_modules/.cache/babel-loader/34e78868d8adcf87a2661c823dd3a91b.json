{"ast":null,"code":"var _jsxFileName = \"/Users/qzheng/Documents/webroot/annotation_tools/src/components/keypoint/components/QualityControl/Missing.tsx\";\nimport React, { useEffect, useState } from 'react';\nimport { observer } from 'mobx-react';\nimport { Button, Form, message } from 'antd';\nimport { ImageTextField } from '@appen-china/easy-form';\nimport Modal from '../../../common/modal/Modal';\nimport ImagePreview from '../../../common/modal/ImagePreview';\nimport formatMessage from '../../locales';\nimport rootStore from '../../store/RootStore';\nimport './index.scss';\nconst QualityControl = ({\n  readonly,\n  jobProxy\n}) => {\n  const [form] = Form.useForm();\n  const [previewImg, setPreviewImg] = useState('');\n  const {\n    selectedMissingReview,\n    selectedMissingReviewModalVisible\n  } = rootStore.review;\n  useEffect(() => {\n    form.resetFields();\n  }, [selectedMissingReview]);\n  const handleValues = async () => {\n    if (rootStore.review.isEnabled && !rootStore.review.drawMode) {\n      const results = await form.validateFields();\n      if (!results.errorFields) {\n        rootStore.review.updateMissingReview({\n          ...selectedMissingReview,\n          ...results\n        });\n        message.success(formatMessage('QC_SET_REJECT'));\n      }\n    }\n    rootStore.review.closeMissingReviewModal();\n  };\n\n  /**\n  * save file\n  * @param file\n  */\n  const saveFile = file => jobProxy.saveFile(file);\n  if (!selectedMissingReview) {\n    return null;\n  }\n  return /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(Modal, {\n    visible: selectedMissingReviewModalVisible,\n    draggable: true,\n    closable: false,\n    dragId: \"keypoint-qa-form\",\n    maskClosable: true,\n    title: formatMessage('QC_MODAL_TITLE'),\n    onClose: handleValues,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 55,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"qa-form\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 64,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(\"p\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 65,\n      columnNumber: 11\n    }\n  }, `${formatMessage('VALIDATION_FRAME', {\n    values: {\n      frameIndex: selectedMissingReview.frameIndex + 1\n    }\n  })}Missing${selectedMissingReview.number}-Dot`), !readonly ? /*#__PURE__*/React.createElement(Form, {\n    form: form,\n    size: \"small\",\n    layout: \"vertical\",\n    initialValues: {\n      comment: selectedMissingReview.comment\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 67,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(Form.Item, {\n    name: \"comment\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 75,\n      columnNumber: 15\n    }\n  }, /*#__PURE__*/React.createElement(ImageTextField, {\n    uploader: saveFile,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 76,\n      columnNumber: 17\n    }\n  })), /*#__PURE__*/React.createElement(Button, {\n    onClick: () => {\n      rootStore.review.deleteMissingReview(selectedMissingReview);\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 78,\n      columnNumber: 15\n    }\n  }, formatMessage('QC_DELETE')), /*#__PURE__*/React.createElement(Button, {\n    style: {\n      marginLeft: '10px'\n    },\n    onClick: handleValues,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 85,\n      columnNumber: 15\n    }\n  }, formatMessage('QC_SAVE'))) : /*#__PURE__*/React.createElement(\"div\", {\n    style: {\n      marginTop: 16\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 93,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 94,\n      columnNumber: 15\n    }\n  }, formatMessage('QC_COMMENT_LABEL')), /*#__PURE__*/React.createElement(\"div\", {\n    style: {\n      color: 'rgba(255, 255, 255, 0.6)'\n    },\n    className: \"img-container\",\n    onClick: e => {\n      if (e.target.tagName === 'IMG') {\n        setPreviewImg(e.target.src);\n      }\n    }\n    // eslint-disable-next-line react/no-danger\n    ,\n    dangerouslySetInnerHTML: {\n      __html: selectedMissingReview.comment || ''\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 95,\n      columnNumber: 15\n    }\n  })))), previewImg && /*#__PURE__*/React.createElement(ImagePreview, {\n    src: previewImg,\n    maskClosable: true,\n    onClose: () => setPreviewImg(''),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 111,\n      columnNumber: 22\n    }\n  }));\n};\nexport default observer(QualityControl);","map":{"version":3,"names":["React","useEffect","useState","observer","Button","Form","message","ImageTextField","Modal","ImagePreview","formatMessage","rootStore","QualityControl","readonly","jobProxy","form","useForm","previewImg","setPreviewImg","selectedMissingReview","selectedMissingReviewModalVisible","review","resetFields","handleValues","isEnabled","drawMode","results","validateFields","errorFields","updateMissingReview","success","closeMissingReviewModal","saveFile","file","createElement","Fragment","visible","draggable","closable","dragId","maskClosable","title","onClose","__self","__source","fileName","_jsxFileName","lineNumber","columnNumber","className","values","frameIndex","number","size","layout","initialValues","comment","Item","name","uploader","onClick","deleteMissingReview","style","marginLeft","marginTop","color","e","target","tagName","src","dangerouslySetInnerHTML","__html"],"sources":["/Users/qzheng/Documents/webroot/annotation_tools/src/components/keypoint/components/QualityControl/Missing.tsx"],"sourcesContent":["import React, { useEffect, useState } from 'react';\nimport { observer } from 'mobx-react';\nimport { Button, Form, message } from 'antd';\nimport { ImageTextField } from '@appen-china/easy-form';\nimport Modal from '../../../common/modal/Modal';\nimport ImagePreview from '../../../common/modal/ImagePreview';\nimport formatMessage from '../../locales';\nimport rootStore from '../../store/RootStore';\nimport JobProxy from '../../../../libs/JobProxy';\nimport './index.scss';\n\ninterface QualityControlProps {\n  readonly: boolean;\n  jobProxy: JobProxy;\n}\n\nconst QualityControl = ({\n  readonly,\n  jobProxy,\n}: QualityControlProps) => {\n  const [form] = Form.useForm();\n  const [previewImg, setPreviewImg] = useState<string>('');\n  const { selectedMissingReview, selectedMissingReviewModalVisible } = rootStore.review;\n\n  useEffect(() => {\n    form.resetFields();\n  }, [selectedMissingReview]);\n\n  const handleValues = async () => {\n    if (rootStore.review.isEnabled && !rootStore.review.drawMode) {\n      const results = await form.validateFields();\n      if (!results.errorFields) {\n        rootStore.review.updateMissingReview({\n          ...selectedMissingReview,\n          ...results,\n        });\n        message.success(formatMessage('QC_SET_REJECT'));\n      }\n    }\n    rootStore.review.closeMissingReviewModal();\n  };\n\n  /**\n  * save file\n  * @param file\n  */\n  const saveFile = (file: File) => jobProxy.saveFile(file);\n\n  if (!selectedMissingReview) {\n    return null;\n  }\n\n  return (\n    <>\n      <Modal\n        visible={selectedMissingReviewModalVisible}\n        draggable\n        closable={false}\n        dragId=\"keypoint-qa-form\"\n        maskClosable\n        title={formatMessage('QC_MODAL_TITLE')}\n        onClose={handleValues}\n      >\n        <div className=\"qa-form\">\n          <p>{`${formatMessage('VALIDATION_FRAME', { values: { frameIndex: selectedMissingReview.frameIndex + 1 } })}Missing${selectedMissingReview.number}-Dot`}</p>\n          {!readonly ? (\n            <Form\n              form={form}\n              size=\"small\"\n              layout=\"vertical\"\n              initialValues={{\n                comment: selectedMissingReview.comment\n              }}\n            >\n              <Form.Item name=\"comment\">\n                <ImageTextField uploader={saveFile} />\n              </Form.Item>\n              <Button\n                onClick={() => {\n                  rootStore.review.deleteMissingReview(selectedMissingReview);\n                }}\n              >\n                {formatMessage('QC_DELETE')}\n              </Button>\n              <Button\n                style={{ marginLeft: '10px' }}\n                onClick={handleValues}\n              >\n                {formatMessage('QC_SAVE')}\n              </Button>\n            </Form>\n          ) : (\n            <div style={{ marginTop: 16 }}>\n              <div>{formatMessage('QC_COMMENT_LABEL')}</div>\n              <div\n                style={{ color: 'rgba(255, 255, 255, 0.6)' }}\n                className=\"img-container\"\n                onClick={(e) => {\n                  if ((e.target as HTMLElement).tagName === 'IMG') {\n                    setPreviewImg((e.target as HTMLImageElement).src);\n                  }\n                }}\n                // eslint-disable-next-line react/no-danger\n                dangerouslySetInnerHTML={{ __html: selectedMissingReview.comment || '' }}\n              />\n            </div>\n          )}\n        </div>\n\n      </Modal>\n      {previewImg && <ImagePreview src={previewImg} maskClosable onClose={() => setPreviewImg('')} />}\n    </>\n  );\n};\n\nexport default observer(QualityControl);\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}