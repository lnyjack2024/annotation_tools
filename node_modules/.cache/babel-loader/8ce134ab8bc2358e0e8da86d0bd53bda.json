{"ast":null,"code":"import{action,makeObservable,observable}from'mobx';import{cloneDeep}from'lodash';import OntologyStore from'./OntologyStore';import ConfigStore from'./ConfigStore';import FrameStore from'./FrameStore';import InstanceStore from'./InstanceStore';import ShapeStore from'./ShapeStore';import UndoStore from'./UndoStore';import ReviewsStore from'./ReviewStore';import i18n from'../locales';import{loadInstancesFromResult,getToolTypeFromFrameData}from'../utils';import{ReviewMode}from'../types';import{isAnnotationReadonly,isReviewEditable,isRework,isPreview,isTemplatePreview,ToolMode}from'../../../utils/tool-mode';/**\n * root store\n * @class\n */class RootStore{/**\n   * is tool readonly (annotate not allowed)\n   */get readonly(){return isAnnotationReadonly(this.jobProxy.toolMode)||this.config.reviewMode===ReviewMode.REVIEW;}/**\n   * is tool annotate allowed\n   */get annotatable(){return!isAnnotationReadonly(this.jobProxy.toolMode);}/**\n   * is tool review enabled\n   */get reviewable(){return isReviewEditable(this.jobProxy.toolMode);}/**\n   * is tool in labeling mode or template preview mode\n   */get isLabeling(){return this.jobProxy.toolMode===ToolMode.LABELING||this.isTemplatePreview;}/**\n   * is tool in rework mode\n   */get isRework(){return isRework(this.jobProxy.toolMode);}/**\n   * is tool in preview mode\n   */get isPreview(){return isPreview(this.jobProxy.toolMode);}/**\n   * is tool in template preview mode\n   */get isTemplatePreview(){return isTemplatePreview(this.jobProxy.toolMode);}constructor(){var _this=this;this.ontology=void 0;this.config=void 0;this.frame=void 0;this.instance=void 0;this.shape=void 0;this.undo=void 0;this.review=void 0;/**\n   * job proxy\n   */this.jobProxy=void 0;/**\n   * initial data copy\n   */this.initialData=null;/**\n   * is tool initialized\n   */this.initialized=false;/**\n   * when screenfull requested\n   */this.fullscreenRequested=false;/**\n   * get instance statistics\n   */this.getInstanceStatistics=()=>{const{categories}=this.ontology;const data={elements:[],categories:categories.map(_ref=>{let{className}=_ref;return className;}),shapes:new Set(),summary:{},frameCount:this.frame.frameCount,validFrames:new Set(),annotatedFrames:new Set(),instanceCount:0,distinctInstanceCount:0};const instances=Object.values(this.instance.instances);for(let i=0;i<instances.length;i+=1){const{id,category,items:objItems,attributes}=instances[i];const items=Object.values(objItems);const instanceFrames=new Set();for(let j=0;j<items.length;j+=1){const item=items[j];const cameras=Object.values(item.cameras);for(let k=0;k<cameras.length;k+=1){const camera=cameras[k];const frames=Object.values(camera.frames);for(let l=0;l<frames.length;l+=1){const frame=frames[l];const shape=getToolTypeFromFrameData(frame);data.shapes.add(shape);const key=\"\".concat(shape,\"_\").concat(category);if(!data.summary[key]){data.summary[key]={ids:[id],category,shape,count:1,distinctCount:0};}else{data.summary[key].count+=1;if(!data.summary[key].ids.includes(id)){data.summary[key].distinctCount+=1;data.summary[key].ids.push(id);}}instanceFrames.add(frame.frameIndex);data.annotatedFrames.add(frame.frameIndex);data.elements.push({id,shape,frame:frame.frameIndex+1,category,label:attributes});}}}data.instanceCount+=instanceFrames.size;data.distinctInstanceCount+=1;}return{...data,shapes:Array.from(data.shapes),summary:Object.values(data.summary).map(_ref2=>{let{category,shape,count,distinctCount}=_ref2;return{category,shape,count,distinctCount};}),annotatedFrames:Array.from(data.annotatedFrames),annotatedFrameCount:data.annotatedFrames.size,validFrameCount:data.validFrames.size};};/**\n   * save file\n   * @param file\n   */this.saveFile=file=>this.jobProxy.saveFile(file);/**\n   * delete selected shape point or instance if possible\n   */this.delete=()=>{if(this.readonly||this.config.isAnyModalOpened||this.shape.isDrawing){return;}this.shape.delete();};/**\n   * add instance item to current frame\n   * @param instanceItem\n   * @param camera\n   */this.addToCurrentFrame=function(instanceItem){let camera=arguments.length>1&&arguments[1]!==undefined?arguments[1]:_this.frame.currentCamera;_this.shape.addShapeToInstanceItem(instanceItem,camera);};/**\n   * move shape up\n   * @param toTop\n   */this.moveFront=function(){let toTop=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;if(_this.readonly||_this.config.isAnyModalOpened||_this.shape.isDrawing||!_this.instance.isSingleSelected){return;}_this.shape.moveFront(toTop);};/**\n   * move shape down\n   * @param toBottom\n   */this.moveBack=function(){let toBottom=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;if(_this.readonly||_this.config.isAnyModalOpened||_this.shape.isDrawing||!_this.instance.isSingleSelected){return;}_this.shape.moveBack(toBottom);};this.toggleAddMode=()=>{if(this.config.reviewMode===ReviewMode.LABELING){this.config.setAddMode(!this.config.addMode);}else{this.review.setAddMode(!this.review.addMode);}};this.activateTool=num=>{if(this.config.reviewMode===ReviewMode.LABELING){this.ontology.activateCategoryItemByIndex(num===0?9:num-1);}else{this.review.activateReviewByHotkey(num);}};this.openAttributesModal=()=>{if(this.readonly||this.shape.isDrawing){return;}// open point attributes modal\nconst{selectedShapes,selectedPointIndex,shapes}=this.shape;if(selectedShapes.length===1&&selectedPointIndex>=0){const selectedShape=selectedShapes[0];const{instanceItem}=shapes[selectedShape.uid];const frameData=instanceItem.cameras[this.frame.currentCamera].frames[this.frame.currentFrame];const{pointLabelConfig}=instanceItem.categoryItemRef;if(frameData&&pointLabelConfig){this.config.setPointAttributesModalVisible(true);return;}}// open instance & items attributes modal\nif(this.instance.selectedInstanceAttributesEnabled){this.config.setAttributesModalVisible(true);}};this.ontology=new OntologyStore(this);this.config=new ConfigStore(this);this.frame=new FrameStore(this);this.instance=new InstanceStore(this);this.shape=new ShapeStore(this);this.undo=new UndoStore(this);this.review=new ReviewsStore(this);makeObservable(this,{initialized:observable,init:action});}async init(payload){let initError='';const appendError=msg=>{initError=\"\".concat(initError?'; ':'').concat(msg);};// init common stores\nthis.ontology.init(payload);this.config.init(payload);// load frames\nawait this.frame.init(payload);// load result & init instances\ntry{await this.loadResult();}catch(e){appendError(i18n.translate('ANNOTATION_DATA_LOAD_ERROR'));}// load & init reviews\ntry{await this.loadReviews(payload);}catch(e){appendError(i18n.translate('REVIEW_DATA_LOAD_ERROR'));}// init shapes\nthis.shape.init(payload);this.initialized=true;// throw error\nif(initError){throw new Error(initError);}}/**\n   * load annotation result\n   */async loadResult(){const savedResult=await this.jobProxy.loadSavedResult();const reviewFromResult=await this.jobProxy.loadReviewFrom();// copy initial data\nif(reviewFromResult){this.initialData=cloneDeep({instances:reviewFromResult.instances,frames:reviewFromResult.frames});}const result=savedResult||reviewFromResult;if(!result){return;}if(result.auditId){this.jobProxy.setAuditId(result.auditId);}// set frame attributes\nthis.frame.initAttributes(result);// load instance\nthis.instance.init(loadInstancesFromResult(result));}/**\n   * save annotation result\n   */async saveResult(){let submit=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;const statData=this.getInstanceStatistics();const statistics=await this.jobProxy.saveResultStat(statData);const instances=this.instance.instancesJSON();const frames=this.frame.framesJSON();return this.jobProxy.saveResult({auditId:this.jobProxy.auditId,instances,frames,statistics,templateConfig:this.jobProxy.templateConfig},submit);}/**\n   * load reviews result\n   * @param payload\n   */async loadReviews(payload){const result=await this.jobProxy.loadReviews();this.review.init(payload,(result===null||result===void 0?void 0:result.reviews)||result);}/**\n   * save review result\n   */async saveReviews(){let submit=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;const reviews=this.review.reviewsJSON();const statData=this.review.getReviewStatistics();const statistics=await this.jobProxy.saveReviewStat(statData);return this.jobProxy.saveReviews({reviews,review_statistics:statistics},submit);}}const rootStore=new RootStore();export default rootStore;","map":{"version":3,"names":["action","makeObservable","observable","cloneDeep","OntologyStore","ConfigStore","FrameStore","InstanceStore","ShapeStore","UndoStore","ReviewsStore","i18n","loadInstancesFromResult","getToolTypeFromFrameData","ReviewMode","isAnnotationReadonly","isReviewEditable","isRework","isPreview","isTemplatePreview","ToolMode","RootStore","readonly","jobProxy","toolMode","config","reviewMode","REVIEW","annotatable","reviewable","isLabeling","LABELING","constructor","_this","ontology","frame","instance","shape","undo","review","initialData","initialized","fullscreenRequested","getInstanceStatistics","categories","data","elements","map","_ref","className","shapes","Set","summary","frameCount","validFrames","annotatedFrames","instanceCount","distinctInstanceCount","instances","Object","values","i","length","id","category","items","objItems","attributes","instanceFrames","j","item","cameras","k","camera","frames","l","add","key","concat","ids","count","distinctCount","includes","push","frameIndex","label","size","Array","from","_ref2","annotatedFrameCount","validFrameCount","saveFile","file","delete","isAnyModalOpened","isDrawing","addToCurrentFrame","instanceItem","arguments","undefined","currentCamera","addShapeToInstanceItem","moveFront","toTop","isSingleSelected","moveBack","toBottom","toggleAddMode","setAddMode","addMode","activateTool","num","activateCategoryItemByIndex","activateReviewByHotkey","openAttributesModal","selectedShapes","selectedPointIndex","selectedShape","uid","frameData","currentFrame","pointLabelConfig","categoryItemRef","setPointAttributesModalVisible","selectedInstanceAttributesEnabled","setAttributesModalVisible","init","payload","initError","appendError","msg","loadResult","e","translate","loadReviews","Error","savedResult","loadSavedResult","reviewFromResult","loadReviewFrom","result","auditId","setAuditId","initAttributes","saveResult","submit","statData","statistics","saveResultStat","instancesJSON","framesJSON","templateConfig","reviews","saveReviews","reviewsJSON","getReviewStatistics","saveReviewStat","review_statistics","rootStore"],"sources":["/Users/qzheng/Documents/webroot/annotation_tools/src/components/video-tracking2/store/RootStore.ts"],"sourcesContent":["import { action, makeObservable, observable } from 'mobx';\nimport { cloneDeep } from 'lodash';\nimport OntologyStore from './OntologyStore';\nimport ConfigStore from './ConfigStore';\nimport FrameStore from './FrameStore';\nimport InstanceStore from './InstanceStore';\nimport ShapeStore from './ShapeStore';\nimport UndoStore from './UndoStore';\nimport ReviewsStore from './ReviewStore';\nimport InstanceItem from '../model/InstanceItem';\nimport i18n from '../locales';\nimport { loadInstancesFromResult, getToolTypeFromFrameData } from '../utils';\nimport { Payload, Statistic, ReviewMode } from '../types';\nimport JobProxy from '../../../libs/JobProxy';\nimport { isAnnotationReadonly, isReviewEditable, isRework, isPreview, isTemplatePreview, ToolMode } from '../../../utils/tool-mode';\n\n/**\n * root store\n * @class\n */\nclass RootStore {\n  ontology: OntologyStore;\n\n  config: ConfigStore;\n\n  frame: FrameStore;\n\n  instance: InstanceStore;\n\n  shape: ShapeStore;\n\n  undo: UndoStore;\n\n  review: ReviewsStore;\n\n  /**\n   * job proxy\n   */\n  jobProxy?: JobProxy;\n\n  /**\n   * initial data copy\n   */\n  initialData: any = null;\n\n  /**\n   * is tool initialized\n   */\n  initialized = false;\n\n  /**\n   * when screenfull requested\n   */\n  fullscreenRequested = false;\n\n  /**\n   * is tool readonly (annotate not allowed)\n   */\n  get readonly() {\n    return isAnnotationReadonly(this.jobProxy!.toolMode) || this.config.reviewMode === ReviewMode.REVIEW;\n  }\n\n  /**\n   * is tool annotate allowed\n   */\n  get annotatable() {\n    return !isAnnotationReadonly(this.jobProxy!.toolMode);\n  }\n\n  /**\n   * is tool review enabled\n   */\n  get reviewable() {\n    return isReviewEditable(this.jobProxy!.toolMode);\n  }\n\n  /**\n   * is tool in labeling mode or template preview mode\n   */\n  get isLabeling() {\n    return this.jobProxy!.toolMode === ToolMode.LABELING || this.isTemplatePreview;\n  }\n\n  /**\n   * is tool in rework mode\n   */\n  get isRework() {\n    return isRework(this.jobProxy!.toolMode);\n  }\n\n  /**\n   * is tool in preview mode\n   */\n  get isPreview() {\n    return isPreview(this.jobProxy!.toolMode);\n  }\n\n  /**\n   * is tool in template preview mode\n   */\n  get isTemplatePreview() {\n    return isTemplatePreview(this.jobProxy!.toolMode);\n  }\n\n  constructor() {\n    this.ontology = new OntologyStore(this);\n    this.config = new ConfigStore(this);\n    this.frame = new FrameStore(this);\n    this.instance = new InstanceStore(this);\n    this.shape = new ShapeStore(this);\n    this.undo = new UndoStore(this);\n    this.review = new ReviewsStore(this);\n\n    makeObservable(this, {\n      initialized: observable,\n      init: action,\n    });\n  }\n\n  async init(payload: Payload) {\n    let initError = '';\n    const appendError = (msg: string) => {\n      initError = `${initError ? '; ' : ''}${msg}`;\n    };\n\n    // init common stores\n    this.ontology.init(payload);\n    this.config.init(payload);\n\n    // load frames\n    await this.frame.init(payload);\n\n    // load result & init instances\n    try {\n      await this.loadResult();\n    } catch (e) {\n      appendError(i18n.translate('ANNOTATION_DATA_LOAD_ERROR'));\n    }\n\n    // load & init reviews\n    try {\n      await this.loadReviews(payload);\n    } catch (e) {\n      appendError(i18n.translate('REVIEW_DATA_LOAD_ERROR'));\n    }\n\n    // init shapes\n    this.shape.init(payload);\n    this.initialized = true;\n\n    // throw error\n    if (initError) {\n      throw new Error(initError);\n    }\n  }\n\n  /**\n   * load annotation result\n   */\n  async loadResult() {\n    const savedResult = await this.jobProxy!.loadSavedResult();\n    const reviewFromResult = await this.jobProxy!.loadReviewFrom();\n\n    // copy initial data\n    if (reviewFromResult) {\n      this.initialData = cloneDeep({\n        instances: reviewFromResult.instances,\n        frames: reviewFromResult.frames,\n      });\n    }\n\n    const result = savedResult || reviewFromResult;\n    if (!result) {\n      return;\n    }\n    if (result.auditId) {\n      this.jobProxy!.setAuditId(result.auditId);\n    }\n    // set frame attributes\n    this.frame.initAttributes(result);\n    // load instance\n    this.instance.init(loadInstancesFromResult(result));\n  }\n\n  /**\n   * save annotation result\n   */\n  async saveResult(submit = false) {\n    const statData = this.getInstanceStatistics();\n    const statistics = await this.jobProxy!.saveResultStat(statData);\n    const instances = this.instance.instancesJSON();\n    const frames = this.frame.framesJSON();\n    return this.jobProxy!.saveResult({\n      auditId: this.jobProxy!.auditId,\n      instances,\n      frames,\n      statistics,\n      templateConfig: this.jobProxy!.templateConfig,\n    }, submit);\n  }\n\n  /**\n   * load reviews result\n   * @param payload\n   */\n  async loadReviews(payload: Payload) {\n    const result = await this.jobProxy!.loadReviews();\n    this.review.init(payload, result?.reviews || result);\n  }\n\n  /**\n   * save review result\n   */\n  async saveReviews(submit = false) {\n    const reviews = this.review.reviewsJSON();\n    const statData = this.review.getReviewStatistics();\n    const statistics = await this.jobProxy!.saveReviewStat(statData);\n    return this.jobProxy!.saveReviews({\n      reviews,\n      review_statistics: statistics,\n    }, submit);\n  }\n\n  /**\n   * get instance statistics\n   */\n  getInstanceStatistics = () => {\n    const { categories } = this.ontology;\n    const data: Statistic = {\n      elements: [],\n      categories: categories.map(({ className }) => className),\n      shapes: new Set(),\n      summary: {},\n      frameCount: this.frame.frameCount,\n      validFrames: new Set(),\n      annotatedFrames: new Set(),\n      instanceCount: 0,\n      distinctInstanceCount: 0,\n    };\n\n    const instances = Object.values(this.instance.instances);\n    for (let i = 0; i < instances.length; i += 1) {\n      const { id, category, items: objItems, attributes } = instances[i];\n      const items = Object.values(objItems);\n      const instanceFrames = new Set();\n      for (let j = 0; j < items.length; j += 1) {\n        const item = items[j];\n        const cameras = Object.values(item.cameras);\n        for (let k = 0; k < cameras.length; k += 1) {\n          const camera = cameras[k];\n          const frames = Object.values(camera.frames);\n          for (let l = 0; l < frames.length; l += 1) {\n            const frame = frames[l];\n            const shape = getToolTypeFromFrameData(frame);\n            data.shapes.add(shape);\n            const key = `${shape}_${category}`;\n            if (!data.summary[key]) {\n              data.summary[key] = {\n                ids: [id],\n                category,\n                shape,\n                count: 1,\n                distinctCount: 0,\n              };\n            } else {\n              data.summary[key].count += 1;\n              if (!data.summary[key].ids.includes(id)) {\n                data.summary[key].distinctCount += 1;\n                data.summary[key].ids.push(id);\n              }\n            }\n            instanceFrames.add(frame.frameIndex);\n            data.annotatedFrames.add(frame.frameIndex);\n            data.elements.push({\n              id,\n              shape,\n              frame: frame.frameIndex + 1,\n              category,\n              label: attributes,\n            });\n          }\n        }\n      }\n      data.instanceCount += instanceFrames.size;\n      data.distinctInstanceCount += 1;\n    }\n\n    return {\n      ...data,\n      shapes: Array.from(data.shapes),\n      summary: Object.values(data.summary).map(({ category, shape, count, distinctCount }) => ({\n        category,\n        shape,\n        count,\n        distinctCount,\n      })),\n      annotatedFrames: Array.from(data.annotatedFrames),\n      annotatedFrameCount: data.annotatedFrames.size,\n      validFrameCount: data.validFrames.size,\n    };\n  };\n\n  /**\n   * save file\n   * @param file\n   */\n  saveFile = (file: File) => this.jobProxy!.saveFile(file);\n\n  /**\n   * delete selected shape point or instance if possible\n   */\n  delete = () => {\n    if (this.readonly || this.config.isAnyModalOpened || this.shape.isDrawing) {\n      return;\n    }\n    this.shape.delete();\n  };\n\n  /**\n   * add instance item to current frame\n   * @param instanceItem\n   * @param camera\n   */\n  addToCurrentFrame = (instanceItem: InstanceItem, camera = this.frame.currentCamera) => {\n    this.shape.addShapeToInstanceItem(instanceItem, camera);\n  };\n\n  /**\n   * move shape up\n   * @param toTop\n   */\n  moveFront = (toTop = false) => {\n    if (\n      this.readonly ||\n      this.config.isAnyModalOpened ||\n      this.shape.isDrawing ||\n      !this.instance.isSingleSelected\n    ) {\n      return;\n    }\n    this.shape.moveFront(toTop);\n  };\n\n  /**\n   * move shape down\n   * @param toBottom\n   */\n  moveBack = (toBottom = false) => {\n    if (\n      this.readonly ||\n      this.config.isAnyModalOpened ||\n      this.shape.isDrawing ||\n      !this.instance.isSingleSelected\n    ) {\n      return;\n    }\n    this.shape.moveBack(toBottom);\n  };\n\n  toggleAddMode = () => {\n    if (this.config.reviewMode === ReviewMode.LABELING) {\n      this.config.setAddMode(!this.config.addMode);\n    } else {\n      this.review.setAddMode(!this.review.addMode);\n    }\n  };\n\n  activateTool = (num: number) => {\n    if (this.config.reviewMode === ReviewMode.LABELING) {\n      this.ontology.activateCategoryItemByIndex(num === 0 ? 9 : num - 1);\n    } else {\n      this.review.activateReviewByHotkey(num);\n    }\n  };\n\n  openAttributesModal = () => {\n    if (this.readonly || this.shape.isDrawing) {\n      return;\n    }\n\n    // open point attributes modal\n    const { selectedShapes, selectedPointIndex, shapes } = this.shape;\n    if (selectedShapes.length === 1 && selectedPointIndex >= 0) {\n      const selectedShape = selectedShapes[0];\n      const { instanceItem } = shapes[selectedShape.uid];\n      const frameData = instanceItem.cameras[this.frame.currentCamera].frames[this.frame.currentFrame];\n      const { pointLabelConfig } = instanceItem.categoryItemRef;\n      if (frameData && pointLabelConfig) {\n        this.config.setPointAttributesModalVisible(true);\n        return;\n      }\n    }\n\n    // open instance & items attributes modal\n    if (this.instance.selectedInstanceAttributesEnabled) {\n      this.config.setAttributesModalVisible(true);\n    }\n  };\n}\n\nconst rootStore = new RootStore();\nexport default rootStore;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}