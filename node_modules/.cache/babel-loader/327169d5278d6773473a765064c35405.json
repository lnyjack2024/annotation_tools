{"ast":null,"code":"var _jsxFileName = \"/Users/qzheng/Documents/webroot/annotation_tools/src/components/video-tracking2/components/attributes/PointAttributesModal.tsx\";\nimport React from 'react';\nimport { observer } from 'mobx-react';\nimport { toJS } from 'mobx';\nimport { Button } from 'antd';\nimport EasyForm from '@appen/easy-form';\nimport Modal from '../../../common/modal/Modal';\nimport store from '../../store/RootStore';\nimport i18n from '../../locales';\nimport { setInitialValues } from '../../utils';\nimport './AttributesModal.scss';\nclass PointAttributesModal extends React.Component {\n  constructor(...args) {\n    super(...args);\n    /**\n     * form container\n     */\n    this.ref = React.createRef();\n    /**\n     * when instance values submit\n     * @param values\n     */\n    this.onFrameValuesSubmit = values => {\n      const {\n        selectedShapes,\n        selectedPointIndex\n      } = store.shape;\n      const selectedShape = selectedShapes[0];\n      store.shape.setPointUserData(selectedShape, selectedPointIndex, values);\n      store.config.setPointAttributesModalVisible(false);\n    };\n    /**\n     * submit button click\n     */\n    this.submit = () => {\n      var _this$ref$current;\n      const buttons = (_this$ref$current = this.ref.current) === null || _this$ref$current === void 0 ? void 0 : _this$ref$current.querySelectorAll('button.easyform-btn.form-btn-submit');\n      buttons === null || buttons === void 0 ? void 0 : buttons.forEach(btn => {\n        btn.click();\n      });\n    };\n  }\n  render() {\n    var _toJS$points$selected;\n    const {\n      pointAttributesModalVisible\n    } = store.config;\n    const {\n      selectedShapes,\n      selectedPointIndex,\n      config\n    } = store.shape;\n    if (!pointAttributesModalVisible || selectedShapes.length !== 1 || selectedPointIndex < 0) {\n      // no selected point\n      return null;\n    }\n    const selectedShape = selectedShapes[0];\n    const {\n      instanceItem\n    } = store.shape.shapes[selectedShape.uid];\n    const frameData = instanceItem.cameras[store.frame.currentCamera].frames[store.frame.currentFrame];\n    const {\n      pointLabelConfig\n    } = instanceItem.categoryItemRef;\n    if (!frameData || !pointLabelConfig) {\n      return null;\n    }\n    const pointUserData = ((_toJS$points$selected = toJS(frameData.shape).points[selectedPointIndex]) === null || _toJS$points$selected === void 0 ? void 0 : _toJS$points$selected.userData) || {};\n    const pointFields = setInitialValues(pointLabelConfig.fields, pointUserData);\n    return /*#__PURE__*/React.createElement(Modal, {\n      visible: true,\n      draggable: true,\n      closable: false,\n      dragId: \"video-tracking-attributes\",\n      className: \"attributes-form\",\n      title: `${instanceItem.label} - ${i18n.translate('POINT_INDEX_LABEL', {\n        values: {\n          index: selectedPointIndex + config.vertexStart\n        }\n      })}`,\n      onClose: () => store.config.setPointAttributesModalVisible(false),\n      onMaskClick: this.submit,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 60,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      ref: this.ref,\n      className: \"attributes-form-content\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 70,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(EasyForm, {\n      theme: \"dark\",\n      fields: pointFields,\n      conditions: pointLabelConfig.conditions,\n      effects: pointLabelConfig.effects,\n      rules: pointLabelConfig.rules,\n      onSubmit: this.onFrameValuesSubmit,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 71,\n        columnNumber: 11\n      }\n    })), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"attributes-form-footer\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 80,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(Button, {\n      type: \"primary\",\n      onClick: this.submit,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 81,\n        columnNumber: 11\n      }\n    }, i18n.translate('COMMON_SUBMIT'))));\n  }\n}\nexport default observer(PointAttributesModal);","map":{"version":3,"names":["React","observer","toJS","Button","EasyForm","Modal","store","i18n","setInitialValues","PointAttributesModal","Component","constructor","args","ref","createRef","onFrameValuesSubmit","values","selectedShapes","selectedPointIndex","shape","selectedShape","setPointUserData","config","setPointAttributesModalVisible","submit","_this$ref$current","buttons","current","querySelectorAll","forEach","btn","click","render","_toJS$points$selected","pointAttributesModalVisible","length","instanceItem","shapes","uid","frameData","cameras","frame","currentCamera","frames","currentFrame","pointLabelConfig","categoryItemRef","pointUserData","points","userData","pointFields","fields","createElement","visible","draggable","closable","dragId","className","title","label","translate","index","vertexStart","onClose","onMaskClick","__self","__source","fileName","_jsxFileName","lineNumber","columnNumber","theme","conditions","effects","rules","onSubmit","type","onClick"],"sources":["/Users/qzheng/Documents/webroot/annotation_tools/src/components/video-tracking2/components/attributes/PointAttributesModal.tsx"],"sourcesContent":["import React from 'react';\nimport { observer } from 'mobx-react';\nimport { toJS } from 'mobx';\nimport { Button } from 'antd';\nimport EasyForm from '@appen/easy-form';\nimport Modal from '../../../common/modal/Modal';\nimport store from '../../store/RootStore';\nimport i18n from '../../locales';\nimport { setInitialValues } from '../../utils';\nimport { PolygonData } from '../../../common/shapes/Polygon';\nimport { LineData } from '../../../common/shapes/Line';\nimport './AttributesModal.scss';\n\nclass PointAttributesModal extends React.Component {\n  /**\n   * form container\n   */\n  ref = React.createRef<HTMLDivElement>();\n\n  /**\n   * when instance values submit\n   * @param values\n   */\n  onFrameValuesSubmit = (values: any) => {\n    const { selectedShapes, selectedPointIndex } = store.shape;\n    const selectedShape = selectedShapes[0];\n    store.shape.setPointUserData(selectedShape, selectedPointIndex, values);\n    store.config.setPointAttributesModalVisible(false);\n  };\n\n  /**\n   * submit button click\n   */\n  submit = () => {\n    const buttons = this.ref.current?.querySelectorAll('button.easyform-btn.form-btn-submit');\n    buttons?.forEach((btn) => {\n      (btn as HTMLButtonElement).click();\n    });\n  };\n\n  render() {\n    const { pointAttributesModalVisible } = store.config;\n    const { selectedShapes, selectedPointIndex, config } = store.shape;\n    if (!pointAttributesModalVisible || selectedShapes.length !== 1 || selectedPointIndex < 0) {\n      // no selected point\n      return null;\n    }\n\n    const selectedShape = selectedShapes[0];\n    const { instanceItem } = store.shape.shapes[selectedShape.uid];\n    const frameData = instanceItem.cameras[store.frame.currentCamera].frames[store.frame.currentFrame];\n    const { pointLabelConfig } = instanceItem.categoryItemRef;\n    if (!frameData || !pointLabelConfig) {\n      return null;\n    }\n\n    const pointUserData = toJS(frameData.shape as PolygonData | LineData).points[selectedPointIndex]?.userData || {};\n    const pointFields = setInitialValues(pointLabelConfig.fields, pointUserData);\n    return (\n      <Modal\n        visible\n        draggable\n        closable={false}\n        dragId=\"video-tracking-attributes\"\n        className=\"attributes-form\"\n        title={`${instanceItem.label} - ${i18n.translate('POINT_INDEX_LABEL', { values: { index: selectedPointIndex + config.vertexStart } })}`}\n        onClose={() => store.config.setPointAttributesModalVisible(false)}\n        onMaskClick={this.submit}\n      >\n        <div ref={this.ref} className=\"attributes-form-content\">\n          <EasyForm\n            theme=\"dark\"\n            fields={pointFields}\n            conditions={pointLabelConfig.conditions}\n            effects={pointLabelConfig.effects}\n            rules={pointLabelConfig.rules}\n            onSubmit={this.onFrameValuesSubmit}\n          />\n        </div>\n        <div className=\"attributes-form-footer\">\n          <Button type=\"primary\" onClick={this.submit}>\n            {i18n.translate('COMMON_SUBMIT')}\n          </Button>\n        </div>\n      </Modal>\n    );\n  }\n}\n\nexport default observer(PointAttributesModal);\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}