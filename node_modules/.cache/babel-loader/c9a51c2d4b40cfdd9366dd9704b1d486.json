{"ast":null,"code":"import ExcelJS from 'exceljs';\nimport { getCellPosition, getCellIndexPosition } from './utils';\n\n// 将x-spreadsheet.getData()导出的json转换成exceljs的workbook\nexport default function json2Workbook(excelData) {\n  const workbook = new ExcelJS.Workbook();\n  workbook.creator = 'appen';\n  workbook.lastModifiedBy = 'appen';\n  workbook.created = new Date();\n  workbook.modified = new Date();\n  workbook.calcProperties.fullCalcOnLoad = true;\n  excelData.forEach(sh => {\n    const sheet = workbook.addWorksheet(sh.name);\n    // 逐行对sheet进行赋值\n    Object.keys(sh.rows).forEach(rowKey => {\n      const sheetRow = sheet.getRow(+rowKey + 1);\n      // 设置行的属性\n      if (sheetRow) {\n        const {\n          height,\n          hide\n        } = sh.rows[rowKey];\n        if (height !== undefined) sheetRow.height = height;\n        if (hide !== undefined) sheetRow.hide = hide;\n      }\n      // 处理单元格的内容及样式\n      const {\n        cells\n      } = sh.rows[rowKey];\n      if (cells) {\n        Object.keys(cells).forEach(cellKey => {\n          if (cells[cellKey]) {\n            const {\n              text,\n              style\n            } = cells[cellKey];\n            const position = getCellPosition(rowKey, cellKey);\n            if (text !== undefined) applyCellInfo(position, sheet, text);\n            if (style !== undefined) applyCellStyle(position, sheet, sh.styles[style]);\n          }\n        });\n      }\n    });\n\n    // 处理合并单元格\n    sh.merges.forEach(merge => {\n      sheet.mergeCells(merge);\n    });\n\n    // 设置列的属性\n    Object.keys(sh.cols).forEach(key => {\n      if (!Number.isNaN(key)) {\n        const {\n          width,\n          hid\n        } = sh.cols[key];\n        const column = sheet.getColumn(1 + +key);\n        if (column) {\n          column.width = width / 10;\n          column.hidden = hid;\n        }\n      }\n    });\n\n    // 设置冻结视图\n    if (sh.freeze !== 'A1') {\n      const {\n        row: ySplit,\n        col: xSplit\n      } = getCellIndexPosition(sh.freeze);\n      sheet.views = [{\n        state: 'frozen',\n        xSplit,\n        ySplit,\n        topLeftCell: sh.freeze\n      }];\n    }\n  });\n  return workbook;\n}\n\n// 设置单元格内容\nfunction applyCellInfo(position, sheet, text) {\n  const cell = sheet.getCell(position);\n  text = text.replace(/\\s$/, '');\n  cell.value = Number.isNaN(Number(text)) ? text : Number(text);\n  cell.alignment = {\n    vertical: 'middle'\n  }; // 将字符垂直居中\n}\n\n// 设置单元格样式\nfunction applyCellStyle(position, sheet, style) {\n  const cell = sheet.getCell(position);\n  // 设置字符样式\n  cell.font = {\n    ...style.font,\n    underline: style.underline,\n    strike: style.strike\n  };\n  if (style.color != null) cell.font.color = {\n    argb: `00${style.color.slice(1)}`\n  };\n  cell.alignment = {\n    vertical: style.valign,\n    horizontal: style.align,\n    wrapText: style.textwrap\n  };\n\n  // 设置边框\n  if (style.border) {\n    cell.border = {};\n    Object.keys(style.border).forEach(key => {\n      cell.border[key] = {};\n      [cell.border[key].style] = style.border[key];\n      if (style.border[key].length > 1) cell.border[key].color = {\n        argb: `00${style.border[key][1].slice(1)}`\n      };\n    });\n  }\n\n  // 设置填充背景\n  if (style.bgcolor) {\n    cell.fill = {\n      type: 'pattern',\n      pattern: 'solid',\n      fgColor: {\n        argb: `00${style.bgcolor.slice(1)}`\n      }\n    };\n  }\n\n  // 设置数字样式\n  switch (style.format) {\n    case 'number':\n      cell.numFmt = '# ?/?';\n      break;\n    case 'percent':\n      cell.numFmt = '0.00%';\n      break;\n    case 'time':\n      cell.numFmt = 'hh:mm:ss';\n      break;\n    case 'date':\n      cell.numFmt = 'yyyy/mm/dd';\n      break;\n    case 'datetime':\n      cell.numFmt = 'yyyy/mm/dd hh:mm:ss';\n      break;\n    case 'rmb':\n      cell.numFmt = '\"¥\"#,##0.00_);[Red](\"¥\"#,##0.00)';\n      break;\n    case 'usd':\n      cell.numFmt = '\"US$\"#,##0.00_);[Red](\"US$\"#,##0.00)';\n      break;\n    case 'eru':\n      cell.numFmt = '[$€-1809]#,##0.00_);[Red]([$€-1809]#,##0.00)';\n      break;\n    default:\n      break;\n  }\n}","map":{"version":3,"names":["ExcelJS","getCellPosition","getCellIndexPosition","json2Workbook","excelData","workbook","Workbook","creator","lastModifiedBy","created","Date","modified","calcProperties","fullCalcOnLoad","forEach","sh","sheet","addWorksheet","name","Object","keys","rows","rowKey","sheetRow","getRow","height","hide","undefined","cells","cellKey","text","style","position","applyCellInfo","applyCellStyle","styles","merges","merge","mergeCells","cols","key","Number","isNaN","width","hid","column","getColumn","hidden","freeze","row","ySplit","col","xSplit","views","state","topLeftCell","cell","getCell","replace","value","alignment","vertical","font","underline","strike","color","argb","slice","valign","horizontal","align","wrapText","textwrap","border","length","bgcolor","fill","type","pattern","fgColor","format","numFmt"],"sources":["/Users/qzheng/Documents/webroot/annotation_tools/src/components/excel/json2Workbook.js"],"sourcesContent":["import ExcelJS from 'exceljs';\nimport { getCellPosition, getCellIndexPosition } from './utils';\n\n// 将x-spreadsheet.getData()导出的json转换成exceljs的workbook\nexport default function json2Workbook(excelData) {\n  const workbook = new ExcelJS.Workbook();\n  workbook.creator = 'appen';\n  workbook.lastModifiedBy = 'appen';\n  workbook.created = new Date();\n  workbook.modified = new Date();\n  workbook.calcProperties.fullCalcOnLoad = true;\n  excelData.forEach((sh) => {\n    const sheet = workbook.addWorksheet(sh.name);\n    // 逐行对sheet进行赋值\n    Object.keys(sh.rows).forEach((rowKey) => {\n      const sheetRow = sheet.getRow(+rowKey + 1);\n      // 设置行的属性\n      if (sheetRow) {\n        const { height, hide } = sh.rows[rowKey];\n        if (height !== undefined) sheetRow.height = height;\n        if (hide !== undefined) sheetRow.hide = hide;\n      }\n      // 处理单元格的内容及样式\n      const { cells } = sh.rows[rowKey];\n      if (cells) {\n        Object.keys(cells).forEach((cellKey) => {\n          if (cells[cellKey]) {\n            const { text, style } = cells[cellKey];\n            const position = getCellPosition(rowKey, cellKey);\n            if (text !== undefined) applyCellInfo(position, sheet, text);\n            if (style !== undefined) applyCellStyle(position, sheet, sh.styles[style]);\n          }\n        });\n      }\n    });\n\n    // 处理合并单元格\n    sh.merges.forEach((merge) => {\n      sheet.mergeCells(merge);\n    });\n\n    // 设置列的属性\n    Object.keys(sh.cols).forEach((key) => {\n      if (!Number.isNaN(key)) {\n        const { width, hid } = sh.cols[key];\n        const column = sheet.getColumn(1 + +key);\n        if (column) {\n          column.width = width / 10;\n          column.hidden = hid;\n        }\n      }\n    });\n\n    // 设置冻结视图\n    if (sh.freeze !== 'A1') {\n      const { row: ySplit, col: xSplit } = getCellIndexPosition(sh.freeze);\n      sheet.views = [\n        { state: 'frozen', xSplit, ySplit, topLeftCell: sh.freeze }\n      ];\n    }\n  });\n  return workbook;\n}\n\n// 设置单元格内容\nfunction applyCellInfo(position, sheet, text) {\n  const cell = sheet.getCell(position);\n  text = text.replace(/\\s$/, '');\n  cell.value = Number.isNaN(Number(text)) ? text : Number(text);\n  cell.alignment = { vertical: 'middle' }; // 将字符垂直居中\n}\n\n// 设置单元格样式\nfunction applyCellStyle(position, sheet, style) {\n  const cell = sheet.getCell(position);\n  // 设置字符样式\n  cell.font = { ...style.font, underline: style.underline, strike: style.strike };\n  if (style.color != null) cell.font.color = { argb: `00${style.color.slice(1)}` };\n  cell.alignment = {\n    vertical: style.valign,\n    horizontal: style.align,\n    wrapText: style.textwrap\n  };\n\n  // 设置边框\n  if (style.border) {\n    cell.border = {};\n    Object.keys(style.border).forEach((key) => {\n      cell.border[key] = {};\n      [cell.border[key].style] = style.border[key];\n      if (style.border[key].length > 1) cell.border[key].color = { argb: `00${style.border[key][1].slice(1)}` };\n    });\n  }\n\n  // 设置填充背景\n  if (style.bgcolor) {\n    cell.fill = {\n      type: 'pattern',\n      pattern: 'solid',\n      fgColor: { argb: `00${style.bgcolor.slice(1)}` }\n    };\n  }\n\n  // 设置数字样式\n  switch (style.format) {\n    case 'number': cell.numFmt = '# ?/?'; break;\n    case 'percent': cell.numFmt = '0.00%'; break;\n    case 'time': cell.numFmt = 'hh:mm:ss'; break;\n    case 'date': cell.numFmt = 'yyyy/mm/dd'; break;\n    case 'datetime': cell.numFmt = 'yyyy/mm/dd hh:mm:ss'; break;\n    case 'rmb': cell.numFmt = '\"¥\"#,##0.00_);[Red](\"¥\"#,##0.00)'; break;\n    case 'usd': cell.numFmt = '\"US$\"#,##0.00_);[Red](\"US$\"#,##0.00)'; break;\n    case 'eru': cell.numFmt = '[$€-1809]#,##0.00_);[Red]([$€-1809]#,##0.00)'; break;\n    default:\n      break;\n  }\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}