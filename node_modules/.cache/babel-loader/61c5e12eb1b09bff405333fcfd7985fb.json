{"ast":null,"code":"import React,{useState}from'react';import{Input,message}from'antd';import{connect}from'react-redux';import hexToRgba from'hex-to-rgba';import{CopyOutlined,CheckOutlined}from'@ant-design/icons';import{setLineText,setAttributeFocusInfo}from'../../../redux/action';import'./LineAbstractItem.scss';import{defaultColor,attributeType}from'../../../constants';import{wordCount,copyTextToClipboard}from'../../../../../utils';import{getFieldDisplayLabel}from'../../../../../utils/form';import i18n from'../../../locales';const LineAbstractItem=props=>{var _props$lineConfig$fie;const[isCopied,setIsCopied]=useState(false);const color=props.ontology.get(props.line.role)?hexToRgba(props.ontology.get(props.line.role),defaultColor.defaultAlpha):'transparent';const validConfig=props.lineConfig.fields.map(value=>value.name)||[];const efOntologyVisible=(_props$lineConfig$fie=props.lineConfig.fields.find(v=>v.name==='ef-ontology'))===null||_props$lineConfig$fie===void 0?void 0:_props$lineConfig$fie.visible;const handleChangeInput=e=>{props.setLineText({videoIndex:null,segmentIndex:props.segmentIndex,lineIndex:props.lineIndex,text:e.target.value});};const handleInputClick=e=>{e.stopPropagation();props.setCurrentSegment({index:props.segmentIndex});e.target.focus();};const handleAttributeClick=(e,key)=>{e.stopPropagation();props.setCurrentSegment({index:props.segmentIndex});props.setAttributeFocusInfo({segmentIndex:props.segmentIndex,type:attributeType.line,lineIndex:props.lineIndex,key});};const handleCopyClick=async e=>{e.stopPropagation();try{await copyTextToClipboard(props.line.text||'');message.success(i18n.translate('SEGMENT_COPY_SUCESS'));setIsCopied(true);const timer=setTimeout(()=>{clearTimeout(timer);setIsCopied(false);},1500);}catch(error){message.success(i18n.translate('SEGMENT_COPY_ERROR'));}};return/*#__PURE__*/ (// eslint-disable-next-line react/jsx-filename-extension\nReact.createElement(\"div\",{className:\"line-abstract-item-container segment-abstract-row\",style:{borderLeft:\"6px solid \".concat(color)}},props.client==='hw-translation'?/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(Input.TextArea,{className:\"line-abstract-item-text-input-hw\",value:props.line.text,onClick:e=>handleInputClick(e),disabled:true,autoComplete:\"off\",autoSize:{minRows:1}})):/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(\"div\",{className:\"line-abstract-item-head\"},props.existRole&&/*#__PURE__*/React.createElement(LineAbstractRoleTag,{color:color,role:props.line.role,handleClick:e=>{handleAttributeClick(e,'role');}}),Object.keys(props.line.attributes).filter(k=>k==='ef-ontology'&&efOntologyVisible!==false||k!=='ef-ontology').map((key,index)=>validConfig.indexOf(key)>=0&&props.line.attributes[key]!==undefined&&props.line.attributes[key]!==''?/*#__PURE__*/React.createElement(\"div\",{className:\"line-abstract-item-category\"// eslint-disable-next-line react/no-array-index-key\n,key:\"line-abstract-item-category\".concat(index),onClick:e=>{handleAttributeClick(e,key);}},getFieldDisplayLabel(props.line.attributes[key],props.lineFieldMap[key])||' - '):null)),/*#__PURE__*/React.createElement(\"div\",{className:\"line-abstract-item-text\"},/*#__PURE__*/React.createElement(\"div\",{className:\"line-abstract-item-text-cnt\"},/*#__PURE__*/React.createElement(\"div\",null,wordCount(props.line.text)),/*#__PURE__*/React.createElement(\"div\",null,\"(\",props.line.text.length,\")\")),/*#__PURE__*/React.createElement(Input,{className:\"line-abstract-item-text-input\",value:props.line.text,onChange:e=>handleChangeInput(e),onClick:e=>handleInputClick(e),disabled:true,autoComplete:\"off\",onFocus:()=>{window.disableLongAudioHotKeys=true;},onBlur:()=>{window.disableLongAudioHotKeys=false;}}))),/*#__PURE__*/React.createElement(\"div\",{className:\"segment-abstract-copy\",onClick:handleCopyClick},isCopied?/*#__PURE__*/React.createElement(CheckOutlined,null):/*#__PURE__*/React.createElement(CopyOutlined,null))));};const LineAbstractRoleTag=props=>/*#__PURE__*/React.createElement(\"div\",{className:\"line-abstract-item-role\",onClick:props.handleClick},/*#__PURE__*/React.createElement(\"div\",{className:\"line-abstract-item-role-color\",style:{backgroundColor:props.color}}),props.role);const mapStateToProps=state=>({ontology:state.ontology,segmentConfig:state.segmentConfig,lineConfig:state.lineConfig,currentSegment:state.currentSegment,toolMode:state.toolMode,client:state.client,lineFieldMap:state.lineFieldMap});const mapDispatchToProps={setLineText,setAttributeFocusInfo};export default connect(mapStateToProps,mapDispatchToProps)(LineAbstractItem);","map":{"version":3,"names":["React","useState","Input","message","connect","hexToRgba","CopyOutlined","CheckOutlined","setLineText","setAttributeFocusInfo","defaultColor","attributeType","wordCount","copyTextToClipboard","getFieldDisplayLabel","i18n","LineAbstractItem","props","_props$lineConfig$fie","isCopied","setIsCopied","color","ontology","get","line","role","defaultAlpha","validConfig","lineConfig","fields","map","value","name","efOntologyVisible","find","v","visible","handleChangeInput","e","videoIndex","segmentIndex","lineIndex","text","target","handleInputClick","stopPropagation","setCurrentSegment","index","focus","handleAttributeClick","key","type","handleCopyClick","success","translate","timer","setTimeout","clearTimeout","error","createElement","className","style","borderLeft","concat","client","Fragment","TextArea","onClick","disabled","autoComplete","autoSize","minRows","existRole","LineAbstractRoleTag","handleClick","Object","keys","attributes","filter","k","indexOf","undefined","lineFieldMap","length","onChange","onFocus","window","disableLongAudioHotKeys","onBlur","backgroundColor","mapStateToProps","state","segmentConfig","currentSegment","toolMode","mapDispatchToProps"],"sources":["/Users/qzheng/Documents/webroot/annotation_tools/src/components/long-audio/components/SegmentAbstract/LineAbstractItem/LineAbstractItem.jsx"],"sourcesContent":["import React, { useState } from 'react';\nimport { Input, message } from 'antd';\nimport { connect } from 'react-redux';\nimport hexToRgba from 'hex-to-rgba';\nimport { CopyOutlined, CheckOutlined } from '@ant-design/icons';\nimport { setLineText, setAttributeFocusInfo } from '../../../redux/action';\nimport './LineAbstractItem.scss';\nimport { defaultColor, attributeType } from '../../../constants';\nimport { wordCount, copyTextToClipboard } from '../../../../../utils';\nimport { getFieldDisplayLabel } from '../../../../../utils/form';\nimport i18n from '../../../locales';\n\nconst LineAbstractItem = ((props) => {\n  const [isCopied, setIsCopied] = useState(false);\n\n  const color = props.ontology.get(props.line.role)\n    ? hexToRgba(props.ontology.get(props.line.role), defaultColor.defaultAlpha)\n    : 'transparent';\n  const validConfig = props.lineConfig.fields.map((value) => value.name) || [];\n  const efOntologyVisible = props.lineConfig.fields.find((v) => v.name === 'ef-ontology')?.visible;\n\n  const handleChangeInput = ((e) => {\n    props.setLineText({\n      videoIndex: null,\n      segmentIndex: props.segmentIndex,\n      lineIndex: props.lineIndex,\n      text: e.target.value,\n    });\n  });\n\n  const handleInputClick = (e) => {\n    e.stopPropagation();\n    props.setCurrentSegment({ index: props.segmentIndex });\n    e.target.focus();\n  };\n\n  const handleAttributeClick = (e, key) => {\n    e.stopPropagation();\n    props.setCurrentSegment({ index: props.segmentIndex });\n    props.setAttributeFocusInfo({\n      segmentIndex: props.segmentIndex,\n      type: attributeType.line,\n      lineIndex: props.lineIndex,\n      key,\n    });\n  };\n\n  const handleCopyClick = async (e) => {\n    e.stopPropagation();\n    try {\n      await copyTextToClipboard(props.line.text || '');\n      message.success(i18n.translate('SEGMENT_COPY_SUCESS'));\n      setIsCopied(true);\n      const timer = setTimeout(() => {\n        clearTimeout(timer);\n        setIsCopied(false);\n      }, 1500);\n    } catch (error) {\n      message.success(i18n.translate('SEGMENT_COPY_ERROR'));\n    }\n  };\n\n  return (\n    // eslint-disable-next-line react/jsx-filename-extension\n    <div\n      className=\"line-abstract-item-container segment-abstract-row\"\n      style={{ borderLeft: `6px solid ${color}` }}\n    >\n      { props.client === 'hw-translation' ? (\n        <>\n          <Input.TextArea\n            className=\"line-abstract-item-text-input-hw\"\n            value={props.line.text}\n            onClick={(e) => handleInputClick(e)}\n            disabled\n            autoComplete=\"off\"\n            autoSize={{ minRows: 1 }}\n          />\n        </>\n      ) : (\n        <>\n          <div className=\"line-abstract-item-head\">\n            {props.existRole && (\n              <LineAbstractRoleTag\n                color={color}\n                role={props.line.role}\n                handleClick={(e) => { handleAttributeClick(e, 'role'); }}\n              />\n            )}\n            {Object.keys(props.line.attributes)\n              .filter((k) => (k === 'ef-ontology' && efOntologyVisible !== false) || k !== 'ef-ontology')\n              .map((key, index) => (\n                (validConfig.indexOf(key) >= 0 &&\n                  props.line.attributes[key] !== undefined &&\n                  props.line.attributes[key] !== ''\n                )\n                  ? (\n                    <div\n                      className=\"line-abstract-item-category\"\n                    // eslint-disable-next-line react/no-array-index-key\n                      key={`line-abstract-item-category${index}`}\n                      onClick={(e) => { handleAttributeClick(e, key); }}\n                    >\n                      {getFieldDisplayLabel(props.line.attributes[key], props.lineFieldMap[key]) || ' - '}\n                    </div>\n                  ) : null\n              ))}\n          </div>\n          <div className=\"line-abstract-item-text\">\n            <div className=\"line-abstract-item-text-cnt\">\n              <div>{wordCount(props.line.text)}</div>\n              <div>\n                (\n                {props.line.text.length}\n                )\n              </div>\n            </div>\n            <Input\n              className=\"line-abstract-item-text-input\"\n              value={props.line.text}\n              onChange={(e) => handleChangeInput(e)}\n              onClick={(e) => handleInputClick(e)}\n              disabled\n              autoComplete=\"off\"\n              onFocus={() => { window.disableLongAudioHotKeys = true; }}\n              onBlur={() => { window.disableLongAudioHotKeys = false; }}\n            />\n          </div>\n        </>\n      )}\n      <div className=\"segment-abstract-copy\" onClick={handleCopyClick}>\n        {isCopied ? <CheckOutlined /> : <CopyOutlined />}\n      </div>\n    </div>\n  );\n});\n\nconst LineAbstractRoleTag = ((props) => (\n  <div className=\"line-abstract-item-role\" onClick={props.handleClick}>\n    <div\n      className=\"line-abstract-item-role-color\"\n      style={{ backgroundColor: props.color }}\n    />\n    {props.role}\n  </div>\n));\n\nconst mapStateToProps = (state) => ({\n  ontology: state.ontology,\n  segmentConfig: state.segmentConfig,\n  lineConfig: state.lineConfig,\n  currentSegment: state.currentSegment,\n  toolMode: state.toolMode,\n  client: state.client,\n  lineFieldMap: state.lineFieldMap,\n});\nconst mapDispatchToProps = {\n  setLineText,\n  setAttributeFocusInfo,\n};\nexport default connect(mapStateToProps, mapDispatchToProps)(LineAbstractItem);\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}