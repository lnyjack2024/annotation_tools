{"ast":null,"code":"import{Graphics,Point}from'pixi.js';import Cursor from'../../Cursor';/**\n * Control base\n * @class\n */export default class Control{/**\n   * get color\n   * @getter\n   */get color(){return this._color;}/**\n   * set color\n   * @setter\n   */set color(color){const shouldUpdate=this._color!==color;this._color=color;if(shouldUpdate){this.drawControl();}}/**\n   * get scale\n   * @getter\n   */get scale(){return this._scale;}/**\n   * set scale\n   * @setter\n   */set scale(scale){const shouldUpdate=this._scale!==scale;this._scale=scale;if(shouldUpdate){this.drawControl();}}/**\n   * get size\n   * @getter\n   */get size(){return this._size;}/**\n   * set size\n   * @setter\n   */set size(size){const shouldUpdate=this._size!==size;this._size=size;if(shouldUpdate){this.drawControl();}}/**\n   * get selected\n   * @getter\n   */get selected(){return this._selected;}/**\n   * set selected\n   * @setter\n   */set selected(selected){const shouldUpdate=this._selected!==selected;this._selected=selected;if(shouldUpdate){this.drawControl();}}/**\n   * get position\n   * @getter\n   */get position(){return{x:this.control.x,y:this.control.y};}/**\n   * set position\n   * @setter\n   */set position(_ref){let{x,y}=_ref;this.control.x=x;this.control.y=y;}/**\n   * when control posistion change\n   */constructor(_ref2){let{position,container,scale,size,color,cursor,onPositionChange,onFinish,onClick}=_ref2;/**\n   * control instance\n   * @member {PIXI.Graphics}\n   */this.control=new Graphics();/**\n   * control\n   */this.cursor=Cursor.DEFAULT;/**\n   * control container\n   * @member {PIXI.Container}\n   */this.container=void 0;/**\n   * control color\n   * @private {number}\n   */this._color=0xFFFF00;/**\n   * scale factor\n   * @private {number}\n   */this._scale=1;/**\n   * control size\n   * @private {number}\n   */this._size=4;/**\n   * is selected\n   * @private {boolean}\n   */this._selected=false;/**\n   * control position when mouse down\n   * @private {PIXI.Point}\n   */this._downPoint=null;/**\n   * control position when mouse down\n   * @private {PIXI.Point}\n   */this._mousePoint=null;/**\n   * is control dragged\n   * @private {boolean}\n   */this._dragged=false;this.onPositionChange=void 0;/**\n   * when control dragging ends\n   */this.onFinish=void 0;/**\n   * when control is clicked\n   */this.onClick=void 0;/**\n   * control pointer down\n   * @private\n   * @param event\n   */this._handlePointerDown=event=>{event.stopPropagation();this._dragged=false;const point=event.data.getLocalPosition(this.container);this._mousePoint=point;this._downPoint=new Point(this.control.x,this.control.y);if(this.onClick){this.onClick();}};/**\n   * control pointer move\n   * @private\n   * @param event\n   */this._handlePointerMove=event=>{if(this._downPoint||this._mousePoint){this._dragged=true;const point=event.data.getLocalPosition(this.container);this.move(point);if(this.onPositionChange){this.onPositionChange(this.control.x,this.control.y,event);}}};/**\n   * control pointer up\n   * @private\n   * @param event\n   */this._handlePointerUp=event=>{this._downPoint=null;this._mousePoint=null;if(this._dragged){if(this.onPositionChange){this.onPositionChange(this.control.x,this.control.y,event);}if(this.onFinish){this.onFinish();}this._dragged=false;}};// setup\nthis.container=container;this.scale=scale||this.container.scale.x;if(size!==undefined){this._size=size;}if(color!==undefined){this._color=color;}this.onPositionChange=onPositionChange;this.onFinish=onFinish;this.onClick=onClick;this.control.x=position.x;this.control.y=position.y;this.control.interactive=true;// FIXME: use 9999 as max z-index\nthis.control.zIndex=9999;// setup control listeners\nthis.control.on('pointerdown',this._handlePointerDown);this.control.on('pointerup',this._handlePointerUp);this.control.on('pointerupoutside',this._handlePointerUp);this.control.on('pointermove',this._handlePointerMove);if(cursor){this.cursor=cursor;this.control.on('pointerover',()=>{this.control.cursor=this.cursor;});this.control.on('pointerout',()=>{this.control.cursor=Cursor.DEFAULT;});}this.container.addChild(this.control);}/**\n   * draw control\n   */ /**\n   * move control\n   * @param point new position\n   */ /**\n   * add and redraw\n   */add(){this.container.addChild(this.control);this.drawControl();}/**\n   * remove\n   */remove(){this.container.removeChild(this.control);}/**\n   * destroy\n   */destroy(){this.container.removeChild(this.control);this.control.destroy({children:true,texture:true,baseTexture:true});}}","map":{"version":3,"names":["Graphics","Point","Cursor","Control","color","_color","shouldUpdate","drawControl","scale","_scale","size","_size","selected","_selected","position","x","control","y","_ref","constructor","_ref2","container","cursor","onPositionChange","onFinish","onClick","DEFAULT","_downPoint","_mousePoint","_dragged","_handlePointerDown","event","stopPropagation","point","data","getLocalPosition","_handlePointerMove","move","_handlePointerUp","undefined","interactive","zIndex","on","addChild","add","remove","removeChild","destroy","children","texture","baseTexture"],"sources":["/Users/qzheng/Documents/webroot/annotation_tools/src/components/common/shapes/controls/Control.ts"],"sourcesContent":["import { Container, Graphics, Point, InteractionEvent } from 'pixi.js';\nimport Cursor from '../../Cursor';\n\nexport interface ControlOptions {\n  position: {\n    x: number;\n    y: number;\n  };\n  container: Container;\n  scale?: number;\n  size?: number;\n  color?: number;\n  cursor?: Cursor;\n  onPositionChange?: (x: number, y: number, event: InteractionEvent) => void;\n  onFinish?: () => void;\n  onClick?: () => void;\n}\n\n/**\n * Control base\n * @class\n */\nexport default abstract class Control {\n  /**\n   * control instance\n   * @member {PIXI.Graphics}\n   */\n  control = new Graphics();\n\n  /**\n   * control\n   */\n  cursor = Cursor.DEFAULT;\n\n  /**\n   * control container\n   * @member {PIXI.Container}\n   */\n  container: Container;\n\n  /**\n   * control color\n   * @private {number}\n   */\n  private _color = 0xFFFF00;\n\n  /**\n   * scale factor\n   * @private {number}\n   */\n  private _scale = 1;\n\n  /**\n   * control size\n   * @private {number}\n   */\n  private _size = 4;\n\n  /**\n   * is selected\n   * @private {boolean}\n   */\n  private _selected = false;\n\n  /**\n   * control position when mouse down\n   * @private {PIXI.Point}\n   */\n  private _downPoint: Point | null = null;\n\n  /**\n   * control position when mouse down\n   * @private {PIXI.Point}\n   */\n  protected _mousePoint: Point | null = null;\n\n  /**\n   * is control dragged\n   * @private {boolean}\n   */\n  private _dragged = false;\n\n  /**\n   * get color\n   * @getter\n   */\n  get color() {\n    return this._color;\n  }\n\n  /**\n   * set color\n   * @setter\n   */\n  set color(color: number) {\n    const shouldUpdate = this._color !== color;\n    this._color = color;\n    if (shouldUpdate) {\n      this.drawControl();\n    }\n  }\n\n  /**\n   * get scale\n   * @getter\n   */\n  get scale() {\n    return this._scale;\n  }\n\n  /**\n   * set scale\n   * @setter\n   */\n  set scale(scale: number) {\n    const shouldUpdate = this._scale !== scale;\n    this._scale = scale;\n    if (shouldUpdate) {\n      this.drawControl();\n    }\n  }\n\n  /**\n   * get size\n   * @getter\n   */\n  get size() {\n    return this._size;\n  }\n\n  /**\n   * set size\n   * @setter\n   */\n  set size(size: number) {\n    const shouldUpdate = this._size !== size;\n    this._size = size;\n    if (shouldUpdate) {\n      this.drawControl();\n    }\n  }\n\n  /**\n   * get selected\n   * @getter\n   */\n  get selected() {\n    return this._selected;\n  }\n\n  /**\n   * set selected\n   * @setter\n   */\n  set selected(selected: boolean) {\n    const shouldUpdate = this._selected !== selected;\n    this._selected = selected;\n    if (shouldUpdate) {\n      this.drawControl();\n    }\n  }\n\n  /**\n   * get position\n   * @getter\n   */\n  get position() {\n    return {\n      x: this.control.x,\n      y: this.control.y,\n    };\n  }\n\n  /**\n   * set position\n   * @setter\n   */\n  set position({ x, y }: { x: number; y: number; }) {\n    this.control.x = x;\n    this.control.y = y;\n  }\n\n  /**\n   * when control posistion change\n   */\n  onPositionChange?: (x: number, y: number, event: InteractionEvent) => void;\n\n  /**\n   * when control dragging ends\n   */\n  onFinish?: () => void;\n\n  /**\n   * when control is clicked\n   */\n  onClick?: () => void;\n\n  constructor({ position, container, scale, size, color, cursor, onPositionChange, onFinish, onClick }: ControlOptions) {\n    // setup\n    this.container = container;\n    this.scale = scale || this.container.scale.x;\n    if (size !== undefined) {\n      this._size = size;\n    }\n    if (color !== undefined) {\n      this._color = color;\n    }\n    this.onPositionChange = onPositionChange;\n    this.onFinish = onFinish;\n    this.onClick = onClick;\n    this.control.x = position.x;\n    this.control.y = position.y;\n    this.control.interactive = true;\n    // FIXME: use 9999 as max z-index\n    this.control.zIndex = 9999;\n    // setup control listeners\n    this.control.on('pointerdown', this._handlePointerDown);\n    this.control.on('pointerup', this._handlePointerUp);\n    this.control.on('pointerupoutside', this._handlePointerUp);\n    this.control.on('pointermove', this._handlePointerMove);\n    if (cursor) {\n      this.cursor = cursor;\n      this.control.on('pointerover', () => {\n        this.control.cursor = this.cursor;\n      });\n      this.control.on('pointerout', () => {\n        this.control.cursor = Cursor.DEFAULT;\n      });\n    }\n    this.container.addChild(this.control);\n  }\n\n  /**\n   * draw control\n   */\n  abstract drawControl(): void;\n\n  /**\n   * move control\n   * @param point new position\n   */\n  abstract move(point: Point): void;\n\n  /**\n   * add and redraw\n   */\n  add() {\n    this.container.addChild(this.control);\n    this.drawControl();\n  }\n\n  /**\n   * remove\n   */\n  remove() {\n    this.container.removeChild(this.control);\n  }\n\n  /**\n   * destroy\n   */\n  destroy() {\n    this.container.removeChild(this.control);\n    this.control.destroy({\n      children: true,\n      texture: true,\n      baseTexture: true,\n    });\n  }\n\n  /**\n   * control pointer down\n   * @private\n   * @param event\n   */\n  private _handlePointerDown = (event: InteractionEvent) => {\n    event.stopPropagation();\n    this._dragged = false;\n    const point = event.data.getLocalPosition(this.container);\n    this._mousePoint = point;\n    this._downPoint = new Point(this.control.x, this.control.y);\n    if (this.onClick) {\n      this.onClick();\n    }\n  };\n\n  /**\n   * control pointer move\n   * @private\n   * @param event\n   */\n  private _handlePointerMove = (event: InteractionEvent) => {\n    if (this._downPoint || this._mousePoint) {\n      this._dragged = true;\n      const point = event.data.getLocalPosition(this.container);\n      this.move(point);\n      if (this.onPositionChange) {\n        this.onPositionChange(this.control.x, this.control.y, event);\n      }\n    }\n  };\n\n  /**\n   * control pointer up\n   * @private\n   * @param event\n   */\n  private _handlePointerUp = (event: InteractionEvent) => {\n    this._downPoint = null;\n    this._mousePoint = null;\n    if (this._dragged) {\n      if (this.onPositionChange) {\n        this.onPositionChange(this.control.x, this.control.y, event);\n      }\n      if (this.onFinish) {\n        this.onFinish();\n      }\n      this._dragged = false;\n    }\n  };\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}