{"ast":null,"code":"import React,{useEffect,useState}from'react';import{connect}from'react-redux';import'./LineDetail.scss';import EasyForm from'@appen-china/easy-form';import LineRoleRadio from'../LineRoleRadio/LineRoleRadio';import LineText from'../LineText/LineText';import{deleteLine,setLineCategory,setLineAttributes,toppingLine,setLineRole}from'../../../redux/action';import{triggerForm}from'../../../constants';import{isAnnotationReadonly}from'../../../../../utils/tool-mode';import DeleteIcon from'../../common/Icons/DeleteIcon';const LineDetail=props=>{const{line,lineIndex,lineConfig,currentRoles,toolMode,currentVideo,currentSegment,annotateDisabled}=props;const handleButtonClick=(e,type)=>{switch(type){case'delete':props.deleteLine({videoIndex:null,segmentIndex:currentSegment,lineIndex,role:line.role});break;case'topping':props.toppingLine({videoIndex:null,segmentIndex:currentSegment,lineIndex});break;default:break;}};const[lineFormConfig,setLineFormConfig]=useState({});const[hasEfOntology,setHasEfOntology]=useState(false);useEffect(()=>{const{fields}=lineConfig;const efOntology=fields.find(f=>f.name==='ef-ontology');setHasEfOntology(!!efOntology);},[lineConfig]);useEffect(()=>{const readonly=isAnnotationReadonly(toolMode)||annotateDisabled;const fields=lineConfig.fields.map(v=>({...v,readonly:readonly||v.readonly,defaultValue:v.name==='role'||v.name==='ef-ontology'?line.role:line.attributes[v.name],optionType:v.type==='RADIO'?'button':'default'}));setLineFormConfig({...lineConfig,fields,footerVisible:false});changeEfOntology(line.role);},[currentSegment,annotateDisabled,line.role]);const changeEfOntology=role=>{var _line$attributes;if(role!==((_line$attributes=line.attributes)===null||_line$attributes===void 0?void 0:_line$attributes['ef-ontology'])&&hasEfOntology){const{updatedValues}=triggerForm(lineFormConfig,{...line.attributes,'ef-ontology':role});props.setLineAttributes({videoIndex:currentVideo,segmentIndex:currentSegment,lineIndex,attributes:updatedValues});}};const changeLineCategory=data=>{const attributes={...line.attributes,...data};const{updatedValues}=triggerForm(lineFormConfig,attributes);const{role,...values}=updatedValues;props.setLineAttributes({videoIndex:currentVideo,segmentIndex:currentSegment,lineIndex,attributes:values});if(role!==undefined){props.setLineRole({lineIndex,role});}};return/*#__PURE__*/React.createElement(\"div\",{className:\"line-detail-container line-attributes-\".concat(lineIndex)},/*#__PURE__*/React.createElement(\"button\",{className:\"line-detail-button\",style:{display:lineIndex===0?'none':'block'},onClick:e=>handleButtonClick(e,'delete'),disabled:annotateDisabled},/*#__PURE__*/React.createElement(DeleteIcon,null)),/*#__PURE__*/React.createElement(LineRoleRadio,{role:line.role,index:lineIndex,currentRoles:currentRoles}),/*#__PURE__*/React.createElement(LineText,{text:line.text,lineIndex:lineIndex}),/*#__PURE__*/React.createElement(EasyForm,Object.assign({theme:\"dark\",autoFocus:false},lineFormConfig&&lineFormConfig,{onChange:changeLineCategory})));};const mapStateToProps=state=>({ontology:state.ontology,segmentConfig:state.segmentConfig,lineConfig:state.lineConfig,currentSegment:state.currentSegment,toolMode:state.toolMode,results:state.results,currentVideo:state.currentVideo,annotateDisabled:state.annotateDisabled});const mapDispatchToProps={deleteLine,toppingLine,setLineCategory,setLineAttributes,setLineRole};export default connect(mapStateToProps,mapDispatchToProps)(LineDetail);","map":{"version":3,"names":["React","useEffect","useState","connect","EasyForm","LineRoleRadio","LineText","deleteLine","setLineCategory","setLineAttributes","toppingLine","setLineRole","triggerForm","isAnnotationReadonly","DeleteIcon","LineDetail","props","line","lineIndex","lineConfig","currentRoles","toolMode","currentVideo","currentSegment","annotateDisabled","handleButtonClick","e","type","videoIndex","segmentIndex","role","lineFormConfig","setLineFormConfig","hasEfOntology","setHasEfOntology","fields","efOntology","find","f","name","readonly","map","v","defaultValue","attributes","optionType","footerVisible","changeEfOntology","_line$attributes","updatedValues","changeLineCategory","data","values","undefined","createElement","className","concat","style","display","onClick","disabled","index","text","Object","assign","theme","autoFocus","onChange","mapStateToProps","state","ontology","segmentConfig","results","mapDispatchToProps"],"sources":["/Users/qzheng/Documents/webroot/annotation_tools/src/components/long-audio/components/SegmentDetail/LineDetail/LineDetail.jsx"],"sourcesContent":["import React, { useEffect, useState } from 'react';\nimport { connect } from 'react-redux';\nimport './LineDetail.scss';\nimport EasyForm from '@appen-china/easy-form';\nimport LineRoleRadio from '../LineRoleRadio/LineRoleRadio';\nimport LineText from '../LineText/LineText';\nimport { deleteLine, setLineCategory, setLineAttributes, toppingLine, setLineRole } from '../../../redux/action';\nimport { triggerForm } from '../../../constants';\nimport { isAnnotationReadonly } from '../../../../../utils/tool-mode';\nimport DeleteIcon from '../../common/Icons/DeleteIcon';\n\nconst LineDetail = (props) => {\n  const { line, lineIndex, lineConfig, currentRoles, toolMode, currentVideo, currentSegment, annotateDisabled } = props;\n  const handleButtonClick = (e, type) => {\n    switch (type) {\n      case 'delete':\n        props.deleteLine({\n          videoIndex: null,\n          segmentIndex: currentSegment,\n          lineIndex,\n          role: line.role,\n        });\n        break;\n      case 'topping':\n        props.toppingLine({\n          videoIndex: null,\n          segmentIndex: currentSegment,\n          lineIndex,\n        });\n        break;\n      default:\n        break;\n    }\n  };\n  const [lineFormConfig, setLineFormConfig] = useState({});\n  const [hasEfOntology, setHasEfOntology] = useState(false);\n\n  useEffect(() => {\n    const { fields } = lineConfig;\n    const efOntology = fields.find((f) => f.name === 'ef-ontology');\n    setHasEfOntology(!!efOntology);\n  }, [lineConfig]);\n\n  useEffect(() => {\n    const readonly = isAnnotationReadonly(toolMode) || annotateDisabled;\n    const fields = lineConfig.fields.map((v) => ({\n      ...v,\n      readonly: readonly || v.readonly,\n      defaultValue: (v.name === 'role' || v.name === 'ef-ontology') ? line.role : line.attributes[v.name],\n      optionType: v.type === 'RADIO' ? 'button' : 'default',\n    }));\n    setLineFormConfig({\n      ...lineConfig,\n      fields,\n      footerVisible: false,\n    });\n    changeEfOntology(line.role);\n  }, [currentSegment, annotateDisabled, line.role]);\n\n  const changeEfOntology = (role) => {\n    if (role !== line.attributes?.['ef-ontology'] && hasEfOntology) {\n      const { updatedValues } = triggerForm(lineFormConfig, { ...line.attributes, 'ef-ontology': role });\n      props.setLineAttributes({\n        videoIndex: currentVideo,\n        segmentIndex: currentSegment,\n        lineIndex,\n        attributes: updatedValues\n      });\n    }\n  };\n\n  const changeLineCategory = (data) => {\n    const attributes = {\n      ...line.attributes,\n      ...data,\n    };\n    const { updatedValues } = triggerForm(lineFormConfig, attributes);\n    const { role, ...values } = updatedValues;\n\n    props.setLineAttributes({\n      videoIndex: currentVideo,\n      segmentIndex: currentSegment,\n      lineIndex,\n      attributes: values\n    });\n\n    if (role !== undefined) {\n      props.setLineRole({\n        lineIndex,\n        role,\n      });\n    }\n  };\n\n  return (\n    <div className={`line-detail-container line-attributes-${lineIndex}`}>\n      <button\n        className=\"line-detail-button\"\n        style={{ display: lineIndex === 0 ? 'none' : 'block' }}\n        onClick={(e) => handleButtonClick(e, 'delete')}\n        disabled={annotateDisabled}\n      >\n        <DeleteIcon />\n      </button>\n      {/* <button\n        className=\"line-detail-button\"\n        style={{ display: lineIndex === 0 ? 'none' : 'block' }}\n        onClick={e => handleButtonClick(e, 'topping')}\n      >\n        topping\n      </button> */}\n      <LineRoleRadio\n        role={line.role}\n        index={lineIndex}\n        currentRoles={currentRoles}\n      />\n      <LineText\n        text={line.text}\n        lineIndex={lineIndex}\n      />\n      <EasyForm\n        theme=\"dark\"\n        autoFocus={false}\n        {...lineFormConfig && lineFormConfig}\n        onChange={changeLineCategory}\n      />\n    </div>\n  );\n};\n\nconst mapStateToProps = (state) => ({\n  ontology: state.ontology,\n  segmentConfig: state.segmentConfig,\n  lineConfig: state.lineConfig,\n  currentSegment: state.currentSegment,\n  toolMode: state.toolMode,\n  results: state.results,\n  currentVideo: state.currentVideo,\n  annotateDisabled: state.annotateDisabled,\n});\nconst mapDispatchToProps = {\n  deleteLine,\n  toppingLine,\n  setLineCategory,\n  setLineAttributes,\n  setLineRole,\n};\nexport default connect(mapStateToProps, mapDispatchToProps)(LineDetail);\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}