{"ast":null,"code":"var _jsxFileName = \"/Users/qzheng/Documents/webroot/annotation_tools/src/components/common/llm/attributes-config/AttributesConfig.tsx\";\nimport React, { useEffect, useState, useMemo, useImperativeHandle, forwardRef } from 'react';\nimport { Base64 } from 'js-base64';\nimport EasyForm from '@appen-china/easy-form';\nimport { validate } from '@appen-china/easy-form/es/utils';\nimport { parseFields } from 'src/utils/form';\nimport AttributeValueItem from './AttributeValueItem';\nimport './AttributesConfig.scss';\nconst AttributesConfig = forwardRef(({\n  config: defaultConfig,\n  value: attributes,\n  onChange,\n  disabled\n}, ref) => {\n  if (!defaultConfig) {\n    return null;\n  }\n  const [formConfig, setFormConfig] = useState();\n  useEffect(() => {\n    const configStr = Base64.decode(defaultConfig || '');\n    if (configStr) {\n      try {\n        const parsedConfig = JSON.parse(configStr);\n        setFormConfig(parsedConfig);\n      } catch (error) {\n        // parse error\n        setFormConfig(undefined);\n      }\n    } else {\n      setFormConfig(undefined);\n    }\n  }, [defaultConfig]);\n  const fieldsMap = useMemo(() => parseFields(formConfig), [formConfig]);\n  // fields with initial value\n  const fieldsWithInitialValue = useMemo(() => ((formConfig === null || formConfig === void 0 ? void 0 : formConfig.fields) || []).map(field => ({\n    ...field,\n    readonly: disabled || field.readonly,\n    ...(attributes && attributes[field.name] !== undefined && {\n      defaultValue: attributes[field.name]\n    })\n  })), [formConfig, attributes]);\n  const handleValuesChange = (changedValues, values) => {\n    if (!values || values.length === 0) {\n      // empty form\n      onChange(undefined);\n    } else {\n      onChange(values);\n    }\n  };\n  const validateForm = () => {\n    if (formConfig) {\n      if (!attributes) {\n        return false;\n      }\n      return validate(formConfig, attributes);\n    }\n    return true;\n  };\n  useImperativeHandle(ref, () => ({\n    validateForm\n  }));\n  const renderAttributes = () => {\n    const fieldKeys = Object.keys(fieldsMap);\n    const attrKeys = attributes ? Object.keys(attributes) : [];\n    const legacyKeys = attrKeys.filter(key => !fieldKeys.includes(key));\n    return /*#__PURE__*/React.createElement(React.Fragment, null, [...fieldKeys, ...legacyKeys].map(key => attrKeys.includes(key) && /*#__PURE__*/React.createElement(AttributeValueItem, {\n      key: key,\n      fieldName: key,\n      fieldsMap: fieldsMap,\n      values: attributes,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 83,\n        columnNumber: 13\n      }\n    })));\n  };\n  return /*#__PURE__*/React.createElement(\"div\", {\n    className: \"llm-attributes-config\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 96,\n      columnNumber: 5\n    }\n  }, !disabled ? /*#__PURE__*/React.createElement(EasyForm, {\n    fields: fieldsWithInitialValue,\n    conditions: formConfig === null || formConfig === void 0 ? void 0 : formConfig.conditions,\n    effects: formConfig === null || formConfig === void 0 ? void 0 : formConfig.effects,\n    rules: formConfig === null || formConfig === void 0 ? void 0 : formConfig.rules,\n    onChange: handleValuesChange,\n    onSubmit: () => {},\n    footerVisible: false,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 98,\n      columnNumber: 9\n    }\n  }) : renderAttributes());\n});\nexport default AttributesConfig;","map":{"version":3,"names":["React","useEffect","useState","useMemo","useImperativeHandle","forwardRef","Base64","EasyForm","validate","parseFields","AttributeValueItem","AttributesConfig","config","defaultConfig","value","attributes","onChange","disabled","ref","formConfig","setFormConfig","configStr","decode","parsedConfig","JSON","parse","error","undefined","fieldsMap","fieldsWithInitialValue","fields","map","field","readonly","name","defaultValue","handleValuesChange","changedValues","values","length","validateForm","renderAttributes","fieldKeys","Object","keys","attrKeys","legacyKeys","filter","key","includes","createElement","Fragment","fieldName","__self","__source","fileName","_jsxFileName","lineNumber","columnNumber","className","conditions","effects","rules","onSubmit","footerVisible"],"sources":["/Users/qzheng/Documents/webroot/annotation_tools/src/components/common/llm/attributes-config/AttributesConfig.tsx"],"sourcesContent":["import React, { useEffect, useState, useMemo, useImperativeHandle, forwardRef } from 'react';\nimport { Base64 } from 'js-base64';\nimport EasyForm from '@appen-china/easy-form';\nimport { FormConfig } from '@appen-china/easy-form/es/types';\nimport { validate } from '@appen-china/easy-form/es/utils';\nimport { parseFields } from 'src/utils/form';\nimport AttributeValueItem from './AttributeValueItem';\nimport './AttributesConfig.scss';\n\ninterface AttributesConfigProps {\n  config: string;\n  onChange: (val: any) => void;\n  disabled?: boolean;\n  value?: {[key: string]: any};\n}\nexport interface AttributesConfigHandle {\n  validateForm: () => boolean;\n}\n\nconst AttributesConfig = forwardRef<AttributesConfigHandle, AttributesConfigProps>(({ config: defaultConfig, value: attributes, onChange, disabled }, ref) => {\n  if (!defaultConfig) {\n    return null;\n  }\n  const [formConfig, setFormConfig] = useState<FormConfig>();\n\n  useEffect(() => {\n    const configStr = Base64.decode(defaultConfig || '');\n    if (configStr) {\n      try {\n        const parsedConfig = JSON.parse(configStr);\n        setFormConfig(parsedConfig);\n      } catch (error) {\n        // parse error\n        setFormConfig(undefined);\n      }\n    } else {\n      setFormConfig(undefined);\n    }\n  }, [defaultConfig]);\n\n  const fieldsMap = useMemo(() => parseFields(formConfig), [formConfig]);\n  // fields with initial value\n  const fieldsWithInitialValue = useMemo(() => (formConfig?.fields || []).map((field) => ({\n    ...field,\n    readonly: disabled || field.readonly,\n    ...attributes && attributes[field.name] !== undefined && {\n      defaultValue: attributes[field.name],\n    }\n  })), [formConfig, attributes]);\n\n  const handleValuesChange = (changedValues:any, values: any) => {\n    if (!values || values.length === 0) {\n      // empty form\n      onChange(undefined);\n    } else {\n      onChange(values);\n    }\n  };\n\n  const validateForm = () => {\n    if (formConfig) {\n      if (!attributes) {\n        return false;\n      }\n      return validate(formConfig, attributes);\n    }\n    return true;\n  };\n\n  useImperativeHandle(ref, () => ({\n    validateForm\n  }));\n\n  const renderAttributes = () => {\n    const fieldKeys = Object.keys(fieldsMap);\n    const attrKeys = attributes ? Object.keys(attributes) : [];\n    const legacyKeys = attrKeys.filter((key) => !fieldKeys.includes(key));\n\n    return (\n      <>\n        {\n          [...fieldKeys, ...legacyKeys].map((key) => attrKeys.includes(key) && (\n            <AttributeValueItem\n              key={key}\n              fieldName={key}\n              fieldsMap={fieldsMap}\n              values={attributes}\n            />\n          ))\n        }\n      </>\n    );\n  };\n\n  return (\n    <div className=\"llm-attributes-config\">\n      {!disabled ? (\n        <EasyForm\n          fields={fieldsWithInitialValue}\n          conditions={formConfig?.conditions}\n          effects={formConfig?.effects}\n          rules={formConfig?.rules}\n          onChange={handleValuesChange}\n          onSubmit={() => {}}\n          footerVisible={false}\n        />\n      ) : renderAttributes()}\n    </div>\n  );\n});\nexport default AttributesConfig;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}