{"ast":null,"code":"import _applyDecoratedDescriptor from\"/Users/qzheng/Documents/webroot/annotation_tools/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/applyDecoratedDescriptor\";var _class;import{observable,computed,action,makeObservable}from'mobx';let UndoStore=(_class=class UndoStore{constructor(rootStore){this.rootStore=void 0;this.savedStatus=[];this.pointer=0;this.actionPointer=0;makeObservable(this,{pointer:observable,undo:action,redo:action,saveStatus:action});this.rootStore=rootStore;}get undoDisabled(){return this.pointer<=0;}get redoDisabled(){return this.pointer>=this.savedStatus.length;}undo(){if(this.pointer>0){this.pointer-=1;this.actionPointer-=1;return this.savedStatus[this.pointer];}return null;}redo(){if(this.pointer<this.savedStatus.length){this.pointer+=1;this.actionPointer+=1;return this.savedStatus[this.pointer-1];}return null;}saveStatus(before,after){let insertPrev=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;this.savedStatus=this.savedStatus.slice(0,this.pointer);const lenIndex=this.savedStatus.length-1;if(insertPrev&&lenIndex>=0){const{before:prevBefore,after:prevAfter}=this.savedStatus[lenIndex];this.savedStatus[lenIndex]={before:[...prevBefore,...before],after:[...prevAfter,...after]};}else{this.savedStatus.push({before,after});if(this.savedStatus.length>30){this.savedStatus.shift();}else{this.pointer+=1;}}this.actionPointer+=1;}},(_applyDecoratedDescriptor(_class.prototype,\"undoDisabled\",[computed],Object.getOwnPropertyDescriptor(_class.prototype,\"undoDisabled\"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,\"redoDisabled\",[computed],Object.getOwnPropertyDescriptor(_class.prototype,\"redoDisabled\"),_class.prototype)),_class);export default UndoStore;","map":{"version":3,"names":["observable","computed","action","makeObservable","UndoStore","_class","constructor","rootStore","savedStatus","pointer","actionPointer","undo","redo","saveStatus","undoDisabled","redoDisabled","length","before","after","insertPrev","arguments","undefined","slice","lenIndex","prevBefore","prevAfter","push","shift","_applyDecoratedDescriptor","prototype","Object","getOwnPropertyDescriptor"],"sources":["/Users/qzheng/Documents/webroot/annotation_tools/src/components/keypoint/store/UndoStore.ts"],"sourcesContent":["import { observable, computed, action, makeObservable } from 'mobx';\nimport { RootStoreType } from './RootStore';\nimport { UpdatedShape, CategoryPathShapeStatus, InstanceStatus, GroupStatus, Review, HandleStatus } from '../types';\n\nexport interface StatusItem {\n  before: Status[];\n  after: Status[];\n}\n\nexport type Status =\n  { type: 'shape'; status: UpdatedShape; } |\n  { type: 'pointCategory-path-shape'; status: CategoryPathShapeStatus; } |\n  { type: 'instance'; status: InstanceStatus; } |\n  { type: 'group'; status: GroupStatus; } |\n  { type: 'reviews'; status: Review[]; } |\n  { type: 'handle'; status: HandleStatus[]; };\n\nclass UndoStore {\n  rootStore: RootStoreType;\n\n  savedStatus: StatusItem[] = [];\n\n  pointer = 0;\n\n  actionPointer = 0;\n\n  constructor(rootStore: RootStoreType) {\n    makeObservable(this, {\n      pointer: observable,\n      undo: action,\n      redo: action,\n      saveStatus: action\n    });\n    this.rootStore = rootStore;\n  }\n\n  @computed get undoDisabled() {\n    return this.pointer <= 0;\n  }\n\n  @computed get redoDisabled() {\n    return this.pointer >= this.savedStatus.length;\n  }\n\n  undo() {\n    if (this.pointer > 0) {\n      this.pointer -= 1;\n      this.actionPointer -= 1;\n      return this.savedStatus[this.pointer];\n    }\n    return null;\n  }\n\n  redo() {\n    if (this.pointer < this.savedStatus.length) {\n      this.pointer += 1;\n      this.actionPointer += 1;\n      return this.savedStatus[this.pointer - 1];\n    }\n    return null;\n  }\n\n  saveStatus(before: Status[], after: Status[], insertPrev = false) {\n    this.savedStatus = this.savedStatus.slice(0, this.pointer);\n    const lenIndex = this.savedStatus.length - 1;\n    if (insertPrev && lenIndex >= 0) {\n      const { before: prevBefore, after: prevAfter } = this.savedStatus[lenIndex];\n      this.savedStatus[lenIndex] = {\n        before: [...prevBefore, ...before],\n        after: [...prevAfter, ...after]\n      };\n    } else {\n      this.savedStatus.push({ before, after });\n      if (this.savedStatus.length > 30) {\n        this.savedStatus.shift();\n      } else {\n        this.pointer += 1;\n      }\n    }\n    this.actionPointer += 1;\n  }\n}\n\nexport default UndoStore;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}