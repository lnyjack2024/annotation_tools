{"ast":null,"code":"import React,{useRef,useState}from'react';import{toJS}from'mobx';import{observer}from'mobx-react';import cx from'classnames';import{Up,Pencil}from'../../../common/icons';import AttributeValueItem from'./AttributeValueItem';import store from'../../store/RootStore';import i18n from'../../locales';import{parseFields}from'../../utils';import'./PointAttributes.scss';const PointAttributes=observer(()=>{var _toJS$points$selected;const[collapsed,setCollapsed]=useState(false);// refs\nconst ref=useRef(null);const{selectedShapes,selectedPointIndex}=store.shape;if(selectedShapes.length!==1||selectedPointIndex<0){// no selected point\nreturn null;}const selectedShape=selectedShapes[0];const{instanceItem}=store.shape.shapes[selectedShape.uid];const frameData=instanceItem.cameras[store.frame.currentCamera].frames[store.frame.currentFrame];if(!frameData){return null;}const{pointLabelConfig}=instanceItem.categoryItemRef;if(!pointLabelConfig){// no config\nreturn null;}const pointUserData=((_toJS$points$selected=toJS(frameData.shape).points[selectedPointIndex])===null||_toJS$points$selected===void 0?void 0:_toJS$points$selected.userData)||{};const fieldsMap=parseFields(pointLabelConfig);const attrKeys=Object.keys(pointUserData);const fieldKeys=Object.keys(fieldsMap);const renderAttrs=()=>{const legacyKeys=attrKeys.filter(key=>!fieldKeys.includes(key));return/*#__PURE__*/React.createElement(\"div\",null,[...fieldKeys,...legacyKeys].map(key=>attrKeys.includes(key)&&/*#__PURE__*/React.createElement(AttributeValueItem,{key:key,fieldName:key,fieldsMap:fieldsMap,values:pointUserData})));};return/*#__PURE__*/React.createElement(\"div\",{className:cx('collapse-panel point-attributes-panel',{collapsed}),ref:ref},/*#__PURE__*/React.createElement(\"div\",{className:\"collapse-panel-title space-between\",onClick:()=>setCollapsed(!collapsed)},/*#__PURE__*/React.createElement(\"span\",null,/*#__PURE__*/React.createElement(\"div\",{className:\"collapse-panel-collapse-icon\"},/*#__PURE__*/React.createElement(Up,null)),i18n.translate('POINT_ATTRIBUTES')),/*#__PURE__*/React.createElement(\"span\",null,!store.readonly&&/*#__PURE__*/React.createElement(\"div\",{className:\"collapse-panel-icon\",onClick:e=>{e.stopPropagation();store.config.setPointAttributesModalVisible(true);}},/*#__PURE__*/React.createElement(Pencil,null)))),/*#__PURE__*/React.createElement(\"div\",{className:\"collapse-panel-content\"},/*#__PURE__*/React.createElement(\"div\",{className:\"point-title\"},i18n.translate('POINT_INDEX_LABEL',{values:{index:selectedPointIndex+1}})),renderAttrs()));});export default PointAttributes;","map":{"version":3,"names":["React","useRef","useState","toJS","observer","cx","Up","Pencil","AttributeValueItem","store","i18n","parseFields","PointAttributes","_toJS$points$selected","collapsed","setCollapsed","ref","selectedShapes","selectedPointIndex","shape","length","selectedShape","instanceItem","shapes","uid","frameData","cameras","frame","currentCamera","frames","currentFrame","pointLabelConfig","categoryItemRef","pointUserData","points","userData","fieldsMap","attrKeys","Object","keys","fieldKeys","renderAttrs","legacyKeys","filter","key","includes","createElement","map","fieldName","values","className","onClick","translate","readonly","e","stopPropagation","config","setPointAttributesModalVisible","index"],"sources":["/Users/qzheng/Documents/webroot/annotation_tools/src/components/video-tracking2/components/attributes/PointAttributes.tsx"],"sourcesContent":["import React, { useRef, useState } from 'react';\nimport { toJS } from 'mobx';\nimport { observer } from 'mobx-react';\nimport cx from 'classnames';\nimport { Up, Pencil } from '../../../common/icons';\nimport AttributeValueItem from './AttributeValueItem';\nimport store from '../../store/RootStore';\nimport i18n from '../../locales';\nimport { parseFields } from '../../utils';\nimport { PolygonData } from '../../../common/shapes/Polygon';\nimport { LineData } from '../../../common/shapes/Line';\nimport './PointAttributes.scss';\n\nconst PointAttributes = observer(() => {\n  const [collapsed, setCollapsed] = useState(false);\n\n  // refs\n  const ref = useRef<HTMLDivElement>(null);\n\n  const { selectedShapes, selectedPointIndex } = store.shape;\n  if (selectedShapes.length !== 1 || selectedPointIndex < 0) {\n    // no selected point\n    return null;\n  }\n\n  const selectedShape = selectedShapes[0];\n  const { instanceItem } = store.shape.shapes[selectedShape.uid];\n  const frameData = instanceItem.cameras[store.frame.currentCamera].frames[store.frame.currentFrame];\n  if (!frameData) {\n    return null;\n  }\n\n  const { pointLabelConfig } = instanceItem.categoryItemRef;\n  if (!pointLabelConfig) {\n    // no config\n    return null;\n  }\n\n  const pointUserData = toJS(frameData.shape as PolygonData | LineData).points[selectedPointIndex]?.userData || {};\n\n  const fieldsMap = parseFields(pointLabelConfig);\n  const attrKeys = Object.keys(pointUserData);\n  const fieldKeys = Object.keys(fieldsMap);\n\n  const renderAttrs = () => {\n    const legacyKeys = attrKeys.filter((key) => !fieldKeys.includes(key));\n    return (\n      <div>\n        {[...fieldKeys, ...legacyKeys].map((key) => attrKeys.includes(key) && (\n          <AttributeValueItem\n            key={key}\n            fieldName={key}\n            fieldsMap={fieldsMap}\n            values={pointUserData}\n          />\n        ))}\n      </div>\n    );\n  };\n\n  return (\n    <div className={cx('collapse-panel point-attributes-panel', { collapsed })} ref={ref}>\n      <div\n        className=\"collapse-panel-title space-between\"\n        onClick={() => setCollapsed(!collapsed)}\n      >\n        <span>\n          <div className=\"collapse-panel-collapse-icon\">\n            <Up />\n          </div>\n          {i18n.translate('POINT_ATTRIBUTES')}\n        </span>\n        <span>\n          {!store.readonly && (\n            <div\n              className=\"collapse-panel-icon\"\n              onClick={(e) => {\n                e.stopPropagation();\n                store.config.setPointAttributesModalVisible(true);\n              }}\n            >\n              <Pencil />\n            </div>\n          )}\n        </span>\n      </div>\n      <div className=\"collapse-panel-content\">\n        <div className=\"point-title\">{i18n.translate('POINT_INDEX_LABEL', { values: { index: selectedPointIndex + 1 } })}</div>\n        {renderAttrs()}\n      </div>\n    </div>\n  );\n});\n\nexport default PointAttributes;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}