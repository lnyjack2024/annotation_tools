{"ast":null,"code":"import { v4 as uuidv4 } from 'uuid';\nimport { CONNECTION_MARKER_ARROW } from '../constants';\nconst SVGNS = 'http://www.w3.org/2000/svg';\nexport default class Connection {\n  set from(position) {\n    this.fromPosition = {\n      x: position.x,\n      y: position.y\n    };\n    this.updateLine();\n  }\n  set to(position) {\n    this.toPosition = {\n      x: position.x,\n      y: position.y\n    };\n    this.updateLine();\n  }\n  set name(name) {\n    this.text.innerHTML = name;\n  }\n  set interactive(editable) {\n    if (editable) {\n      this.rect.style.pointerEvents = 'auto';\n    } else {\n      this.rect.style.pointerEvents = 'none';\n    }\n  }\n  set visible(visible) {\n    this.group.style.display = visible ? 'block' : 'none';\n  }\n  set selected(selected) {\n    if (selected) {\n      this.rect.setAttribute('stroke-width', '1');\n    } else {\n      this.rect.setAttribute('stroke-width', '0');\n    }\n  }\n\n  // eslint-disable-next-line class-methods-use-this\n  get container() {\n    return document.getElementById(this.containerId);\n  }\n  constructor({\n    containerId,\n    from,\n    to,\n    text,\n    interactive = true,\n    visible = true,\n    onClick = () => {},\n    onRightClick = () => {}\n  }) {\n    var _this$container;\n    this.id = void 0;\n    this.containerId = void 0;\n    this.fromPosition = void 0;\n    this.toPosition = void 0;\n    this.line = void 0;\n    this.rect = void 0;\n    this.text = void 0;\n    this.group = void 0;\n    this.id = uuidv4();\n    this.containerId = containerId;\n    this.fromPosition = {\n      x: from.x,\n      y: from.y\n    };\n    this.toPosition = {\n      x: to.x,\n      y: to.y\n    };\n    this.line = document.createElementNS(SVGNS, 'path');\n    this.line.setAttribute('stroke', '#FFAFFE');\n    this.line.setAttribute('fill', 'none');\n    this.line.setAttribute('marker-end', `url(#${CONNECTION_MARKER_ARROW})`);\n    this.rect = document.createElementNS(SVGNS, 'rect');\n    this.rect.setAttribute('fill', '#FFAFFE');\n    this.rect.setAttribute('stroke', '#FFED00');\n    this.rect.setAttribute('stroke-width', '0');\n    this.rect.setAttribute('rx', '2');\n    this.rect.setAttribute('ry', '2');\n    this.interactive = interactive;\n    this.rect.style.cursor = 'pointer';\n    this.rect.addEventListener('contextmenu', e => e.preventDefault());\n    this.rect.addEventListener('mousedown', e => {\n      e.preventDefault();\n      if (e.buttons === 2) {\n        onRightClick(this);\n      } else {\n        onClick(this);\n      }\n    });\n    this.text = document.createElementNS(SVGNS, 'text');\n    this.text.innerHTML = text;\n    this.text.style.fontSize = '12px';\n    this.text.style.fontWeight = '400';\n    this.text.setAttribute('fill', '#252935');\n    this.group = document.createElementNS(SVGNS, 'g');\n    this.group.style.display = visible ? 'block' : 'none';\n    this.group.appendChild(this.line);\n    this.group.appendChild(this.rect);\n    this.group.appendChild(this.text);\n    (_this$container = this.container) === null || _this$container === void 0 ? void 0 : _this$container.appendChild(this.group);\n    this.updateLine();\n  }\n  updateLine() {\n    var _this$container2;\n    const {\n      x = 0,\n      y = 0\n    } = ((_this$container2 = this.container) === null || _this$container2 === void 0 ? void 0 : _this$container2.getBoundingClientRect()) || {};\n    const fx = this.fromPosition.x - x;\n    const fy = this.fromPosition.y - y;\n    const tx = this.toPosition.x - x;\n    const ty = this.toPosition.y - y;\n    const right = fx + 20;\n    const top = ty - fy >= 20 && tx - fx >= 20 ? fy : Math.min(fy, ty) - 20;\n    this.line.setAttribute('d', `\n      M ${fx} ${fy}\n      L ${right} ${fy}\n      L ${right} ${top}\n      L ${tx} ${top}\n      L ${tx} ${ty}\n    `);\n    const use1st = Math.abs(fy - top) > Math.abs(tx - right);\n    const cx = use1st ? right : (tx + right) / 2;\n    const cy = use1st ? (fy + top) / 2 : top;\n    const {\n      width,\n      height\n    } = this.text.getBoundingClientRect();\n    this.rect.setAttribute('width', `${width + 4}`);\n    this.rect.setAttribute('height', `${height + 2}`);\n    this.rect.setAttribute('x', `${cx - width / 2 - 2}`);\n    this.rect.setAttribute('y', `${cy - height / 2 - 1}`);\n    this.text.setAttribute('x', `${cx - width / 2}`);\n    this.text.setAttribute('y', `${cy + 5}`);\n  }\n  remove() {\n    this.line.remove();\n    this.rect.remove();\n    this.text.remove();\n  }\n}","map":{"version":3,"names":["v4","uuidv4","CONNECTION_MARKER_ARROW","SVGNS","Connection","from","position","fromPosition","x","y","updateLine","to","toPosition","name","text","innerHTML","interactive","editable","rect","style","pointerEvents","visible","group","display","selected","setAttribute","container","document","getElementById","containerId","constructor","onClick","onRightClick","_this$container","id","line","createElementNS","cursor","addEventListener","e","preventDefault","buttons","fontSize","fontWeight","appendChild","_this$container2","getBoundingClientRect","fx","fy","tx","ty","right","top","Math","min","use1st","abs","cx","cy","width","height","remove"],"sources":["/Users/qzheng/Documents/webroot/annotation_tools/src/components/video-tracking2/view/Connection.ts"],"sourcesContent":["import { v4 as uuidv4 } from 'uuid';\nimport { CONNECTION_MARKER_ARROW } from '../constants';\n\ninterface Position {\n  x: number;\n  y: number;\n}\n\ninterface ConnectionProps {\n  containerId: string;\n  from: Position;\n  to: Position;\n  text: string;\n  interactive?: boolean;\n  visible?: boolean;\n  onClick?: (connection: Connection) => void;\n  onRightClick?: (connection: Connection) => void;\n}\n\nconst SVGNS = 'http://www.w3.org/2000/svg';\n\nexport default class Connection {\n  id: string;\n\n  containerId: string;\n\n  fromPosition: Position;\n\n  toPosition: Position;\n\n  line: SVGPathElement;\n\n  rect: SVGRectElement;\n\n  text: SVGTextElement;\n\n  group: SVGGElement;\n\n  set from(position: Position) {\n    this.fromPosition = { x: position.x, y: position.y };\n    this.updateLine();\n  }\n\n  set to(position: Position) {\n    this.toPosition = { x: position.x, y: position.y };\n    this.updateLine();\n  }\n\n  set name(name: string) {\n    this.text.innerHTML = name;\n  }\n\n  set interactive(editable: boolean) {\n    if (editable) {\n      this.rect.style.pointerEvents = 'auto';\n    } else {\n      this.rect.style.pointerEvents = 'none';\n    }\n  }\n\n  set visible(visible: boolean) {\n    this.group.style.display = visible ? 'block' : 'none';\n  }\n\n  set selected(selected: boolean) {\n    if (selected) {\n      this.rect.setAttribute('stroke-width', '1');\n    } else {\n      this.rect.setAttribute('stroke-width', '0');\n    }\n  }\n\n  // eslint-disable-next-line class-methods-use-this\n  get container() {\n    return document.getElementById(this.containerId);\n  }\n\n  constructor({ containerId, from, to, text, interactive = true, visible = true, onClick = () => {}, onRightClick = () => {} }: ConnectionProps) {\n    this.id = uuidv4();\n    this.containerId = containerId;\n    this.fromPosition = { x: from.x, y: from.y };\n    this.toPosition = { x: to.x, y: to.y };\n\n    this.line = document.createElementNS(SVGNS, 'path');\n    this.line.setAttribute('stroke', '#FFAFFE');\n    this.line.setAttribute('fill', 'none');\n    this.line.setAttribute('marker-end', `url(#${CONNECTION_MARKER_ARROW})`);\n\n    this.rect = document.createElementNS(SVGNS, 'rect');\n    this.rect.setAttribute('fill', '#FFAFFE');\n    this.rect.setAttribute('stroke', '#FFED00');\n    this.rect.setAttribute('stroke-width', '0');\n    this.rect.setAttribute('rx', '2');\n    this.rect.setAttribute('ry', '2');\n    this.interactive = interactive;\n    this.rect.style.cursor = 'pointer';\n    this.rect.addEventListener('contextmenu', (e) => e.preventDefault());\n    this.rect.addEventListener('mousedown', (e) => {\n      e.preventDefault();\n      if (e.buttons === 2) {\n        onRightClick(this);\n      } else {\n        onClick(this);\n      }\n    });\n\n    this.text = document.createElementNS(SVGNS, 'text');\n    this.text.innerHTML = text;\n    this.text.style.fontSize = '12px';\n    this.text.style.fontWeight = '400';\n    this.text.setAttribute('fill', '#252935');\n\n    this.group = document.createElementNS(SVGNS, 'g');\n    this.group.style.display = visible ? 'block' : 'none';\n    this.group.appendChild(this.line);\n    this.group.appendChild(this.rect);\n    this.group.appendChild(this.text);\n\n    this.container?.appendChild(this.group);\n    this.updateLine();\n  }\n\n  updateLine() {\n    const { x = 0, y = 0 } = this.container?.getBoundingClientRect() || {};\n    const fx = this.fromPosition.x - x;\n    const fy = this.fromPosition.y - y;\n    const tx = this.toPosition.x - x;\n    const ty = this.toPosition.y - y;\n    const right = fx + 20;\n    const top = (ty - fy >= 20 && tx - fx >= 20) ? fy : Math.min(fy, ty) - 20;\n    this.line.setAttribute('d', `\n      M ${fx} ${fy}\n      L ${right} ${fy}\n      L ${right} ${top}\n      L ${tx} ${top}\n      L ${tx} ${ty}\n    `);\n\n    const use1st = Math.abs(fy - top) > Math.abs(tx - right);\n    const cx = use1st ? right : (tx + right) / 2;\n    const cy = use1st ? (fy + top) / 2 : top;\n    const { width, height } = this.text.getBoundingClientRect();\n\n    this.rect.setAttribute('width', `${width + 4}`);\n    this.rect.setAttribute('height', `${height + 2}`);\n    this.rect.setAttribute('x', `${cx - width / 2 - 2}`);\n    this.rect.setAttribute('y', `${cy - height / 2 - 1}`);\n    this.text.setAttribute('x', `${cx - width / 2}`);\n    this.text.setAttribute('y', `${cy + 5}`);\n  }\n\n  remove() {\n    this.line.remove();\n    this.rect.remove();\n    this.text.remove();\n  }\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}