{"ast":null,"code":"import Paper from 'paper';\nimport screenfull from 'screenfull';\nimport { v4 as uuid } from 'uuid';\nimport { message } from 'antd';\nimport { SHAPE_TYPE } from '../components/Canvas';\nimport { CategoryPathShape, LandmarkEditType, ReviewResult, HandleType } from '../types';\nimport { isInput } from '../../../utils';\nimport formatMessage from '../locales';\nimport rootStore from '../store/RootStore';\nexport default class Tool extends Paper.Tool {\n  constructor(editor) {\n    super();\n    this.editor = void 0;\n    this.downPoint = null;\n    this.downCenter = null;\n    this.mouseDown = false;\n    this.dragging = false;\n    this.movingPaths = [];\n    this.movingShapes = [];\n    this.dragType = '';\n    this.movingSegments = [];\n    this.movingHandles = undefined;\n    this.affectedCategories = [];\n    this.selectPath = null;\n    this.minArea = 3;\n    this.isRightButton = event => event.event.which === 3 || event.modifiers.space;\n    this.isCtrlKey = event => event.event.ctrlKey;\n    this.onMouseDown = event => {\n      if (this.isRightButton(event)) {\n        this.downPoint = Paper.view.projectToView(event.point);\n        this.downCenter = Paper.view.center;\n        return;\n      }\n      if (this.editor) {\n        this.mouseDown = true;\n        if (this.editor.warningBtn && this.editor.warningBtn.item) {\n          const {\n            instanceId,\n            groupName,\n            shapeIds\n          } = this.editor.warningBtn.item.data;\n          if (instanceId && groupName && shapeIds !== undefined) {\n            rootStore.review.setSelectedReview({\n              frameIndex: this.editor.props.currentFrame,\n              instanceId,\n              groupName,\n              shapeIds,\n              result: ReviewResult.REJECT\n            });\n          }\n          return;\n        }\n        const {\n          type: hitsType\n        } = this.editor.hits || {};\n        if (!this.isCtrlKey(event) && this.editor.hits && this.editor.hits.item.data.type !== SHAPE_TYPE.KEYPOINT_BOX) {\n          const {\n            instanceId: selectedInstanceId,\n            groupName: selectedGroupName,\n            index,\n            id\n          } = this.editor.hits.item.data;\n          // move start\n          if (this.editor.selectedPoints.length > 0 && this.editor.isShapeInSelectedShapes(selectedInstanceId, selectedGroupName, index)) {\n            // multi points\n            this.movingShapes = this.editor.selectedPoints;\n          } else if (this.editor.selectedRectangles.length > 0 && this.editor.isShapeInSelectedShapes(selectedInstanceId, selectedGroupName, id)) {\n            // multi rectangles\n            this.movingShapes = this.editor.selectedRectangles;\n          } else if (Object.values(HandleType).includes(hitsType)) {\n            const {\n              currentFrame\n            } = this.editor.props;\n            const {\n              handleIn,\n              handleOut,\n              index: segIndex,\n              path: {\n                data: {\n                  instanceId,\n                  groupName,\n                  pointCategory: category,\n                  id: pathId,\n                  points\n                }\n              }\n            } = this.editor.hits.segment;\n            const pointIndex = points[segIndex];\n            this.movingHandles = {\n              actual: hitsType === HandleType.HANDLE_IN ? handleIn : handleOut,\n              opposite: hitsType === HandleType.HANDLE_IN ? handleOut : handleIn,\n              type: hitsType,\n              pointIndex,\n              pathId,\n              instanceId,\n              groupName,\n              category,\n              frameIndex: currentFrame\n            };\n          } else if (this.editor.hits.item) {\n            const {\n              type: hitItemType\n            } = this.editor.hits.item.data;\n            if ((hitItemType === SHAPE_TYPE.RECTANGLE_PATH || hitItemType === SHAPE_TYPE.RECTANGLE || hitItemType === SHAPE_TYPE.RECTANGLE_POINT) && this.editor.hits.item.parent) {\n              // rectangle-control\n              this.movingShapes = [this.editor.hits.item.parent];\n              if (hitItemType === SHAPE_TYPE.RECTANGLE_PATH) {\n                switch (this.editor.hits.item.data.controlIndex) {\n                  case 0:\n                    this.dragType = 'top';\n                    break;\n                  case 1:\n                    this.dragType = 'right';\n                    break;\n                  case 2:\n                    this.dragType = 'bottom';\n                    break;\n                  case 3:\n                    this.dragType = 'left';\n                    break;\n                  default:\n                    break;\n                }\n              } else if (hitItemType === SHAPE_TYPE.RECTANGLE_POINT) {\n                switch (this.editor.hits.item.data.controlIndex) {\n                  case 0:\n                    this.dragType = 'tl';\n                    break;\n                  case 1:\n                    this.dragType = 'tr';\n                    break;\n                  case 2:\n                    this.dragType = 'br';\n                    break;\n                  case 3:\n                    this.dragType = 'bl';\n                    break;\n                  default:\n                    break;\n                }\n              } else {\n                this.dragType = 'center';\n              }\n            } else if (hitItemType === SHAPE_TYPE.KEYPOINT) {\n              // single point\n              this.movingShapes = [this.editor.hits.item];\n            }\n          }\n          this.affectedCategories = [];\n          this.movingSegments = [];\n          if (this.movingShapes.length === 1) {\n            const {\n              instanceId,\n              category,\n              groupName,\n              index: pointIndex,\n              type,\n              id: shapeId\n            } = this.movingShapes[0].data;\n            if (type === SHAPE_TYPE.KEYPOINT) {\n              var _this$editor;\n              (_this$editor = this.editor) === null || _this$editor === void 0 ? void 0 : _this$editor.props.setSelectedShape(pointIndex, {\n                instanceId,\n                category,\n                groupName,\n                shapeType: LandmarkEditType.KEYPOINT\n              });\n            } else if (type === SHAPE_TYPE.RECTANGLE_GROUP) {\n              var _this$editor2;\n              const {\n                bounds: {\n                  topLeft,\n                  topRight,\n                  bottomRight,\n                  bottomLeft\n                }\n              } = this.movingShapes[0].children[0];\n              this.selectPath = new Paper.Path();\n              this.selectPath.data.id = shapeId;\n              this.selectPath.add(topLeft);\n              this.selectPath.add(topRight);\n              this.selectPath.add(bottomRight);\n              this.selectPath.add(bottomLeft);\n              this.selectPath.closed = true;\n              (_this$editor2 = this.editor) === null || _this$editor2 === void 0 ? void 0 : _this$editor2.props.setSelectedShape(shapeId, {\n                instanceId,\n                category,\n                groupName,\n                shapeType: LandmarkEditType.RECTANGLE\n              });\n            }\n          }\n          if (!rootStore.review.drawMode) {\n            this.movingShapes = [];\n            this.selectPath = null;\n          }\n        } else {\n          // select start\n          this.editor.setMultiShapesUnselected();\n          const localPoint = this.editor.getPointInImage(Paper.view.projectToView(event.point));\n          if (this.editor.activeTool === CategoryPathShape.CIRCLE || this.editor.activeTool === CategoryPathShape.RECTANGLE && !this.editor.canAddShape()) {\n            this.selectPath = new Paper.Path({\n              segments: [localPoint],\n              strokeColor: 'red',\n              strokeWidth: 2,\n              strokeScaling: false\n            });\n          } else if (this.editor.activeTool === CategoryPathShape.RECTANGLE && this.editor.canAddShape() && this.editor.canvasContainer.current) {\n            var _this$editor3;\n            const {\n              instanceId,\n              category,\n              groupName\n            } = this.editor.props.selectedShapeInfo;\n            const id = uuid();\n            this.selectPath = new Paper.Path();\n            this.selectPath.data.id = id;\n            this.selectPath.add(localPoint);\n            this.selectPath.add(localPoint);\n            this.selectPath.add(localPoint);\n            this.selectPath.add(localPoint);\n            this.selectPath.closed = true;\n            this.editor.addRectangle(this.selectPath, (_this$editor3 = this.editor) === null || _this$editor3 === void 0 ? void 0 : _this$editor3.props.selectedShapeInfo);\n            const rectangleBox = this.editor.getShapeByKey(instanceId, groupName, id);\n            this.editor.props.setSelectedShape(id, {\n              instanceId,\n              category,\n              groupName,\n              shapeType: LandmarkEditType.RECTANGLE\n            });\n            this.movingShapes.push(rectangleBox);\n            this.dragType = 'br';\n            this.dragging = true;\n          }\n        }\n      }\n    };\n    this.onMouseDrag = event => {\n      var _this$editor4, _this$editor5, _this$editor6, _this$editor7;\n      if (this.isRightButton(event)) {\n        if (!this.downPoint || !this.downCenter) {\n          this.downPoint = Paper.view.projectToView(event.point);\n          this.downCenter = Paper.view.center;\n        }\n        const rotation = Math.round(Paper.view.rotation);\n        const targetPoint = Paper.view.projectToView(event.point).rotate(-rotation, this.downPoint);\n        const deltaPixel = targetPoint.subtract(this.downPoint);\n        const candidateCenter = this.downCenter.subtract(deltaPixel.divide(Paper.view.zoom));\n        Paper.view.center = candidateCenter;\n        return;\n      }\n      if (((_this$editor4 = this.editor) === null || _this$editor4 === void 0 ? void 0 : _this$editor4.props.isReview) || ((_this$editor5 = this.editor) === null || _this$editor5 === void 0 ? void 0 : _this$editor5.props.readonly) || ((_this$editor6 = this.editor) === null || _this$editor6 === void 0 ? void 0 : _this$editor6.warningBtn) && ((_this$editor7 = this.editor) === null || _this$editor7 === void 0 ? void 0 : _this$editor7.warningBtn.item)) return;\n      let resize = false;\n      if (this.editor) {\n        const localPoint = this.editor.getPointInImage(Paper.view.projectToView(event.point));\n        const localLastPoint = this.editor.getPointInImage(Paper.view.projectToView(event.lastPoint));\n        const offsetX = localPoint.x - localLastPoint.x;\n        const offsetY = localPoint.y - localLastPoint.y;\n        if (Math.abs(offsetX) > 0 || Math.abs(offsetY) > 0) {\n          this.dragging = true;\n        }\n        if (this.movingShapes.length > 0) {\n          // moving\n          /* eslint-disable no-param-reassign */\n          this.movingShapes.forEach(movingShape => {\n            const {\n              frameIndex,\n              instanceId,\n              category,\n              groupName,\n              pointCategory: categoryName,\n              index,\n              type,\n              displayColor\n            } = movingShape.data;\n            if (type === SHAPE_TYPE.RECTANGLE_GROUP && this.selectPath) {\n              var _this$editor8;\n              resize = true;\n              switch (this.dragType) {\n                case 'tl':\n                  this.selectPath.segments[0].point.x += offsetX;\n                  this.selectPath.segments[0].point.y += offsetY;\n                  this.selectPath.segments[1].point.y += offsetY;\n                  this.selectPath.segments[3].point.x += offsetX;\n                  break;\n                case 'tr':\n                  this.selectPath.segments[1].point.x += offsetX;\n                  this.selectPath.segments[1].point.y += offsetY;\n                  this.selectPath.segments[0].point.y += offsetY;\n                  this.selectPath.segments[2].point.x += offsetX;\n                  break;\n                case 'br':\n                  this.selectPath.segments[2].point.x += offsetX;\n                  this.selectPath.segments[2].point.y += offsetY;\n                  this.selectPath.segments[3].point.y += offsetY;\n                  this.selectPath.segments[1].point.x += offsetX;\n                  break;\n                case 'bl':\n                  this.selectPath.segments[3].point.x += offsetX;\n                  this.selectPath.segments[3].point.y += offsetY;\n                  this.selectPath.segments[2].point.y += offsetY;\n                  this.selectPath.segments[0].point.x += offsetX;\n                  break;\n                case 'top':\n                  this.selectPath.segments[0].point.y += offsetY;\n                  this.selectPath.segments[1].point.y += offsetY;\n                  break;\n                case 'right':\n                  this.selectPath.segments[1].point.x += offsetX;\n                  this.selectPath.segments[2].point.x += offsetX;\n                  break;\n                case 'bottom':\n                  this.selectPath.segments[2].point.y += offsetY;\n                  this.selectPath.segments[3].point.y += offsetY;\n                  break;\n                case 'left':\n                  this.selectPath.segments[3].point.x += offsetX;\n                  this.selectPath.segments[0].point.x += offsetX;\n                  break;\n                case 'center':\n                  this.selectPath.segments[0].point.x += offsetX;\n                  this.selectPath.segments[0].point.y += offsetY;\n                  this.selectPath.segments[1].point.x += offsetX;\n                  this.selectPath.segments[1].point.y += offsetY;\n                  this.selectPath.segments[2].point.x += offsetX;\n                  this.selectPath.segments[2].point.y += offsetY;\n                  this.selectPath.segments[3].point.x += offsetX;\n                  this.selectPath.segments[3].point.y += offsetY;\n                  break;\n                default:\n                  break;\n              }\n              const shapeInfo = {\n                instanceId,\n                category,\n                groupName,\n                shapeType: LandmarkEditType.RECTANGLE,\n                displayColor\n              };\n              (_this$editor8 = this.editor) === null || _this$editor8 === void 0 ? void 0 : _this$editor8.addRectangle(this.selectPath, shapeInfo, false);\n            } else if (type === SHAPE_TYPE.KEYPOINT) {\n              var _this$editor9, _this$editor10;\n              const categoryKey = `${frameIndex}_${instanceId}_${groupName}_${categoryName}`;\n              if (((_this$editor9 = this.editor) === null || _this$editor9 === void 0 ? void 0 : _this$editor9.props.categoryPathShapes[categoryKey]) === CategoryPathShape.CIRCLE) {\n                const path = this.editor.getPathByCategory(instanceId, groupName, categoryName);\n                if (path && path.data.isCircle) {\n                  const pointCategory = this.editor.props.categories.find(c => c.name === categoryName);\n                  if (pointCategory) {\n                    if (this.affectedCategories.findIndex(affected => affected.instanceId === instanceId && affected.groupName === groupName && affected.pointCategory === categoryName) < 0) {\n                      this.affectedCategories.push({\n                        instanceId,\n                        category,\n                        groupName,\n                        pointCategory: categoryName\n                      });\n                    }\n                    const sortedKeys = [...pointCategory.keys].sort((a, b) => a - b);\n                    const pIndex1 = sortedKeys[0];\n                    const pIndex2 = sortedKeys[Math.ceil(sortedKeys.length / 2)];\n                    if (index !== pIndex1 && index !== pIndex2) {\n                      return;\n                    }\n                  }\n                }\n              }\n              (_this$editor10 = this.editor) === null || _this$editor10 === void 0 ? void 0 : _this$editor10.updatePath(movingShape, {\n                x: movingShape.position.x + offsetX,\n                y: movingShape.position.y + offsetY\n              });\n              movingShape.position.x += offsetX;\n              movingShape.position.y += offsetY;\n            }\n          });\n          this.movingSegments.forEach(movingSegment => {\n            movingSegment.point.x += offsetX;\n            movingSegment.point.y += offsetY;\n          });\n          this.affectedCategories.forEach(({\n            instanceId,\n            category,\n            groupName,\n            pointCategory\n          }) => {\n            var _this$editor11;\n            const container = {\n              instanceId,\n              category,\n              groupName\n            };\n            (_this$editor11 = this.editor) === null || _this$editor11 === void 0 ? void 0 : _this$editor11.updateCirclePath(pointCategory, true, container);\n          });\n          /* eslint-enable no-param-reassign */\n        } else if (this.movingHandles) {\n          // moving handle point\n          this.movingHandles.actual.x += offsetX;\n          this.movingHandles.actual.y += offsetY;\n          this.movingHandles.opposite.x = -this.movingHandles.actual.x;\n          this.movingHandles.opposite.y = -this.movingHandles.actual.y;\n        } else if (this.selectPath) {\n          // draw select path\n          if (this.editor.activeTool === CategoryPathShape.CIRCLE || this.editor.activeTool === CategoryPathShape.RECTANGLE && !this.editor.canAddShape()) {\n            this.selectPath.add(localPoint);\n          } else if (this.editor.activeTool === CategoryPathShape.RECTANGLE && !resize) {\n            var _this$editor12;\n            this.selectPath.segments[1].point.x += offsetX;\n            this.selectPath.segments[2].point.x += offsetX;\n            this.selectPath.segments[2].point.y += offsetY;\n            this.selectPath.segments[3].point.y += offsetY;\n            this.editor.addRectangle(this.selectPath, (_this$editor12 = this.editor) === null || _this$editor12 === void 0 ? void 0 : _this$editor12.props.selectedShapeInfo, false);\n          }\n        }\n      }\n    };\n    this.onMouseUp = event => {\n      var _this$editor14, _this$editor15, _this$editor27;\n      if (this.isRightButton(event)) {\n        var _this$editor13;\n        (_this$editor13 = this.editor) === null || _this$editor13 === void 0 ? void 0 : _this$editor13.drag(Paper.view.center);\n        this.downPoint = null;\n        this.downCenter = null;\n        return;\n      }\n      this.mouseDown = false;\n      if (((_this$editor14 = this.editor) === null || _this$editor14 === void 0 ? void 0 : _this$editor14.warningBtn) && ((_this$editor15 = this.editor) === null || _this$editor15 === void 0 ? void 0 : _this$editor15.warningBtn.item)) return;\n      if (!this.isCtrlKey(event) && this.movingShapes.length > 0) {\n        var _this$editor23;\n        // move ends\n        if (this.dragging && this.editor) {\n          if (this.editor.activeTool === CategoryPathShape.CIRCLE) {\n            var _this$editor18;\n            const otherPoints = [];\n            this.affectedCategories.forEach(({\n              instanceId,\n              category,\n              groupName,\n              pointCategory\n            }) => {\n              var _this$editor16;\n              const container = {\n                instanceId,\n                category,\n                groupName\n              };\n              const updatedShapes = (_this$editor16 = this.editor) === null || _this$editor16 === void 0 ? void 0 : _this$editor16.updateCirclePath(pointCategory, true, container);\n              if (updatedShapes) {\n                updatedShapes.forEach(({\n                  shape,\n                  index\n                }) => {\n                  if (index !== undefined && shape) {\n                    var _this$editor17;\n                    otherPoints.push({\n                      frameIndex: ((_this$editor17 = this.editor) === null || _this$editor17 === void 0 ? void 0 : _this$editor17.props.selectedShapeStatus.frameIndex) || 0,\n                      instanceId,\n                      category,\n                      groupName,\n                      index,\n                      shapeType: LandmarkEditType.KEYPOINT,\n                      shape\n                    });\n                  }\n                });\n              }\n            });\n            (_this$editor18 = this.editor) === null || _this$editor18 === void 0 ? void 0 : _this$editor18.updatePointsPosition([...this.movingShapes.map(movingPoint => {\n              const {\n                frameIndex,\n                instanceId,\n                category,\n                groupName,\n                index\n              } = movingPoint.data;\n              return {\n                frameIndex,\n                instanceId,\n                category,\n                groupName,\n                index,\n                shapeType: LandmarkEditType.KEYPOINT,\n                shape: {\n                  position: {\n                    x: movingPoint.position.x,\n                    y: movingPoint.position.y\n                  }\n                }\n              };\n            }), ...otherPoints]);\n          } else if (this.editor.activeTool === CategoryPathShape.RECTANGLE) {\n            var _this$editor19;\n            (_this$editor19 = this.editor) === null || _this$editor19 === void 0 ? void 0 : _this$editor19.updateRectanglePosition([...this.movingShapes.filter(movingRectangle => {\n              const {\n                bounds: {\n                  width,\n                  height\n                }\n              } = movingRectangle.children[0];\n              if (width < this.minArea || height < this.minArea) {\n                var _this$editor20;\n                (_this$editor20 = this.editor) === null || _this$editor20 === void 0 ? void 0 : _this$editor20.deleteSelectedRectangle();\n                message.warning(formatMessage('MIN_SIZE_ALERT'));\n                return false;\n              }\n              return true;\n            }).map(movingRectangle => {\n              var _this$editor21, _this$editor22;\n              const {\n                instanceId,\n                category,\n                groupName,\n                id,\n                displayColor\n              } = movingRectangle.data;\n              const {\n                bounds: {\n                  x,\n                  y,\n                  width,\n                  height\n                }\n              } = movingRectangle.children[0];\n              const groupInfo = {\n                frameIndex: ((_this$editor21 = this.editor) === null || _this$editor21 === void 0 ? void 0 : _this$editor21.props.selectedShapeStatus.frameIndex) || 0,\n                instanceId,\n                category,\n                groupName\n              };\n              const rectInfo = {\n                x,\n                y,\n                width,\n                height,\n                displayColor: displayColor || '#5cdef0'\n              };\n              (_this$editor22 = this.editor) === null || _this$editor22 === void 0 ? void 0 : _this$editor22.drawRectangle(rectInfo, groupInfo, id);\n              return {\n                ...groupInfo,\n                id,\n                shapeType: LandmarkEditType.RECTANGLE,\n                shape: {\n                  ...rectInfo,\n                  id,\n                  visible: true // default is visible when point added\n                }\n              };\n            })]);\n          }\n        }\n        if (this.selectPath) {\n          this.selectPath.remove();\n          this.selectPath = null;\n        }\n        this.movingShapes = [];\n        this.movingSegments = [];\n        this.affectedCategories = [];\n        (_this$editor23 = this.editor) === null || _this$editor23 === void 0 ? void 0 : _this$editor23.drawWarnings();\n      } else if (this.movingHandles) {\n        // handle move ends\n        this.movingHandles = undefined;\n      } else if (this.dragging && this.selectPath) {\n        var _this$editor24;\n        // select ends\n        if ((_this$editor24 = this.editor) === null || _this$editor24 === void 0 ? void 0 : _this$editor24.mainLayer) {\n          var _this$editor25, _this$editor26;\n          const center = this.editor.mainLayer.localToGlobal(this.selectPath.bounds.center);\n          const hits = this.editor.mainLayer.hitTestAll(center, {\n            fill: true,\n            segments: true,\n            tolerance: this.selectPath.bounds.topLeft.getDistance(this.selectPath.bounds.bottomRight) / 2\n          });\n          const selectedPoints = new Set();\n          const selectedRectangles = new Set();\n          let selectedGroup;\n          const isOneGroup = (instanceId, groupName) => {\n            if (!selectedGroup) {\n              selectedGroup = `${instanceId}_${groupName}`;\n              return true;\n            }\n            return `${instanceId}_${groupName}` === selectedGroup;\n          };\n          hits.forEach(seg => {\n            if (this.selectPath.contains(seg.item.bounds.center)) {\n              if (seg.item.data.type === SHAPE_TYPE.KEYPOINT) {\n                if (isOneGroup(seg.item.data.instanceId, seg.item.data.groupName)) {\n                  selectedPoints.add(seg.item);\n                }\n              } else if (seg.item.data.type === SHAPE_TYPE.RECTANGLE || seg.item.data.type === SHAPE_TYPE.RECTANGLE_POINT || seg.item.data.type === SHAPE_TYPE.RECTANGLE_PATH) {\n                if (isOneGroup(seg.item.parent.data.instanceId, seg.item.parent.data.groupName)) {\n                  selectedRectangles.add(seg.item.parent);\n                }\n              }\n            }\n          });\n\n          // selected\n          if (selectedPoints.size) (_this$editor25 = this.editor) === null || _this$editor25 === void 0 ? void 0 : _this$editor25.setMultiShapesSelected(Array.from(selectedPoints), CategoryPathShape.CIRCLE);\n          if (selectedRectangles.size) (_this$editor26 = this.editor) === null || _this$editor26 === void 0 ? void 0 : _this$editor26.setMultiShapesSelected(Array.from(selectedRectangles), CategoryPathShape.RECTANGLE);\n        }\n        this.selectPath.remove();\n        this.selectPath = null;\n      } else if (((_this$editor27 = this.editor) === null || _this$editor27 === void 0 ? void 0 : _this$editor27.canAddShape()) && this.editor.activeTool === CategoryPathShape.CIRCLE) {\n        // add point\n        const point = Paper.view.projectToView(event.point);\n        // if (this.editor?.isPointInImage(point)) {\n        this.editor.addKeypoint(point);\n        // }\n      } else if (this.editor && rootStore.review.drawMode) {\n        // clear selection and move next\n        this.editor.props.setNextEmptyShape();\n      }\n      this.dragging = false;\n    };\n    this.handleQa = result => {\n      var _this$editor28;\n      if ((_this$editor28 = this.editor) === null || _this$editor28 === void 0 ? void 0 : _this$editor28.props.selectedShapeStatus) {\n        var _this$editor29, _this$editor31;\n        const {\n          instanceId,\n          groupName,\n          frameIndex,\n          id\n        } = this.editor.props.selectedShapeStatus;\n        let shapeIds = [];\n        if (id !== undefined) {\n          shapeIds = [id];\n        } else if (((_this$editor29 = this.editor) === null || _this$editor29 === void 0 ? void 0 : _this$editor29.selectedPoints.length) > 0) {\n          var _this$editor30;\n          shapeIds = (_this$editor30 = this.editor) === null || _this$editor30 === void 0 ? void 0 : _this$editor30.selectedPoints.map(point => point.data.index);\n        } else if (((_this$editor31 = this.editor) === null || _this$editor31 === void 0 ? void 0 : _this$editor31.selectedRectangles.length) > 0) {\n          var _this$editor32;\n          shapeIds = (_this$editor32 = this.editor) === null || _this$editor32 === void 0 ? void 0 : _this$editor32.selectedRectangles.map(shape => shape.data.id);\n        }\n        if (shapeIds.length) {\n          shapeIds.sort((a, b) => a - b);\n          if (result !== ReviewResult.REJECT && !rootStore.review.selectedReview) {\n            rootStore.review.setReview({\n              result\n            }, {\n              frameIndex,\n              instanceId,\n              groupName,\n              shapeIds,\n              result\n            });\n          } else {\n            rootStore.review.setSelectedReview({\n              frameIndex,\n              instanceId,\n              groupName,\n              shapeIds,\n              result\n            });\n          }\n          if ((result === ReviewResult.SUSPEND || result === ReviewResult.APPROVE) && !rootStore.review.selectedReview) {\n            message.success(formatMessage(`QC_SET_${result.toLocaleUpperCase()}`));\n          }\n        }\n      }\n    };\n    this.onKeyDown = ({\n      event\n    }) => {\n      var _this$editor33, _this$editor35, _this$editor36, _this$editor37;\n      if (isInput()) return;\n      const key = event.key.toLowerCase();\n      if (((_this$editor33 = this.editor) === null || _this$editor33 === void 0 ? void 0 : _this$editor33.props.isReview) && key !== 'v') return;\n      // Judgment modifier keyboard\n      if (event.altKey || event.shiftKey) {\n        return;\n      }\n      if (rootStore.review.drawMode) {\n        this.drawOnKeyDown(event, key);\n      } else if (rootStore.review.isEnabled) {\n        this.QaOnKeyDown(event, key);\n      }\n      switch (key) {\n        case ' ':\n          event.preventDefault();\n          if (rootStore.review.isEnabled) {\n            var _this$editor34;\n            (_this$editor34 = this.editor) === null || _this$editor34 === void 0 ? void 0 : _this$editor34.props.handleChangeDrawMode(!rootStore.review.drawMode);\n          }\n          break;\n        case 'f':\n          event.preventDefault();\n          if (screenfull.isEnabled) {\n            screenfull.toggle();\n          }\n          break;\n        // case 'g':\n        //   event.preventDefault();\n        //   if (this.editor && this.editor.gridLayer) {\n        //     this.editor.gridLayer.visible = !rootStore.setting.isGridVisible;\n        //   }\n        //   rootStore.setting.setGridVisible(!rootStore.setting.isGridVisible);\n        //   break;\n        case 's':\n          event.preventDefault();\n          (_this$editor35 = this.editor) === null || _this$editor35 === void 0 ? void 0 : _this$editor35.props.onSave();\n          break;\n        case 'z':\n          event.preventDefault();\n          if (event.ctrlKey) (_this$editor36 = this.editor) === null || _this$editor36 === void 0 ? void 0 : _this$editor36.props.handleUndo();\n          break;\n        case 'y':\n          event.preventDefault();\n          if (event.ctrlKey) (_this$editor37 = this.editor) === null || _this$editor37 === void 0 ? void 0 : _this$editor37.props.handleRedo();\n          break;\n        case 'v':\n          if (!rootStore.review.selectedReview) {\n            event.preventDefault();\n            if (event.ctrlKey) {\n              var _this$editor38;\n              (_this$editor38 = this.editor) === null || _this$editor38 === void 0 ? void 0 : _this$editor38.props.setReview();\n            }\n          }\n          break;\n        default:\n      }\n    };\n    this.QaOnKeyDown = (event, key) => {\n      var _this$editor39;\n      if ((_this$editor39 = this.editor) === null || _this$editor39 === void 0 ? void 0 : _this$editor39.props.readonly) return;\n      switch (key) {\n        case '2':\n          event.preventDefault();\n          this.handleQa(ReviewResult.REJECT);\n          break;\n        case '1':\n          event.preventDefault();\n          this.handleQa(ReviewResult.APPROVE);\n          break;\n        case '3':\n          event.preventDefault();\n          this.handleQa(ReviewResult.SUSPEND);\n          break;\n        default:\n      }\n    };\n    this.drawOnKeyDown = (event, key) => {\n      var _this$editor40, _this$editor41, _this$editor42, _this$editor43, _this$editor44;\n      if ((_this$editor40 = this.editor) === null || _this$editor40 === void 0 ? void 0 : _this$editor40.props.readonly) return;\n      switch (key) {\n        case 'delete':\n        case 'backspace':\n          event.preventDefault();\n          (_this$editor41 = this.editor) === null || _this$editor41 === void 0 ? void 0 : _this$editor41.deleteSelectedPoints();\n          (_this$editor42 = this.editor) === null || _this$editor42 === void 0 ? void 0 : _this$editor42.deleteSelectedRectangle();\n          break;\n        // case 'a':\n        //   event.preventDefault();\n        //   this.editor?.autoAdjust();\n        //   break;\n        // case 'c':\n        //   event.preventDefault();\n        //   this.editor?.switchSmoothMode();\n        //   break;\n        case 'o':\n          event.preventDefault();\n          (_this$editor43 = this.editor) === null || _this$editor43 === void 0 ? void 0 : _this$editor43.props.editShapeForm();\n          break;\n        case 'p':\n          event.preventDefault();\n          (_this$editor44 = this.editor) === null || _this$editor44 === void 0 ? void 0 : _this$editor44.props.editGroupForm();\n          break;\n        // case 'r':\n        //   event.preventDefault();\n        //   this.editor?.setCategoryAsCircle();\n        //   break;\n        // case 'v':\n        //   event.preventDefault();\n        //   this.editor?.toggleSelectedPointVisibility();\n        //   break;\n        default:\n      }\n    };\n    this.editor = editor;\n  }\n}\n;","map":{"version":3,"names":["Paper","screenfull","v4","uuid","message","SHAPE_TYPE","CategoryPathShape","LandmarkEditType","ReviewResult","HandleType","isInput","formatMessage","rootStore","Tool","constructor","editor","downPoint","downCenter","mouseDown","dragging","movingPaths","movingShapes","dragType","movingSegments","movingHandles","undefined","affectedCategories","selectPath","minArea","isRightButton","event","which","modifiers","space","isCtrlKey","ctrlKey","onMouseDown","view","projectToView","point","center","warningBtn","item","instanceId","groupName","shapeIds","data","review","setSelectedReview","frameIndex","props","currentFrame","result","REJECT","type","hitsType","hits","KEYPOINT_BOX","selectedInstanceId","selectedGroupName","index","id","selectedPoints","length","isShapeInSelectedShapes","selectedRectangles","Object","values","includes","handleIn","handleOut","segIndex","path","pointCategory","category","pathId","points","segment","pointIndex","actual","HANDLE_IN","opposite","hitItemType","RECTANGLE_PATH","RECTANGLE","RECTANGLE_POINT","parent","controlIndex","KEYPOINT","shapeId","_this$editor","setSelectedShape","shapeType","RECTANGLE_GROUP","_this$editor2","bounds","topLeft","topRight","bottomRight","bottomLeft","children","Path","add","closed","drawMode","setMultiShapesUnselected","localPoint","getPointInImage","activeTool","CIRCLE","canAddShape","segments","strokeColor","strokeWidth","strokeScaling","canvasContainer","current","_this$editor3","selectedShapeInfo","addRectangle","rectangleBox","getShapeByKey","push","onMouseDrag","_this$editor4","_this$editor5","_this$editor6","_this$editor7","rotation","Math","round","targetPoint","rotate","deltaPixel","subtract","candidateCenter","divide","zoom","isReview","readonly","resize","localLastPoint","lastPoint","offsetX","x","offsetY","y","abs","forEach","movingShape","categoryName","displayColor","_this$editor8","shapeInfo","_this$editor9","_this$editor10","categoryKey","categoryPathShapes","getPathByCategory","isCircle","categories","find","c","name","findIndex","affected","sortedKeys","keys","sort","a","b","pIndex1","pIndex2","ceil","updatePath","position","movingSegment","_this$editor11","container","updateCirclePath","_this$editor12","onMouseUp","_this$editor14","_this$editor15","_this$editor27","_this$editor13","drag","_this$editor23","_this$editor18","otherPoints","_this$editor16","updatedShapes","shape","_this$editor17","selectedShapeStatus","updatePointsPosition","map","movingPoint","_this$editor19","updateRectanglePosition","filter","movingRectangle","width","height","_this$editor20","deleteSelectedRectangle","warning","_this$editor21","_this$editor22","groupInfo","rectInfo","drawRectangle","visible","remove","drawWarnings","_this$editor24","mainLayer","_this$editor25","_this$editor26","localToGlobal","hitTestAll","fill","tolerance","getDistance","Set","selectedGroup","isOneGroup","seg","contains","size","setMultiShapesSelected","Array","from","addKeypoint","setNextEmptyShape","handleQa","_this$editor28","_this$editor29","_this$editor31","_this$editor30","_this$editor32","selectedReview","setReview","SUSPEND","APPROVE","success","toLocaleUpperCase","onKeyDown","_this$editor33","_this$editor35","_this$editor36","_this$editor37","key","toLowerCase","altKey","shiftKey","drawOnKeyDown","isEnabled","QaOnKeyDown","preventDefault","_this$editor34","handleChangeDrawMode","toggle","onSave","handleUndo","handleRedo","_this$editor38","_this$editor39","_this$editor40","_this$editor41","_this$editor42","_this$editor43","_this$editor44","deleteSelectedPoints","editShapeForm","editGroupForm"],"sources":["/Users/qzheng/Documents/webroot/annotation_tools/src/components/keypoint/tools/Tool.ts"],"sourcesContent":["import Paper from 'paper';\nimport screenfull from 'screenfull';\nimport { v4 as uuid } from 'uuid';\nimport { message } from 'antd';\nimport Canvas, { SHAPE_TYPE } from '../components/Canvas';\nimport { CategoryPathShape, GroupInfo, LandmarkEditType, UpdatedShape, ReviewResult, HandleType, Group } from '../types';\nimport { isInput } from '../../../utils';\nimport formatMessage from '../locales';\nimport rootStore from '../store/RootStore';\n\nexport interface ToolEventExtend extends paper.ToolEvent {\n  event: MouseEvent;\n  mouseDown: boolean;\n}\n\nexport interface ToolProps extends paper.Tool {\n  mouseDown: boolean;\n}\n\nexport interface MoveHandles extends Group {\n  actual: paper.Point;\n  opposite: paper.Point;\n  type: HandleType;\n  pointIndex: number;\n  pathId: string;\n  frameIndex: number;\n}\n\nexport default class Tool extends Paper.Tool {\n  editor: Canvas | undefined;\n\n  downPoint: paper.Point | null = null;\n\n  downCenter: paper.Point | null = null;\n\n  mouseDown = false;\n\n  dragging = false;\n\n  movingPaths: paper.Path[] = [];\n\n  movingShapes: paper.Item[] = [];\n\n  dragType = '';\n\n  movingSegments: paper.Segment[] = [];\n\n  movingHandles: MoveHandles | undefined = undefined;\n\n  affectedCategories: { instanceId: string, category: string, groupName: string, pointCategory: string }[] = [];\n\n  selectPath: paper.Path | null = null;\n\n  minArea = 3;\n\n  constructor(editor: Canvas) {\n    super();\n    this.editor = editor;\n  }\n\n  isRightButton = (event: ToolEventExtend) => event.event.which === 3 || event.modifiers.space;\n\n  isCtrlKey = (event: ToolEventExtend) => event.event.ctrlKey;\n\n  onMouseDown = (event: ToolEventExtend) => {\n    if (this.isRightButton(event)) {\n      this.downPoint = Paper.view.projectToView(event.point);\n      this.downCenter = Paper.view.center;\n      return;\n    }\n    if (this.editor) {\n      this.mouseDown = true;\n      if (this.editor.warningBtn && this.editor.warningBtn.item) {\n        const { instanceId, groupName, shapeIds } = this.editor.warningBtn.item.data;\n        if (instanceId && groupName && shapeIds !== undefined) {\n          rootStore.review.setSelectedReview({ frameIndex: this.editor.props.currentFrame, instanceId, groupName, shapeIds, result: ReviewResult.REJECT });\n        }\n        return;\n      }\n      const { type: hitsType } = this.editor.hits || {};\n      if (!this.isCtrlKey(event) && this.editor.hits && this.editor.hits.item.data.type !== SHAPE_TYPE.KEYPOINT_BOX) {\n        const { instanceId: selectedInstanceId, groupName: selectedGroupName, index, id } = this.editor.hits.item.data;\n        // move start\n        if (this.editor.selectedPoints.length > 0 && this.editor.isShapeInSelectedShapes(selectedInstanceId, selectedGroupName, index)) {\n          // multi points\n          this.movingShapes = this.editor.selectedPoints;\n        } else if (this.editor.selectedRectangles.length > 0 && this.editor.isShapeInSelectedShapes(selectedInstanceId, selectedGroupName, id)) {\n          // multi rectangles\n          this.movingShapes = this.editor.selectedRectangles;\n        } else if (Object.values(HandleType).includes(hitsType as HandleType)) {\n          const { currentFrame } = this.editor.props;\n          const { handleIn, handleOut, index: segIndex, path: { data: { instanceId, groupName, pointCategory: category, id: pathId, points } } } = this.editor.hits.segment;\n          const pointIndex = points[segIndex];\n          this.movingHandles = {\n            actual: hitsType === HandleType.HANDLE_IN ? handleIn : handleOut,\n            opposite: hitsType === HandleType.HANDLE_IN ? handleOut : handleIn,\n            type: hitsType as HandleType,\n            pointIndex,\n            pathId,\n            instanceId,\n            groupName,\n            category,\n            frameIndex: currentFrame\n          };\n        } else if (this.editor.hits.item) {\n          const { type: hitItemType } = this.editor.hits.item.data;\n          if (\n            (\n              hitItemType === SHAPE_TYPE.RECTANGLE_PATH ||\n              hitItemType === SHAPE_TYPE.RECTANGLE ||\n              hitItemType === SHAPE_TYPE.RECTANGLE_POINT\n            ) &&\n            this.editor.hits.item.parent\n          ) {\n            // rectangle-control\n            this.movingShapes = [this.editor.hits.item.parent];\n            if (hitItemType === SHAPE_TYPE.RECTANGLE_PATH) {\n              switch (this.editor.hits.item.data.controlIndex) {\n                case 0:\n                  this.dragType = 'top';\n                  break;\n                case 1:\n                  this.dragType = 'right';\n                  break;\n                case 2:\n                  this.dragType = 'bottom';\n                  break;\n                case 3:\n                  this.dragType = 'left';\n                  break;\n                default:\n                  break;\n              }\n            } else if (hitItemType === SHAPE_TYPE.RECTANGLE_POINT) {\n              switch (this.editor.hits.item.data.controlIndex) {\n                case 0:\n                  this.dragType = 'tl';\n                  break;\n                case 1:\n                  this.dragType = 'tr';\n                  break;\n                case 2:\n                  this.dragType = 'br';\n                  break;\n                case 3:\n                  this.dragType = 'bl';\n                  break;\n                default:\n                  break;\n              }\n            } else {\n              this.dragType = 'center';\n            }\n          } else if (hitItemType === SHAPE_TYPE.KEYPOINT) {\n            // single point\n            this.movingShapes = [this.editor.hits.item];\n          }\n        }\n        this.affectedCategories = [];\n        this.movingSegments = [];\n        if (this.movingShapes.length === 1) {\n          const { instanceId, category, groupName, index: pointIndex, type, id: shapeId } = this.movingShapes[0].data;\n          if (type === SHAPE_TYPE.KEYPOINT) {\n            this.editor?.props.setSelectedShape(pointIndex, { instanceId, category, groupName, shapeType: LandmarkEditType.KEYPOINT });\n          } else if (type === SHAPE_TYPE.RECTANGLE_GROUP) {\n            const { bounds: { topLeft, topRight, bottomRight, bottomLeft } } = this.movingShapes[0].children[0];\n            this.selectPath = new Paper.Path();\n            this.selectPath.data.id = shapeId;\n            this.selectPath.add(topLeft);\n            this.selectPath.add(topRight);\n            this.selectPath.add(bottomRight);\n            this.selectPath.add(bottomLeft);\n            this.selectPath.closed = true;\n            this.editor?.props.setSelectedShape(shapeId, { instanceId, category, groupName, shapeType: LandmarkEditType.RECTANGLE });\n          }\n        }\n\n        if (!rootStore.review.drawMode) {\n          this.movingShapes = [];\n          this.selectPath = null;\n        }\n      } else {\n        // select start\n        this.editor.setMultiShapesUnselected();\n        const localPoint = this.editor.getPointInImage(Paper.view.projectToView(event.point));\n        if (this.editor.activeTool === CategoryPathShape.CIRCLE || (this.editor.activeTool === CategoryPathShape.RECTANGLE && !this.editor.canAddShape())) {\n          this.selectPath = new Paper.Path({\n            segments: [localPoint],\n            strokeColor: 'red',\n            strokeWidth: 2,\n            strokeScaling: false,\n          });\n        } else if (\n          this.editor.activeTool === CategoryPathShape.RECTANGLE &&\n          this.editor.canAddShape() &&\n          this.editor.canvasContainer.current\n        ) {\n          const { instanceId, category, groupName } = this.editor.props.selectedShapeInfo as GroupInfo;\n          const id = uuid();\n          this.selectPath = new Paper.Path();\n          this.selectPath.data.id = id;\n          this.selectPath.add(localPoint);\n          this.selectPath.add(localPoint);\n          this.selectPath.add(localPoint);\n          this.selectPath.add(localPoint);\n          this.selectPath.closed = true;\n          this.editor.addRectangle(this.selectPath, this.editor?.props.selectedShapeInfo as GroupInfo);\n          const rectangleBox = this.editor.getShapeByKey(instanceId, groupName, id);\n          this.editor.props.setSelectedShape(id, { instanceId, category, groupName, shapeType: LandmarkEditType.RECTANGLE });\n          this.movingShapes.push(rectangleBox);\n          this.dragType = 'br';\n          this.dragging = true;\n        }\n      }\n    }\n  };\n\n  onMouseDrag = (event: ToolEventExtend) => {\n    if (this.isRightButton(event)) {\n      if (!this.downPoint || !this.downCenter) {\n        this.downPoint = Paper.view.projectToView(event.point);\n        this.downCenter = Paper.view.center;\n      }\n\n      const rotation = Math.round(Paper.view.rotation);\n      const targetPoint = Paper.view.projectToView(event.point).rotate(-rotation, this.downPoint);\n      const deltaPixel = targetPoint.subtract(this.downPoint);\n      const candidateCenter = this.downCenter.subtract(deltaPixel.divide(Paper.view.zoom));\n      Paper.view.center = candidateCenter;\n      return;\n    }\n    if (this.editor?.props.isReview || this.editor?.props.readonly || (this.editor?.warningBtn && this.editor?.warningBtn.item)) return;\n    let resize = false;\n    if (this.editor) {\n      const localPoint = this.editor.getPointInImage(Paper.view.projectToView(event.point));\n      const localLastPoint = this.editor.getPointInImage(Paper.view.projectToView(event.lastPoint));\n      const offsetX = localPoint.x - localLastPoint.x;\n      const offsetY = localPoint.y - localLastPoint.y;\n      if (Math.abs(offsetX) > 0 || Math.abs(offsetY) > 0) {\n        this.dragging = true;\n      }\n\n      if (this.movingShapes.length > 0) {\n        // moving\n        /* eslint-disable no-param-reassign */\n        this.movingShapes.forEach((movingShape) => {\n          const { frameIndex, instanceId, category, groupName, pointCategory: categoryName, index, type, displayColor } = movingShape.data;\n          if (type === SHAPE_TYPE.RECTANGLE_GROUP && this.selectPath) {\n            resize = true;\n            switch (this.dragType) {\n              case 'tl':\n                this.selectPath.segments[0].point.x += offsetX;\n                this.selectPath.segments[0].point.y += offsetY;\n                this.selectPath.segments[1].point.y += offsetY;\n                this.selectPath.segments[3].point.x += offsetX;\n                break;\n              case 'tr':\n                this.selectPath.segments[1].point.x += offsetX;\n                this.selectPath.segments[1].point.y += offsetY;\n                this.selectPath.segments[0].point.y += offsetY;\n                this.selectPath.segments[2].point.x += offsetX;\n                break;\n              case 'br':\n                this.selectPath.segments[2].point.x += offsetX;\n                this.selectPath.segments[2].point.y += offsetY;\n                this.selectPath.segments[3].point.y += offsetY;\n                this.selectPath.segments[1].point.x += offsetX;\n                break;\n              case 'bl':\n                this.selectPath.segments[3].point.x += offsetX;\n                this.selectPath.segments[3].point.y += offsetY;\n                this.selectPath.segments[2].point.y += offsetY;\n                this.selectPath.segments[0].point.x += offsetX;\n                break;\n              case 'top':\n                this.selectPath.segments[0].point.y += offsetY;\n                this.selectPath.segments[1].point.y += offsetY;\n                break;\n              case 'right':\n                this.selectPath.segments[1].point.x += offsetX;\n                this.selectPath.segments[2].point.x += offsetX;\n                break;\n              case 'bottom':\n                this.selectPath.segments[2].point.y += offsetY;\n                this.selectPath.segments[3].point.y += offsetY;\n                break;\n              case 'left':\n                this.selectPath.segments[3].point.x += offsetX;\n                this.selectPath.segments[0].point.x += offsetX;\n                break;\n              case 'center':\n                this.selectPath.segments[0].point.x += offsetX;\n                this.selectPath.segments[0].point.y += offsetY;\n                this.selectPath.segments[1].point.x += offsetX;\n                this.selectPath.segments[1].point.y += offsetY;\n                this.selectPath.segments[2].point.x += offsetX;\n                this.selectPath.segments[2].point.y += offsetY;\n                this.selectPath.segments[3].point.x += offsetX;\n                this.selectPath.segments[3].point.y += offsetY;\n                break;\n              default:\n                break;\n            }\n            const shapeInfo: GroupInfo = {\n              instanceId,\n              category,\n              groupName,\n              shapeType: LandmarkEditType.RECTANGLE,\n              displayColor,\n            };\n            this.editor?.addRectangle(this.selectPath, shapeInfo, false);\n          } else if (type === SHAPE_TYPE.KEYPOINT) {\n            const categoryKey = `${frameIndex}_${instanceId}_${groupName}_${categoryName}`;\n            if (this.editor?.props.categoryPathShapes[categoryKey] === CategoryPathShape.CIRCLE) {\n              const path = this.editor.getPathByCategory(instanceId, groupName, categoryName);\n              if (path && path.data.isCircle) {\n                const pointCategory = this.editor.props.categories.find((c) => c.name === categoryName);\n                if (pointCategory) {\n                  if (\n                    this.affectedCategories.findIndex((affected) => affected.instanceId === instanceId && affected.groupName === groupName && affected.pointCategory === categoryName) < 0) {\n                    this.affectedCategories.push({\n                      instanceId,\n                      category,\n                      groupName,\n                      pointCategory: categoryName\n                    });\n                  }\n                  const sortedKeys = [...pointCategory.keys].sort((a, b) => a - b);\n                  const pIndex1 = sortedKeys[0];\n                  const pIndex2 = sortedKeys[Math.ceil(sortedKeys.length / 2)];\n                  if (index !== pIndex1 && index !== pIndex2) {\n                    return;\n                  }\n                }\n              }\n            }\n            this.editor?.updatePath(movingShape as paper.Shape, { x: movingShape.position.x + offsetX, y: movingShape.position.y + offsetY });\n            movingShape.position.x += offsetX;\n            movingShape.position.y += offsetY;\n          }\n        });\n        this.movingSegments.forEach((movingSegment) => {\n          movingSegment.point.x += offsetX;\n          movingSegment.point.y += offsetY;\n        });\n        this.affectedCategories.forEach(({ instanceId, category, groupName, pointCategory }) => {\n          const container = { instanceId, category, groupName };\n          this.editor?.updateCirclePath(pointCategory, true, container);\n        });\n        /* eslint-enable no-param-reassign */\n      } else if (this.movingHandles) {\n        // moving handle point\n        this.movingHandles.actual.x += offsetX;\n        this.movingHandles.actual.y += offsetY;\n        this.movingHandles.opposite.x = -this.movingHandles.actual.x;\n        this.movingHandles.opposite.y = -this.movingHandles.actual.y;\n      } else if (this.selectPath) {\n        // draw select path\n        if (this.editor.activeTool === CategoryPathShape.CIRCLE || (this.editor.activeTool === CategoryPathShape.RECTANGLE && !this.editor.canAddShape())) {\n          this.selectPath.add(localPoint);\n        } else if (this.editor.activeTool === CategoryPathShape.RECTANGLE && !resize) {\n          this.selectPath.segments[1].point.x += offsetX;\n          this.selectPath.segments[2].point.x += offsetX;\n          this.selectPath.segments[2].point.y += offsetY;\n          this.selectPath.segments[3].point.y += offsetY;\n          this.editor.addRectangle(this.selectPath, this.editor?.props.selectedShapeInfo as GroupInfo, false);\n        }\n      }\n    }\n  };\n\n  onMouseUp = (event: ToolEventExtend) => {\n    if (this.isRightButton(event)) {\n      this.editor?.drag(Paper.view.center);\n      this.downPoint = null;\n      this.downCenter = null;\n      return;\n    }\n    this.mouseDown = false;\n    if (this.editor?.warningBtn && this.editor?.warningBtn.item) return;\n    if (!this.isCtrlKey(event) && this.movingShapes.length > 0) {\n      // move ends\n      if (this.dragging && this.editor) {\n        if (this.editor.activeTool === CategoryPathShape.CIRCLE) {\n          const otherPoints: UpdatedShape[] = [];\n          this.affectedCategories.forEach(({ instanceId, category, groupName, pointCategory }) => {\n            const container = { instanceId, category, groupName };\n            const updatedShapes = this.editor?.updateCirclePath(pointCategory, true, container);\n            if (updatedShapes) {\n              updatedShapes.forEach(({ shape, index }) => {\n                if (index !== undefined && shape) {\n                  otherPoints.push({\n                    frameIndex: this.editor?.props.selectedShapeStatus.frameIndex || 0,\n                    instanceId,\n                    category,\n                    groupName,\n                    index,\n                    shapeType: LandmarkEditType.KEYPOINT,\n                    shape\n                  });\n                }\n              });\n            }\n          });\n          this.editor?.updatePointsPosition([...this.movingShapes.map((movingPoint) => {\n            const { frameIndex, instanceId, category, groupName, index } = movingPoint.data;\n            return {\n              frameIndex,\n              instanceId,\n              category,\n              groupName,\n              index,\n              shapeType: LandmarkEditType.KEYPOINT,\n              shape: { position: { x: movingPoint.position.x, y: movingPoint.position.y } }\n            };\n          }), ...otherPoints]);\n        } else if (this.editor.activeTool === CategoryPathShape.RECTANGLE) {\n          this.editor?.updateRectanglePosition([...this.movingShapes.filter((movingRectangle) => {\n            const { bounds: { width, height } } = movingRectangle.children[0];\n            if (width < this.minArea || height < this.minArea) {\n              this.editor?.deleteSelectedRectangle();\n              message.warning(formatMessage('MIN_SIZE_ALERT'));\n              return false;\n            }\n            return true;\n          }).map((movingRectangle) => {\n            const { instanceId, category, groupName, id, displayColor } = movingRectangle.data;\n            const { bounds: { x, y, width, height } } = movingRectangle.children[0];\n            const groupInfo = { frameIndex: this.editor?.props.selectedShapeStatus.frameIndex || 0, instanceId, category, groupName };\n            const rectInfo = {\n              x,\n              y,\n              width,\n              height,\n              displayColor: displayColor || '#5cdef0',\n            };\n            this.editor?.drawRectangle(rectInfo, groupInfo, id);\n            return {\n              ...groupInfo,\n              id,\n              shapeType: LandmarkEditType.RECTANGLE,\n              shape: {\n                ...rectInfo,\n                id,\n                visible: true, // default is visible when point added\n              },\n            };\n          })]);\n        }\n      }\n      if (this.selectPath) {\n        this.selectPath.remove();\n        this.selectPath = null;\n      }\n      this.movingShapes = [];\n      this.movingSegments = [];\n      this.affectedCategories = [];\n      this.editor?.drawWarnings();\n    } else if (this.movingHandles) {\n      // handle move ends\n      this.movingHandles = undefined;\n    } else if (this.dragging && this.selectPath) {\n      // select ends\n      if (this.editor?.mainLayer) {\n        const center = this.editor.mainLayer.localToGlobal(this.selectPath.bounds.center);\n        const hits = this.editor.mainLayer.hitTestAll(center, {\n          fill: true,\n          segments: true,\n          tolerance: this.selectPath.bounds.topLeft.getDistance(this.selectPath.bounds.bottomRight) / 2,\n        });\n\n        const selectedPoints: Set<paper.Shape> = new Set();\n        const selectedRectangles: Set<paper.Group> = new Set();\n        let selectedGroup: string | undefined;\n        const isOneGroup = (instanceId: string, groupName: string) => {\n          if (!selectedGroup) {\n            selectedGroup = `${instanceId}_${groupName}`;\n            return true;\n          }\n          return `${instanceId}_${groupName}` === selectedGroup;\n        };\n        hits.forEach((seg) => {\n          if (this.selectPath!.contains(seg.item.bounds.center)) {\n            if (seg.item.data.type === SHAPE_TYPE.KEYPOINT) {\n              if (isOneGroup(seg.item.data.instanceId, seg.item.data.groupName)) {\n                selectedPoints.add(seg.item as paper.Shape);\n              }\n            } else if (\n              seg.item.data.type === SHAPE_TYPE.RECTANGLE ||\n              seg.item.data.type === SHAPE_TYPE.RECTANGLE_POINT ||\n              seg.item.data.type === SHAPE_TYPE.RECTANGLE_PATH\n            ) {\n              if (isOneGroup(seg.item.parent.data.instanceId, seg.item.parent.data.groupName)) {\n                selectedRectangles.add(seg.item.parent as paper.Group);\n              }\n            }\n          }\n        });\n\n        // selected\n        if (selectedPoints.size) this.editor?.setMultiShapesSelected(Array.from(selectedPoints), CategoryPathShape.CIRCLE);\n        if (selectedRectangles.size) this.editor?.setMultiShapesSelected(Array.from(selectedRectangles), CategoryPathShape.RECTANGLE);\n      }\n      this.selectPath.remove();\n      this.selectPath = null;\n    } else if (this.editor?.canAddShape() && this.editor.activeTool === CategoryPathShape.CIRCLE) {\n      // add point\n      const point = Paper.view.projectToView(event.point);\n      // if (this.editor?.isPointInImage(point)) {\n      this.editor.addKeypoint(point);\n      // }\n    } else if (this.editor && rootStore.review.drawMode) {\n      // clear selection and move next\n      this.editor.props.setNextEmptyShape();\n    }\n    this.dragging = false;\n  };\n\n  handleQa = (result: ReviewResult) => {\n    if (this.editor?.props.selectedShapeStatus) {\n      const { instanceId, groupName, frameIndex, id } = this.editor.props.selectedShapeStatus;\n      let shapeIds = [];\n      if (id !== undefined) {\n        shapeIds = [id];\n      } else if (this.editor?.selectedPoints.length > 0) {\n        shapeIds = this.editor?.selectedPoints.map((point) => point.data.index);\n      } else if (this.editor?.selectedRectangles.length > 0) {\n        shapeIds = this.editor?.selectedRectangles.map((shape) => shape.data.id);\n      }\n      if (shapeIds.length) {\n        shapeIds.sort((a, b) => a - b);\n        if (result !== ReviewResult.REJECT && !rootStore.review.selectedReview) {\n          rootStore.review.setReview(\n            { result },\n            {\n              frameIndex,\n              instanceId,\n              groupName,\n              shapeIds,\n              result\n            }\n          );\n        } else {\n          rootStore.review.setSelectedReview({\n            frameIndex,\n            instanceId,\n            groupName,\n            shapeIds,\n            result\n          });\n        }\n        if ((result === ReviewResult.SUSPEND || result === ReviewResult.APPROVE) && !rootStore.review.selectedReview) {\n          message.success(formatMessage(`QC_SET_${result.toLocaleUpperCase()}`));\n        }\n      }\n    }\n  };\n\n  onKeyDown = ({ event }: { event: KeyboardEvent }) => {\n    if (isInput()) return;\n    const key = event.key.toLowerCase();\n    if (this.editor?.props.isReview && key !== 'v') return;\n    // Judgment modifier keyboard\n    if (event.altKey || event.shiftKey) {\n      return;\n    }\n\n    if (rootStore.review.drawMode) {\n      this.drawOnKeyDown(event, key);\n    } else if (rootStore.review.isEnabled) {\n      this.QaOnKeyDown(event, key);\n    }\n\n    switch (key) {\n      case ' ':\n        event.preventDefault();\n        if (rootStore.review.isEnabled) {\n          this.editor?.props.handleChangeDrawMode(!rootStore.review.drawMode);\n        }\n        break;\n      case 'f':\n        event.preventDefault();\n        if (screenfull.isEnabled) {\n          screenfull.toggle();\n        }\n        break;\n      // case 'g':\n      //   event.preventDefault();\n      //   if (this.editor && this.editor.gridLayer) {\n      //     this.editor.gridLayer.visible = !rootStore.setting.isGridVisible;\n      //   }\n      //   rootStore.setting.setGridVisible(!rootStore.setting.isGridVisible);\n      //   break;\n      case 's':\n        event.preventDefault();\n        this.editor?.props.onSave();\n        break;\n      case 'z':\n        event.preventDefault();\n        if (event.ctrlKey) this.editor?.props.handleUndo();\n        break;\n      case 'y':\n        event.preventDefault();\n        if (event.ctrlKey) this.editor?.props.handleRedo();\n        break;\n      case 'v':\n        if (!rootStore.review.selectedReview) {\n          event.preventDefault();\n          if (event.ctrlKey) {\n            this.editor?.props.setReview();\n          }\n        }\n        break;\n      default:\n    }\n  };\n\n  QaOnKeyDown = (event: KeyboardEvent, key: string) => {\n    if (this.editor?.props.readonly) return;\n    switch (key) {\n      case '2':\n        event.preventDefault();\n        this.handleQa(ReviewResult.REJECT);\n        break;\n      case '1':\n        event.preventDefault();\n        this.handleQa(ReviewResult.APPROVE);\n        break;\n      case '3':\n        event.preventDefault();\n        this.handleQa(ReviewResult.SUSPEND);\n        break;\n      default:\n    }\n  };\n\n  drawOnKeyDown = (event: KeyboardEvent, key: string) => {\n    if (this.editor?.props.readonly) return;\n    switch (key) {\n      case 'delete':\n      case 'backspace':\n        event.preventDefault();\n        this.editor?.deleteSelectedPoints();\n        this.editor?.deleteSelectedRectangle();\n        break;\n      // case 'a':\n      //   event.preventDefault();\n      //   this.editor?.autoAdjust();\n      //   break;\n      // case 'c':\n      //   event.preventDefault();\n      //   this.editor?.switchSmoothMode();\n      //   break;\n      case 'o':\n        event.preventDefault();\n        this.editor?.props.editShapeForm();\n        break;\n      case 'p':\n        event.preventDefault();\n        this.editor?.props.editGroupForm();\n        break;\n      // case 'r':\n      //   event.preventDefault();\n      //   this.editor?.setCategoryAsCircle();\n      //   break;\n      // case 'v':\n      //   event.preventDefault();\n      //   this.editor?.toggleSelectedPointVisibility();\n      //   break;\n      default:\n    }\n  };\n};\n"],"mappings":"AAAA,OAAOA,KAAK,MAAM,OAAO;AACzB,OAAOC,UAAU,MAAM,YAAY;AACnC,SAASC,EAAE,IAAIC,IAAI,QAAQ,MAAM;AACjC,SAASC,OAAO,QAAQ,MAAM;AAC9B,SAAiBC,UAAU,QAAQ,sBAAsB;AACzD,SAASC,iBAAiB,EAAaC,gBAAgB,EAAgBC,YAAY,EAAEC,UAAU,QAAe,UAAU;AACxH,SAASC,OAAO,QAAQ,gBAAgB;AACxC,OAAOC,aAAa,MAAM,YAAY;AACtC,OAAOC,SAAS,MAAM,oBAAoB;AAoB1C,eAAe,MAAMC,IAAI,SAASb,KAAK,CAACa,IAAI,CAAC;EA2B3CC,WAAWA,CAACC,MAAc,EAAE;IAC1B,KAAK,CAAC,CAAC;IAAC,KA3BVA,MAAM;IAAA,KAENC,SAAS,GAAuB,IAAI;IAAA,KAEpCC,UAAU,GAAuB,IAAI;IAAA,KAErCC,SAAS,GAAG,KAAK;IAAA,KAEjBC,QAAQ,GAAG,KAAK;IAAA,KAEhBC,WAAW,GAAiB,EAAE;IAAA,KAE9BC,YAAY,GAAiB,EAAE;IAAA,KAE/BC,QAAQ,GAAG,EAAE;IAAA,KAEbC,cAAc,GAAoB,EAAE;IAAA,KAEpCC,aAAa,GAA4BC,SAAS;IAAA,KAElDC,kBAAkB,GAAyF,EAAE;IAAA,KAE7GC,UAAU,GAAsB,IAAI;IAAA,KAEpCC,OAAO,GAAG,CAAC;IAAA,KAOXC,aAAa,GAAIC,KAAsB,IAAKA,KAAK,CAACA,KAAK,CAACC,KAAK,KAAK,CAAC,IAAID,KAAK,CAACE,SAAS,CAACC,KAAK;IAAA,KAE5FC,SAAS,GAAIJ,KAAsB,IAAKA,KAAK,CAACA,KAAK,CAACK,OAAO;IAAA,KAE3DC,WAAW,GAAIN,KAAsB,IAAK;MACxC,IAAI,IAAI,CAACD,aAAa,CAACC,KAAK,CAAC,EAAE;QAC7B,IAAI,CAACd,SAAS,GAAGhB,KAAK,CAACqC,IAAI,CAACC,aAAa,CAACR,KAAK,CAACS,KAAK,CAAC;QACtD,IAAI,CAACtB,UAAU,GAAGjB,KAAK,CAACqC,IAAI,CAACG,MAAM;QACnC;MACF;MACA,IAAI,IAAI,CAACzB,MAAM,EAAE;QACf,IAAI,CAACG,SAAS,GAAG,IAAI;QACrB,IAAI,IAAI,CAACH,MAAM,CAAC0B,UAAU,IAAI,IAAI,CAAC1B,MAAM,CAAC0B,UAAU,CAACC,IAAI,EAAE;UACzD,MAAM;YAAEC,UAAU;YAAEC,SAAS;YAAEC;UAAS,CAAC,GAAG,IAAI,CAAC9B,MAAM,CAAC0B,UAAU,CAACC,IAAI,CAACI,IAAI;UAC5E,IAAIH,UAAU,IAAIC,SAAS,IAAIC,QAAQ,KAAKpB,SAAS,EAAE;YACrDb,SAAS,CAACmC,MAAM,CAACC,iBAAiB,CAAC;cAAEC,UAAU,EAAE,IAAI,CAAClC,MAAM,CAACmC,KAAK,CAACC,YAAY;cAAER,UAAU;cAAEC,SAAS;cAAEC,QAAQ;cAAEO,MAAM,EAAE5C,YAAY,CAAC6C;YAAO,CAAC,CAAC;UAClJ;UACA;QACF;QACA,MAAM;UAAEC,IAAI,EAAEC;QAAS,CAAC,GAAG,IAAI,CAACxC,MAAM,CAACyC,IAAI,IAAI,CAAC,CAAC;QACjD,IAAI,CAAC,IAAI,CAACtB,SAAS,CAACJ,KAAK,CAAC,IAAI,IAAI,CAACf,MAAM,CAACyC,IAAI,IAAI,IAAI,CAACzC,MAAM,CAACyC,IAAI,CAACd,IAAI,CAACI,IAAI,CAACQ,IAAI,KAAKjD,UAAU,CAACoD,YAAY,EAAE;UAC7G,MAAM;YAAEd,UAAU,EAAEe,kBAAkB;YAAEd,SAAS,EAAEe,iBAAiB;YAAEC,KAAK;YAAEC;UAAG,CAAC,GAAG,IAAI,CAAC9C,MAAM,CAACyC,IAAI,CAACd,IAAI,CAACI,IAAI;UAC9G;UACA,IAAI,IAAI,CAAC/B,MAAM,CAAC+C,cAAc,CAACC,MAAM,GAAG,CAAC,IAAI,IAAI,CAAChD,MAAM,CAACiD,uBAAuB,CAACN,kBAAkB,EAAEC,iBAAiB,EAAEC,KAAK,CAAC,EAAE;YAC9H;YACA,IAAI,CAACvC,YAAY,GAAG,IAAI,CAACN,MAAM,CAAC+C,cAAc;UAChD,CAAC,MAAM,IAAI,IAAI,CAAC/C,MAAM,CAACkD,kBAAkB,CAACF,MAAM,GAAG,CAAC,IAAI,IAAI,CAAChD,MAAM,CAACiD,uBAAuB,CAACN,kBAAkB,EAAEC,iBAAiB,EAAEE,EAAE,CAAC,EAAE;YACtI;YACA,IAAI,CAACxC,YAAY,GAAG,IAAI,CAACN,MAAM,CAACkD,kBAAkB;UACpD,CAAC,MAAM,IAAIC,MAAM,CAACC,MAAM,CAAC1D,UAAU,CAAC,CAAC2D,QAAQ,CAACb,QAAsB,CAAC,EAAE;YACrE,MAAM;cAAEJ;YAAa,CAAC,GAAG,IAAI,CAACpC,MAAM,CAACmC,KAAK;YAC1C,MAAM;cAAEmB,QAAQ;cAAEC,SAAS;cAAEV,KAAK,EAAEW,QAAQ;cAAEC,IAAI,EAAE;gBAAE1B,IAAI,EAAE;kBAAEH,UAAU;kBAAEC,SAAS;kBAAE6B,aAAa,EAAEC,QAAQ;kBAAEb,EAAE,EAAEc,MAAM;kBAAEC;gBAAO;cAAE;YAAE,CAAC,GAAG,IAAI,CAAC7D,MAAM,CAACyC,IAAI,CAACqB,OAAO;YACjK,MAAMC,UAAU,GAAGF,MAAM,CAACL,QAAQ,CAAC;YACnC,IAAI,CAAC/C,aAAa,GAAG;cACnBuD,MAAM,EAAExB,QAAQ,KAAK9C,UAAU,CAACuE,SAAS,GAAGX,QAAQ,GAAGC,SAAS;cAChEW,QAAQ,EAAE1B,QAAQ,KAAK9C,UAAU,CAACuE,SAAS,GAAGV,SAAS,GAAGD,QAAQ;cAClEf,IAAI,EAAEC,QAAsB;cAC5BuB,UAAU;cACVH,MAAM;cACNhC,UAAU;cACVC,SAAS;cACT8B,QAAQ;cACRzB,UAAU,EAAEE;YACd,CAAC;UACH,CAAC,MAAM,IAAI,IAAI,CAACpC,MAAM,CAACyC,IAAI,CAACd,IAAI,EAAE;YAChC,MAAM;cAAEY,IAAI,EAAE4B;YAAY,CAAC,GAAG,IAAI,CAACnE,MAAM,CAACyC,IAAI,CAACd,IAAI,CAACI,IAAI;YACxD,IACE,CACEoC,WAAW,KAAK7E,UAAU,CAAC8E,cAAc,IACzCD,WAAW,KAAK7E,UAAU,CAAC+E,SAAS,IACpCF,WAAW,KAAK7E,UAAU,CAACgF,eAAe,KAE5C,IAAI,CAACtE,MAAM,CAACyC,IAAI,CAACd,IAAI,CAAC4C,MAAM,EAC5B;cACA;cACA,IAAI,CAACjE,YAAY,GAAG,CAAC,IAAI,CAACN,MAAM,CAACyC,IAAI,CAACd,IAAI,CAAC4C,MAAM,CAAC;cAClD,IAAIJ,WAAW,KAAK7E,UAAU,CAAC8E,cAAc,EAAE;gBAC7C,QAAQ,IAAI,CAACpE,MAAM,CAACyC,IAAI,CAACd,IAAI,CAACI,IAAI,CAACyC,YAAY;kBAC7C,KAAK,CAAC;oBACJ,IAAI,CAACjE,QAAQ,GAAG,KAAK;oBACrB;kBACF,KAAK,CAAC;oBACJ,IAAI,CAACA,QAAQ,GAAG,OAAO;oBACvB;kBACF,KAAK,CAAC;oBACJ,IAAI,CAACA,QAAQ,GAAG,QAAQ;oBACxB;kBACF,KAAK,CAAC;oBACJ,IAAI,CAACA,QAAQ,GAAG,MAAM;oBACtB;kBACF;oBACE;gBACJ;cACF,CAAC,MAAM,IAAI4D,WAAW,KAAK7E,UAAU,CAACgF,eAAe,EAAE;gBACrD,QAAQ,IAAI,CAACtE,MAAM,CAACyC,IAAI,CAACd,IAAI,CAACI,IAAI,CAACyC,YAAY;kBAC7C,KAAK,CAAC;oBACJ,IAAI,CAACjE,QAAQ,GAAG,IAAI;oBACpB;kBACF,KAAK,CAAC;oBACJ,IAAI,CAACA,QAAQ,GAAG,IAAI;oBACpB;kBACF,KAAK,CAAC;oBACJ,IAAI,CAACA,QAAQ,GAAG,IAAI;oBACpB;kBACF,KAAK,CAAC;oBACJ,IAAI,CAACA,QAAQ,GAAG,IAAI;oBACpB;kBACF;oBACE;gBACJ;cACF,CAAC,MAAM;gBACL,IAAI,CAACA,QAAQ,GAAG,QAAQ;cAC1B;YACF,CAAC,MAAM,IAAI4D,WAAW,KAAK7E,UAAU,CAACmF,QAAQ,EAAE;cAC9C;cACA,IAAI,CAACnE,YAAY,GAAG,CAAC,IAAI,CAACN,MAAM,CAACyC,IAAI,CAACd,IAAI,CAAC;YAC7C;UACF;UACA,IAAI,CAAChB,kBAAkB,GAAG,EAAE;UAC5B,IAAI,CAACH,cAAc,GAAG,EAAE;UACxB,IAAI,IAAI,CAACF,YAAY,CAAC0C,MAAM,KAAK,CAAC,EAAE;YAClC,MAAM;cAAEpB,UAAU;cAAE+B,QAAQ;cAAE9B,SAAS;cAAEgB,KAAK,EAAEkB,UAAU;cAAExB,IAAI;cAAEO,EAAE,EAAE4B;YAAQ,CAAC,GAAG,IAAI,CAACpE,YAAY,CAAC,CAAC,CAAC,CAACyB,IAAI;YAC3G,IAAIQ,IAAI,KAAKjD,UAAU,CAACmF,QAAQ,EAAE;cAAA,IAAAE,YAAA;cAChC,CAAAA,YAAA,OAAI,CAAC3E,MAAM,cAAA2E,YAAA,uBAAXA,YAAA,CAAaxC,KAAK,CAACyC,gBAAgB,CAACb,UAAU,EAAE;gBAAEnC,UAAU;gBAAE+B,QAAQ;gBAAE9B,SAAS;gBAAEgD,SAAS,EAAErF,gBAAgB,CAACiF;cAAS,CAAC,CAAC;YAC5H,CAAC,MAAM,IAAIlC,IAAI,KAAKjD,UAAU,CAACwF,eAAe,EAAE;cAAA,IAAAC,aAAA;cAC9C,MAAM;gBAAEC,MAAM,EAAE;kBAAEC,OAAO;kBAAEC,QAAQ;kBAAEC,WAAW;kBAAEC;gBAAW;cAAE,CAAC,GAAG,IAAI,CAAC9E,YAAY,CAAC,CAAC,CAAC,CAAC+E,QAAQ,CAAC,CAAC,CAAC;cACnG,IAAI,CAACzE,UAAU,GAAG,IAAI3B,KAAK,CAACqG,IAAI,CAAC,CAAC;cAClC,IAAI,CAAC1E,UAAU,CAACmB,IAAI,CAACe,EAAE,GAAG4B,OAAO;cACjC,IAAI,CAAC9D,UAAU,CAAC2E,GAAG,CAACN,OAAO,CAAC;cAC5B,IAAI,CAACrE,UAAU,CAAC2E,GAAG,CAACL,QAAQ,CAAC;cAC7B,IAAI,CAACtE,UAAU,CAAC2E,GAAG,CAACJ,WAAW,CAAC;cAChC,IAAI,CAACvE,UAAU,CAAC2E,GAAG,CAACH,UAAU,CAAC;cAC/B,IAAI,CAACxE,UAAU,CAAC4E,MAAM,GAAG,IAAI;cAC7B,CAAAT,aAAA,OAAI,CAAC/E,MAAM,cAAA+E,aAAA,uBAAXA,aAAA,CAAa5C,KAAK,CAACyC,gBAAgB,CAACF,OAAO,EAAE;gBAAE9C,UAAU;gBAAE+B,QAAQ;gBAAE9B,SAAS;gBAAEgD,SAAS,EAAErF,gBAAgB,CAAC6E;cAAU,CAAC,CAAC;YAC1H;UACF;UAEA,IAAI,CAACxE,SAAS,CAACmC,MAAM,CAACyD,QAAQ,EAAE;YAC9B,IAAI,CAACnF,YAAY,GAAG,EAAE;YACtB,IAAI,CAACM,UAAU,GAAG,IAAI;UACxB;QACF,CAAC,MAAM;UACL;UACA,IAAI,CAACZ,MAAM,CAAC0F,wBAAwB,CAAC,CAAC;UACtC,MAAMC,UAAU,GAAG,IAAI,CAAC3F,MAAM,CAAC4F,eAAe,CAAC3G,KAAK,CAACqC,IAAI,CAACC,aAAa,CAACR,KAAK,CAACS,KAAK,CAAC,CAAC;UACrF,IAAI,IAAI,CAACxB,MAAM,CAAC6F,UAAU,KAAKtG,iBAAiB,CAACuG,MAAM,IAAK,IAAI,CAAC9F,MAAM,CAAC6F,UAAU,KAAKtG,iBAAiB,CAAC8E,SAAS,IAAI,CAAC,IAAI,CAACrE,MAAM,CAAC+F,WAAW,CAAC,CAAE,EAAE;YACjJ,IAAI,CAACnF,UAAU,GAAG,IAAI3B,KAAK,CAACqG,IAAI,CAAC;cAC/BU,QAAQ,EAAE,CAACL,UAAU,CAAC;cACtBM,WAAW,EAAE,KAAK;cAClBC,WAAW,EAAE,CAAC;cACdC,aAAa,EAAE;YACjB,CAAC,CAAC;UACJ,CAAC,MAAM,IACL,IAAI,CAACnG,MAAM,CAAC6F,UAAU,KAAKtG,iBAAiB,CAAC8E,SAAS,IACtD,IAAI,CAACrE,MAAM,CAAC+F,WAAW,CAAC,CAAC,IACzB,IAAI,CAAC/F,MAAM,CAACoG,eAAe,CAACC,OAAO,EACnC;YAAA,IAAAC,aAAA;YACA,MAAM;cAAE1E,UAAU;cAAE+B,QAAQ;cAAE9B;YAAU,CAAC,GAAG,IAAI,CAAC7B,MAAM,CAACmC,KAAK,CAACoE,iBAA8B;YAC5F,MAAMzD,EAAE,GAAG1D,IAAI,CAAC,CAAC;YACjB,IAAI,CAACwB,UAAU,GAAG,IAAI3B,KAAK,CAACqG,IAAI,CAAC,CAAC;YAClC,IAAI,CAAC1E,UAAU,CAACmB,IAAI,CAACe,EAAE,GAAGA,EAAE;YAC5B,IAAI,CAAClC,UAAU,CAAC2E,GAAG,CAACI,UAAU,CAAC;YAC/B,IAAI,CAAC/E,UAAU,CAAC2E,GAAG,CAACI,UAAU,CAAC;YAC/B,IAAI,CAAC/E,UAAU,CAAC2E,GAAG,CAACI,UAAU,CAAC;YAC/B,IAAI,CAAC/E,UAAU,CAAC2E,GAAG,CAACI,UAAU,CAAC;YAC/B,IAAI,CAAC/E,UAAU,CAAC4E,MAAM,GAAG,IAAI;YAC7B,IAAI,CAACxF,MAAM,CAACwG,YAAY,CAAC,IAAI,CAAC5F,UAAU,GAAA0F,aAAA,GAAE,IAAI,CAACtG,MAAM,cAAAsG,aAAA,uBAAXA,aAAA,CAAanE,KAAK,CAACoE,iBAA8B,CAAC;YAC5F,MAAME,YAAY,GAAG,IAAI,CAACzG,MAAM,CAAC0G,aAAa,CAAC9E,UAAU,EAAEC,SAAS,EAAEiB,EAAE,CAAC;YACzE,IAAI,CAAC9C,MAAM,CAACmC,KAAK,CAACyC,gBAAgB,CAAC9B,EAAE,EAAE;cAAElB,UAAU;cAAE+B,QAAQ;cAAE9B,SAAS;cAAEgD,SAAS,EAAErF,gBAAgB,CAAC6E;YAAU,CAAC,CAAC;YAClH,IAAI,CAAC/D,YAAY,CAACqG,IAAI,CAACF,YAAY,CAAC;YACpC,IAAI,CAAClG,QAAQ,GAAG,IAAI;YACpB,IAAI,CAACH,QAAQ,GAAG,IAAI;UACtB;QACF;MACF;IACF,CAAC;IAAA,KAEDwG,WAAW,GAAI7F,KAAsB,IAAK;MAAA,IAAA8F,aAAA,EAAAC,aAAA,EAAAC,aAAA,EAAAC,aAAA;MACxC,IAAI,IAAI,CAAClG,aAAa,CAACC,KAAK,CAAC,EAAE;QAC7B,IAAI,CAAC,IAAI,CAACd,SAAS,IAAI,CAAC,IAAI,CAACC,UAAU,EAAE;UACvC,IAAI,CAACD,SAAS,GAAGhB,KAAK,CAACqC,IAAI,CAACC,aAAa,CAACR,KAAK,CAACS,KAAK,CAAC;UACtD,IAAI,CAACtB,UAAU,GAAGjB,KAAK,CAACqC,IAAI,CAACG,MAAM;QACrC;QAEA,MAAMwF,QAAQ,GAAGC,IAAI,CAACC,KAAK,CAAClI,KAAK,CAACqC,IAAI,CAAC2F,QAAQ,CAAC;QAChD,MAAMG,WAAW,GAAGnI,KAAK,CAACqC,IAAI,CAACC,aAAa,CAACR,KAAK,CAACS,KAAK,CAAC,CAAC6F,MAAM,CAAC,CAACJ,QAAQ,EAAE,IAAI,CAAChH,SAAS,CAAC;QAC3F,MAAMqH,UAAU,GAAGF,WAAW,CAACG,QAAQ,CAAC,IAAI,CAACtH,SAAS,CAAC;QACvD,MAAMuH,eAAe,GAAG,IAAI,CAACtH,UAAU,CAACqH,QAAQ,CAACD,UAAU,CAACG,MAAM,CAACxI,KAAK,CAACqC,IAAI,CAACoG,IAAI,CAAC,CAAC;QACpFzI,KAAK,CAACqC,IAAI,CAACG,MAAM,GAAG+F,eAAe;QACnC;MACF;MACA,IAAI,EAAAX,aAAA,OAAI,CAAC7G,MAAM,cAAA6G,aAAA,uBAAXA,aAAA,CAAa1E,KAAK,CAACwF,QAAQ,OAAAb,aAAA,GAAI,IAAI,CAAC9G,MAAM,cAAA8G,aAAA,uBAAXA,aAAA,CAAa3E,KAAK,CAACyF,QAAQ,KAAK,EAAAb,aAAA,OAAI,CAAC/G,MAAM,cAAA+G,aAAA,uBAAXA,aAAA,CAAarF,UAAU,OAAAsF,aAAA,GAAI,IAAI,CAAChH,MAAM,cAAAgH,aAAA,uBAAXA,aAAA,CAAatF,UAAU,CAACC,IAAI,CAAC,EAAE;MAC7H,IAAIkG,MAAM,GAAG,KAAK;MAClB,IAAI,IAAI,CAAC7H,MAAM,EAAE;QACf,MAAM2F,UAAU,GAAG,IAAI,CAAC3F,MAAM,CAAC4F,eAAe,CAAC3G,KAAK,CAACqC,IAAI,CAACC,aAAa,CAACR,KAAK,CAACS,KAAK,CAAC,CAAC;QACrF,MAAMsG,cAAc,GAAG,IAAI,CAAC9H,MAAM,CAAC4F,eAAe,CAAC3G,KAAK,CAACqC,IAAI,CAACC,aAAa,CAACR,KAAK,CAACgH,SAAS,CAAC,CAAC;QAC7F,MAAMC,OAAO,GAAGrC,UAAU,CAACsC,CAAC,GAAGH,cAAc,CAACG,CAAC;QAC/C,MAAMC,OAAO,GAAGvC,UAAU,CAACwC,CAAC,GAAGL,cAAc,CAACK,CAAC;QAC/C,IAAIjB,IAAI,CAACkB,GAAG,CAACJ,OAAO,CAAC,GAAG,CAAC,IAAId,IAAI,CAACkB,GAAG,CAACF,OAAO,CAAC,GAAG,CAAC,EAAE;UAClD,IAAI,CAAC9H,QAAQ,GAAG,IAAI;QACtB;QAEA,IAAI,IAAI,CAACE,YAAY,CAAC0C,MAAM,GAAG,CAAC,EAAE;UAChC;UACA;UACA,IAAI,CAAC1C,YAAY,CAAC+H,OAAO,CAAEC,WAAW,IAAK;YACzC,MAAM;cAAEpG,UAAU;cAAEN,UAAU;cAAE+B,QAAQ;cAAE9B,SAAS;cAAE6B,aAAa,EAAE6E,YAAY;cAAE1F,KAAK;cAAEN,IAAI;cAAEiG;YAAa,CAAC,GAAGF,WAAW,CAACvG,IAAI;YAChI,IAAIQ,IAAI,KAAKjD,UAAU,CAACwF,eAAe,IAAI,IAAI,CAAClE,UAAU,EAAE;cAAA,IAAA6H,aAAA;cAC1DZ,MAAM,GAAG,IAAI;cACb,QAAQ,IAAI,CAACtH,QAAQ;gBACnB,KAAK,IAAI;kBACP,IAAI,CAACK,UAAU,CAACoF,QAAQ,CAAC,CAAC,CAAC,CAACxE,KAAK,CAACyG,CAAC,IAAID,OAAO;kBAC9C,IAAI,CAACpH,UAAU,CAACoF,QAAQ,CAAC,CAAC,CAAC,CAACxE,KAAK,CAAC2G,CAAC,IAAID,OAAO;kBAC9C,IAAI,CAACtH,UAAU,CAACoF,QAAQ,CAAC,CAAC,CAAC,CAACxE,KAAK,CAAC2G,CAAC,IAAID,OAAO;kBAC9C,IAAI,CAACtH,UAAU,CAACoF,QAAQ,CAAC,CAAC,CAAC,CAACxE,KAAK,CAACyG,CAAC,IAAID,OAAO;kBAC9C;gBACF,KAAK,IAAI;kBACP,IAAI,CAACpH,UAAU,CAACoF,QAAQ,CAAC,CAAC,CAAC,CAACxE,KAAK,CAACyG,CAAC,IAAID,OAAO;kBAC9C,IAAI,CAACpH,UAAU,CAACoF,QAAQ,CAAC,CAAC,CAAC,CAACxE,KAAK,CAAC2G,CAAC,IAAID,OAAO;kBAC9C,IAAI,CAACtH,UAAU,CAACoF,QAAQ,CAAC,CAAC,CAAC,CAACxE,KAAK,CAAC2G,CAAC,IAAID,OAAO;kBAC9C,IAAI,CAACtH,UAAU,CAACoF,QAAQ,CAAC,CAAC,CAAC,CAACxE,KAAK,CAACyG,CAAC,IAAID,OAAO;kBAC9C;gBACF,KAAK,IAAI;kBACP,IAAI,CAACpH,UAAU,CAACoF,QAAQ,CAAC,CAAC,CAAC,CAACxE,KAAK,CAACyG,CAAC,IAAID,OAAO;kBAC9C,IAAI,CAACpH,UAAU,CAACoF,QAAQ,CAAC,CAAC,CAAC,CAACxE,KAAK,CAAC2G,CAAC,IAAID,OAAO;kBAC9C,IAAI,CAACtH,UAAU,CAACoF,QAAQ,CAAC,CAAC,CAAC,CAACxE,KAAK,CAAC2G,CAAC,IAAID,OAAO;kBAC9C,IAAI,CAACtH,UAAU,CAACoF,QAAQ,CAAC,CAAC,CAAC,CAACxE,KAAK,CAACyG,CAAC,IAAID,OAAO;kBAC9C;gBACF,KAAK,IAAI;kBACP,IAAI,CAACpH,UAAU,CAACoF,QAAQ,CAAC,CAAC,CAAC,CAACxE,KAAK,CAACyG,CAAC,IAAID,OAAO;kBAC9C,IAAI,CAACpH,UAAU,CAACoF,QAAQ,CAAC,CAAC,CAAC,CAACxE,KAAK,CAAC2G,CAAC,IAAID,OAAO;kBAC9C,IAAI,CAACtH,UAAU,CAACoF,QAAQ,CAAC,CAAC,CAAC,CAACxE,KAAK,CAAC2G,CAAC,IAAID,OAAO;kBAC9C,IAAI,CAACtH,UAAU,CAACoF,QAAQ,CAAC,CAAC,CAAC,CAACxE,KAAK,CAACyG,CAAC,IAAID,OAAO;kBAC9C;gBACF,KAAK,KAAK;kBACR,IAAI,CAACpH,UAAU,CAACoF,QAAQ,CAAC,CAAC,CAAC,CAACxE,KAAK,CAAC2G,CAAC,IAAID,OAAO;kBAC9C,IAAI,CAACtH,UAAU,CAACoF,QAAQ,CAAC,CAAC,CAAC,CAACxE,KAAK,CAAC2G,CAAC,IAAID,OAAO;kBAC9C;gBACF,KAAK,OAAO;kBACV,IAAI,CAACtH,UAAU,CAACoF,QAAQ,CAAC,CAAC,CAAC,CAACxE,KAAK,CAACyG,CAAC,IAAID,OAAO;kBAC9C,IAAI,CAACpH,UAAU,CAACoF,QAAQ,CAAC,CAAC,CAAC,CAACxE,KAAK,CAACyG,CAAC,IAAID,OAAO;kBAC9C;gBACF,KAAK,QAAQ;kBACX,IAAI,CAACpH,UAAU,CAACoF,QAAQ,CAAC,CAAC,CAAC,CAACxE,KAAK,CAAC2G,CAAC,IAAID,OAAO;kBAC9C,IAAI,CAACtH,UAAU,CAACoF,QAAQ,CAAC,CAAC,CAAC,CAACxE,KAAK,CAAC2G,CAAC,IAAID,OAAO;kBAC9C;gBACF,KAAK,MAAM;kBACT,IAAI,CAACtH,UAAU,CAACoF,QAAQ,CAAC,CAAC,CAAC,CAACxE,KAAK,CAACyG,CAAC,IAAID,OAAO;kBAC9C,IAAI,CAACpH,UAAU,CAACoF,QAAQ,CAAC,CAAC,CAAC,CAACxE,KAAK,CAACyG,CAAC,IAAID,OAAO;kBAC9C;gBACF,KAAK,QAAQ;kBACX,IAAI,CAACpH,UAAU,CAACoF,QAAQ,CAAC,CAAC,CAAC,CAACxE,KAAK,CAACyG,CAAC,IAAID,OAAO;kBAC9C,IAAI,CAACpH,UAAU,CAACoF,QAAQ,CAAC,CAAC,CAAC,CAACxE,KAAK,CAAC2G,CAAC,IAAID,OAAO;kBAC9C,IAAI,CAACtH,UAAU,CAACoF,QAAQ,CAAC,CAAC,CAAC,CAACxE,KAAK,CAACyG,CAAC,IAAID,OAAO;kBAC9C,IAAI,CAACpH,UAAU,CAACoF,QAAQ,CAAC,CAAC,CAAC,CAACxE,KAAK,CAAC2G,CAAC,IAAID,OAAO;kBAC9C,IAAI,CAACtH,UAAU,CAACoF,QAAQ,CAAC,CAAC,CAAC,CAACxE,KAAK,CAACyG,CAAC,IAAID,OAAO;kBAC9C,IAAI,CAACpH,UAAU,CAACoF,QAAQ,CAAC,CAAC,CAAC,CAACxE,KAAK,CAAC2G,CAAC,IAAID,OAAO;kBAC9C,IAAI,CAACtH,UAAU,CAACoF,QAAQ,CAAC,CAAC,CAAC,CAACxE,KAAK,CAACyG,CAAC,IAAID,OAAO;kBAC9C,IAAI,CAACpH,UAAU,CAACoF,QAAQ,CAAC,CAAC,CAAC,CAACxE,KAAK,CAAC2G,CAAC,IAAID,OAAO;kBAC9C;gBACF;kBACE;cACJ;cACA,MAAMQ,SAAoB,GAAG;gBAC3B9G,UAAU;gBACV+B,QAAQ;gBACR9B,SAAS;gBACTgD,SAAS,EAAErF,gBAAgB,CAAC6E,SAAS;gBACrCmE;cACF,CAAC;cACD,CAAAC,aAAA,OAAI,CAACzI,MAAM,cAAAyI,aAAA,uBAAXA,aAAA,CAAajC,YAAY,CAAC,IAAI,CAAC5F,UAAU,EAAE8H,SAAS,EAAE,KAAK,CAAC;YAC9D,CAAC,MAAM,IAAInG,IAAI,KAAKjD,UAAU,CAACmF,QAAQ,EAAE;cAAA,IAAAkE,aAAA,EAAAC,cAAA;cACvC,MAAMC,WAAW,GAAI,GAAE3G,UAAW,IAAGN,UAAW,IAAGC,SAAU,IAAG0G,YAAa,EAAC;cAC9E,IAAI,EAAAI,aAAA,OAAI,CAAC3I,MAAM,cAAA2I,aAAA,uBAAXA,aAAA,CAAaxG,KAAK,CAAC2G,kBAAkB,CAACD,WAAW,CAAC,MAAKtJ,iBAAiB,CAACuG,MAAM,EAAE;gBACnF,MAAMrC,IAAI,GAAG,IAAI,CAACzD,MAAM,CAAC+I,iBAAiB,CAACnH,UAAU,EAAEC,SAAS,EAAE0G,YAAY,CAAC;gBAC/E,IAAI9E,IAAI,IAAIA,IAAI,CAAC1B,IAAI,CAACiH,QAAQ,EAAE;kBAC9B,MAAMtF,aAAa,GAAG,IAAI,CAAC1D,MAAM,CAACmC,KAAK,CAAC8G,UAAU,CAACC,IAAI,CAAEC,CAAC,IAAKA,CAAC,CAACC,IAAI,KAAKb,YAAY,CAAC;kBACvF,IAAI7E,aAAa,EAAE;oBACjB,IACE,IAAI,CAAC/C,kBAAkB,CAAC0I,SAAS,CAAEC,QAAQ,IAAKA,QAAQ,CAAC1H,UAAU,KAAKA,UAAU,IAAI0H,QAAQ,CAACzH,SAAS,KAAKA,SAAS,IAAIyH,QAAQ,CAAC5F,aAAa,KAAK6E,YAAY,CAAC,GAAG,CAAC,EAAE;sBACxK,IAAI,CAAC5H,kBAAkB,CAACgG,IAAI,CAAC;wBAC3B/E,UAAU;wBACV+B,QAAQ;wBACR9B,SAAS;wBACT6B,aAAa,EAAE6E;sBACjB,CAAC,CAAC;oBACJ;oBACA,MAAMgB,UAAU,GAAG,CAAC,GAAG7F,aAAa,CAAC8F,IAAI,CAAC,CAACC,IAAI,CAAC,CAACC,CAAC,EAAEC,CAAC,KAAKD,CAAC,GAAGC,CAAC,CAAC;oBAChE,MAAMC,OAAO,GAAGL,UAAU,CAAC,CAAC,CAAC;oBAC7B,MAAMM,OAAO,GAAGN,UAAU,CAACrC,IAAI,CAAC4C,IAAI,CAACP,UAAU,CAACvG,MAAM,GAAG,CAAC,CAAC,CAAC;oBAC5D,IAAIH,KAAK,KAAK+G,OAAO,IAAI/G,KAAK,KAAKgH,OAAO,EAAE;sBAC1C;oBACF;kBACF;gBACF;cACF;cACA,CAAAjB,cAAA,OAAI,CAAC5I,MAAM,cAAA4I,cAAA,uBAAXA,cAAA,CAAamB,UAAU,CAACzB,WAAW,EAAiB;gBAAEL,CAAC,EAAEK,WAAW,CAAC0B,QAAQ,CAAC/B,CAAC,GAAGD,OAAO;gBAAEG,CAAC,EAAEG,WAAW,CAAC0B,QAAQ,CAAC7B,CAAC,GAAGD;cAAQ,CAAC,CAAC;cACjII,WAAW,CAAC0B,QAAQ,CAAC/B,CAAC,IAAID,OAAO;cACjCM,WAAW,CAAC0B,QAAQ,CAAC7B,CAAC,IAAID,OAAO;YACnC;UACF,CAAC,CAAC;UACF,IAAI,CAAC1H,cAAc,CAAC6H,OAAO,CAAE4B,aAAa,IAAK;YAC7CA,aAAa,CAACzI,KAAK,CAACyG,CAAC,IAAID,OAAO;YAChCiC,aAAa,CAACzI,KAAK,CAAC2G,CAAC,IAAID,OAAO;UAClC,CAAC,CAAC;UACF,IAAI,CAACvH,kBAAkB,CAAC0H,OAAO,CAAC,CAAC;YAAEzG,UAAU;YAAE+B,QAAQ;YAAE9B,SAAS;YAAE6B;UAAc,CAAC,KAAK;YAAA,IAAAwG,cAAA;YACtF,MAAMC,SAAS,GAAG;cAAEvI,UAAU;cAAE+B,QAAQ;cAAE9B;YAAU,CAAC;YACrD,CAAAqI,cAAA,OAAI,CAAClK,MAAM,cAAAkK,cAAA,uBAAXA,cAAA,CAAaE,gBAAgB,CAAC1G,aAAa,EAAE,IAAI,EAAEyG,SAAS,CAAC;UAC/D,CAAC,CAAC;UACF;QACF,CAAC,MAAM,IAAI,IAAI,CAAC1J,aAAa,EAAE;UAC7B;UACA,IAAI,CAACA,aAAa,CAACuD,MAAM,CAACiE,CAAC,IAAID,OAAO;UACtC,IAAI,CAACvH,aAAa,CAACuD,MAAM,CAACmE,CAAC,IAAID,OAAO;UACtC,IAAI,CAACzH,aAAa,CAACyD,QAAQ,CAAC+D,CAAC,GAAG,CAAC,IAAI,CAACxH,aAAa,CAACuD,MAAM,CAACiE,CAAC;UAC5D,IAAI,CAACxH,aAAa,CAACyD,QAAQ,CAACiE,CAAC,GAAG,CAAC,IAAI,CAAC1H,aAAa,CAACuD,MAAM,CAACmE,CAAC;QAC9D,CAAC,MAAM,IAAI,IAAI,CAACvH,UAAU,EAAE;UAC1B;UACA,IAAI,IAAI,CAACZ,MAAM,CAAC6F,UAAU,KAAKtG,iBAAiB,CAACuG,MAAM,IAAK,IAAI,CAAC9F,MAAM,CAAC6F,UAAU,KAAKtG,iBAAiB,CAAC8E,SAAS,IAAI,CAAC,IAAI,CAACrE,MAAM,CAAC+F,WAAW,CAAC,CAAE,EAAE;YACjJ,IAAI,CAACnF,UAAU,CAAC2E,GAAG,CAACI,UAAU,CAAC;UACjC,CAAC,MAAM,IAAI,IAAI,CAAC3F,MAAM,CAAC6F,UAAU,KAAKtG,iBAAiB,CAAC8E,SAAS,IAAI,CAACwD,MAAM,EAAE;YAAA,IAAAwC,cAAA;YAC5E,IAAI,CAACzJ,UAAU,CAACoF,QAAQ,CAAC,CAAC,CAAC,CAACxE,KAAK,CAACyG,CAAC,IAAID,OAAO;YAC9C,IAAI,CAACpH,UAAU,CAACoF,QAAQ,CAAC,CAAC,CAAC,CAACxE,KAAK,CAACyG,CAAC,IAAID,OAAO;YAC9C,IAAI,CAACpH,UAAU,CAACoF,QAAQ,CAAC,CAAC,CAAC,CAACxE,KAAK,CAAC2G,CAAC,IAAID,OAAO;YAC9C,IAAI,CAACtH,UAAU,CAACoF,QAAQ,CAAC,CAAC,CAAC,CAACxE,KAAK,CAAC2G,CAAC,IAAID,OAAO;YAC9C,IAAI,CAAClI,MAAM,CAACwG,YAAY,CAAC,IAAI,CAAC5F,UAAU,GAAAyJ,cAAA,GAAE,IAAI,CAACrK,MAAM,cAAAqK,cAAA,uBAAXA,cAAA,CAAalI,KAAK,CAACoE,iBAAiB,EAAe,KAAK,CAAC;UACrG;QACF;MACF;IACF,CAAC;IAAA,KAED+D,SAAS,GAAIvJ,KAAsB,IAAK;MAAA,IAAAwJ,cAAA,EAAAC,cAAA,EAAAC,cAAA;MACtC,IAAI,IAAI,CAAC3J,aAAa,CAACC,KAAK,CAAC,EAAE;QAAA,IAAA2J,cAAA;QAC7B,CAAAA,cAAA,OAAI,CAAC1K,MAAM,cAAA0K,cAAA,uBAAXA,cAAA,CAAaC,IAAI,CAAC1L,KAAK,CAACqC,IAAI,CAACG,MAAM,CAAC;QACpC,IAAI,CAACxB,SAAS,GAAG,IAAI;QACrB,IAAI,CAACC,UAAU,GAAG,IAAI;QACtB;MACF;MACA,IAAI,CAACC,SAAS,GAAG,KAAK;MACtB,IAAI,EAAAoK,cAAA,OAAI,CAACvK,MAAM,cAAAuK,cAAA,uBAAXA,cAAA,CAAa7I,UAAU,OAAA8I,cAAA,GAAI,IAAI,CAACxK,MAAM,cAAAwK,cAAA,uBAAXA,cAAA,CAAa9I,UAAU,CAACC,IAAI,GAAE;MAC7D,IAAI,CAAC,IAAI,CAACR,SAAS,CAACJ,KAAK,CAAC,IAAI,IAAI,CAACT,YAAY,CAAC0C,MAAM,GAAG,CAAC,EAAE;QAAA,IAAA4H,cAAA;QAC1D;QACA,IAAI,IAAI,CAACxK,QAAQ,IAAI,IAAI,CAACJ,MAAM,EAAE;UAChC,IAAI,IAAI,CAACA,MAAM,CAAC6F,UAAU,KAAKtG,iBAAiB,CAACuG,MAAM,EAAE;YAAA,IAAA+E,cAAA;YACvD,MAAMC,WAA2B,GAAG,EAAE;YACtC,IAAI,CAACnK,kBAAkB,CAAC0H,OAAO,CAAC,CAAC;cAAEzG,UAAU;cAAE+B,QAAQ;cAAE9B,SAAS;cAAE6B;YAAc,CAAC,KAAK;cAAA,IAAAqH,cAAA;cACtF,MAAMZ,SAAS,GAAG;gBAAEvI,UAAU;gBAAE+B,QAAQ;gBAAE9B;cAAU,CAAC;cACrD,MAAMmJ,aAAa,IAAAD,cAAA,GAAG,IAAI,CAAC/K,MAAM,cAAA+K,cAAA,uBAAXA,cAAA,CAAaX,gBAAgB,CAAC1G,aAAa,EAAE,IAAI,EAAEyG,SAAS,CAAC;cACnF,IAAIa,aAAa,EAAE;gBACjBA,aAAa,CAAC3C,OAAO,CAAC,CAAC;kBAAE4C,KAAK;kBAAEpI;gBAAM,CAAC,KAAK;kBAC1C,IAAIA,KAAK,KAAKnC,SAAS,IAAIuK,KAAK,EAAE;oBAAA,IAAAC,cAAA;oBAChCJ,WAAW,CAACnE,IAAI,CAAC;sBACfzE,UAAU,EAAE,EAAAgJ,cAAA,OAAI,CAAClL,MAAM,cAAAkL,cAAA,uBAAXA,cAAA,CAAa/I,KAAK,CAACgJ,mBAAmB,CAACjJ,UAAU,KAAI,CAAC;sBAClEN,UAAU;sBACV+B,QAAQ;sBACR9B,SAAS;sBACTgB,KAAK;sBACLgC,SAAS,EAAErF,gBAAgB,CAACiF,QAAQ;sBACpCwG;oBACF,CAAC,CAAC;kBACJ;gBACF,CAAC,CAAC;cACJ;YACF,CAAC,CAAC;YACF,CAAAJ,cAAA,OAAI,CAAC7K,MAAM,cAAA6K,cAAA,uBAAXA,cAAA,CAAaO,oBAAoB,CAAC,CAAC,GAAG,IAAI,CAAC9K,YAAY,CAAC+K,GAAG,CAAEC,WAAW,IAAK;cAC3E,MAAM;gBAAEpJ,UAAU;gBAAEN,UAAU;gBAAE+B,QAAQ;gBAAE9B,SAAS;gBAAEgB;cAAM,CAAC,GAAGyI,WAAW,CAACvJ,IAAI;cAC/E,OAAO;gBACLG,UAAU;gBACVN,UAAU;gBACV+B,QAAQ;gBACR9B,SAAS;gBACTgB,KAAK;gBACLgC,SAAS,EAAErF,gBAAgB,CAACiF,QAAQ;gBACpCwG,KAAK,EAAE;kBAAEjB,QAAQ,EAAE;oBAAE/B,CAAC,EAAEqD,WAAW,CAACtB,QAAQ,CAAC/B,CAAC;oBAAEE,CAAC,EAAEmD,WAAW,CAACtB,QAAQ,CAAC7B;kBAAE;gBAAE;cAC9E,CAAC;YACH,CAAC,CAAC,EAAE,GAAG2C,WAAW,CAAC,CAAC;UACtB,CAAC,MAAM,IAAI,IAAI,CAAC9K,MAAM,CAAC6F,UAAU,KAAKtG,iBAAiB,CAAC8E,SAAS,EAAE;YAAA,IAAAkH,cAAA;YACjE,CAAAA,cAAA,OAAI,CAACvL,MAAM,cAAAuL,cAAA,uBAAXA,cAAA,CAAaC,uBAAuB,CAAC,CAAC,GAAG,IAAI,CAAClL,YAAY,CAACmL,MAAM,CAAEC,eAAe,IAAK;cACrF,MAAM;gBAAE1G,MAAM,EAAE;kBAAE2G,KAAK;kBAAEC;gBAAO;cAAE,CAAC,GAAGF,eAAe,CAACrG,QAAQ,CAAC,CAAC,CAAC;cACjE,IAAIsG,KAAK,GAAG,IAAI,CAAC9K,OAAO,IAAI+K,MAAM,GAAG,IAAI,CAAC/K,OAAO,EAAE;gBAAA,IAAAgL,cAAA;gBACjD,CAAAA,cAAA,OAAI,CAAC7L,MAAM,cAAA6L,cAAA,uBAAXA,cAAA,CAAaC,uBAAuB,CAAC,CAAC;gBACtCzM,OAAO,CAAC0M,OAAO,CAACnM,aAAa,CAAC,gBAAgB,CAAC,CAAC;gBAChD,OAAO,KAAK;cACd;cACA,OAAO,IAAI;YACb,CAAC,CAAC,CAACyL,GAAG,CAAEK,eAAe,IAAK;cAAA,IAAAM,cAAA,EAAAC,cAAA;cAC1B,MAAM;gBAAErK,UAAU;gBAAE+B,QAAQ;gBAAE9B,SAAS;gBAAEiB,EAAE;gBAAE0F;cAAa,CAAC,GAAGkD,eAAe,CAAC3J,IAAI;cAClF,MAAM;gBAAEiD,MAAM,EAAE;kBAAEiD,CAAC;kBAAEE,CAAC;kBAAEwD,KAAK;kBAAEC;gBAAO;cAAE,CAAC,GAAGF,eAAe,CAACrG,QAAQ,CAAC,CAAC,CAAC;cACvE,MAAM6G,SAAS,GAAG;gBAAEhK,UAAU,EAAE,EAAA8J,cAAA,OAAI,CAAChM,MAAM,cAAAgM,cAAA,uBAAXA,cAAA,CAAa7J,KAAK,CAACgJ,mBAAmB,CAACjJ,UAAU,KAAI,CAAC;gBAAEN,UAAU;gBAAE+B,QAAQ;gBAAE9B;cAAU,CAAC;cACzH,MAAMsK,QAAQ,GAAG;gBACflE,CAAC;gBACDE,CAAC;gBACDwD,KAAK;gBACLC,MAAM;gBACNpD,YAAY,EAAEA,YAAY,IAAI;cAChC,CAAC;cACD,CAAAyD,cAAA,OAAI,CAACjM,MAAM,cAAAiM,cAAA,uBAAXA,cAAA,CAAaG,aAAa,CAACD,QAAQ,EAAED,SAAS,EAAEpJ,EAAE,CAAC;cACnD,OAAO;gBACL,GAAGoJ,SAAS;gBACZpJ,EAAE;gBACF+B,SAAS,EAAErF,gBAAgB,CAAC6E,SAAS;gBACrC4G,KAAK,EAAE;kBACL,GAAGkB,QAAQ;kBACXrJ,EAAE;kBACFuJ,OAAO,EAAE,IAAI,CAAE;gBACjB;cACF,CAAC;YACH,CAAC,CAAC,CAAC,CAAC;UACN;QACF;QACA,IAAI,IAAI,CAACzL,UAAU,EAAE;UACnB,IAAI,CAACA,UAAU,CAAC0L,MAAM,CAAC,CAAC;UACxB,IAAI,CAAC1L,UAAU,GAAG,IAAI;QACxB;QACA,IAAI,CAACN,YAAY,GAAG,EAAE;QACtB,IAAI,CAACE,cAAc,GAAG,EAAE;QACxB,IAAI,CAACG,kBAAkB,GAAG,EAAE;QAC5B,CAAAiK,cAAA,OAAI,CAAC5K,MAAM,cAAA4K,cAAA,uBAAXA,cAAA,CAAa2B,YAAY,CAAC,CAAC;MAC7B,CAAC,MAAM,IAAI,IAAI,CAAC9L,aAAa,EAAE;QAC7B;QACA,IAAI,CAACA,aAAa,GAAGC,SAAS;MAChC,CAAC,MAAM,IAAI,IAAI,CAACN,QAAQ,IAAI,IAAI,CAACQ,UAAU,EAAE;QAAA,IAAA4L,cAAA;QAC3C;QACA,KAAAA,cAAA,GAAI,IAAI,CAACxM,MAAM,cAAAwM,cAAA,uBAAXA,cAAA,CAAaC,SAAS,EAAE;UAAA,IAAAC,cAAA,EAAAC,cAAA;UAC1B,MAAMlL,MAAM,GAAG,IAAI,CAACzB,MAAM,CAACyM,SAAS,CAACG,aAAa,CAAC,IAAI,CAAChM,UAAU,CAACoE,MAAM,CAACvD,MAAM,CAAC;UACjF,MAAMgB,IAAI,GAAG,IAAI,CAACzC,MAAM,CAACyM,SAAS,CAACI,UAAU,CAACpL,MAAM,EAAE;YACpDqL,IAAI,EAAE,IAAI;YACV9G,QAAQ,EAAE,IAAI;YACd+G,SAAS,EAAE,IAAI,CAACnM,UAAU,CAACoE,MAAM,CAACC,OAAO,CAAC+H,WAAW,CAAC,IAAI,CAACpM,UAAU,CAACoE,MAAM,CAACG,WAAW,CAAC,GAAG;UAC9F,CAAC,CAAC;UAEF,MAAMpC,cAAgC,GAAG,IAAIkK,GAAG,CAAC,CAAC;UAClD,MAAM/J,kBAAoC,GAAG,IAAI+J,GAAG,CAAC,CAAC;UACtD,IAAIC,aAAiC;UACrC,MAAMC,UAAU,GAAGA,CAACvL,UAAkB,EAAEC,SAAiB,KAAK;YAC5D,IAAI,CAACqL,aAAa,EAAE;cAClBA,aAAa,GAAI,GAAEtL,UAAW,IAAGC,SAAU,EAAC;cAC5C,OAAO,IAAI;YACb;YACA,OAAQ,GAAED,UAAW,IAAGC,SAAU,EAAC,KAAKqL,aAAa;UACvD,CAAC;UACDzK,IAAI,CAAC4F,OAAO,CAAE+E,GAAG,IAAK;YACpB,IAAI,IAAI,CAACxM,UAAU,CAAEyM,QAAQ,CAACD,GAAG,CAACzL,IAAI,CAACqD,MAAM,CAACvD,MAAM,CAAC,EAAE;cACrD,IAAI2L,GAAG,CAACzL,IAAI,CAACI,IAAI,CAACQ,IAAI,KAAKjD,UAAU,CAACmF,QAAQ,EAAE;gBAC9C,IAAI0I,UAAU,CAACC,GAAG,CAACzL,IAAI,CAACI,IAAI,CAACH,UAAU,EAAEwL,GAAG,CAACzL,IAAI,CAACI,IAAI,CAACF,SAAS,CAAC,EAAE;kBACjEkB,cAAc,CAACwC,GAAG,CAAC6H,GAAG,CAACzL,IAAmB,CAAC;gBAC7C;cACF,CAAC,MAAM,IACLyL,GAAG,CAACzL,IAAI,CAACI,IAAI,CAACQ,IAAI,KAAKjD,UAAU,CAAC+E,SAAS,IAC3C+I,GAAG,CAACzL,IAAI,CAACI,IAAI,CAACQ,IAAI,KAAKjD,UAAU,CAACgF,eAAe,IACjD8I,GAAG,CAACzL,IAAI,CAACI,IAAI,CAACQ,IAAI,KAAKjD,UAAU,CAAC8E,cAAc,EAChD;gBACA,IAAI+I,UAAU,CAACC,GAAG,CAACzL,IAAI,CAAC4C,MAAM,CAACxC,IAAI,CAACH,UAAU,EAAEwL,GAAG,CAACzL,IAAI,CAAC4C,MAAM,CAACxC,IAAI,CAACF,SAAS,CAAC,EAAE;kBAC/EqB,kBAAkB,CAACqC,GAAG,CAAC6H,GAAG,CAACzL,IAAI,CAAC4C,MAAqB,CAAC;gBACxD;cACF;YACF;UACF,CAAC,CAAC;;UAEF;UACA,IAAIxB,cAAc,CAACuK,IAAI,EAAE,CAAAZ,cAAA,OAAI,CAAC1M,MAAM,cAAA0M,cAAA,uBAAXA,cAAA,CAAaa,sBAAsB,CAACC,KAAK,CAACC,IAAI,CAAC1K,cAAc,CAAC,EAAExD,iBAAiB,CAACuG,MAAM,CAAC;UAClH,IAAI5C,kBAAkB,CAACoK,IAAI,EAAE,CAAAX,cAAA,OAAI,CAAC3M,MAAM,cAAA2M,cAAA,uBAAXA,cAAA,CAAaY,sBAAsB,CAACC,KAAK,CAACC,IAAI,CAACvK,kBAAkB,CAAC,EAAE3D,iBAAiB,CAAC8E,SAAS,CAAC;QAC/H;QACA,IAAI,CAACzD,UAAU,CAAC0L,MAAM,CAAC,CAAC;QACxB,IAAI,CAAC1L,UAAU,GAAG,IAAI;MACxB,CAAC,MAAM,IAAI,EAAA6J,cAAA,OAAI,CAACzK,MAAM,cAAAyK,cAAA,uBAAXA,cAAA,CAAa1E,WAAW,CAAC,CAAC,KAAI,IAAI,CAAC/F,MAAM,CAAC6F,UAAU,KAAKtG,iBAAiB,CAACuG,MAAM,EAAE;QAC5F;QACA,MAAMtE,KAAK,GAAGvC,KAAK,CAACqC,IAAI,CAACC,aAAa,CAACR,KAAK,CAACS,KAAK,CAAC;QACnD;QACA,IAAI,CAACxB,MAAM,CAAC0N,WAAW,CAAClM,KAAK,CAAC;QAC9B;MACF,CAAC,MAAM,IAAI,IAAI,CAACxB,MAAM,IAAIH,SAAS,CAACmC,MAAM,CAACyD,QAAQ,EAAE;QACnD;QACA,IAAI,CAACzF,MAAM,CAACmC,KAAK,CAACwL,iBAAiB,CAAC,CAAC;MACvC;MACA,IAAI,CAACvN,QAAQ,GAAG,KAAK;IACvB,CAAC;IAAA,KAEDwN,QAAQ,GAAIvL,MAAoB,IAAK;MAAA,IAAAwL,cAAA;MACnC,KAAAA,cAAA,GAAI,IAAI,CAAC7N,MAAM,cAAA6N,cAAA,uBAAXA,cAAA,CAAa1L,KAAK,CAACgJ,mBAAmB,EAAE;QAAA,IAAA2C,cAAA,EAAAC,cAAA;QAC1C,MAAM;UAAEnM,UAAU;UAAEC,SAAS;UAAEK,UAAU;UAAEY;QAAG,CAAC,GAAG,IAAI,CAAC9C,MAAM,CAACmC,KAAK,CAACgJ,mBAAmB;QACvF,IAAIrJ,QAAQ,GAAG,EAAE;QACjB,IAAIgB,EAAE,KAAKpC,SAAS,EAAE;UACpBoB,QAAQ,GAAG,CAACgB,EAAE,CAAC;QACjB,CAAC,MAAM,IAAI,EAAAgL,cAAA,OAAI,CAAC9N,MAAM,cAAA8N,cAAA,uBAAXA,cAAA,CAAa/K,cAAc,CAACC,MAAM,IAAG,CAAC,EAAE;UAAA,IAAAgL,cAAA;UACjDlM,QAAQ,IAAAkM,cAAA,GAAG,IAAI,CAAChO,MAAM,cAAAgO,cAAA,uBAAXA,cAAA,CAAajL,cAAc,CAACsI,GAAG,CAAE7J,KAAK,IAAKA,KAAK,CAACO,IAAI,CAACc,KAAK,CAAC;QACzE,CAAC,MAAM,IAAI,EAAAkL,cAAA,OAAI,CAAC/N,MAAM,cAAA+N,cAAA,uBAAXA,cAAA,CAAa7K,kBAAkB,CAACF,MAAM,IAAG,CAAC,EAAE;UAAA,IAAAiL,cAAA;UACrDnM,QAAQ,IAAAmM,cAAA,GAAG,IAAI,CAACjO,MAAM,cAAAiO,cAAA,uBAAXA,cAAA,CAAa/K,kBAAkB,CAACmI,GAAG,CAAEJ,KAAK,IAAKA,KAAK,CAAClJ,IAAI,CAACe,EAAE,CAAC;QAC1E;QACA,IAAIhB,QAAQ,CAACkB,MAAM,EAAE;UACnBlB,QAAQ,CAAC2H,IAAI,CAAC,CAACC,CAAC,EAAEC,CAAC,KAAKD,CAAC,GAAGC,CAAC,CAAC;UAC9B,IAAItH,MAAM,KAAK5C,YAAY,CAAC6C,MAAM,IAAI,CAACzC,SAAS,CAACmC,MAAM,CAACkM,cAAc,EAAE;YACtErO,SAAS,CAACmC,MAAM,CAACmM,SAAS,CACxB;cAAE9L;YAAO,CAAC,EACV;cACEH,UAAU;cACVN,UAAU;cACVC,SAAS;cACTC,QAAQ;cACRO;YACF,CACF,CAAC;UACH,CAAC,MAAM;YACLxC,SAAS,CAACmC,MAAM,CAACC,iBAAiB,CAAC;cACjCC,UAAU;cACVN,UAAU;cACVC,SAAS;cACTC,QAAQ;cACRO;YACF,CAAC,CAAC;UACJ;UACA,IAAI,CAACA,MAAM,KAAK5C,YAAY,CAAC2O,OAAO,IAAI/L,MAAM,KAAK5C,YAAY,CAAC4O,OAAO,KAAK,CAACxO,SAAS,CAACmC,MAAM,CAACkM,cAAc,EAAE;YAC5G7O,OAAO,CAACiP,OAAO,CAAC1O,aAAa,CAAE,UAASyC,MAAM,CAACkM,iBAAiB,CAAC,CAAE,EAAC,CAAC,CAAC;UACxE;QACF;MACF;IACF,CAAC;IAAA,KAEDC,SAAS,GAAG,CAAC;MAAEzN;IAAgC,CAAC,KAAK;MAAA,IAAA0N,cAAA,EAAAC,cAAA,EAAAC,cAAA,EAAAC,cAAA;MACnD,IAAIjP,OAAO,CAAC,CAAC,EAAE;MACf,MAAMkP,GAAG,GAAG9N,KAAK,CAAC8N,GAAG,CAACC,WAAW,CAAC,CAAC;MACnC,IAAI,EAAAL,cAAA,OAAI,CAACzO,MAAM,cAAAyO,cAAA,uBAAXA,cAAA,CAAatM,KAAK,CAACwF,QAAQ,KAAIkH,GAAG,KAAK,GAAG,EAAE;MAChD;MACA,IAAI9N,KAAK,CAACgO,MAAM,IAAIhO,KAAK,CAACiO,QAAQ,EAAE;QAClC;MACF;MAEA,IAAInP,SAAS,CAACmC,MAAM,CAACyD,QAAQ,EAAE;QAC7B,IAAI,CAACwJ,aAAa,CAAClO,KAAK,EAAE8N,GAAG,CAAC;MAChC,CAAC,MAAM,IAAIhP,SAAS,CAACmC,MAAM,CAACkN,SAAS,EAAE;QACrC,IAAI,CAACC,WAAW,CAACpO,KAAK,EAAE8N,GAAG,CAAC;MAC9B;MAEA,QAAQA,GAAG;QACT,KAAK,GAAG;UACN9N,KAAK,CAACqO,cAAc,CAAC,CAAC;UACtB,IAAIvP,SAAS,CAACmC,MAAM,CAACkN,SAAS,EAAE;YAAA,IAAAG,cAAA;YAC9B,CAAAA,cAAA,OAAI,CAACrP,MAAM,cAAAqP,cAAA,uBAAXA,cAAA,CAAalN,KAAK,CAACmN,oBAAoB,CAAC,CAACzP,SAAS,CAACmC,MAAM,CAACyD,QAAQ,CAAC;UACrE;UACA;QACF,KAAK,GAAG;UACN1E,KAAK,CAACqO,cAAc,CAAC,CAAC;UACtB,IAAIlQ,UAAU,CAACgQ,SAAS,EAAE;YACxBhQ,UAAU,CAACqQ,MAAM,CAAC,CAAC;UACrB;UACA;QACF;QACA;QACA;QACA;QACA;QACA;QACA;QACA,KAAK,GAAG;UACNxO,KAAK,CAACqO,cAAc,CAAC,CAAC;UACtB,CAAAV,cAAA,OAAI,CAAC1O,MAAM,cAAA0O,cAAA,uBAAXA,cAAA,CAAavM,KAAK,CAACqN,MAAM,CAAC,CAAC;UAC3B;QACF,KAAK,GAAG;UACNzO,KAAK,CAACqO,cAAc,CAAC,CAAC;UACtB,IAAIrO,KAAK,CAACK,OAAO,EAAE,CAAAuN,cAAA,OAAI,CAAC3O,MAAM,cAAA2O,cAAA,uBAAXA,cAAA,CAAaxM,KAAK,CAACsN,UAAU,CAAC,CAAC;UAClD;QACF,KAAK,GAAG;UACN1O,KAAK,CAACqO,cAAc,CAAC,CAAC;UACtB,IAAIrO,KAAK,CAACK,OAAO,EAAE,CAAAwN,cAAA,OAAI,CAAC5O,MAAM,cAAA4O,cAAA,uBAAXA,cAAA,CAAazM,KAAK,CAACuN,UAAU,CAAC,CAAC;UAClD;QACF,KAAK,GAAG;UACN,IAAI,CAAC7P,SAAS,CAACmC,MAAM,CAACkM,cAAc,EAAE;YACpCnN,KAAK,CAACqO,cAAc,CAAC,CAAC;YACtB,IAAIrO,KAAK,CAACK,OAAO,EAAE;cAAA,IAAAuO,cAAA;cACjB,CAAAA,cAAA,OAAI,CAAC3P,MAAM,cAAA2P,cAAA,uBAAXA,cAAA,CAAaxN,KAAK,CAACgM,SAAS,CAAC,CAAC;YAChC;UACF;UACA;QACF;MACF;IACF,CAAC;IAAA,KAEDgB,WAAW,GAAG,CAACpO,KAAoB,EAAE8N,GAAW,KAAK;MAAA,IAAAe,cAAA;MACnD,KAAAA,cAAA,GAAI,IAAI,CAAC5P,MAAM,cAAA4P,cAAA,uBAAXA,cAAA,CAAazN,KAAK,CAACyF,QAAQ,EAAE;MACjC,QAAQiH,GAAG;QACT,KAAK,GAAG;UACN9N,KAAK,CAACqO,cAAc,CAAC,CAAC;UACtB,IAAI,CAACxB,QAAQ,CAACnO,YAAY,CAAC6C,MAAM,CAAC;UAClC;QACF,KAAK,GAAG;UACNvB,KAAK,CAACqO,cAAc,CAAC,CAAC;UACtB,IAAI,CAACxB,QAAQ,CAACnO,YAAY,CAAC4O,OAAO,CAAC;UACnC;QACF,KAAK,GAAG;UACNtN,KAAK,CAACqO,cAAc,CAAC,CAAC;UACtB,IAAI,CAACxB,QAAQ,CAACnO,YAAY,CAAC2O,OAAO,CAAC;UACnC;QACF;MACF;IACF,CAAC;IAAA,KAEDa,aAAa,GAAG,CAAClO,KAAoB,EAAE8N,GAAW,KAAK;MAAA,IAAAgB,cAAA,EAAAC,cAAA,EAAAC,cAAA,EAAAC,cAAA,EAAAC,cAAA;MACrD,KAAAJ,cAAA,GAAI,IAAI,CAAC7P,MAAM,cAAA6P,cAAA,uBAAXA,cAAA,CAAa1N,KAAK,CAACyF,QAAQ,EAAE;MACjC,QAAQiH,GAAG;QACT,KAAK,QAAQ;QACb,KAAK,WAAW;UACd9N,KAAK,CAACqO,cAAc,CAAC,CAAC;UACtB,CAAAU,cAAA,OAAI,CAAC9P,MAAM,cAAA8P,cAAA,uBAAXA,cAAA,CAAaI,oBAAoB,CAAC,CAAC;UACnC,CAAAH,cAAA,OAAI,CAAC/P,MAAM,cAAA+P,cAAA,uBAAXA,cAAA,CAAajE,uBAAuB,CAAC,CAAC;UACtC;QACF;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA,KAAK,GAAG;UACN/K,KAAK,CAACqO,cAAc,CAAC,CAAC;UACtB,CAAAY,cAAA,OAAI,CAAChQ,MAAM,cAAAgQ,cAAA,uBAAXA,cAAA,CAAa7N,KAAK,CAACgO,aAAa,CAAC,CAAC;UAClC;QACF,KAAK,GAAG;UACNpP,KAAK,CAACqO,cAAc,CAAC,CAAC;UACtB,CAAAa,cAAA,OAAI,CAACjQ,MAAM,cAAAiQ,cAAA,uBAAXA,cAAA,CAAa9N,KAAK,CAACiO,aAAa,CAAC,CAAC;UAClC;QACF;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;MACF;IACF,CAAC;IAtmBC,IAAI,CAACpQ,MAAM,GAAGA,MAAM;EACtB;AAsmBF;AAAC","ignoreList":[]},"metadata":{},"sourceType":"module"}