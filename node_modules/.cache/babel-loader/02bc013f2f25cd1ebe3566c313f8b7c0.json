{"ast":null,"code":"var _jsxFileName = \"/Users/qzheng/Documents/webroot/annotation_tools/src/components/common/llm/chat/AttributesItem.tsx\";\nimport React, { useContext, useMemo } from 'react';\nimport EasyForm from '@appen-china/easy-form';\nimport { parseFields } from 'src/utils/form';\nimport { Button } from 'antd';\nimport { DeleteOutlined, FormOutlined } from '@ant-design/icons';\nimport AttributeValueItem from '../attributes-config/AttributeValueItem';\nimport LocaleContext from '../locales/context';\nimport translate from '../locales';\nconst AttributesItemConfig = ({\n  config,\n  attributes,\n  attributesEditing,\n  attributesEditable,\n  onEdit,\n  onDelete,\n  onChange\n}) => {\n  const locale = useContext(LocaleContext);\n  const fieldsMap = useMemo(() => parseFields(config), [config]);\n  // fields with initial value\n  const fieldsWithInitialValue = useMemo(() => ((config === null || config === void 0 ? void 0 : config.fields) || []).map(field => ({\n    ...field,\n    ...(attributes && attributes[field.name] !== undefined && {\n      defaultValue: attributes[field.name]\n    })\n  })), [config, attributes]);\n  const handleValuesChange = (changedValues, values) => {\n    if (!values || values.length === 0) {\n      // empty form\n      onChange(undefined);\n    } else {\n      onChange(values);\n    }\n  };\n  const renderAttributes = () => {\n    if (!config) {\n      return null;\n    }\n    if (!attributes) {\n      return /*#__PURE__*/React.createElement(\"div\", {\n        className: \"values-empty\",\n        onClick: e => {\n          if (onEdit) {\n            e.stopPropagation();\n            onEdit();\n          }\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 47,\n          columnNumber: 9\n        }\n      }, translate(locale, 'CHAT_ATTR_EMPTY'));\n    }\n    const fieldKeys = Object.keys(fieldsMap);\n    const attrKeys = attributes ? Object.keys(attributes) : [];\n    const legacyKeys = attrKeys.filter(key => !fieldKeys.includes(key));\n    return /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"value-content\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 66,\n        columnNumber: 9\n      }\n    }, [...fieldKeys, ...legacyKeys].map(key => attrKeys.includes(key) && /*#__PURE__*/React.createElement(AttributeValueItem, {\n      compact: true,\n      key: key,\n      fieldName: key,\n      fieldsMap: fieldsMap,\n      values: attributes,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 69,\n        columnNumber: 15\n      }\n    }))), attributesEditable && /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(Button, {\n      size: \"small\",\n      type: \"link\",\n      icon: /*#__PURE__*/React.createElement(FormOutlined, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 84,\n          columnNumber: 21\n        }\n      }),\n      onClick: e => {\n        if (onEdit) {\n          e.stopPropagation();\n          onEdit();\n        }\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 81,\n        columnNumber: 13\n      }\n    }), /*#__PURE__*/React.createElement(Button, {\n      size: \"small\",\n      type: \"link\",\n      className: \"delete_btn\",\n      icon: /*#__PURE__*/React.createElement(DeleteOutlined, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 96,\n          columnNumber: 21\n        }\n      }),\n      onClick: e => {\n        if (onDelete) {\n          e.stopPropagation();\n          onDelete();\n        }\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 92,\n        columnNumber: 13\n      }\n    })));\n  };\n  return /*#__PURE__*/React.createElement(\"div\", {\n    className: \"llm-chat-item-content-attributes\",\n    onClick: e => {\n      if (attributesEditing) {\n        e.stopPropagation();\n      }\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 111,\n      columnNumber: 5\n    }\n  }, attributesEditing ? /*#__PURE__*/React.createElement(EasyForm, {\n    fields: fieldsWithInitialValue,\n    conditions: config === null || config === void 0 ? void 0 : config.conditions,\n    effects: config === null || config === void 0 ? void 0 : config.effects,\n    rules: config === null || config === void 0 ? void 0 : config.rules,\n    onChange: handleValuesChange,\n    onSubmit: () => {},\n    footerVisible: false,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 113,\n      columnNumber: 9\n    }\n  }) : renderAttributes());\n};\nexport default AttributesItemConfig;","map":{"version":3,"names":["React","useContext","useMemo","EasyForm","parseFields","Button","DeleteOutlined","FormOutlined","AttributeValueItem","LocaleContext","translate","AttributesItemConfig","config","attributes","attributesEditing","attributesEditable","onEdit","onDelete","onChange","locale","fieldsMap","fieldsWithInitialValue","fields","map","field","name","undefined","defaultValue","handleValuesChange","changedValues","values","length","renderAttributes","createElement","className","onClick","e","stopPropagation","__self","__source","fileName","_jsxFileName","lineNumber","columnNumber","fieldKeys","Object","keys","attrKeys","legacyKeys","filter","key","includes","Fragment","compact","fieldName","size","type","icon","conditions","effects","rules","onSubmit","footerVisible"],"sources":["/Users/qzheng/Documents/webroot/annotation_tools/src/components/common/llm/chat/AttributesItem.tsx"],"sourcesContent":["import React, { useContext, useMemo } from 'react';\nimport EasyForm from '@appen-china/easy-form';\nimport { FormConfig } from '@appen-china/easy-form/es/types';\nimport { parseFields } from 'src/utils/form';\nimport { Button } from 'antd';\nimport { DeleteOutlined, FormOutlined } from '@ant-design/icons';\nimport AttributeValueItem from '../attributes-config/AttributeValueItem';\nimport LocaleContext from '../locales/context';\nimport translate from '../locales';\n\ninterface AttributesItemConfigProps {\n  config: FormConfig;\n  attributesEditing?: boolean;\n  attributes?: {[key: string]: any};\n  attributesEditable: boolean;\n  onChange: (val: any) => void;\n  onEdit?: () => void;\n  onDelete?: () => void;\n}\n\nconst AttributesItemConfig: React.FC<AttributesItemConfigProps> = ({ config, attributes, attributesEditing, attributesEditable, onEdit, onDelete, onChange }) => {\n  const locale = useContext(LocaleContext);\n  const fieldsMap = useMemo(() => parseFields(config), [config]);\n  // fields with initial value\n  const fieldsWithInitialValue = useMemo(() => (config?.fields || []).map((field) => ({\n    ...field,\n    ...attributes && attributes[field.name] !== undefined && {\n      defaultValue: attributes[field.name],\n    }\n  })), [config, attributes]);\n\n  const handleValuesChange = (changedValues:any, values: any) => {\n    if (!values || values.length === 0) {\n      // empty form\n      onChange(undefined);\n    } else {\n      onChange(values);\n    }\n  };\n\n  const renderAttributes = () => {\n    if (!config) {\n      return null;\n    }\n    if (!attributes) {\n      return (\n        <div\n          className=\"values-empty\"\n          onClick={(e) => {\n            if (onEdit) {\n              e.stopPropagation();\n              onEdit();\n            }\n          }}\n        >\n          {translate(locale, 'CHAT_ATTR_EMPTY')}\n        </div>\n      );\n    }\n    const fieldKeys = Object.keys(fieldsMap);\n    const attrKeys = attributes ? Object.keys(attributes) : [];\n    const legacyKeys = attrKeys.filter((key) => !fieldKeys.includes(key));\n\n    return (\n      <>\n        <div className=\"value-content\">\n          {\n            [...fieldKeys, ...legacyKeys].map((key) => attrKeys.includes(key) && (\n              <AttributeValueItem\n                compact\n                key={key}\n                fieldName={key}\n                fieldsMap={fieldsMap}\n                values={attributes}\n              />\n            ))\n          }\n        </div>\n        {attributesEditable && (\n          <>\n            <Button\n              size=\"small\"\n              type=\"link\"\n              icon={<FormOutlined />}\n              onClick={(e) => {\n                if (onEdit) {\n                  e.stopPropagation();\n                  onEdit();\n                }\n              }}\n            />\n            <Button\n              size=\"small\"\n              type=\"link\"\n              className=\"delete_btn\"\n              icon={<DeleteOutlined />}\n              onClick={(e) => {\n                if (onDelete) {\n                  e.stopPropagation();\n                  onDelete();\n                }\n              }}\n            />\n          </>\n        )}\n      </>\n    );\n  };\n\n  return (\n    <div className=\"llm-chat-item-content-attributes\" onClick={(e) => { if (attributesEditing) { e.stopPropagation(); } }}>\n      {attributesEditing ? (\n        <EasyForm\n          fields={fieldsWithInitialValue}\n          conditions={config?.conditions}\n          effects={config?.effects}\n          rules={config?.rules}\n          onChange={handleValuesChange}\n          onSubmit={() => {}}\n          footerVisible={false}\n        />\n      ) : renderAttributes()}\n    </div>\n  );\n};\nexport default AttributesItemConfig;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}