{"ast":null,"code":"export function cleanExpiredStorage(namespace){let expire=arguments.length>1&&arguments[1]!==undefined?arguments[1]:7*24*60*60*1000;const current=Date.now();const last=current-expire;const data=localStorage.getItem(namespace);if(data){// if namespace exists\nlet store;try{store=JSON.parse(data);}catch(e){store={};}Object.keys(store).forEach(key=>{// check lastUpdate\nconst{lastUpdate}=store[key];if(lastUpdate<last){delete store[key];}});try{// set new store\nlocalStorage.setItem(namespace,JSON.stringify(store));}catch(e){// eslint-disable-next-line no-console\nconsole.log('clean expired storage error: ',e);}}}export function setStorage(namespace,key,value){const current=Date.now();let store;try{store=JSON.parse(localStorage.getItem(namespace)||'{}');}catch(e){store={};}store[key]={value,lastUpdate:current// set last update time\n};try{localStorage.setItem(namespace,JSON.stringify(store));}catch(e){if(e.name==='QUOTA_EXCEEDED_ERR'||e.name==='NS_ERROR_DOM_QUOTA_REACHED'){// clean expired storage and try again\ncleanExpiredStorage(namespace);try{localStorage.setItem(namespace,JSON.stringify(store));}catch(error){// eslint-disable-next-line no-console\nconsole.log('set storage error: ',error);}}else{// eslint-disable-next-line no-console\nconsole.log('set storage error: ',e);}}}export function getStorage(namespace,key){try{var _store$key;const store=JSON.parse(localStorage.getItem(namespace)||'{}');return(_store$key=store[key])===null||_store$key===void 0?void 0:_store$key.value;}catch(e){return undefined;}}export function removeStorage(namespace,key){let store;try{store=JSON.parse(localStorage.getItem(namespace)||'{}');}catch(e){store={};}delete store[key];try{localStorage.setItem(namespace,JSON.stringify(store));}catch(e){// eslint-disable-next-line no-console\nconsole.log('remove storage error: ',e);}}export function clear(namespace){localStorage.removeItem(namespace);}export function isEnabled(){var _window;return!!((_window=window)===null||_window===void 0?void 0:_window.localStorage);}","map":{"version":3,"names":["cleanExpiredStorage","namespace","expire","arguments","length","undefined","current","Date","now","last","data","localStorage","getItem","store","JSON","parse","e","Object","keys","forEach","key","lastUpdate","setItem","stringify","console","log","setStorage","value","name","error","getStorage","_store$key","removeStorage","clear","removeItem","isEnabled","_window","window"],"sources":["/Users/qzheng/Documents/webroot/annotation_tools/src/utils/storage.ts"],"sourcesContent":["export function cleanExpiredStorage(namespace: string, expire = 7 * 24 * 60 * 60 * 1000) {\n  const current = Date.now();\n  const last = current - expire;\n\n  const data = localStorage.getItem(namespace);\n  if (data) {\n    // if namespace exists\n    let store: any;\n    try {\n      store = JSON.parse(data);\n    } catch (e) {\n      store = {};\n    }\n\n    Object.keys(store).forEach((key) => {\n      // check lastUpdate\n      const { lastUpdate } = store[key];\n      if (lastUpdate < last) {\n        delete store[key];\n      }\n    });\n\n    try {\n      // set new store\n      localStorage.setItem(namespace, JSON.stringify(store));\n    } catch (e) {\n      // eslint-disable-next-line no-console\n      console.log('clean expired storage error: ', e);\n    }\n  }\n}\n\nexport function setStorage(namespace: string, key: string, value: any) {\n  const current = Date.now();\n\n  let store;\n  try {\n    store = JSON.parse(localStorage.getItem(namespace) || '{}');\n  } catch (e) {\n    store = {};\n  }\n\n  store[key] = {\n    value,\n    lastUpdate: current, // set last update time\n  };\n\n  try {\n    localStorage.setItem(namespace, JSON.stringify(store));\n  } catch (e: any) {\n    if (e.name === 'QUOTA_EXCEEDED_ERR' || e.name === 'NS_ERROR_DOM_QUOTA_REACHED') {\n      // clean expired storage and try again\n      cleanExpiredStorage(namespace);\n      try {\n        localStorage.setItem(namespace, JSON.stringify(store));\n      } catch (error) {\n        // eslint-disable-next-line no-console\n        console.log('set storage error: ', error);\n      }\n    } else {\n      // eslint-disable-next-line no-console\n      console.log('set storage error: ', e);\n    }\n  }\n}\n\nexport function getStorage(namespace: string, key: string) {\n  try {\n    const store = JSON.parse(localStorage.getItem(namespace) || '{}');\n    return store[key]?.value;\n  } catch (e) {\n    return undefined;\n  }\n}\n\nexport function removeStorage(namespace: string, key: string) {\n  let store;\n  try {\n    store = JSON.parse(localStorage.getItem(namespace) || '{}');\n  } catch (e) {\n    store = {};\n  }\n\n  delete store[key];\n\n  try {\n    localStorage.setItem(namespace, JSON.stringify(store));\n  } catch (e) {\n    // eslint-disable-next-line no-console\n    console.log('remove storage error: ', e);\n  }\n}\n\nexport function clear(namespace: string) {\n  localStorage.removeItem(namespace);\n}\n\nexport function isEnabled() {\n  return !!window?.localStorage;\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}