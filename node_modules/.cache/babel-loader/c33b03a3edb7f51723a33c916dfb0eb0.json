{"ast":null,"code":"import _applyDecoratedDescriptor from \"/Users/qzheng/Documents/webroot/annotation_tools/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/applyDecoratedDescriptor\";\nvar _class,\n  _jsxFileName = \"/Users/qzheng/Documents/webroot/annotation_tools/src/components/phonetic-transcription/index.tsx\";\nimport React from 'react';\nimport { makeObservable, observable, action, toJS, computed } from 'mobx';\nimport { observer } from 'mobx-react';\nimport { notification } from 'antd';\nimport cx from 'classnames';\nimport ResizeObserver from 'resize-observer-polyfill';\nimport LayoutWrapper from '../common/layout/LayoutWrapper';\nimport AppWrapper from '../common/shapes/wrapper/AppWrapper';\nimport AutoSaver from '../common/AutoSaver';\nimport Toolbar from './components/Toolbar';\nimport Atlas from './components/Atlas';\nimport Ruler from './components/Helper/Ruler';\nimport Region from './components/Helper/Region';\nimport TabMenu from '../common/tabs-menu/TabMenu';\nimport Sidebar from './components/Sidebar';\nimport Validator from './components/Validator';\nimport Assist from './components/Helper/Assist';\nimport Tier from './components/TierPannel';\nimport TimeControl from './components/Helper/TimeControl';\nimport ScalerControl from './components/Helper/ScalerControl';\nimport AttributesPannel from './components/Helper/AttributesPannel';\nimport ReviewPanel from './components/Helper/ReviewPanel';\nimport bindKeyboardEvents from './keyboard-events';\nimport i18n from './locales';\nimport { UpdateType, ReviewResult, ValidationType } from './types';\nimport store from './store/RootStore';\nimport { validate } from './utils';\nimport { methods } from './payload';\nimport './index.scss';\nexport let SpeechAnalysis = (_class = class SpeechAnalysis extends React.Component {\n  // eslint-disable-next-line class-methods-use-this\n  get ratioPlacement() {\n    const {\n      placement\n    } = store.analyse;\n    const {\n      ratio\n    } = store.setting;\n    const newPlacement = {};\n    const keys = Object.keys(placement);\n    for (let i = 0; i < keys.length; i += 1) {\n      const key = keys[i];\n      if (key === 'duration') {\n        newPlacement[key] = placement[key];\n      } else {\n        newPlacement[key] = placement[key] * ratio;\n      }\n    }\n    return newPlacement;\n  }\n  constructor(props) {\n    super(props);\n    /**\n     * auto saver reference\n     */\n    this.saverRef = React.createRef();\n    /**\n     * attributes reference\n     */\n    this.attrRef = React.createRef();\n    /**\n     * analyse container reference\n     */\n    this.analyseContainer = React.createRef();\n    /**\n     * mouse position\n     */\n    this.mousePosition = {\n      x: 0,\n      y: 0\n    };\n    this.resizeObserve = null;\n    /**\n     * keyboard events\n     */\n    this.removeKeyboardEvents = () => {};\n    this.handleMouseWheel = e => {\n      const {\n        timelineHeight,\n        atlasHeight,\n        tierHeight,\n        margin,\n        atlasWidth\n      } = store.analyse.placement;\n      const {\n        y,\n        x\n      } = this.mousePosition;\n\n      // mouse on altas & tier\n      if (y > timelineHeight && y < timelineHeight + atlasHeight + tierHeight && x > margin && x < margin + atlasWidth) {\n        e.preventDefault();\n        let {\n          zoom\n        } = store.setting;\n        const {\n          precent\n        } = store.analyse.displayBuffer;\n        if (precent >= 1 && e.deltaY > 0) {\n          // scrollwidth === clientwidth\n          return;\n        }\n        let delta = 1;\n        zoom = Math.ceil(zoom);\n        if (zoom > 200) {\n          delta = 30;\n        } else if (zoom > 150) {\n          delta = 20;\n        } else if (zoom > 80) {\n          delta = 8;\n        } else if (zoom > 50) {\n          delta = 5;\n        } else if (zoom > 20) {\n          delta = 2;\n        }\n        if (e.deltaY < 0) {\n          zoom += delta;\n        } else if (e.deltaY > 0) {\n          zoom -= delta;\n        }\n        store.setting.setZoom(zoom);\n      }\n    };\n    /**\n     * trigger validation, return passed or not\n     */\n    this.triggerValidation = async () => {\n      const {\n        results,\n        hasCustomError\n      } = await this.getScriptResult();\n      const {\n        emptys,\n        hasEmptyError\n      } = this.emptyValidation();\n      const hasError = hasCustomError || hasEmptyError;\n      const errors = [...emptys, ...results];\n      store.review.setScriptResult({\n        results: errors,\n        hasCustomError\n      });\n      return !hasError && errors.length <= 0;\n    };\n    this.emptyValidation = () => {\n      const newInstances = Object.values(toJS(store.instance.instances));\n      const result = {\n        emptys: [],\n        hasEmptyError: false\n      };\n      if (store.checkMissingCharacter) {\n        for (let i = 0; i < newInstances.length; i += 1) {\n          const {\n            id,\n            category,\n            start,\n            text\n          } = newInstances[i];\n          if (!text) {\n            result.hasEmptyError = true;\n            const categoryInstances = store.instance.categoryInstancesMap[category];\n            const index = categoryInstances.findIndex(instance => instance.start === start);\n            result.emptys.push({\n              warningType: ValidationType.ATTR_EMPTY,\n              id,\n              message: i18n.translate('ERROR_INCOMPLETE', {\n                values: {\n                  category,\n                  index: index + 1\n                }\n              }),\n              frames: []\n            });\n          }\n        }\n        ;\n      }\n      return result;\n    };\n    this.onSave = async (submit = true) => {\n      var _this$saverRef$curren;\n      if (store.setting.loading || !store.jobProxy) {\n        const loadError = i18n.translate('ERROR_DATA_LOAD');\n        notification.error({\n          message: loadError\n        });\n        throw new Error(loadError);\n      }\n      (_this$saverRef$curren = this.saverRef.current) === null || _this$saverRef$curren === void 0 ? void 0 : _this$saverRef$curren.disableLeaveCheck();\n      if (submit) {\n        if (store.setting.submitCheck) {\n          // validate before submit\n          const passed = await this.triggerValidation();\n          if (!passed) {\n            throw new Error(i18n.translate('SUBMIT_CHECK_FAIL'));\n          }\n        }\n      }\n      return store.saveResult(submit);\n    };\n    this.saveReviews = (type = 'submit') => {\n      var _this$saverRef$curren2;\n      if (type === 'submit') {\n        const hasSuspend = store.review.reviewsResult.find(review => review.result === ReviewResult.SUSPEND);\n        if (hasSuspend) {\n          throw new Error(i18n.translate('QC_SUSPEND_ERROR'));\n        }\n      }\n      (_this$saverRef$curren2 = this.saverRef.current) === null || _this$saverRef$curren2 === void 0 ? void 0 : _this$saverRef$curren2.disableLeaveCheck();\n      return store.saveReviews();\n    };\n    /**\n     * get review statistics\n     */\n    this.getStatistics = () => {\n      const statShapes = {};\n      const objects = {\n        total: 0,\n        approved: 0,\n        rejected: 0,\n        suspended: 0,\n        missed: 0\n      };\n      const reviews = store.review.reviewsResult.filter(r => r.result !== ReviewResult.APPROVE);\n      const instancesList = Object.values(store.instance.instances).filter(v => !!v);\n      for (let i = 0; i < instancesList.length; i += 1) {\n        const {\n          id,\n          category\n        } = instancesList[i];\n        if (!statShapes[category]) {\n          statShapes[category] = {\n            rejected: 0,\n            approved: 0,\n            suspended: 0,\n            missed: 0,\n            total: 0\n          };\n        }\n        statShapes[category].total += 1;\n        objects.total += 1;\n        const review = reviews.find(r => r.instanceId === id);\n        if ((review === null || review === void 0 ? void 0 : review.result) === ReviewResult.REJECT) {\n          statShapes[category].rejected += 1;\n          objects.rejected += 1;\n        } else if ((review === null || review === void 0 ? void 0 : review.result) === ReviewResult.SUSPEND) {\n          statShapes[category].suspended += 1;\n          objects.suspended += 1;\n        } else {\n          statShapes[category].approved += 1;\n          objects.approved += 1;\n        }\n      }\n      return {\n        objects,\n        shapes: statShapes\n      };\n    };\n    this.handleSave = async () => {\n      if (store.isPreview) {\n        return;\n      }\n      try {\n        await this.onSave(false);\n        if (store.review.isEnabled) {\n          await this.saveReviews('save');\n        }\n        notification.success({\n          message: i18n.translate('SAVE_SUCCESS')\n        });\n      } catch (e) {\n        notification.error({\n          message: i18n.translate('SAVE_FAIL')\n        });\n      }\n    };\n    this.handleUndo = () => {\n      if (!store.undo.undoDisabled) {\n        const item = store.undo.undo();\n        if (item && item.before) {\n          this.updateStatus(item.before, item.after);\n          notification.success({\n            message: 'Undo successfully.'\n          });\n        }\n      }\n    };\n    this.handleRedo = () => {\n      if (!store.undo.redoDisabled) {\n        const item = store.undo.redo();\n        if (item && item.after) {\n          this.updateStatus(item.after, item.before);\n          notification.success({\n            message: 'Redo successfully.'\n          });\n        }\n      }\n    };\n    this.updateStatus = (curr, prev) => {\n      curr.forEach(step => {\n        if (step.type === 'instance') {\n          store.instance.setUpdatedInstances(step.status, UpdateType.UNDOREDO);\n        } else if (step.type === 'review') {\n          store.review.updateReviews(step.status);\n        }\n      });\n    };\n    this.addInstance = index => {\n      var _store$ontology$categ;\n      const selectedCategoryName = index !== undefined ? (_store$ontology$categ = store.ontology.categories[index - 1]) === null || _store$ontology$categ === void 0 ? void 0 : _store$ontology$categ.className : store.ontology.selectedCategoryName;\n      const {\n        selectedTime,\n        selectedRegion\n      } = store.analyse;\n      if (selectedCategoryName) {\n        if (selectedTime) {\n          store.instance.addInstance(selectedCategoryName, selectedTime);\n        } else if (selectedRegion) {\n          const canAddTier = store.ontology.canAddTiers[selectedCategoryName];\n          if (canAddTier) {\n            const {\n              start,\n              end\n            } = selectedRegion;\n            const time = [];\n            if (canAddTier.first) {\n              time.push(start);\n            }\n            if (canAddTier.second) {\n              time.push(end);\n            }\n            if (time.length) store.instance.addInstance(selectedCategoryName, time);\n          }\n        }\n      }\n    };\n    this.updateMousePostion = e => {\n      if (this.analyseContainer.current) {\n        const {\n          scrollTop\n        } = this.analyseContainer.current;\n        const bound = this.analyseContainer.current.getBoundingClientRect();\n        this.mousePosition = {\n          x: e.pageX - bound.x,\n          y: e.pageY - bound.y + scrollTop\n        };\n      }\n    };\n    this.updateAnalyseWindowSize = () => {\n      const {\n        clientWidth,\n        clientHeight\n      } = this.analyseContainer.current;\n      const {\n        margin\n      } = store.analyse.placement;\n      /**\n       * others height 214\n       */\n      const useableHeight = clientHeight - 214;\n      let atlasHeight = useableHeight * 4 / 7;\n      let tierHeight = useableHeight * 3 / 7;\n      atlasHeight = atlasHeight < 320 ? 320 : Math.floor(atlasHeight / 2) * 2;\n      atlasHeight = atlasHeight > 440 ? 440 : atlasHeight;\n      tierHeight = tierHeight < 240 ? 240 : tierHeight;\n      store.analyse.updatePlacement({\n        atlasWidth: clientWidth - 2 * margin - 1,\n        analyserHeight: clientHeight,\n        tierHeight,\n        atlasHeight\n      });\n    };\n    this.getScriptResult = async () => {\n      let resultLink = '';\n      if (store.setting.customCheck) {\n        if (typeof store.jobProxy.reviewFrom === 'string') {\n          resultLink = store.jobProxy.reviewFrom;\n        }\n        if (!store.readonly) {\n          try {\n            resultLink = await this.onSave(false);\n          } catch (e) {\n            resultLink = '';\n          }\n        }\n      }\n      const [result] = await Promise.all([validate(store.setting.customCheck, {\n        resultLink\n      }), new Promise(resolve => {\n        setTimeout(resolve, 300);\n      })]);\n      return result || {\n        results: [],\n        hasCustomError: false\n      };\n    };\n    this.handleScreenFull = () => {\n      if (store.setting.screenfull.isEnabled) {\n        store.setting.screenfull.toggle();\n      }\n    };\n    this.reload = () => {\n      window.location.reload();\n    };\n    this.handleEnter = () => {\n      var _this$attrRef$current;\n      (_this$attrRef$current = this.attrRef.current) === null || _this$attrRef$current === void 0 ? void 0 : _this$attrRef$current.handleFocus();\n    };\n    makeObservable(this, {\n      mousePosition: observable,\n      updateMousePostion: action\n    });\n    // set props\n    store.jobProxy = this.props.jobProxy;\n    i18n.setLocale(props.locale);\n  }\n  async componentDidMount() {\n    this.removeKeyboardEvents = bindKeyboardEvents(this);\n    // init store\n    try {\n      await store.init(this.props);\n    } catch (e) {\n      notification.error({\n        message: i18n.translate('ANNOTATION_DATA_LOAD_ERROR')\n      });\n      return;\n    }\n    // render completed\n    this.props.renderComplete();\n    this.updateAnalyseWindowSize();\n    if (this.analyseContainer.current) {\n      this.analyseContainer.current.addEventListener('mousemove', this.updateMousePostion);\n      this.analyseContainer.current.addEventListener('wheel', this.handleMouseWheel);\n      if (this.analyseContainer.current) {\n        this.resizeObserve = new ResizeObserver(() => {\n          this.updateAnalyseWindowSize();\n        });\n        this.resizeObserve.observe(this.analyseContainer.current);\n      }\n    }\n  }\n  componentWillUnmount() {\n    if (this.analyseContainer.current) {\n      this.analyseContainer.current.removeEventListener('mousemove', this.updateMousePostion);\n      this.analyseContainer.current.removeEventListener('wheel', this.handleMouseWheel);\n    }\n    if (this.resizeObserve) {\n      this.resizeObserve.disconnect();\n      this.resizeObserve = null;\n    }\n  }\n  render() {\n    return /*#__PURE__*/React.createElement(LayoutWrapper, {\n      className: \"phonetic-transcription-app\",\n      loading: store.setting.loading,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 429,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(AutoSaver, {\n      ref: this.saverRef,\n      leaveCheck: true,\n      data: {\n        storePointer: store.undo.pointer\n      },\n      save: this.handleSave,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 430,\n        columnNumber: 9\n      }\n    }), /*#__PURE__*/React.createElement(Toolbar, {\n      readonly: store.setting.loading,\n      onSave: this.handleSave,\n      handleUndo: this.handleUndo,\n      handleRedo: this.handleRedo,\n      handleScreenFull: this.handleScreenFull,\n      reload: this.reload,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 436,\n        columnNumber: 9\n      }\n    }), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"container\",\n      onContextMenu: e => e.preventDefault(),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 444,\n        columnNumber: 9\n      }\n    }, store.setting.sideBarVisible && /*#__PURE__*/React.createElement(TabMenu, {\n      tabs: [{\n        title: i18n.translate('MENU_REFERENCE'),\n        key: 'reference',\n        count: 0,\n        content: /*#__PURE__*/React.createElement(Sidebar, {\n          loading: store.setting.loading,\n          reference: this.props.reference,\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 453,\n            columnNumber: 21\n          }\n        })\n      }, {\n        title: i18n.translate('MENU_WARNING'),\n        key: 'validator',\n        count: store.review.warnings.length,\n        content: /*#__PURE__*/React.createElement(Validator, {\n          instances: {},\n          triggerValidation: this.triggerValidation,\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 464,\n            columnNumber: 21\n          }\n        })\n      }],\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 446,\n        columnNumber: 13\n      }\n    }), /*#__PURE__*/React.createElement(\"div\", {\n      className: cx('analyse-container', {\n        unfold: !store.setting.sideBarVisible\n      }),\n      ref: this.analyseContainer,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 473,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"analyse-annotation\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 474,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(Atlas, {\n      selectedRegion: store.analyse.selectedRegion,\n      seekto: store.analyse.seekto,\n      display: store.analyse.displayBuffer,\n      mousePosition: this.mousePosition,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 475,\n        columnNumber: 15\n      }\n    }), /*#__PURE__*/React.createElement(Tier, {\n      app: this.props.app,\n      interactive: !store.setting.loading,\n      selectedInstance: store.instance.selectedInstance,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 481,\n        columnNumber: 15\n      }\n    }), /*#__PURE__*/React.createElement(TimeControl, {\n      mousePosition: this.mousePosition,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 486,\n        columnNumber: 15\n      }\n    })), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"control-pannel\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 488,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(ScalerControl, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 489,\n        columnNumber: 15\n      }\n    }), store.instance.selectedInstance && /*#__PURE__*/React.createElement(React.Fragment, null, store.review.drawMode && /*#__PURE__*/React.createElement(AttributesPannel, {\n      ref: this.attrRef,\n      instance: store.instance.selectedInstance,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 495,\n        columnNumber: 25\n      }\n    }), store.review.isEnabled && !store.review.drawMode && /*#__PURE__*/React.createElement(ReviewPanel, {\n      instance: store.instance.selectedInstance,\n      review: store.review.currentReview,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 500,\n        columnNumber: 23\n      }\n    }))), /*#__PURE__*/React.createElement(Ruler, {\n      ratioPlacement: this.ratioPlacement,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 510,\n        columnNumber: 13\n      }\n    }), /*#__PURE__*/React.createElement(Region, {\n      ratioPlacement: this.ratioPlacement,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 511,\n        columnNumber: 13\n      }\n    }), /*#__PURE__*/React.createElement(Assist, {\n      mousePosition: this.mousePosition,\n      ratioPlacement: this.ratioPlacement,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 512,\n        columnNumber: 13\n      }\n    }))));\n  }\n}, _applyDecoratedDescriptor(_class.prototype, \"ratioPlacement\", [computed], Object.getOwnPropertyDescriptor(_class.prototype, \"ratioPlacement\"), _class.prototype), _class);\n;\nexport default AppWrapper(observer(SpeechAnalysis), {\n  mappingMethods: Object.values(methods)\n});","map":{"version":3,"names":["React","makeObservable","observable","action","toJS","computed","observer","notification","cx","ResizeObserver","LayoutWrapper","AppWrapper","AutoSaver","Toolbar","Atlas","Ruler","Region","TabMenu","Sidebar","Validator","Assist","Tier","TimeControl","ScalerControl","AttributesPannel","ReviewPanel","bindKeyboardEvents","i18n","UpdateType","ReviewResult","ValidationType","store","validate","methods","SpeechAnalysis","_class","Component","ratioPlacement","placement","analyse","ratio","setting","newPlacement","keys","Object","i","length","key","constructor","props","saverRef","createRef","attrRef","analyseContainer","mousePosition","x","y","resizeObserve","removeKeyboardEvents","handleMouseWheel","e","timelineHeight","atlasHeight","tierHeight","margin","atlasWidth","preventDefault","zoom","precent","displayBuffer","deltaY","delta","Math","ceil","setZoom","triggerValidation","results","hasCustomError","getScriptResult","emptys","hasEmptyError","emptyValidation","hasError","errors","review","setScriptResult","newInstances","values","instance","instances","result","checkMissingCharacter","id","category","start","text","categoryInstances","categoryInstancesMap","index","findIndex","push","warningType","ATTR_EMPTY","message","translate","frames","onSave","submit","_this$saverRef$curren","loading","jobProxy","loadError","error","Error","current","disableLeaveCheck","submitCheck","passed","saveResult","saveReviews","type","_this$saverRef$curren2","hasSuspend","reviewsResult","find","SUSPEND","getStatistics","statShapes","objects","total","approved","rejected","suspended","missed","reviews","filter","r","APPROVE","instancesList","v","instanceId","REJECT","shapes","handleSave","isPreview","isEnabled","success","handleUndo","undo","undoDisabled","item","before","updateStatus","after","handleRedo","redoDisabled","redo","curr","prev","forEach","step","setUpdatedInstances","status","UNDOREDO","updateReviews","addInstance","_store$ontology$categ","selectedCategoryName","undefined","ontology","categories","className","selectedTime","selectedRegion","canAddTier","canAddTiers","end","time","first","second","updateMousePostion","scrollTop","bound","getBoundingClientRect","pageX","pageY","updateAnalyseWindowSize","clientWidth","clientHeight","useableHeight","floor","updatePlacement","analyserHeight","resultLink","customCheck","reviewFrom","readonly","Promise","all","resolve","setTimeout","handleScreenFull","screenfull","toggle","reload","window","location","handleEnter","_this$attrRef$current","handleFocus","setLocale","locale","componentDidMount","init","renderComplete","addEventListener","observe","componentWillUnmount","removeEventListener","disconnect","render","createElement","__self","__source","fileName","_jsxFileName","lineNumber","columnNumber","ref","leaveCheck","data","storePointer","pointer","save","onContextMenu","sideBarVisible","tabs","title","count","content","reference","warnings","unfold","seekto","display","app","interactive","selectedInstance","Fragment","drawMode","currentReview","_applyDecoratedDescriptor","prototype","getOwnPropertyDescriptor","mappingMethods"],"sources":["/Users/qzheng/Documents/webroot/annotation_tools/src/components/phonetic-transcription/index.tsx"],"sourcesContent":["import React from 'react';\nimport { makeObservable, observable, action, toJS, computed } from 'mobx';\nimport { observer } from 'mobx-react';\nimport { Application } from 'pixi.js';\nimport { notification } from 'antd';\nimport cx from 'classnames';\nimport ResizeObserver from 'resize-observer-polyfill';\nimport LayoutWrapper from '../common/layout/LayoutWrapper';\nimport AppWrapper from '../common/shapes/wrapper/AppWrapper';\nimport AutoSaver from '../common/AutoSaver';\nimport Toolbar from './components/Toolbar';\nimport Atlas from './components/Atlas';\nimport Ruler from './components/Helper/Ruler';\nimport Region from './components/Helper/Region';\nimport TabMenu from '../common/tabs-menu/TabMenu';\nimport Sidebar from './components/Sidebar';\nimport Validator from './components/Validator';\nimport Assist from './components/Helper/Assist';\nimport Tier from './components/TierPannel';\nimport TimeControl from './components/Helper/TimeControl';\nimport ScalerControl from './components/Helper/ScalerControl';\nimport AttributesPannel, { AttributesHandle } from './components/Helper/AttributesPannel';\nimport ReviewPanel from './components/Helper/ReviewPanel';\nimport bindKeyboardEvents from './keyboard-events';\nimport { Status } from './store/UndoStore';\nimport i18n from './locales';\nimport { Payload, UpdateType, ReviewResult, InstanceItem, ValidationType } from './types';\nimport { IWarning } from '../common/tabs-menu/Validator';\nimport store from './store/RootStore';\nimport { validate } from './utils';\nimport { methods } from './payload';\nimport './index.scss';\n\nexport interface SpeechAnalysisProps extends Payload {\n  app: Application;\n  renderComplete: () => Promise<void>;\n}\n\nexport class SpeechAnalysis extends React.Component<SpeechAnalysisProps> {\n  /**\n   * auto saver reference\n   */\n  saverRef = React.createRef<AutoSaver>();\n\n  /**\n   * attributes reference\n   */\n  attrRef = React.createRef<AttributesHandle>();\n\n  /**\n   * analyse container reference\n   */\n  analyseContainer: React.RefObject<HTMLDivElement> = React.createRef();\n\n  /**\n   * mouse position\n   */\n  mousePosition = {\n    x: 0,\n    y: 0,\n  };\n\n  resizeObserve: ResizeObserver | null = null;\n\n  /**\n   * keyboard events\n   */\n  removeKeyboardEvents = () => {};\n\n  // eslint-disable-next-line class-methods-use-this\n  @computed get ratioPlacement() {\n    const { placement } = store.analyse;\n    const { ratio } = store.setting;\n    const newPlacement:{[key:string]: number;} = {};\n    const keys = Object.keys(placement);\n    for (let i = 0; i < keys.length; i += 1) {\n      const key = keys[i];\n      if (key === 'duration') {\n        newPlacement[key] = placement[key];\n      } else {\n        newPlacement[key] = placement[key] * ratio;\n      }\n    }\n    return newPlacement;\n  }\n\n  constructor(props: SpeechAnalysisProps) {\n    super(props);\n    makeObservable(this, {\n      mousePosition: observable,\n      updateMousePostion: action,\n    });\n    // set props\n    store.jobProxy = this.props.jobProxy;\n    i18n.setLocale(props.locale);\n  }\n\n  async componentDidMount() {\n    this.removeKeyboardEvents = bindKeyboardEvents(this);\n    // init store\n    try {\n      await store.init(this.props);\n    } catch (e) {\n      notification.error({ message: i18n.translate('ANNOTATION_DATA_LOAD_ERROR') });\n      return;\n    }\n    // render completed\n    this.props.renderComplete();\n    this.updateAnalyseWindowSize();\n    if (this.analyseContainer.current) {\n      this.analyseContainer.current.addEventListener('mousemove', this.updateMousePostion);\n      this.analyseContainer.current.addEventListener('wheel', this.handleMouseWheel);\n      if (this.analyseContainer.current) {\n        this.resizeObserve = new ResizeObserver(() => {\n          this.updateAnalyseWindowSize();\n        });\n        this.resizeObserve.observe(this.analyseContainer.current);\n      }\n    }\n  }\n\n  componentWillUnmount() {\n    if (this.analyseContainer.current) {\n      this.analyseContainer.current.removeEventListener('mousemove', this.updateMousePostion);\n      this.analyseContainer.current.removeEventListener('wheel', this.handleMouseWheel);\n    }\n    if (this.resizeObserve) {\n      this.resizeObserve.disconnect();\n      this.resizeObserve = null;\n    }\n  }\n\n  handleMouseWheel = (e: WheelEvent) => {\n    const { timelineHeight, atlasHeight, tierHeight, margin, atlasWidth } = store.analyse.placement;\n    const { y, x } = this.mousePosition;\n\n    // mouse on altas & tier\n    if ((y > timelineHeight && y < timelineHeight + atlasHeight + tierHeight) && (x > margin && x < margin + atlasWidth)) {\n      e.preventDefault();\n      let { zoom } = store.setting;\n      const { precent } = store.analyse.displayBuffer;\n      if (precent >= 1 && e.deltaY > 0) { // scrollwidth === clientwidth\n        return;\n      }\n\n      let delta = 1;\n      zoom = Math.ceil(zoom);\n      if (zoom > 200) {\n        delta = 30;\n      } else if (zoom > 150) {\n        delta = 20;\n      } else if (zoom > 80) {\n        delta = 8;\n      } else if (zoom > 50) {\n        delta = 5;\n      } else if (zoom > 20) {\n        delta = 2;\n      }\n      if (e.deltaY < 0) {\n        zoom += delta;\n      } else if (e.deltaY > 0) {\n        zoom -= delta;\n      }\n\n      store.setting.setZoom(zoom);\n    }\n  };\n\n  /**\n   * trigger validation, return passed or not\n   */\n  triggerValidation = async () => {\n    const { results, hasCustomError } = await this.getScriptResult();\n    const { emptys, hasEmptyError } = this.emptyValidation();\n    const hasError = hasCustomError || hasEmptyError;\n    const errors = [...emptys, ...results];\n    store.review.setScriptResult({ results: errors, hasCustomError });\n    return !hasError && errors.length <= 0;\n  };\n\n  emptyValidation = () => {\n    const newInstances: InstanceItem[] = Object.values(toJS(store.instance.instances));\n    const result: { emptys: IWarning[], hasEmptyError: boolean, } = {\n      emptys: [],\n      hasEmptyError: false,\n    };\n    if (store.checkMissingCharacter) {\n      for (let i = 0; i < newInstances.length; i += 1) {\n        const { id, category, start, text } = newInstances[i];\n        if (!text) {\n          result.hasEmptyError = true;\n          const categoryInstances = store.instance.categoryInstancesMap[category];\n          const index = categoryInstances.findIndex((instance) => instance.start === start);\n          result.emptys.push({\n            warningType: ValidationType.ATTR_EMPTY,\n            id,\n            message: i18n.translate('ERROR_INCOMPLETE', {\n              values: {\n                category,\n                index: index + 1,\n              }\n            }),\n            frames: [],\n          });\n        }\n      };\n    }\n    return result;\n  };\n\n  onSave = async (submit = true) => {\n    if (store.setting.loading || !store.jobProxy) {\n      const loadError = i18n.translate('ERROR_DATA_LOAD');\n      notification.error({ message: loadError });\n      throw new Error(loadError);\n    }\n    this.saverRef.current?.disableLeaveCheck();\n    if (submit) {\n      if (store.setting.submitCheck) {\n        // validate before submit\n        const passed = await this.triggerValidation();\n        if (!passed) {\n          throw new Error(i18n.translate('SUBMIT_CHECK_FAIL'));\n        }\n      }\n    }\n    return store.saveResult(submit);\n  };\n\n  saveReviews = (type = 'submit') => {\n    if (type === 'submit') {\n      const hasSuspend = store.review.reviewsResult.find((review) => review.result === ReviewResult.SUSPEND);\n      if (hasSuspend) {\n        throw new Error(i18n.translate('QC_SUSPEND_ERROR'));\n      }\n    }\n    this.saverRef.current?.disableLeaveCheck();\n    return store.saveReviews();\n  };\n\n  /**\n   * get review statistics\n   */\n  getStatistics = () => {\n    const statShapes: {\n      [shape: string]: { rejected: number; approved: number, suspended: number, missed: number, total: number };\n    } = {};\n    const objects = {\n      total: 0,\n      approved: 0,\n      rejected: 0,\n      suspended: 0,\n      missed: 0,\n    };\n    const reviews = store.review.reviewsResult.filter((r) => r.result !== ReviewResult.APPROVE);\n    const instancesList = Object.values(store.instance.instances).filter((v) => !!v);\n    for (let i = 0; i < instancesList.length; i += 1) {\n      const { id, category } = instancesList[i];\n      if (!statShapes[category]) {\n        statShapes[category] = {\n          rejected: 0,\n          approved: 0,\n          suspended: 0,\n          missed: 0,\n          total: 0\n        };\n      }\n      statShapes[category].total += 1;\n      objects.total += 1;\n      const review = reviews.find((r) => r.instanceId === id);\n      if (review?.result === ReviewResult.REJECT) {\n        statShapes[category].rejected += 1;\n        objects.rejected += 1;\n      } else if (review?.result === ReviewResult.SUSPEND) {\n        statShapes[category].suspended += 1;\n        objects.suspended += 1;\n      } else {\n        statShapes[category].approved += 1;\n        objects.approved += 1;\n      }\n    }\n    return { objects, shapes: statShapes };\n  };\n\n  handleSave = async () => {\n    if (store.isPreview) {\n      return;\n    }\n\n    try {\n      await this.onSave(false);\n      if (store.review.isEnabled) {\n        await this.saveReviews('save');\n      }\n      notification.success({ message: i18n.translate('SAVE_SUCCESS') });\n    } catch (e) {\n      notification.error({ message: i18n.translate('SAVE_FAIL') });\n    }\n  };\n\n  handleUndo = () => {\n    if (!store.undo.undoDisabled) {\n      const item = store.undo.undo();\n      if (item && item.before) {\n        this.updateStatus(item.before, item.after);\n        notification.success({ message: 'Undo successfully.' });\n      }\n    }\n  };\n\n  handleRedo = () => {\n    if (!store.undo.redoDisabled) {\n      const item = store.undo.redo();\n      if (item && item.after) {\n        this.updateStatus(item.after, item.before);\n        notification.success({ message: 'Redo successfully.' });\n      }\n    }\n  };\n\n  updateStatus = (curr: Status[], prev: Status[]) => {\n    curr.forEach((step) => {\n      if (step.type === 'instance') {\n        store.instance.setUpdatedInstances(step.status, UpdateType.UNDOREDO);\n      } else if (step.type === 'review') {\n        store.review.updateReviews(step.status);\n      }\n    });\n  };\n\n  addInstance = (index?: number) => {\n    const selectedCategoryName = index !== undefined ?\n      store.ontology.categories[index - 1]?.className :\n      store.ontology.selectedCategoryName;\n    const { selectedTime, selectedRegion } = store.analyse;\n    if (selectedCategoryName) {\n      if (selectedTime) {\n        store.instance.addInstance(selectedCategoryName, selectedTime);\n      } else if (selectedRegion) {\n        const canAddTier = store.ontology.canAddTiers[selectedCategoryName];\n        if (canAddTier) {\n          const { start, end } = selectedRegion;\n          const time: number[] = [];\n          if (canAddTier.first) {\n            time.push(start);\n          }\n          if (canAddTier.second) {\n            time.push(end);\n          }\n          if (time.length) store.instance.addInstance(selectedCategoryName, time);\n        }\n      }\n    }\n  };\n\n  updateMousePostion = (e: MouseEvent) => {\n    if (this.analyseContainer.current) {\n      const { scrollTop } = this.analyseContainer.current;\n      const bound = this.analyseContainer.current.getBoundingClientRect();\n      this.mousePosition = {\n        x: e.pageX - bound.x,\n        y: e.pageY - bound.y + scrollTop,\n      };\n    }\n  };\n\n  updateAnalyseWindowSize = () => {\n    const { clientWidth, clientHeight } = this.analyseContainer.current as HTMLDivElement;\n    const { margin } = store.analyse.placement;\n    /**\n     * others height 214\n     */\n    const useableHeight = clientHeight - 214;\n    let atlasHeight = (useableHeight * 4) / 7;\n    let tierHeight = (useableHeight * 3) / 7;\n    atlasHeight = atlasHeight < 320 ? 320 : Math.floor(atlasHeight / 2) * 2;\n    atlasHeight = atlasHeight > 440 ? 440 : atlasHeight;\n    tierHeight = tierHeight < 240 ? 240 : tierHeight;\n    store.analyse.updatePlacement({\n      atlasWidth: clientWidth - (2 * margin) - 1,\n      analyserHeight: clientHeight,\n      tierHeight,\n      atlasHeight,\n    });\n  };\n\n  getScriptResult = async () => {\n    let resultLink = '';\n    if (store.setting.customCheck) {\n      if (typeof store.jobProxy!.reviewFrom === 'string') {\n        resultLink = store.jobProxy!.reviewFrom;\n      }\n      if (!store.readonly) {\n        try {\n          resultLink = await this.onSave(false);\n        } catch (e) {\n          resultLink = '';\n        }\n      }\n    }\n\n    const [result] = await Promise.all([\n      validate(store.setting.customCheck, {\n        resultLink,\n      }),\n      new Promise((resolve) => {\n        setTimeout(resolve, 300);\n      }),\n    ]);\n    return result || { results: [], hasCustomError: false };\n  };\n\n  handleScreenFull = () => {\n    if (store.setting.screenfull.isEnabled) {\n      store.setting.screenfull.toggle();\n    }\n  };\n\n  reload = () => {\n    window.location.reload();\n  };\n\n  handleEnter = () => {\n    this.attrRef.current?.handleFocus();\n  };\n\n  render() {\n    return (\n      <LayoutWrapper className=\"phonetic-transcription-app\" loading={store.setting.loading}>\n        <AutoSaver\n          ref={this.saverRef}\n          leaveCheck\n          data={{ storePointer: store.undo.pointer }}\n          save={this.handleSave}\n        />\n        <Toolbar\n          readonly={store.setting.loading}\n          onSave={this.handleSave}\n          handleUndo={this.handleUndo}\n          handleRedo={this.handleRedo}\n          handleScreenFull={this.handleScreenFull}\n          reload={this.reload}\n        />\n        <div className=\"container\" onContextMenu={(e) => e.preventDefault()}>\n          {store.setting.sideBarVisible && (\n            <TabMenu\n              tabs={[\n                {\n                  title: i18n.translate('MENU_REFERENCE'),\n                  key: 'reference',\n                  count: 0,\n                  content: (\n                    <Sidebar\n                      loading={store.setting.loading}\n                      reference={this.props.reference}\n                    />\n                  )\n                },\n                {\n                  title: i18n.translate('MENU_WARNING'),\n                  key: 'validator',\n                  count: store.review.warnings.length,\n                  content: (\n                    <Validator\n                      instances={{}}\n                      triggerValidation={this.triggerValidation}\n                    />\n                  )\n                }\n              ]}\n            />\n          )}\n          <div className={cx('analyse-container', { unfold: !store.setting.sideBarVisible })} ref={this.analyseContainer}>\n            <div className=\"analyse-annotation\">\n              <Atlas\n                selectedRegion={store.analyse.selectedRegion}\n                seekto={store.analyse.seekto}\n                display={store.analyse.displayBuffer}\n                mousePosition={this.mousePosition}\n              />\n              <Tier\n                app={this.props.app}\n                interactive={!store.setting.loading}\n                selectedInstance={store.instance.selectedInstance}\n              />\n              <TimeControl mousePosition={this.mousePosition} />\n            </div>\n            <div className=\"control-pannel\">\n              <ScalerControl />\n              {\n                store.instance.selectedInstance && (\n                  <>\n                    {\n                      store.review.drawMode && (\n                        <AttributesPannel ref={this.attrRef} instance={store.instance.selectedInstance} />\n                      )\n                    }\n                    {\n                      store.review.isEnabled && !store.review.drawMode && (\n                      <ReviewPanel\n                        instance={store.instance.selectedInstance}\n                        review={store.review.currentReview}\n                      />\n                      )\n                    }\n                  </>\n                )\n              }\n            </div>\n            <Ruler ratioPlacement={this.ratioPlacement} />\n            <Region ratioPlacement={this.ratioPlacement} />\n            <Assist\n              mousePosition={this.mousePosition}\n              ratioPlacement={this.ratioPlacement}\n            />\n          </div>\n        </div>\n      </LayoutWrapper>\n    );\n  }\n};\nexport default AppWrapper(observer(SpeechAnalysis), {\n  mappingMethods: Object.values(methods),\n});\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}