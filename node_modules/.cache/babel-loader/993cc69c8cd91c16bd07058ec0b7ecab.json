{"ast":null,"code":"var _jsxFileName = \"/Users/qzheng/Documents/webroot/annotation_tools/src/components/video-tracking2/components/attributes/InstanceAttributes.tsx\";\nimport React from 'react';\nimport { action, makeObservable, observable } from 'mobx';\nimport { observer } from 'mobx-react';\nimport cx from 'classnames';\nimport InstanceItemAttributes from './InstanceItemAttributes';\nimport AttributeValueItem from './AttributeValueItem';\nimport { Up, Pencil } from '../../../common/icons';\nimport store from '../../store/RootStore';\nimport i18n from '../../locales';\nimport { parseFields } from '../../utils';\nimport './InstanceAttributes.scss';\nclass InstanceAttributes extends React.Component {\n  constructor(props) {\n    super(props);\n    /**\n     * fields map for instance & its items\n     */\n    this.fieldsMap = {};\n    /**\n     * collapsed\n     */\n    this.collapsed = false;\n    this.toggleCollapsed = () => {\n      this.collapsed = !this.collapsed;\n    };\n    makeObservable(this, {\n      fieldsMap: observable,\n      collapsed: observable,\n      updateFieldsMap: action,\n      toggleCollapsed: action\n    });\n    this.updateFieldsMap();\n  }\n  componentDidUpdate(prevProps) {\n    if (prevProps.instance.id !== this.props.instance.id) {\n      this.updateFieldsMap();\n    }\n  }\n  updateFieldsMap() {\n    const {\n      labelConfig,\n      children = []\n    } = this.props.instance.categoryRef;\n    this.fieldsMap = {\n      instance: parseFields(labelConfig)\n    };\n    // get label config for all items\n    children.forEach(child => {\n      this.fieldsMap[child.name] = parseFields(child.labelConfig);\n    });\n  }\n  render() {\n    const {\n      instance,\n      instanceItem\n    } = this.props;\n    const {\n      attributes,\n      label\n    } = instance;\n    const attrKeys = Object.keys(attributes || {});\n    const fieldKeys = Object.keys(this.fieldsMap.instance);\n    const legacyKeys = attrKeys.filter(key => !fieldKeys.includes(key));\n    return /*#__PURE__*/React.createElement(\"div\", {\n      className: cx('collapse-panel instance-attributes-panel', {\n        collapsed: this.collapsed\n      }),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 75,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"collapse-panel-title space-between\",\n      onClick: this.toggleCollapsed,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 80,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(\"span\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 84,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"collapse-panel-collapse-icon\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 85,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(Up, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 86,\n        columnNumber: 15\n      }\n    })), i18n.translate('INSTANCE_ATTRIBUTES_INSTANCE', {\n      values: {\n        frame: store.frame.currentFrame + 1\n      }\n    })), /*#__PURE__*/React.createElement(\"span\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 92,\n        columnNumber: 11\n      }\n    }, !store.readonly && store.instance.isAttributesEnabled(instance, instanceItem) && /*#__PURE__*/React.createElement(\"div\", {\n      className: \"collapse-panel-icon\",\n      onClick: e => {\n        e.stopPropagation();\n        store.config.setAttributesModalVisible(true);\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 94,\n        columnNumber: 15\n      }\n    }, /*#__PURE__*/React.createElement(Pencil, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 101,\n        columnNumber: 17\n      }\n    })))), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"collapse-panel-content\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 106,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"section\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 107,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"section-title\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 108,\n        columnNumber: 13\n      }\n    }, label), [...fieldKeys, ...legacyKeys].map(key => attrKeys.includes(key) && /*#__PURE__*/React.createElement(AttributeValueItem, {\n      key: key,\n      fieldName: key,\n      fieldsMap: this.fieldsMap.instance,\n      values: attributes,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 112,\n        columnNumber: 15\n      }\n    }))), instanceItem && /*#__PURE__*/React.createElement(InstanceItemAttributes, {\n      instanceItem: instanceItem,\n      fieldsMap: this.fieldsMap[instanceItem.name],\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 116,\n        columnNumber: 13\n      }\n    }), !instanceItem && Object.values(instance.items).filter(i => {\n      const cameras = Object.keys(i.cameras).filter(c => !i.cameras[c].isEmpty);\n      return cameras.includes(store.frame.currentCamera);\n    }).map(item => /*#__PURE__*/React.createElement(InstanceItemAttributes, {\n      key: item.id,\n      instanceItem: item,\n      fieldsMap: this.fieldsMap[item.name],\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 128,\n        columnNumber: 17\n      }\n    }))));\n  }\n}\nexport default observer(InstanceAttributes);","map":{"version":3,"names":["React","action","makeObservable","observable","observer","cx","InstanceItemAttributes","AttributeValueItem","Up","Pencil","store","i18n","parseFields","InstanceAttributes","Component","constructor","props","fieldsMap","collapsed","toggleCollapsed","updateFieldsMap","componentDidUpdate","prevProps","instance","id","labelConfig","children","categoryRef","forEach","child","name","render","instanceItem","attributes","label","attrKeys","Object","keys","fieldKeys","legacyKeys","filter","key","includes","createElement","className","__self","__source","fileName","_jsxFileName","lineNumber","columnNumber","onClick","translate","values","frame","currentFrame","readonly","isAttributesEnabled","e","stopPropagation","config","setAttributesModalVisible","map","fieldName","items","i","cameras","c","isEmpty","currentCamera","item"],"sources":["/Users/qzheng/Documents/webroot/annotation_tools/src/components/video-tracking2/components/attributes/InstanceAttributes.tsx"],"sourcesContent":["import React from 'react';\nimport { action, makeObservable, observable } from 'mobx';\nimport { observer } from 'mobx-react';\nimport cx from 'classnames';\nimport InstanceItemAttributes from './InstanceItemAttributes';\nimport AttributeValueItem from './AttributeValueItem';\nimport { Up, Pencil } from '../../../common/icons';\nimport store from '../../store/RootStore';\nimport i18n from '../../locales';\nimport { parseFields } from '../../utils';\nimport { FieldConfig } from '../../types';\nimport Instance from '../../model/Instance';\nimport InstanceItem from '../../model/InstanceItem';\nimport './InstanceAttributes.scss';\n\ninterface InstanceAttributesProps {\n  instance: Instance;\n  instanceItem?: InstanceItem;\n}\n\nclass InstanceAttributes extends React.Component<InstanceAttributesProps> {\n  /**\n   * fields map for instance & its items\n   */\n  fieldsMap: {\n    [type: string]: { [fieldName: string]: FieldConfig }\n  } = {};\n\n  /**\n   * collapsed\n   */\n  collapsed = false;\n\n  constructor(props: InstanceAttributesProps) {\n    super(props);\n\n    makeObservable(this, {\n      fieldsMap: observable,\n      collapsed: observable,\n      updateFieldsMap: action,\n      toggleCollapsed: action,\n    });\n\n    this.updateFieldsMap();\n  }\n\n  componentDidUpdate(prevProps: InstanceAttributesProps) {\n    if (prevProps.instance.id !== this.props.instance.id) {\n      this.updateFieldsMap();\n    }\n  }\n\n  updateFieldsMap() {\n    const { labelConfig, children = [] } = this.props.instance.categoryRef;\n    this.fieldsMap = {\n      instance: parseFields(labelConfig),\n    };\n    // get label config for all items\n    children.forEach((child) => {\n      this.fieldsMap[child.name] = parseFields(child.labelConfig);\n    });\n  }\n\n  toggleCollapsed = () => {\n    this.collapsed = !this.collapsed;\n  };\n\n  render() {\n    const { instance, instanceItem } = this.props;\n    const { attributes, label } = instance;\n    const attrKeys = Object.keys(attributes || {});\n    const fieldKeys = Object.keys(this.fieldsMap.instance);\n    const legacyKeys = attrKeys.filter((key) => !fieldKeys.includes(key));\n    return (\n      <div\n        className={cx('collapse-panel instance-attributes-panel', {\n          collapsed: this.collapsed,\n        })}\n      >\n        <div\n          className=\"collapse-panel-title space-between\"\n          onClick={this.toggleCollapsed}\n        >\n          <span>\n            <div className=\"collapse-panel-collapse-icon\">\n              <Up />\n            </div>\n            {i18n.translate('INSTANCE_ATTRIBUTES_INSTANCE', {\n              values: { frame: store.frame.currentFrame + 1 },\n            })}\n          </span>\n          <span>\n            {!store.readonly && store.instance.isAttributesEnabled(instance, instanceItem) && (\n              <div\n                className=\"collapse-panel-icon\"\n                onClick={(e) => {\n                  e.stopPropagation();\n                  store.config.setAttributesModalVisible(true);\n                }}\n              >\n                <Pencil />\n              </div>\n            )}\n          </span>\n        </div>\n        <div className=\"collapse-panel-content\">\n          <div className=\"section\">\n            <div className=\"section-title\">\n              {label}\n            </div>\n            {[...fieldKeys, ...legacyKeys].map((key) => attrKeys.includes(key) && (\n              <AttributeValueItem key={key} fieldName={key} fieldsMap={this.fieldsMap.instance} values={attributes} />\n            ))}\n          </div>\n          {instanceItem && (\n            <InstanceItemAttributes\n              instanceItem={instanceItem}\n              fieldsMap={this.fieldsMap[instanceItem.name]}\n            />\n          )}\n          {\n            !instanceItem && Object.values(instance.items)\n              .filter((i) => {\n                const cameras = Object.keys(i.cameras).filter((c) => !i.cameras[c].isEmpty);\n                return cameras.includes(store.frame.currentCamera);\n              })\n              .map((item) => (\n                <InstanceItemAttributes\n                  key={item.id}\n                  instanceItem={item}\n                  fieldsMap={this.fieldsMap[item.name]}\n                />\n              ))\n          }\n        </div>\n      </div>\n    );\n  }\n}\n\nexport default observer(InstanceAttributes);\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}