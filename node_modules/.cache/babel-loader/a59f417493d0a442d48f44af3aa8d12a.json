{"ast":null,"code":"import React,{useEffect,useRef,useState}from'react';import{Button}from'antd';import{FormOutlined}from'@ant-design/icons';import cx from'classnames';import ChatContent from'./ChatContent';import RankItem from'./RankItem';import AttributesItemConfig from'./AttributesItem';import OriginalValueContent from'./OriginalValueContent';import'./ChatItem.scss';export let ChatItemType=/*#__PURE__*/function(ChatItemType){ChatItemType[\"Q\"]=\"question\";ChatItemType[\"A\"]=\"answer\";return ChatItemType;}({});const ChatItem=_ref=>{let{dragging=false,draggableProvided,draggableSnapshot,type,label,value,onValueChange,originalValue,error=false,selected=false,onSelect,valueEditable=false,valueEditing=false,onValueEdit,noValueContent,rankingType,rankingOptions=[],rankEditable=false,rankEditing=false,onRankEdit,rank,onRankChange,prefix,itemAttributesConfig,attributesEditing=false,attributesEditable=false,attributes,onItemAttributesEdit,onItemAttributesDelete,onItemAttributesChange}=_ref;const avatarRef=useRef(null);const[hovered,setHovered]=useState(false);useEffect(()=>{if(selected){var _avatarRef$current;const item=(_avatarRef$current=avatarRef.current)===null||_avatarRef$current===void 0?void 0:_avatarRef$current.parentElement;const parent=item===null||item===void 0?void 0:item.parentElement;if(!item||!parent){return;}const overTop=item.offsetTop-parent.offsetTop<parent.scrollTop;const overBottom=item.offsetTop-parent.offsetTop+item.clientHeight>parent.scrollTop+parent.clientHeight;const alignWithTop=overTop&&!overBottom;if(overTop||overBottom){item.scrollIntoView(alignWithTop);}}},[selected]);return/*#__PURE__*/React.createElement(\"div\",Object.assign({},draggableProvided===null||draggableProvided===void 0?void 0:draggableProvided.draggableProps,{ref:draggableProvided===null||draggableProvided===void 0?void 0:draggableProvided.innerRef,className:cx('llm-chat-item',{'llm-q':type===ChatItemType.Q,'llm-a':type===ChatItemType.A,error,selected,hovered:hovered||(draggableSnapshot===null||draggableSnapshot===void 0?void 0:draggableSnapshot.isDragging)}),onMouseDown:e=>e.stopPropagation(),onMouseEnter:()=>{if(!dragging){// not set hovered when dragging\nsetHovered(true);}},onMouseLeave:()=>setHovered(false),onClick:onSelect}),prefix,/*#__PURE__*/React.createElement(\"div\",{ref:avatarRef,className:\"llm-chat-item-avatar\"},label||(type===ChatItemType.Q?'Q':'A')),value||valueEditing?/*#__PURE__*/React.createElement(\"div\",{className:\"llm-chat-item-content-container\"},/*#__PURE__*/React.createElement(\"div\",{className:cx('llm-chat-item-content',{editing:valueEditing})},/*#__PURE__*/React.createElement(ChatContent,{type:type,content:value,onContentChange:newContent=>{if(valueEditable&&!valueEditing&&onValueChange){onValueChange(newContent);}}})),valueEditable&&!valueEditing&&hovered&&/*#__PURE__*/React.createElement(\"div\",{className:\"llm-chat-item-content-btns\"},/*#__PURE__*/React.createElement(Button,{size:\"small\",type:\"link\",icon:/*#__PURE__*/React.createElement(FormOutlined,null),onClick:e=>{if(onValueEdit){e.stopPropagation();onValueEdit();}}})),/*#__PURE__*/React.createElement(OriginalValueContent,{originalValue:originalValue,value:value}),rankingType&&rankingOptions.length>0&&/*#__PURE__*/React.createElement(RankItem,{rankingType:rankingType,rankingOptions:rankingOptions,rankEditable:rankEditable&&hovered,rankEditing:rankEditing,onRankEdit:onRankEdit,rank:rank,onRankChange:onRankChange}),itemAttributesConfig&&/*#__PURE__*/React.createElement(AttributesItemConfig,{attributesEditing:attributesEditing,config:itemAttributesConfig,attributesEditable:attributesEditable&&hovered,attributes:attributes,onEdit:onItemAttributesEdit,onDelete:onItemAttributesDelete,onChange:val=>{if(onItemAttributesChange){onItemAttributesChange(val);}}})):noValueContent);};export default ChatItem;","map":{"version":3,"names":["React","useEffect","useRef","useState","Button","FormOutlined","cx","ChatContent","RankItem","AttributesItemConfig","OriginalValueContent","ChatItemType","ChatItem","_ref","dragging","draggableProvided","draggableSnapshot","type","label","value","onValueChange","originalValue","error","selected","onSelect","valueEditable","valueEditing","onValueEdit","noValueContent","rankingType","rankingOptions","rankEditable","rankEditing","onRankEdit","rank","onRankChange","prefix","itemAttributesConfig","attributesEditing","attributesEditable","attributes","onItemAttributesEdit","onItemAttributesDelete","onItemAttributesChange","avatarRef","hovered","setHovered","_avatarRef$current","item","current","parentElement","parent","overTop","offsetTop","scrollTop","overBottom","clientHeight","alignWithTop","scrollIntoView","createElement","Object","assign","draggableProps","ref","innerRef","className","Q","A","isDragging","onMouseDown","e","stopPropagation","onMouseEnter","onMouseLeave","onClick","editing","content","onContentChange","newContent","size","icon","length","config","onEdit","onDelete","onChange","val"],"sources":["/Users/qzheng/Documents/webroot/annotation_tools/src/components/common/llm/chat/ChatItem.tsx"],"sourcesContent":["import React, { useEffect, useRef, useState } from 'react';\nimport { Button } from 'antd';\nimport { FormOutlined } from '@ant-design/icons';\nimport type { DraggableProvided, DraggableStateSnapshot } from 'react-beautiful-dnd';\nimport cx from 'classnames';\nimport { FormConfig } from '@appen-china/easy-form/es/types';\nimport ChatContent from './ChatContent';\nimport RankItem from './RankItem';\nimport AttributesItemConfig from './AttributesItem';\nimport OriginalValueContent from './OriginalValueContent';\nimport { Content, Rank, RankingType } from '../types';\nimport './ChatItem.scss';\n\nexport enum ChatItemType {\n  Q = 'question',\n  A = 'answer',\n}\n\ninterface ChatItemProps {\n  dragging?: boolean;\n  draggableProvided?: DraggableProvided;\n  draggableSnapshot?: DraggableStateSnapshot;\n  type: ChatItemType;\n  label?: string;\n  value?: Content;\n  onValueChange?: (value: Content) => void;\n  originalValue?: Content;\n  error?: boolean;\n  selected?: boolean;\n  onSelect?: () => void;\n  // value\n  valueEditable?: boolean;\n  valueEditing?: boolean;\n  onValueEdit?: () => void;\n  noValueContent?: React.ReactNode;\n  // rank\n  rankingType?: RankingType;\n  rankingOptions?: string[];\n  rankEditable?: boolean;\n  rankEditing?: boolean;\n  onRankEdit?: () => void;\n  rank?: Rank;\n  onRankChange?: (rank: Rank) => void;\n  // prefix\n  prefix?: React.ReactNode;\n  // attributes\n  itemAttributesConfig?: FormConfig;\n  attributesEditing?: boolean;\n  attributesEditable?: boolean;\n  attributes?: any\n  onItemAttributesEdit?: () => void;\n  onItemAttributesDelete?: () => void;\n  onItemAttributesChange?: (attributes: any) => void;\n}\n\nconst ChatItem: React.FC<ChatItemProps> = ({\n  dragging = false,\n  draggableProvided,\n  draggableSnapshot,\n  type,\n  label,\n  value,\n  onValueChange,\n  originalValue,\n  error = false,\n  selected = false,\n  onSelect,\n  valueEditable = false,\n  valueEditing = false,\n  onValueEdit,\n  noValueContent,\n  rankingType,\n  rankingOptions = [],\n  rankEditable = false,\n  rankEditing = false,\n  onRankEdit,\n  rank,\n  onRankChange,\n  prefix,\n  itemAttributesConfig,\n  attributesEditing = false,\n  attributesEditable = false,\n  attributes,\n  onItemAttributesEdit,\n  onItemAttributesDelete,\n  onItemAttributesChange,\n}) => {\n  const avatarRef = useRef<HTMLDivElement>(null);\n  const [hovered, setHovered] = useState(false);\n\n  useEffect(() => {\n    if (selected) {\n      const item = avatarRef.current?.parentElement;\n      const parent = item?.parentElement;\n      if (!item || !parent) {\n        return;\n      }\n\n      const overTop = item.offsetTop - parent.offsetTop < parent.scrollTop;\n      const overBottom = (item.offsetTop - parent.offsetTop + item.clientHeight) > (parent.scrollTop + parent.clientHeight);\n      const alignWithTop = overTop && !overBottom;\n      if (overTop || overBottom) {\n        item.scrollIntoView(alignWithTop);\n      }\n    }\n  }, [selected]);\n\n  return (\n    <div\n      {...draggableProvided?.draggableProps}\n      ref={draggableProvided?.innerRef}\n      className={cx('llm-chat-item', {\n        'llm-q': type === ChatItemType.Q,\n        'llm-a': type === ChatItemType.A,\n        error,\n        selected,\n        hovered: hovered || draggableSnapshot?.isDragging,\n      })}\n      onMouseDown={(e) => e.stopPropagation()}\n      onMouseEnter={() => {\n        if (!dragging) {\n          // not set hovered when dragging\n          setHovered(true);\n        }\n      }}\n      onMouseLeave={() => setHovered(false)}\n      onClick={onSelect}\n    >\n      {prefix}\n      <div ref={avatarRef} className=\"llm-chat-item-avatar\">\n        {label || (type === ChatItemType.Q ? 'Q' : 'A')}\n      </div>\n      {(value || valueEditing) ? (\n        <div className=\"llm-chat-item-content-container\">\n          <div\n            className={cx('llm-chat-item-content', {\n              editing: valueEditing,\n            })}\n          >\n            <ChatContent\n              type={type}\n              content={value}\n              onContentChange={(newContent) => {\n                if (valueEditable && !valueEditing && onValueChange) {\n                  onValueChange(newContent);\n                }\n              }}\n            />\n          </div>\n          {valueEditable && !valueEditing && hovered && (\n            <div className=\"llm-chat-item-content-btns\">\n              <Button\n                size=\"small\"\n                type=\"link\"\n                icon={<FormOutlined />}\n                onClick={(e) => {\n                  if (onValueEdit) {\n                    e.stopPropagation();\n                    onValueEdit();\n                  }\n                }}\n              />\n            </div>\n          )}\n          <OriginalValueContent originalValue={originalValue} value={value} />\n          {rankingType && rankingOptions.length > 0 && (\n            <RankItem\n              rankingType={rankingType}\n              rankingOptions={rankingOptions}\n              rankEditable={rankEditable && hovered}\n              rankEditing={rankEditing}\n              onRankEdit={onRankEdit}\n              rank={rank}\n              onRankChange={onRankChange}\n            />\n          )}\n          {\n            itemAttributesConfig && (\n              <AttributesItemConfig\n                attributesEditing={attributesEditing}\n                config={itemAttributesConfig}\n                attributesEditable={attributesEditable && hovered}\n                attributes={attributes}\n                onEdit={onItemAttributesEdit}\n                onDelete={onItemAttributesDelete}\n                onChange={(val) => {\n                  if (onItemAttributesChange) {\n                    onItemAttributesChange(val);\n                  }\n                }}\n              />\n            )\n          }\n        </div>\n      ) : noValueContent}\n    </div>\n  );\n};\n\nexport default ChatItem;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}