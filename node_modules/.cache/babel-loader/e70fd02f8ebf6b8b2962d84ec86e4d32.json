{"ast":null,"code":"import{makeAutoObservable}from'mobx';import{v4 as uuidv4}from'uuid';import{cloneDeep}from'lodash';import{message}from'antd';import i18n from'../locales';import ReviewItem from'../model/ReviewItem';const STACK_SIZE=20;;/**\n * undo & redo store\n * @class\n */export default class UndoStore{/**\n   * is undo disabled\n   * @getter\n   */get undoDisabled(){return this.pointer<=0;}/**\n   * is redo disabled\n   * @getter\n   */get redoDisabled(){return this.pointer>=this.stack.length;}constructor(rootStore){/**\n   * root store\n   */this.rootStore=void 0;/**\n   * current pointer\n   */this.pointer=0;/**\n   * last stored data uuid\n   */this.lastStoreId='';/**\n   * saved status\n   */this.stack=[];/**\n   * current data uuid\n   */this.storeId='';/**\n   * saved data copy\n   */this.savedData={};makeAutoObservable(this,{rootStore:false,stack:false,storeId:false,savedData:false},{autoBind:true});this.rootStore=rootStore;}/**\n   * preserve current data\n   * @param data\n   */preserve(){let data=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};this.storeId=uuidv4();this.savedData=cloneDeep(data);return this.storeId;}/**\n   * save to stack\n   * @param uid\n   * @param data\n   */save(uid){let data=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};if(uid===this.storeId){// same command\nthis.stack=this.stack.slice(0,this.pointer);this.stack.push({before:this.savedData,after:cloneDeep(data)});if(this.stack.length>STACK_SIZE){this.stack.shift();}else{this.pointer+=1;}this.lastStoreId=uid;}this.storeId='';this.savedData={};}/**\n   * push state by prev & curr state\n   * @param prevState\n   * @param currState\n   */push(prevState,currState){this.stack=this.stack.slice(0,this.pointer);this.stack.push({before:cloneDeep(prevState),after:cloneDeep(currState)});if(this.stack.length>STACK_SIZE){this.stack.shift();}else{this.pointer+=1;}this.lastStoreId=uuidv4();}/**\n   * undo\n   */undo(){if(this.undoDisabled||this.rootStore.config.isAnyModalOpened||this.rootStore.shape.isDrawing){return;}if(this.pointer>0){this.pointer-=1;const item=this.stack[this.pointer];if(item&&item.before){this.updateData(item.before,item.after);message.success(i18n.translate('UNDO_SUCCESS'));}}}/**\n   * redo\n   */redo(){if(this.redoDisabled||this.rootStore.config.isAnyModalOpened||this.rootStore.shape.isDrawing){return;}if(this.pointer<this.stack.length){this.pointer+=1;const item=this.stack[this.pointer-1];if(item&&item.after){this.updateData(item.after,item.before);message.success(i18n.translate('REDO_SUCCESS'));}}}/**\n   * update data (used for undo / redo)\n   * @param curr\n   * @param prev\n   */updateData(curr,prev){var _prev$instances,_curr$instances,_prev$frames,_curr$frames,_prev$reviews,_curr$reviews;const{selectedInstances,selectedInstanceItems,getInstanceById,deleteInstance,deleteInstanceItem,createInstanceFromData}=this.rootStore.instance;const{getShapeByInstanceItem,deleteShape,setupShape}=this.rootStore.shape;const{currentFrame}=this.rootStore.frame;const selectedInstanceMap={};selectedInstances.forEach(instance=>{selectedInstanceMap[instance.id]=selectedInstanceItems.filter(i=>i.instance===instance).map(i=>i.id);});(_prev$instances=prev.instances)===null||_prev$instances===void 0?void 0:_prev$instances.forEach(affectedInstance=>{if(affectedInstance){const instance=getInstanceById(affectedInstance.id);if(instance){affectedInstance.children.forEach(affectedItem=>{const item=instance.items[affectedItem.id];if(item){affectedItem.cameras.forEach(affectedCamera=>{const camera=item.cameras[affectedCamera.camera];if(camera){// delete frame\naffectedCamera.frames.forEach(affectedFrame=>{if(affectedFrame.frameIndex===currentFrame){// remove shapes if needed\nconst shape=getShapeByInstanceItem(item,camera.camera);if(shape){deleteShape(shape);}}// delete frame data\ndelete camera.frames[affectedFrame.frameIndex];});// delete camera if needed\nif(camera.isEmpty){delete item.cameras[camera.camera];}// delete instance item if needed\nif(item.isEmpty){deleteInstanceItem(item);}// delete instance if needed\nif(instance.isEmpty){deleteInstance(instance);}}});}});}}});(_curr$instances=curr.instances)===null||_curr$instances===void 0?void 0:_curr$instances.forEach(affectedInstance=>{if(affectedInstance){const instance=getInstanceById(affectedInstance.id);if(instance){instance.attributes=cloneDeep(affectedInstance.attributes);instance.setDynamicAttributes(affectedInstance.dynamicAttributes);affectedInstance.children.forEach(affectedItem=>{const item=instance.items[affectedItem.id];if(item){affectedItem.cameras.forEach(affectedCamera=>{const camera=item.cameras[affectedCamera.camera];if(camera){// update frame\naffectedCamera.frames.forEach(affectedFrame=>{camera.createFrameFromData(affectedFrame);});}else{// no camera, create\nitem.createCameraFromData(affectedCamera);}// readd shape\nsetupShape(item,affectedCamera.camera);});}else{// no instance item, create\ninstance.createItemFromData(affectedItem);const createdItem=instance.items[affectedItem.id];// readd shapes\naffectedItem.cameras.forEach(affectedCamera=>{setupShape(createdItem,affectedCamera.camera);});}});if(instance.number!==affectedInstance.number){instance.number=affectedInstance.number;Object.values(instance.items).forEach(item=>{Object.keys(item.cameras).forEach(camera=>{setupShape(item,camera);});});}}else{// no instance, create\ncreateInstanceFromData(affectedInstance);const createdInstance=getInstanceById(affectedInstance.id);affectedInstance.children.forEach(affectedItem=>{const item=createdInstance.items[affectedItem.id];// readd shapes\naffectedItem.cameras.forEach(affectedCamera=>{setupShape(item,affectedCamera.camera);});});}}});(_prev$frames=prev.frames)===null||_prev$frames===void 0?void 0:_prev$frames.forEach(affectedCamera=>{const{camera,frames}=affectedCamera;if(this.rootStore.frame.attributes[camera]){frames.forEach(_ref=>{let{frameIndex}=_ref;delete this.rootStore.frame.attributes[camera][frameIndex];});}});(_curr$frames=curr.frames)===null||_curr$frames===void 0?void 0:_curr$frames.forEach(affectedCamera=>{const{camera,frames}=affectedCamera;if(!this.rootStore.frame.attributes[camera]){this.rootStore.frame.attributes[camera]={};}frames.forEach(_ref2=>{let{frameIndex,...attributes}=_ref2;this.rootStore.frame.attributes[camera][frameIndex]={frameIndex,...attributes};});});(_prev$reviews=prev.reviews)===null||_prev$reviews===void 0?void 0:_prev$reviews.forEach(affectedReview=>{const{id,frameIndex}=affectedReview;const frameReviews=this.rootStore.review.reviews[frameIndex]||[];const index=frameReviews.findIndex(r=>r.id===id);if(index>=0){frameReviews.splice(index,1);}const{anchor}=this.rootStore.review.anchors[id]||{};if(anchor){delete this.rootStore.review.anchors[id];anchor.destroy();}});(_curr$reviews=curr.reviews)===null||_curr$reviews===void 0?void 0:_curr$reviews.forEach(affectedReview=>{const{frameIndex,camera}=affectedReview;const review=new ReviewItem(affectedReview);if(!this.rootStore.review.reviews[frameIndex]){this.rootStore.review.reviews[frameIndex]=[];}this.rootStore.review.reviews[frameIndex].push(review);if(frameIndex===currentFrame){const cameraView=this.rootStore.frame.cameraViews[camera];if(cameraView&&cameraView.reviewLayer){const anchor=this.rootStore.review.createReviewAnchor(review.result,review.x,review.y,cameraView.reviewLayer,cameraView.viewScale);if(anchor){this.rootStore.review.anchors[review.id]={anchor,camera};}}}});// reselect instance or instance item\nif(Object.keys(selectedInstanceMap).length>0){const instances=[];const instanceItems=[];Object.keys(selectedInstanceMap).forEach(instanceId=>{const instance=getInstanceById(instanceId);if(instance){instances.push(instance);const itemIds=selectedInstanceMap[instanceId];Object.values(instance.items).forEach(item=>{if(itemIds.includes(item.id)){instanceItems.push(item);}});}});if(instanceItems.length>0){this.rootStore.instance.selectInstanceItem(instanceItems);}else if(instances.length>0){this.rootStore.instance.selectInstance(instances);}}this.rootStore.shape.predict();// reselect review item\nif(this.rootStore.review.selectedReviewId){const review=this.rootStore.review.allReviews.find(r=>r.id===this.rootStore.review.selectedReviewId);if(review){const{anchor}=this.rootStore.review.anchors[review.id]||{};if(anchor){this.rootStore.review.selectReview(review,anchor);}}}}}","map":{"version":3,"names":["makeAutoObservable","v4","uuidv4","cloneDeep","message","i18n","ReviewItem","STACK_SIZE","UndoStore","undoDisabled","pointer","redoDisabled","stack","length","constructor","rootStore","lastStoreId","storeId","savedData","autoBind","preserve","data","arguments","undefined","save","uid","slice","push","before","after","shift","prevState","currState","undo","config","isAnyModalOpened","shape","isDrawing","item","updateData","success","translate","redo","curr","prev","_prev$instances","_curr$instances","_prev$frames","_curr$frames","_prev$reviews","_curr$reviews","selectedInstances","selectedInstanceItems","getInstanceById","deleteInstance","deleteInstanceItem","createInstanceFromData","instance","getShapeByInstanceItem","deleteShape","setupShape","currentFrame","frame","selectedInstanceMap","forEach","id","filter","i","map","instances","affectedInstance","children","affectedItem","items","cameras","affectedCamera","camera","frames","affectedFrame","frameIndex","isEmpty","attributes","setDynamicAttributes","dynamicAttributes","createFrameFromData","createCameraFromData","createItemFromData","createdItem","number","Object","values","keys","createdInstance","_ref","_ref2","reviews","affectedReview","frameReviews","review","index","findIndex","r","splice","anchor","anchors","destroy","cameraView","cameraViews","reviewLayer","createReviewAnchor","result","x","y","viewScale","instanceItems","instanceId","itemIds","includes","selectInstanceItem","selectInstance","predict","selectedReviewId","allReviews","find","selectReview"],"sources":["/Users/qzheng/Documents/webroot/annotation_tools/src/components/video-tracking2/store/UndoStore.ts"],"sourcesContent":["import { makeAutoObservable } from 'mobx';\nimport { v4 as uuidv4 } from 'uuid';\nimport { cloneDeep } from 'lodash';\nimport { message } from 'antd';\nimport RootStore from './RootStore';\nimport i18n from '../locales';\nimport { Instance, Review, CameraFrameAttributes } from '../types';\nimport ReviewItem from '../model/ReviewItem';\nimport MInstance from '../model/Instance';\nimport MInstanceItem from '../model/InstanceItem';\n\nconst STACK_SIZE = 20;\n\nexport interface StoreData {\n  // for instances\n  instances?: Instance[];\n  // for reviews\n  reviews?: Review[];\n  // for frame attributes\n  frames?: CameraFrameAttributes[];\n};\n\ninterface StoreItem {\n  before: StoreData;\n  after: StoreData;\n}\n\n/**\n * undo & redo store\n * @class\n */\nexport default class UndoStore {\n  /**\n   * root store\n   */\n  rootStore: typeof RootStore;\n\n  /**\n   * current pointer\n   */\n  pointer = 0;\n\n  /**\n   * last stored data uuid\n   */\n  lastStoreId = '';\n\n  /**\n   * saved status\n   */\n  stack: StoreItem[] = [];\n\n  /**\n   * current data uuid\n   */\n  storeId = '';\n\n  /**\n   * saved data copy\n   */\n  savedData: StoreData = {};\n\n  /**\n   * is undo disabled\n   * @getter\n   */\n  get undoDisabled() {\n    return this.pointer <= 0;\n  }\n\n  /**\n   * is redo disabled\n   * @getter\n   */\n  get redoDisabled() {\n    return this.pointer >= this.stack.length;\n  }\n\n  constructor(rootStore: typeof RootStore) {\n    makeAutoObservable(this, {\n      rootStore: false,\n      stack: false,\n      storeId: false,\n      savedData: false,\n    }, {\n      autoBind: true,\n    });\n\n    this.rootStore = rootStore;\n  }\n\n  /**\n   * preserve current data\n   * @param data\n   */\n  preserve(data: StoreData = {}) {\n    this.storeId = uuidv4();\n    this.savedData = cloneDeep(data);\n    return this.storeId;\n  }\n\n  /**\n   * save to stack\n   * @param uid\n   * @param data\n   */\n  save(uid: string, data: StoreData = {}) {\n    if (uid === this.storeId) { // same command\n      this.stack = this.stack.slice(0, this.pointer);\n      this.stack.push({\n        before: this.savedData,\n        after: cloneDeep(data),\n      });\n      if (this.stack.length > STACK_SIZE) {\n        this.stack.shift();\n      } else {\n        this.pointer += 1;\n      }\n      this.lastStoreId = uid;\n    }\n    this.storeId = '';\n    this.savedData = {};\n  }\n\n  /**\n   * push state by prev & curr state\n   * @param prevState\n   * @param currState\n   */\n  push(prevState: StoreData, currState: StoreData) {\n    this.stack = this.stack.slice(0, this.pointer);\n    this.stack.push({\n      before: cloneDeep(prevState),\n      after: cloneDeep(currState),\n    });\n    if (this.stack.length > STACK_SIZE) {\n      this.stack.shift();\n    } else {\n      this.pointer += 1;\n    }\n    this.lastStoreId = uuidv4();\n  }\n\n  /**\n   * undo\n   */\n  undo() {\n    if (this.undoDisabled || this.rootStore.config.isAnyModalOpened || this.rootStore.shape.isDrawing) {\n      return;\n    }\n    if (this.pointer > 0) {\n      this.pointer -= 1;\n      const item = this.stack[this.pointer];\n      if (item && item.before) {\n        this.updateData(item.before, item.after);\n        message.success(i18n.translate('UNDO_SUCCESS'));\n      }\n    }\n  }\n\n  /**\n   * redo\n   */\n  redo() {\n    if (this.redoDisabled || this.rootStore.config.isAnyModalOpened || this.rootStore.shape.isDrawing) {\n      return;\n    }\n    if (this.pointer < this.stack.length) {\n      this.pointer += 1;\n      const item = this.stack[this.pointer - 1];\n      if (item && item.after) {\n        this.updateData(item.after, item.before);\n        message.success(i18n.translate('REDO_SUCCESS'));\n      }\n    }\n  }\n\n  /**\n   * update data (used for undo / redo)\n   * @param curr\n   * @param prev\n   */\n  updateData(curr: StoreData, prev: StoreData) {\n    const {\n      selectedInstances,\n      selectedInstanceItems,\n      getInstanceById,\n      deleteInstance,\n      deleteInstanceItem,\n      createInstanceFromData,\n    } = this.rootStore.instance;\n    const {\n      getShapeByInstanceItem,\n      deleteShape,\n      setupShape,\n    } = this.rootStore.shape;\n    const {\n      currentFrame,\n    } = this.rootStore.frame;\n    const selectedInstanceMap: { [instanceId: string]: string[] } = {};\n    selectedInstances.forEach((instance) => {\n      selectedInstanceMap[instance.id] = selectedInstanceItems.filter((i) => i.instance === instance).map((i) => i.id);\n    });\n\n    prev.instances?.forEach((affectedInstance) => {\n      if (affectedInstance) {\n        const instance = getInstanceById(affectedInstance.id);\n        if (instance) {\n          affectedInstance.children.forEach((affectedItem) => {\n            const item = instance.items[affectedItem.id];\n            if (item) {\n              affectedItem.cameras.forEach((affectedCamera) => {\n                const camera = item.cameras[affectedCamera.camera];\n                if (camera) {\n                  // delete frame\n                  affectedCamera.frames.forEach((affectedFrame) => {\n                    if (affectedFrame.frameIndex === currentFrame) {\n                      // remove shapes if needed\n                      const shape = getShapeByInstanceItem(item, camera.camera);\n                      if (shape) {\n                        deleteShape(shape);\n                      }\n                    }\n                    // delete frame data\n                    delete camera.frames[affectedFrame.frameIndex];\n                  });\n                  // delete camera if needed\n                  if (camera.isEmpty) {\n                    delete item.cameras[camera.camera];\n                  }\n                  // delete instance item if needed\n                  if (item.isEmpty) {\n                    deleteInstanceItem(item);\n                  }\n                  // delete instance if needed\n                  if (instance.isEmpty) {\n                    deleteInstance(instance);\n                  }\n                }\n              });\n            }\n          });\n        }\n      }\n    });\n    curr.instances?.forEach((affectedInstance) => {\n      if (affectedInstance) {\n        const instance = getInstanceById(affectedInstance.id);\n        if (instance) {\n          instance.attributes = cloneDeep(affectedInstance.attributes);\n          instance.setDynamicAttributes(affectedInstance.dynamicAttributes);\n          affectedInstance.children.forEach((affectedItem) => {\n            const item = instance.items[affectedItem.id];\n            if (item) {\n              affectedItem.cameras.forEach((affectedCamera) => {\n                const camera = item.cameras[affectedCamera.camera];\n                if (camera) {\n                  // update frame\n                  affectedCamera.frames.forEach((affectedFrame) => {\n                    camera.createFrameFromData(affectedFrame);\n                  });\n                } else {\n                  // no camera, create\n                  item.createCameraFromData(affectedCamera);\n                }\n                // readd shape\n                setupShape(item, affectedCamera.camera);\n              });\n            } else {\n              // no instance item, create\n              instance.createItemFromData(affectedItem);\n              const createdItem = instance.items[affectedItem.id];\n              // readd shapes\n              affectedItem.cameras.forEach((affectedCamera) => {\n                setupShape(createdItem, affectedCamera.camera);\n              });\n            }\n          });\n          if (instance.number !== affectedInstance.number) {\n            instance.number = affectedInstance.number;\n            Object.values(instance.items).forEach((item) => {\n              Object.keys(item.cameras).forEach((camera) => {\n                setupShape(item, camera);\n              });\n            });\n          }\n        } else {\n          // no instance, create\n          createInstanceFromData(affectedInstance);\n          const createdInstance = getInstanceById(affectedInstance.id);\n          affectedInstance.children.forEach((affectedItem) => {\n            const item = createdInstance.items[affectedItem.id];\n            // readd shapes\n            affectedItem.cameras.forEach((affectedCamera) => {\n              setupShape(item, affectedCamera.camera);\n            });\n          });\n        }\n      }\n    });\n\n    prev.frames?.forEach((affectedCamera) => {\n      const { camera, frames } = affectedCamera;\n      if (this.rootStore.frame.attributes[camera]) {\n        frames.forEach(({ frameIndex }) => {\n          delete this.rootStore.frame.attributes[camera][frameIndex];\n        });\n      }\n    });\n    curr.frames?.forEach((affectedCamera) => {\n      const { camera, frames } = affectedCamera;\n      if (!this.rootStore.frame.attributes[camera]) {\n        this.rootStore.frame.attributes[camera] = {};\n      }\n      frames.forEach(({ frameIndex, ...attributes }) => {\n        this.rootStore.frame.attributes[camera][frameIndex] = { frameIndex, ...attributes };\n      });\n    });\n\n    prev.reviews?.forEach((affectedReview) => {\n      const { id, frameIndex } = affectedReview;\n      const frameReviews = this.rootStore.review.reviews[frameIndex] || [];\n      const index = frameReviews.findIndex((r) => r.id === id);\n      if (index >= 0) {\n        frameReviews.splice(index, 1);\n      }\n      const { anchor } = this.rootStore.review.anchors[id] || {};\n      if (anchor) {\n        delete this.rootStore.review.anchors[id];\n        anchor.destroy();\n      }\n    });\n    curr.reviews?.forEach((affectedReview) => {\n      const { frameIndex, camera } = affectedReview;\n      const review = new ReviewItem(affectedReview);\n      if (!this.rootStore.review.reviews[frameIndex]) {\n        this.rootStore.review.reviews[frameIndex] = [];\n      }\n      this.rootStore.review.reviews[frameIndex].push(review);\n      if (frameIndex === currentFrame) {\n        const cameraView = this.rootStore.frame.cameraViews[camera];\n        if (cameraView && cameraView.reviewLayer) {\n          const anchor = this.rootStore.review.createReviewAnchor(review.result, review.x, review.y, cameraView.reviewLayer, cameraView.viewScale);\n          if (anchor) {\n            this.rootStore.review.anchors[review.id] = {\n              anchor,\n              camera,\n            };\n          }\n        }\n      }\n    });\n\n    // reselect instance or instance item\n    if (Object.keys(selectedInstanceMap).length > 0) {\n      const instances: MInstance[] = [];\n      const instanceItems: MInstanceItem[] = [];\n      Object.keys(selectedInstanceMap).forEach((instanceId) => {\n        const instance = getInstanceById(instanceId);\n        if (instance) {\n          instances.push(instance);\n          const itemIds = selectedInstanceMap[instanceId];\n          Object.values(instance.items).forEach((item) => {\n            if (itemIds.includes(item.id)) {\n              instanceItems.push(item);\n            }\n          });\n        }\n      });\n      if (instanceItems.length > 0) {\n        this.rootStore.instance.selectInstanceItem(instanceItems);\n      } else if (instances.length > 0) {\n        this.rootStore.instance.selectInstance(instances);\n      }\n    }\n    this.rootStore.shape.predict();\n\n    // reselect review item\n    if (this.rootStore.review.selectedReviewId) {\n      const review = this.rootStore.review.allReviews.find((r) => r.id === this.rootStore.review.selectedReviewId);\n      if (review) {\n        const { anchor } = this.rootStore.review.anchors[review.id] || {};\n        if (anchor) {\n          this.rootStore.review.selectReview(review, anchor);\n        }\n      }\n    }\n  };\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}