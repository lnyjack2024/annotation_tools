{"ast":null,"code":"import _initializerDefineProperty from \"/Users/qzheng/Documents/webroot/annotation_tools/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/initializerDefineProperty\";\nimport _applyDecoratedDescriptor from \"/Users/qzheng/Documents/webroot/annotation_tools/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/applyDecoratedDescriptor\";\nimport _initializerWarningHelper from \"/Users/qzheng/Documents/webroot/annotation_tools/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/initializerWarningHelper\";\nvar _class,\n  _class2,\n  _descriptor,\n  _descriptor2,\n  _jsxFileName = \"/Users/qzheng/Documents/webroot/annotation_tools/src/components/translation/components/Video.tsx\";\nimport React from 'react';\nimport { observable, makeObservable } from 'mobx';\nimport { observer } from 'mobx-react';\nimport Mousetrap from 'mousetrap';\nimport { Button } from 'antd';\nimport formatMessage from '../locales';\nimport './Video.scss';\nlet Video = observer(_class = (_class2 = class Video extends React.Component {\n  constructor(props) {\n    super(props);\n    this.videoRef = React.createRef();\n    _initializerDefineProperty(this, \"sourceText\", _descriptor, this);\n    _initializerDefineProperty(this, \"targetText\", _descriptor2, this);\n    /**\n     * video blur (fix Chrome video controls auto focus issue)\n     */\n    this.blur = () => {\n      var _this$videoRef$curren;\n      (_this$videoRef$curren = this.videoRef.current) === null || _this$videoRef$curren === void 0 ? void 0 : _this$videoRef$curren.blur();\n    };\n    /**\n     * video play\n     */\n    this.play = () => {\n      if (this.videoRef.current) {\n        this.videoRef.current.play();\n      }\n    };\n    /**\n     * video pause\n     */\n    this.pause = () => {\n      if (this.videoRef.current) {\n        this.videoRef.current.pause();\n      }\n    };\n    /**\n     * video play or pause according to the paused status\n     */\n    this.playPause = () => {\n      var _this$videoRef$curren2;\n      if ((_this$videoRef$curren2 = this.videoRef.current) === null || _this$videoRef$curren2 === void 0 ? void 0 : _this$videoRef$curren2.paused) {\n        this.play();\n      } else {\n        this.pause();\n      }\n    };\n    /**\n     * play video at specific time\n     * @param time\n     */\n    this.playAt = time => {\n      if (this.videoRef.current) {\n        this.videoRef.current.currentTime = time;\n        this.play();\n      }\n    };\n    /**\n     * find subtitle index\n     */\n    this.targetSubtitle = () => {\n      if (this.videoRef.current) {\n        return this.props.targetSubtitle(this.videoRef.current.currentTime);\n      }\n      return -1;\n    };\n    /**\n     * refresh subtitle text\n     */\n    this.refreshSubtitle = () => {\n      this.sourceText = '';\n      this.targetText = '';\n      const index = this.targetSubtitle();\n      if (index >= 0) {\n        const {\n          source = '',\n          target = ''\n        } = this.props.getSubtitleByIndex(index);\n        this.sourceText = source;\n        this.targetText = target;\n      }\n    };\n    this.handleTarget = () => {\n      const index = this.targetSubtitle();\n      if (index >= 0) {\n        this.props.targetCurrent(index);\n      }\n    };\n    makeObservable(this);\n  }\n  componentDidMount() {\n    Mousetrap.bind('space', event => {\n      event.preventDefault();\n      this.playPause();\n    });\n  }\n  componentWillUnmount() {\n    Mousetrap.unbind('space');\n  }\n  render() {\n    return /*#__PURE__*/React.createElement(\"div\", {\n      className: \"video-container\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 121,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(\"video\", {\n      ref: this.videoRef,\n      controls: true,\n      controlsList: \"nodownload\",\n      disablePictureInPicture: true,\n      onPlay: this.blur,\n      onPause: this.blur,\n      onTimeUpdate: this.refreshSubtitle,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 122,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(\"source\", {\n      src: this.props.url,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 131,\n        columnNumber: 11\n      }\n    })), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"video-subtitle\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 133,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 134,\n        columnNumber: 11\n      }\n    }, this.targetText), /*#__PURE__*/React.createElement(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 135,\n        columnNumber: 11\n      }\n    }, this.sourceText)), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"video-actions\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 137,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(Button, {\n      onClick: this.refreshSubtitle,\n      style: {\n        marginRight: 16\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 138,\n        columnNumber: 11\n      }\n    }, formatMessage('VIDEO_SUBTITLE_REFRESH')), /*#__PURE__*/React.createElement(Button, {\n      onClick: this.handleTarget,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 141,\n        columnNumber: 11\n      }\n    }, formatMessage('VIDEO_TARGET'))));\n  }\n}, _descriptor = _applyDecoratedDescriptor(_class2.prototype, \"sourceText\", [observable], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: function () {\n    return '';\n  }\n}), _descriptor2 = _applyDecoratedDescriptor(_class2.prototype, \"targetText\", [observable], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: function () {\n    return '';\n  }\n}), _class2)) || _class;\nexport default Video;","map":{"version":3,"names":["React","observable","makeObservable","observer","Mousetrap","Button","formatMessage","Video","_class","_class2","Component","constructor","props","videoRef","createRef","_initializerDefineProperty","_descriptor","_descriptor2","blur","_this$videoRef$curren","current","play","pause","playPause","_this$videoRef$curren2","paused","playAt","time","currentTime","targetSubtitle","refreshSubtitle","sourceText","targetText","index","source","target","getSubtitleByIndex","handleTarget","targetCurrent","componentDidMount","bind","event","preventDefault","componentWillUnmount","unbind","render","createElement","className","__self","__source","fileName","_jsxFileName","lineNumber","columnNumber","ref","controls","controlsList","disablePictureInPicture","onPlay","onPause","onTimeUpdate","src","url","onClick","style","marginRight","_applyDecoratedDescriptor","prototype","configurable","enumerable","writable","initializer"],"sources":["/Users/qzheng/Documents/webroot/annotation_tools/src/components/translation/components/Video.tsx"],"sourcesContent":["import React from 'react';\nimport { observable, makeObservable } from 'mobx';\nimport { observer } from 'mobx-react';\nimport Mousetrap from 'mousetrap';\nimport { Button } from 'antd';\nimport { Subtitle } from '../types';\nimport formatMessage from '../locales';\nimport './Video.scss';\n\ninterface VideoProps {\n  url: string;\n  targetCurrent: (current: number) => void;\n  targetSubtitle: (time: number) => number;\n  getSubtitleByIndex: (index: number) => Subtitle;\n}\n\n@observer\nclass Video extends React.Component<VideoProps> {\n  videoRef = React.createRef<HTMLVideoElement>();\n\n  @observable sourceText = '';\n\n  @observable targetText = '';\n\n  constructor(props: VideoProps) {\n    super(props);\n    makeObservable(this);\n  }\n\n  componentDidMount() {\n    Mousetrap.bind('space', (event) => {\n      event.preventDefault();\n      this.playPause();\n    });\n  }\n\n  componentWillUnmount() {\n    Mousetrap.unbind('space');\n  }\n\n  /**\n   * video blur (fix Chrome video controls auto focus issue)\n   */\n  blur = () => {\n    this.videoRef.current?.blur();\n  };\n\n  /**\n   * video play\n   */\n  play = () => {\n    if (this.videoRef.current) {\n      this.videoRef.current.play();\n    }\n  };\n\n  /**\n   * video pause\n   */\n  pause = () => {\n    if (this.videoRef.current) {\n      this.videoRef.current.pause();\n    }\n  };\n\n  /**\n   * video play or pause according to the paused status\n   */\n  playPause = () => {\n    if (this.videoRef.current?.paused) {\n      this.play();\n    } else {\n      this.pause();\n    }\n  };\n\n  /**\n   * play video at specific time\n   * @param time\n   */\n  playAt = (time: number) => {\n    if (this.videoRef.current) {\n      this.videoRef.current.currentTime = time;\n      this.play();\n    }\n  };\n\n  /**\n   * find subtitle index\n   */\n  targetSubtitle = () => {\n    if (this.videoRef.current) {\n      return this.props.targetSubtitle(this.videoRef.current.currentTime);\n    }\n    return -1;\n  };\n\n  /**\n   * refresh subtitle text\n   */\n  refreshSubtitle = () => {\n    this.sourceText = '';\n    this.targetText = '';\n    const index = this.targetSubtitle();\n    if (index >= 0) {\n      const { source = '', target = '' } = this.props.getSubtitleByIndex(index);\n      this.sourceText = source;\n      this.targetText = target;\n    }\n  };\n\n  handleTarget = () => {\n    const index = this.targetSubtitle();\n    if (index >= 0) {\n      this.props.targetCurrent(index);\n    }\n  };\n\n  render() {\n    return (\n      <div className=\"video-container\">\n        <video\n          ref={this.videoRef}\n          controls\n          controlsList=\"nodownload\"\n          disablePictureInPicture\n          onPlay={this.blur}\n          onPause={this.blur}\n          onTimeUpdate={this.refreshSubtitle}\n        >\n          <source src={this.props.url} />\n        </video>\n        <div className=\"video-subtitle\">\n          <div>{this.targetText}</div>\n          <div>{this.sourceText}</div>\n        </div>\n        <div className=\"video-actions\">\n          <Button onClick={this.refreshSubtitle} style={{ marginRight: 16 }}>\n            {formatMessage('VIDEO_SUBTITLE_REFRESH')}\n          </Button>\n          <Button onClick={this.handleTarget}>\n            {formatMessage('VIDEO_TARGET')}\n          </Button>\n        </div>\n      </div>\n    );\n  }\n}\n\nexport default Video;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}