{"ast":null,"code":"import _applyDecoratedDescriptor from \"/Users/qzheng/Documents/webroot/annotation_tools/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/applyDecoratedDescriptor\";\nvar _class,\n  _jsxFileName = \"/Users/qzheng/Documents/webroot/annotation_tools/src/components/phonetic-transcription/index.tsx\";\nimport React from 'react';\nimport { makeObservable, observable, action, toJS, computed } from 'mobx';\nimport { observer } from 'mobx-react';\nimport { notification } from 'antd';\nimport cx from 'classnames';\nimport ResizeObserver from 'resize-observer-polyfill';\nimport LayoutWrapper from '../common/layout/LayoutWrapper';\nimport AppWrapper from '../common/shapes/wrapper/AppWrapper';\nimport AutoSaver from '../common/AutoSaver';\nimport Toolbar from './components/Toolbar';\nimport Atlas from './components/Atlas';\nimport Ruler from './components/Helper/Ruler';\nimport Region from './components/Helper/Region';\nimport TabMenu from '../common/tabs-menu/TabMenu';\nimport Sidebar from './components/Sidebar';\nimport Validator from './components/Validator';\nimport Assist from './components/Helper/Assist';\nimport Tier from './components/TierPannel';\nimport Controls from './components/Controls';\nimport AttributesPannel from './components/Helper/AttributesPannel';\nimport ReviewPanel from './components/Helper/ReviewPanel';\nimport bindKeyboardEvents from './keyboard-events';\nimport i18n from './locales';\nimport { UpdateType, ReviewResult, ValidationType } from './types';\nimport store from './store/RootStore';\nimport { validate } from './utils';\nimport { methods } from './payload';\nimport './index.scss';\nexport let SpeechAnalysis = (_class = class SpeechAnalysis extends React.Component {\n  // eslint-disable-next-line class-methods-use-this\n  get ratioPlacement() {\n    const {\n      placement\n    } = store.analyse;\n    const newPlacement = {};\n    const keys = Object.keys(placement);\n    for (let i = 0; i < keys.length; i += 1) {\n      const key = keys[i];\n      if (key === 'duration') {\n        newPlacement[key] = placement[key];\n      } else {\n        newPlacement[key] = placement[key] * window.devicePixelRatio;\n      }\n    }\n    return newPlacement;\n  }\n  constructor(props) {\n    super(props);\n    /**\n     * auto saver reference\n     */\n    this.saverRef = React.createRef();\n    /**\n     * attributes reference\n     */\n    this.attrRef = React.createRef();\n    /**\n     * region reference\n     */\n    this.regionRef = React.createRef();\n    /**\n     * form reference\n     */\n    this.formRef = React.createRef();\n    /**\n     * analyse container reference\n     */\n    this.analyseContainer = React.createRef();\n    /**\n     * mouse position\n     */\n    this.mousePosition = {\n      x: 0,\n      y: 0,\n      mousedown: false\n    };\n    this.isDragTimeline = false;\n    this.resizeObserve = null;\n    /**\n     * keyboard events\n     */\n    this.removeKeyboardEvents = () => {};\n    this.handleMouseWheel = e => {\n      const {\n        placement: {\n          timelineHeight,\n          atlasHeight,\n          margin,\n          atlasWidth\n        },\n        annotationPanelHeight\n      } = store.analyse;\n      const {\n        y,\n        x\n      } = this.mousePosition;\n\n      // mouse on altas & tier\n      if (y > timelineHeight && y < timelineHeight + atlasHeight + annotationPanelHeight && x > margin && x < margin + atlasWidth) {\n        e.preventDefault();\n        let {\n          zoom\n        } = store.setting;\n        const {\n          precent\n        } = store.analyse.displayBuffer;\n        if (precent >= 1 && e.deltaY > 0) {\n          // scrollwidth === clientwidth\n          return;\n        }\n        let delta = 1;\n        zoom = Math.ceil(zoom);\n        if (zoom > 200) {\n          delta = 30;\n        } else if (zoom > 150) {\n          delta = 20;\n        } else if (zoom > 80) {\n          delta = 8;\n        } else if (zoom > 50) {\n          delta = 5;\n        } else if (zoom > 20) {\n          delta = 2;\n        }\n        if (e.deltaY < 0) {\n          zoom += delta;\n        } else if (e.deltaY > 0) {\n          zoom -= delta;\n        }\n        store.setting.setZoom(zoom);\n      }\n    };\n    /**\n     * trigger validation, return passed or not\n     */\n    this.triggerValidation = async () => {\n      const {\n        results,\n        hasCustomError\n      } = await this.getScriptResult();\n      const {\n        emptys,\n        hasEmptyError\n      } = this.emptyValidation();\n      const hasError = hasCustomError || hasEmptyError;\n      const errors = [...emptys, ...results];\n      store.review.setScriptResult({\n        results: errors,\n        hasCustomError\n      });\n      return !hasError && errors.length <= 0;\n    };\n    this.emptyValidation = () => {\n      const newInstances = Object.values(toJS(store.instance.instances));\n      const result = {\n        emptys: [],\n        hasEmptyError: false\n      };\n      if (store.checkMissingCharacter) {\n        for (let i = 0; i < newInstances.length; i += 1) {\n          const {\n            id,\n            category,\n            start,\n            text\n          } = newInstances[i];\n          if (!text) {\n            result.hasEmptyError = true;\n            const categoryInstances = store.instance.categoryInstancesMap[category];\n            const index = categoryInstances.findIndex(instance => instance.start === start);\n            result.emptys.push({\n              warningType: ValidationType.ATTR_EMPTY,\n              id,\n              message: i18n.translate('ERROR_INCOMPLETE', {\n                values: {\n                  category,\n                  index: index + 1\n                }\n              }),\n              frames: [],\n              blockSubmit: true\n            });\n          }\n        }\n        ;\n      }\n      return result;\n    };\n    this.onSave = async (submit = true) => {\n      var _this$saverRef$curren;\n      if (store.setting.loading || !store.jobProxy) {\n        const loadError = i18n.translate('ERROR_DATA_LOAD');\n        notification.error({\n          message: loadError\n        });\n        throw new Error(loadError);\n      }\n      (_this$saverRef$curren = this.saverRef.current) === null || _this$saverRef$curren === void 0 ? void 0 : _this$saverRef$curren.disableLeaveCheck();\n      if (submit) {\n        if (store.setting.submitCheck) {\n          // validate before submit\n          await this.triggerValidation();\n          if (store.review.blockSubmitErrors.length > 0) {\n            throw new Error(i18n.translate('SUBMIT_CHECK_FAIL'));\n          }\n        }\n      }\n      return store.saveResult(submit);\n    };\n    this.saveReviews = (type = 'submit') => {\n      var _this$saverRef$curren2;\n      if (type === 'submit') {\n        const hasSuspend = store.review.reviewsResult.find(review => review.result === ReviewResult.SUSPEND);\n        if (hasSuspend) {\n          throw new Error(i18n.translate('QC_SUSPEND_ERROR'));\n        }\n      }\n      (_this$saverRef$curren2 = this.saverRef.current) === null || _this$saverRef$curren2 === void 0 ? void 0 : _this$saverRef$curren2.disableLeaveCheck();\n      return store.saveReviews(type === 'submit');\n    };\n    /**\n     * get review statistics\n     */\n    this.getStatistics = () => {\n      const statShapes = {};\n      const objects = {\n        total: 0,\n        approved: 0,\n        rejected: 0,\n        suspended: 0,\n        missed: 0\n      };\n      const reviews = store.review.reviewsResult.filter(r => r.result !== ReviewResult.APPROVE);\n      const instancesList = Object.values(store.instance.instances).filter(v => !!v);\n      for (let i = 0; i < instancesList.length; i += 1) {\n        const {\n          id,\n          category\n        } = instancesList[i];\n        if (!statShapes[category]) {\n          statShapes[category] = {\n            rejected: 0,\n            approved: 0,\n            suspended: 0,\n            missed: 0,\n            total: 0\n          };\n        }\n        statShapes[category].total += 1;\n        objects.total += 1;\n        const review = reviews.find(r => r.instanceId === id);\n        if ((review === null || review === void 0 ? void 0 : review.result) === ReviewResult.REJECT) {\n          statShapes[category].rejected += 1;\n          objects.rejected += 1;\n        } else if ((review === null || review === void 0 ? void 0 : review.result) === ReviewResult.SUSPEND) {\n          statShapes[category].suspended += 1;\n          objects.suspended += 1;\n        } else {\n          statShapes[category].approved += 1;\n          objects.approved += 1;\n        }\n      }\n      return {\n        objects,\n        shapes: statShapes\n      };\n    };\n    this.handleSave = async () => {\n      if (store.isPreview) {\n        return;\n      }\n      try {\n        if (!store.readonly) {\n          await this.onSave(false);\n        }\n        if (store.review.isEnabled) {\n          await this.saveReviews('save');\n        }\n        notification.success({\n          message: i18n.translate('SAVE_SUCCESS')\n        });\n      } catch (e) {\n        notification.error({\n          message: i18n.translate('SAVE_FAIL')\n        });\n      }\n    };\n    this.handleUndo = () => {\n      if (!store.undo.undoDisabled) {\n        const item = store.undo.undo();\n        if (item && item.before) {\n          this.updateStatus(item.before, item.after);\n          notification.success({\n            message: 'Undo successfully.'\n          });\n        }\n      }\n    };\n    this.handleRedo = () => {\n      if (!store.undo.redoDisabled) {\n        const item = store.undo.redo();\n        if (item && item.after) {\n          this.updateStatus(item.after, item.before);\n          notification.success({\n            message: 'Redo successfully.'\n          });\n        }\n      }\n    };\n    this.updateStatus = (curr, prev) => {\n      curr.forEach(step => {\n        if (step.type === 'instance') {\n          store.instance.setUpdatedInstances(step.status, UpdateType.UNDOREDO);\n        } else if (step.type === 'review') {\n          store.review.updateReviews(step.status);\n        }\n      });\n    };\n    this.addInstance = index => {\n      var _store$ontology$categ;\n      const selectedCategoryName = index !== undefined ? (_store$ontology$categ = store.ontology.categories[index - 1]) === null || _store$ontology$categ === void 0 ? void 0 : _store$ontology$categ.className : store.ontology.selectedCategoryName;\n      const {\n        selectedTime,\n        selectedRegion\n      } = store.analyse;\n      const canAddTier = store.ontology.canAddTiers[selectedCategoryName];\n      if (canAddTier) {\n        if (selectedTime) {\n          store.instance.addInstance(selectedCategoryName, selectedTime);\n        } else if (selectedRegion) {\n          if (canAddTier) {\n            const {\n              start,\n              end\n            } = selectedRegion;\n            const time = [];\n            if (canAddTier.first) {\n              time.push(start);\n            }\n            if (canAddTier.second) {\n              time.push(end);\n            }\n            if (time.length) store.instance.addInstance(selectedCategoryName, time);\n          }\n        }\n      }\n    };\n    this.mouseDown = () => {\n      var _this$formRef$current;\n      const {\n        placement: {\n          timelineHeight,\n          margin,\n          atlasWidth,\n          atlasHeight\n        },\n        annotationPanelHeight\n      } = store.analyse;\n      const {\n        x,\n        y\n      } = this.mousePosition;\n      const viewHeight = timelineHeight + atlasHeight + annotationPanelHeight + (((_this$formRef$current = this.formRef.current) === null || _this$formRef$current === void 0 ? void 0 : _this$formRef$current.clientHeight) || 0) + 114;\n      if (x < margin || x > margin + atlasWidth || y > viewHeight) {\n        store.analyse.clearSelected();\n      }\n    };\n    this.mouseUp = () => {\n      this.isDragTimeline = false;\n    };\n    this.updateMousePostion = e => {\n      if (this.analyseContainer.current) {\n        const {\n          scrollTop\n        } = this.analyseContainer.current;\n        const bound = this.analyseContainer.current.getBoundingClientRect();\n        this.mousePosition = {\n          x: e.pageX - bound.x,\n          y: e.pageY - bound.y + scrollTop,\n          mousedown: e.buttons === 1\n        };\n      }\n    };\n    this.updateAnalyseWindowSize = () => {\n      const {\n        clientWidth,\n        clientHeight\n      } = this.analyseContainer.current;\n      const {\n        placement: {\n          margin\n        },\n        annotationPanelHeight\n      } = store.analyse;\n      const useableHeight = clientHeight - 140;\n      const atlasHeight = useableHeight - annotationPanelHeight;\n      store.analyse.updatePlacement({\n        atlasWidth: clientWidth - 2 * margin,\n        analyserHeight: clientHeight,\n        atlasHeight\n      });\n    };\n    this.getScriptResult = async () => {\n      var _store$jobProxy;\n      let resultLink = '';\n      if (store.setting.customCheck.length > 0 || store.setting.scriptCheck) {\n        if (typeof store.jobProxy.reviewFrom === 'string') {\n          resultLink = store.jobProxy.reviewFrom;\n        }\n        if (!store.readonly) {\n          try {\n            resultLink = await this.onSave(false);\n          } catch (e) {\n            resultLink = '';\n          }\n        }\n      }\n      const [result] = await Promise.all([validate(store.setting.customCheck, {\n        resultLink,\n        flowData: (_store$jobProxy = store.jobProxy) === null || _store$jobProxy === void 0 ? void 0 : _store$jobProxy.flowData\n      }), new Promise(resolve => {\n        setTimeout(resolve, 300);\n      })]);\n      return result || {\n        results: [],\n        hasCustomError: false\n      };\n    };\n    this.handleScreenFull = () => {\n      if (store.setting.screenfull.isEnabled) {\n        store.setting.screenfull.toggle();\n      }\n    };\n    this.reload = () => {\n      window.location.reload();\n    };\n    this.handleEnter = () => {\n      const {\n        ontology: {\n          selectedCategoryName,\n          canAddTiers\n        }\n      } = store;\n      if (canAddTiers[selectedCategoryName]) {\n        this.addInstance();\n      } else {\n        this.focusForm();\n      }\n    };\n    this.focusForm = () => {\n      var _this$attrRef$current;\n      (_this$attrRef$current = this.attrRef.current) === null || _this$attrRef$current === void 0 ? void 0 : _this$attrRef$current.handleFocus();\n    };\n    makeObservable(this, {\n      mousePosition: observable,\n      isDragTimeline: observable,\n      updateMousePostion: action,\n      mouseDown: action,\n      mouseUp: action\n    });\n    // set props\n    store.jobProxy = this.props.jobProxy;\n    i18n.setLocale(props.locale);\n  }\n  async componentDidMount() {\n    this.removeKeyboardEvents = bindKeyboardEvents(this);\n    // init store\n    try {\n      await store.init(this.props);\n    } catch (e) {\n      notification.error({\n        message: i18n.translate('ANNOTATION_DATA_LOAD_ERROR')\n      });\n      return;\n    }\n    // render completed\n    this.props.renderComplete();\n    if (this.analyseContainer.current) {\n      document.addEventListener('mousedown', this.mouseDown);\n      document.addEventListener('mouseup', this.mouseUp);\n      document.addEventListener('mousemove', this.updateMousePostion);\n      this.analyseContainer.current.addEventListener('wheel', this.handleMouseWheel);\n      this.resizeObserve = new ResizeObserver(() => {\n        this.updateAnalyseWindowSize();\n      });\n      this.resizeObserve.observe(this.analyseContainer.current);\n    }\n  }\n  componentWillUnmount() {\n    if (this.analyseContainer.current) {\n      document.removeEventListener('mousedown', this.mouseDown);\n      document.removeEventListener('mouseup', this.mouseUp);\n      document.removeEventListener('mousemove', this.updateMousePostion);\n      this.analyseContainer.current.removeEventListener('wheel', this.handleMouseWheel);\n    }\n    if (this.resizeObserve) {\n      this.resizeObserve.disconnect();\n      this.resizeObserve = null;\n    }\n  }\n  render() {\n    return /*#__PURE__*/React.createElement(LayoutWrapper, {\n      className: \"phonetic-transcription-app\",\n      loading: store.setting.loading,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 463,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(AutoSaver, {\n      ref: this.saverRef,\n      leaveCheck: true,\n      data: {\n        storePointer: store.undo.pointer\n      },\n      save: this.handleSave,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 464,\n        columnNumber: 9\n      }\n    }), /*#__PURE__*/React.createElement(Toolbar, {\n      readonly: store.setting.loading,\n      onSave: this.handleSave,\n      handleUndo: this.handleUndo,\n      handleRedo: this.handleRedo,\n      handleScreenFull: this.handleScreenFull,\n      reload: this.reload,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 470,\n        columnNumber: 9\n      }\n    }), store.initialized && /*#__PURE__*/React.createElement(\"div\", {\n      className: \"container\",\n      onContextMenu: e => e.preventDefault(),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 479,\n        columnNumber: 9\n      }\n    }, store.setting.sideBarVisible && /*#__PURE__*/React.createElement(TabMenu, {\n      tabs: [{\n        title: i18n.translate('MENU_REFERENCE'),\n        key: 'reference',\n        count: 0,\n        content: /*#__PURE__*/React.createElement(Sidebar, {\n          loading: store.setting.loading,\n          reference: this.props.reference,\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 488,\n            columnNumber: 21\n          }\n        })\n      }, {\n        title: i18n.translate('MENU_WARNING'),\n        key: 'validator',\n        count: store.review.warnings.length,\n        content: /*#__PURE__*/React.createElement(Validator, {\n          instances: {},\n          triggerValidation: this.triggerValidation,\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 499,\n            columnNumber: 21\n          }\n        })\n      }],\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 481,\n        columnNumber: 13\n      }\n    }), /*#__PURE__*/React.createElement(\"div\", {\n      className: cx('analyse-container', {\n        unfold: !store.setting.sideBarVisible\n      }),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 508,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"analyse-annotation\",\n      ref: this.analyseContainer,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 509,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(Atlas, {\n      selectedRegion: store.analyse.selectedRegion,\n      display: store.analyse.displayBuffer,\n      mousePosition: this.mousePosition,\n      isDragTimeline: this.isDragTimeline,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 510,\n        columnNumber: 15\n      }\n    }), /*#__PURE__*/React.createElement(Controls, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 516,\n        columnNumber: 15\n      }\n    }), /*#__PURE__*/React.createElement(Tier, {\n      app: this.props.app,\n      interactive: !store.setting.loading,\n      selectedInstance: store.instance.selectedInstance,\n      focusForm: this.focusForm,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 517,\n        columnNumber: 15\n      }\n    })), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"control-pannel\",\n      ref: this.formRef,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 524,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(AttributesPannel, {\n      ref: this.attrRef,\n      instance: store.instance.selectedInstance,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 525,\n        columnNumber: 15\n      }\n    }), /*#__PURE__*/React.createElement(ReviewPanel, {\n      instance: store.instance.selectedInstance,\n      review: store.review.selectedReview,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 526,\n        columnNumber: 15\n      }\n    })), /*#__PURE__*/React.createElement(Region, {\n      ref: this.regionRef,\n      ratioPlacement: this.ratioPlacement,\n      isDragTimeline: this.isDragTimeline,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 531,\n        columnNumber: 13\n      }\n    }), /*#__PURE__*/React.createElement(Assist, {\n      mousePosition: this.mousePosition,\n      ratioPlacement: this.ratioPlacement,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 536,\n        columnNumber: 13\n      }\n    }), /*#__PURE__*/React.createElement(Ruler, {\n      ratioPlacement: this.ratioPlacement,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 540,\n        columnNumber: 13\n      }\n    }))));\n  }\n}, _applyDecoratedDescriptor(_class.prototype, \"ratioPlacement\", [computed], Object.getOwnPropertyDescriptor(_class.prototype, \"ratioPlacement\"), _class.prototype), _class);\n;\nexport default AppWrapper(observer(SpeechAnalysis), {\n  mappingMethods: Object.values(methods)\n});","map":{"version":3,"names":["React","makeObservable","observable","action","toJS","computed","observer","notification","cx","ResizeObserver","LayoutWrapper","AppWrapper","AutoSaver","Toolbar","Atlas","Ruler","Region","TabMenu","Sidebar","Validator","Assist","Tier","Controls","AttributesPannel","ReviewPanel","bindKeyboardEvents","i18n","UpdateType","ReviewResult","ValidationType","store","validate","methods","SpeechAnalysis","_class","Component","ratioPlacement","placement","analyse","newPlacement","keys","Object","i","length","key","window","devicePixelRatio","constructor","props","saverRef","createRef","attrRef","regionRef","formRef","analyseContainer","mousePosition","x","y","mousedown","isDragTimeline","resizeObserve","removeKeyboardEvents","handleMouseWheel","e","timelineHeight","atlasHeight","margin","atlasWidth","annotationPanelHeight","preventDefault","zoom","setting","precent","displayBuffer","deltaY","delta","Math","ceil","setZoom","triggerValidation","results","hasCustomError","getScriptResult","emptys","hasEmptyError","emptyValidation","hasError","errors","review","setScriptResult","newInstances","values","instance","instances","result","checkMissingCharacter","id","category","start","text","categoryInstances","categoryInstancesMap","index","findIndex","push","warningType","ATTR_EMPTY","message","translate","frames","blockSubmit","onSave","submit","_this$saverRef$curren","loading","jobProxy","loadError","error","Error","current","disableLeaveCheck","submitCheck","blockSubmitErrors","saveResult","saveReviews","type","_this$saverRef$curren2","hasSuspend","reviewsResult","find","SUSPEND","getStatistics","statShapes","objects","total","approved","rejected","suspended","missed","reviews","filter","r","APPROVE","instancesList","v","instanceId","REJECT","shapes","handleSave","isPreview","readonly","isEnabled","success","handleUndo","undo","undoDisabled","item","before","updateStatus","after","handleRedo","redoDisabled","redo","curr","prev","forEach","step","setUpdatedInstances","status","UNDOREDO","updateReviews","addInstance","_store$ontology$categ","selectedCategoryName","undefined","ontology","categories","className","selectedTime","selectedRegion","canAddTier","canAddTiers","end","time","first","second","mouseDown","_this$formRef$current","viewHeight","clientHeight","clearSelected","mouseUp","updateMousePostion","scrollTop","bound","getBoundingClientRect","pageX","pageY","buttons","updateAnalyseWindowSize","clientWidth","useableHeight","updatePlacement","analyserHeight","_store$jobProxy","resultLink","customCheck","scriptCheck","reviewFrom","Promise","all","flowData","resolve","setTimeout","handleScreenFull","screenfull","toggle","reload","location","handleEnter","focusForm","_this$attrRef$current","handleFocus","setLocale","locale","componentDidMount","init","renderComplete","document","addEventListener","observe","componentWillUnmount","removeEventListener","disconnect","render","createElement","__self","__source","fileName","_jsxFileName","lineNumber","columnNumber","ref","leaveCheck","data","storePointer","pointer","save","initialized","onContextMenu","sideBarVisible","tabs","title","count","content","reference","warnings","unfold","display","app","interactive","selectedInstance","selectedReview","_applyDecoratedDescriptor","prototype","getOwnPropertyDescriptor","mappingMethods"],"sources":["/Users/qzheng/Documents/webroot/annotation_tools/src/components/phonetic-transcription/index.tsx"],"sourcesContent":["import React from 'react';\nimport { makeObservable, observable, action, toJS, computed } from 'mobx';\nimport { observer } from 'mobx-react';\nimport { Application } from 'pixi.js';\nimport { notification } from 'antd';\nimport cx from 'classnames';\nimport ResizeObserver from 'resize-observer-polyfill';\nimport LayoutWrapper from '../common/layout/LayoutWrapper';\nimport AppWrapper from '../common/shapes/wrapper/AppWrapper';\nimport AutoSaver from '../common/AutoSaver';\nimport Toolbar from './components/Toolbar';\nimport Atlas from './components/Atlas';\nimport Ruler from './components/Helper/Ruler';\nimport Region from './components/Helper/Region';\nimport TabMenu from '../common/tabs-menu/TabMenu';\nimport Sidebar from './components/Sidebar';\nimport Validator from './components/Validator';\nimport Assist from './components/Helper/Assist';\nimport Tier from './components/TierPannel';\nimport Controls from './components/Controls';\nimport AttributesPannel, { AttributesHandle } from './components/Helper/AttributesPannel';\nimport ReviewPanel from './components/Helper/ReviewPanel';\nimport bindKeyboardEvents from './keyboard-events';\nimport { Status } from './store/UndoStore';\nimport i18n from './locales';\nimport { Payload, UpdateType, ReviewResult, InstanceItem, ValidationType } from './types';\nimport { IWarning } from '../common/tabs-menu/Validator';\nimport store from './store/RootStore';\nimport { validate } from './utils';\nimport { methods } from './payload';\nimport './index.scss';\n\nexport interface SpeechAnalysisProps extends Payload {\n  app: Application;\n  renderComplete: () => Promise<void>;\n}\n\nexport class SpeechAnalysis extends React.Component<SpeechAnalysisProps> {\n  /**\n   * auto saver reference\n   */\n  saverRef = React.createRef<AutoSaver>();\n\n  /**\n   * attributes reference\n   */\n  attrRef = React.createRef<AttributesHandle>();\n\n  /**\n   * region reference\n   */\n  regionRef = React.createRef<Region>();\n\n  /**\n   * form reference\n   */\n  formRef: React.RefObject<HTMLDivElement> = React.createRef();\n\n  /**\n   * analyse container reference\n   */\n  analyseContainer: React.RefObject<HTMLDivElement> = React.createRef();\n\n  /**\n   * mouse position\n   */\n  mousePosition = {\n    x: 0,\n    y: 0,\n    mousedown: false,\n  };\n\n  isDragTimeline = false;\n\n  resizeObserve: ResizeObserver | null = null;\n\n  /**\n   * keyboard events\n   */\n  removeKeyboardEvents = () => {};\n\n  // eslint-disable-next-line class-methods-use-this\n  @computed get ratioPlacement() {\n    const { placement } = store.analyse;\n    const newPlacement:{[key:string]: number;} = {};\n    const keys = Object.keys(placement);\n    for (let i = 0; i < keys.length; i += 1) {\n      const key = keys[i];\n      if (key === 'duration') {\n        newPlacement[key] = placement[key];\n      } else {\n        newPlacement[key] = placement[key] * window.devicePixelRatio;\n      }\n    }\n    return newPlacement;\n  }\n\n  constructor(props: SpeechAnalysisProps) {\n    super(props);\n    makeObservable(this, {\n      mousePosition: observable,\n      isDragTimeline: observable,\n      updateMousePostion: action,\n      mouseDown: action,\n      mouseUp: action,\n    });\n    // set props\n    store.jobProxy = this.props.jobProxy;\n    i18n.setLocale(props.locale);\n  }\n\n  async componentDidMount() {\n    this.removeKeyboardEvents = bindKeyboardEvents(this);\n    // init store\n    try {\n      await store.init(this.props);\n    } catch (e) {\n      notification.error({ message: i18n.translate('ANNOTATION_DATA_LOAD_ERROR') });\n      return;\n    }\n    // render completed\n    this.props.renderComplete();\n    if (this.analyseContainer.current) {\n      document.addEventListener('mousedown', this.mouseDown);\n      document.addEventListener('mouseup', this.mouseUp);\n      document.addEventListener('mousemove', this.updateMousePostion);\n      this.analyseContainer.current.addEventListener('wheel', this.handleMouseWheel);\n      this.resizeObserve = new ResizeObserver(() => {\n        this.updateAnalyseWindowSize();\n      });\n      this.resizeObserve.observe(this.analyseContainer.current);\n    }\n  }\n\n  componentWillUnmount() {\n    if (this.analyseContainer.current) {\n      document.removeEventListener('mousedown', this.mouseDown);\n      document.removeEventListener('mouseup', this.mouseUp);\n      document.removeEventListener('mousemove', this.updateMousePostion);\n      this.analyseContainer.current.removeEventListener('wheel', this.handleMouseWheel);\n    }\n    if (this.resizeObserve) {\n      this.resizeObserve.disconnect();\n      this.resizeObserve = null;\n    }\n  }\n\n  handleMouseWheel = (e: WheelEvent) => {\n    const { placement: { timelineHeight, atlasHeight, margin, atlasWidth }, annotationPanelHeight } = store.analyse;\n    const { y, x } = this.mousePosition;\n\n    // mouse on altas & tier\n    if ((y > timelineHeight && y < timelineHeight + atlasHeight + annotationPanelHeight) && (x > margin && x < margin + atlasWidth)) {\n      e.preventDefault();\n      let { zoom } = store.setting;\n      const { precent } = store.analyse.displayBuffer;\n      if (precent >= 1 && e.deltaY > 0) { // scrollwidth === clientwidth\n        return;\n      }\n\n      let delta = 1;\n      zoom = Math.ceil(zoom);\n      if (zoom > 200) {\n        delta = 30;\n      } else if (zoom > 150) {\n        delta = 20;\n      } else if (zoom > 80) {\n        delta = 8;\n      } else if (zoom > 50) {\n        delta = 5;\n      } else if (zoom > 20) {\n        delta = 2;\n      }\n      if (e.deltaY < 0) {\n        zoom += delta;\n      } else if (e.deltaY > 0) {\n        zoom -= delta;\n      }\n\n      store.setting.setZoom(zoom);\n    }\n  };\n\n  /**\n   * trigger validation, return passed or not\n   */\n  triggerValidation = async () => {\n    const { results, hasCustomError } = await this.getScriptResult();\n    const { emptys, hasEmptyError } = this.emptyValidation();\n    const hasError = hasCustomError || hasEmptyError;\n    const errors = [...emptys, ...results];\n    store.review.setScriptResult({ results: errors, hasCustomError });\n    return !hasError && errors.length <= 0;\n  };\n\n  emptyValidation = () => {\n    const newInstances: InstanceItem[] = Object.values(toJS(store.instance.instances));\n    const result: { emptys: IWarning[], hasEmptyError: boolean, } = {\n      emptys: [],\n      hasEmptyError: false,\n    };\n    if (store.checkMissingCharacter) {\n      for (let i = 0; i < newInstances.length; i += 1) {\n        const { id, category, start, text } = newInstances[i];\n        if (!text) {\n          result.hasEmptyError = true;\n          const categoryInstances = store.instance.categoryInstancesMap[category];\n          const index = categoryInstances.findIndex((instance) => instance.start === start);\n          result.emptys.push({\n            warningType: ValidationType.ATTR_EMPTY,\n            id,\n            message: i18n.translate('ERROR_INCOMPLETE', {\n              values: {\n                category,\n                index: index + 1,\n              }\n            }),\n            frames: [],\n            blockSubmit: true,\n          });\n        }\n      };\n    }\n    return result;\n  };\n\n  onSave = async (submit = true) => {\n    if (store.setting.loading || !store.jobProxy) {\n      const loadError = i18n.translate('ERROR_DATA_LOAD');\n      notification.error({ message: loadError });\n      throw new Error(loadError);\n    }\n    this.saverRef.current?.disableLeaveCheck();\n    if (submit) {\n      if (store.setting.submitCheck) {\n        // validate before submit\n        await this.triggerValidation();\n        if (store.review.blockSubmitErrors.length > 0) {\n          throw new Error(i18n.translate('SUBMIT_CHECK_FAIL'));\n        }\n      }\n    }\n    return store.saveResult(submit);\n  };\n\n  saveReviews = (type = 'submit') => {\n    if (type === 'submit') {\n      const hasSuspend = store.review.reviewsResult.find((review) => review.result === ReviewResult.SUSPEND);\n      if (hasSuspend) {\n        throw new Error(i18n.translate('QC_SUSPEND_ERROR'));\n      }\n    }\n    this.saverRef.current?.disableLeaveCheck();\n    return store.saveReviews(type === 'submit');\n  };\n\n  /**\n   * get review statistics\n   */\n  getStatistics = () => {\n    const statShapes: {\n      [shape: string]: { rejected: number; approved: number, suspended: number, missed: number, total: number };\n    } = {};\n    const objects = {\n      total: 0,\n      approved: 0,\n      rejected: 0,\n      suspended: 0,\n      missed: 0,\n    };\n    const reviews = store.review.reviewsResult.filter((r) => r.result !== ReviewResult.APPROVE);\n    const instancesList = Object.values(store.instance.instances).filter((v) => !!v);\n    for (let i = 0; i < instancesList.length; i += 1) {\n      const { id, category } = instancesList[i];\n      if (!statShapes[category]) {\n        statShapes[category] = {\n          rejected: 0,\n          approved: 0,\n          suspended: 0,\n          missed: 0,\n          total: 0\n        };\n      }\n      statShapes[category].total += 1;\n      objects.total += 1;\n      const review = reviews.find((r) => r.instanceId === id);\n      if (review?.result === ReviewResult.REJECT) {\n        statShapes[category].rejected += 1;\n        objects.rejected += 1;\n      } else if (review?.result === ReviewResult.SUSPEND) {\n        statShapes[category].suspended += 1;\n        objects.suspended += 1;\n      } else {\n        statShapes[category].approved += 1;\n        objects.approved += 1;\n      }\n    }\n    return { objects, shapes: statShapes };\n  };\n\n  handleSave = async () => {\n    if (store.isPreview) {\n      return;\n    }\n\n    try {\n      if (!store.readonly) {\n        await this.onSave(false);\n      }\n      if (store.review.isEnabled) {\n        await this.saveReviews('save');\n      }\n      notification.success({ message: i18n.translate('SAVE_SUCCESS') });\n    } catch (e) {\n      notification.error({ message: i18n.translate('SAVE_FAIL') });\n    }\n  };\n\n  handleUndo = () => {\n    if (!store.undo.undoDisabled) {\n      const item = store.undo.undo();\n      if (item && item.before) {\n        this.updateStatus(item.before, item.after);\n        notification.success({ message: 'Undo successfully.' });\n      }\n    }\n  };\n\n  handleRedo = () => {\n    if (!store.undo.redoDisabled) {\n      const item = store.undo.redo();\n      if (item && item.after) {\n        this.updateStatus(item.after, item.before);\n        notification.success({ message: 'Redo successfully.' });\n      }\n    }\n  };\n\n  updateStatus = (curr: Status[], prev: Status[]) => {\n    curr.forEach((step) => {\n      if (step.type === 'instance') {\n        store.instance.setUpdatedInstances(step.status, UpdateType.UNDOREDO);\n      } else if (step.type === 'review') {\n        store.review.updateReviews(step.status);\n      }\n    });\n  };\n\n  addInstance = (index?: number) => {\n    const selectedCategoryName = index !== undefined ?\n      store.ontology.categories[index - 1]?.className :\n      store.ontology.selectedCategoryName;\n    const { selectedTime, selectedRegion } = store.analyse;\n    const canAddTier = store.ontology.canAddTiers[selectedCategoryName];\n    if (canAddTier) {\n      if (selectedTime) {\n        store.instance.addInstance(selectedCategoryName, selectedTime);\n      } else if (selectedRegion) {\n        if (canAddTier) {\n          const { start, end } = selectedRegion;\n          const time: number[] = [];\n          if (canAddTier.first) {\n            time.push(start);\n          }\n          if (canAddTier.second) {\n            time.push(end);\n          }\n          if (time.length) store.instance.addInstance(selectedCategoryName, time);\n        }\n      }\n    }\n  };\n\n  mouseDown = () => {\n    const { placement: { timelineHeight, margin, atlasWidth, atlasHeight }, annotationPanelHeight } = store.analyse;\n    const { x, y } = this.mousePosition;\n    const viewHeight = timelineHeight + atlasHeight + annotationPanelHeight + (this.formRef.current?.clientHeight || 0) + 114;\n    if (x < margin || x > (margin + atlasWidth) || y > viewHeight) {\n      store.analyse.clearSelected();\n    }\n  };\n\n  mouseUp = () => {\n    this.isDragTimeline = false;\n  };\n\n  updateMousePostion = (e: MouseEvent) => {\n    if (this.analyseContainer.current) {\n      const { scrollTop } = this.analyseContainer.current;\n      const bound = this.analyseContainer.current.getBoundingClientRect();\n      this.mousePosition = {\n        x: e.pageX - bound.x,\n        y: e.pageY - bound.y + scrollTop,\n        mousedown: e.buttons === 1,\n      };\n    }\n  };\n\n  updateAnalyseWindowSize = () => {\n    const { clientWidth, clientHeight } = this.analyseContainer.current as HTMLDivElement;\n    const { placement: { margin }, annotationPanelHeight } = store.analyse;\n    const useableHeight = clientHeight - 140;\n    const atlasHeight = useableHeight - annotationPanelHeight;\n    store.analyse.updatePlacement({\n      atlasWidth: clientWidth - (2 * margin),\n      analyserHeight: clientHeight,\n      atlasHeight,\n    });\n  };\n\n  getScriptResult = async () => {\n    let resultLink = '';\n    if (store.setting.customCheck.length > 0 || store.setting.scriptCheck) {\n      if (typeof store.jobProxy!.reviewFrom === 'string') {\n        resultLink = store.jobProxy!.reviewFrom;\n      }\n      if (!store.readonly) {\n        try {\n          resultLink = await this.onSave(false);\n        } catch (e) {\n          resultLink = '';\n        }\n      }\n    }\n\n    const [result] = await Promise.all([\n      validate(store.setting.customCheck, {\n        resultLink,\n        flowData: store.jobProxy?.flowData,\n      }),\n      new Promise((resolve) => {\n        setTimeout(resolve, 300);\n      }),\n    ]);\n    return result || { results: [], hasCustomError: false };\n  };\n\n  handleScreenFull = () => {\n    if (store.setting.screenfull.isEnabled) {\n      store.setting.screenfull.toggle();\n    }\n  };\n\n  reload = () => {\n    window.location.reload();\n  };\n\n  handleEnter = () => {\n    const { ontology: { selectedCategoryName, canAddTiers } } = store;\n    if (canAddTiers[selectedCategoryName]) {\n      this.addInstance();\n    } else {\n      this.focusForm();\n    }\n  };\n\n  focusForm = () => {\n    this.attrRef.current?.handleFocus();\n  };\n\n  render() {\n    return (\n      <LayoutWrapper className=\"phonetic-transcription-app\" loading={store.setting.loading}>\n        <AutoSaver\n          ref={this.saverRef}\n          leaveCheck\n          data={{ storePointer: store.undo.pointer }}\n          save={this.handleSave}\n        />\n        <Toolbar\n          readonly={store.setting.loading}\n          onSave={this.handleSave}\n          handleUndo={this.handleUndo}\n          handleRedo={this.handleRedo}\n          handleScreenFull={this.handleScreenFull}\n          reload={this.reload}\n        />\n        {store.initialized && (\n        <div className=\"container\" onContextMenu={(e) => e.preventDefault()}>\n          {store.setting.sideBarVisible && (\n            <TabMenu\n              tabs={[\n                {\n                  title: i18n.translate('MENU_REFERENCE'),\n                  key: 'reference',\n                  count: 0,\n                  content: (\n                    <Sidebar\n                      loading={store.setting.loading}\n                      reference={this.props.reference}\n                    />\n                  )\n                },\n                {\n                  title: i18n.translate('MENU_WARNING'),\n                  key: 'validator',\n                  count: store.review.warnings.length,\n                  content: (\n                    <Validator\n                      instances={{}}\n                      triggerValidation={this.triggerValidation}\n                    />\n                  )\n                }\n              ]}\n            />\n          )}\n          <div className={cx('analyse-container', { unfold: !store.setting.sideBarVisible })}>\n            <div className=\"analyse-annotation\" ref={this.analyseContainer}>\n              <Atlas\n                selectedRegion={store.analyse.selectedRegion}\n                display={store.analyse.displayBuffer}\n                mousePosition={this.mousePosition}\n                isDragTimeline={this.isDragTimeline}\n              />\n              <Controls />\n              <Tier\n                app={this.props.app}\n                interactive={!store.setting.loading}\n                selectedInstance={store.instance.selectedInstance}\n                focusForm={this.focusForm}\n              />\n            </div>\n            <div className=\"control-pannel\" ref={this.formRef}>\n              <AttributesPannel ref={this.attrRef} instance={store.instance.selectedInstance} />\n              <ReviewPanel\n                instance={store.instance.selectedInstance}\n                review={store.review.selectedReview}\n              />\n            </div>\n            <Region\n              ref={this.regionRef}\n              ratioPlacement={this.ratioPlacement}\n              isDragTimeline={this.isDragTimeline}\n            />\n            <Assist\n              mousePosition={this.mousePosition}\n              ratioPlacement={this.ratioPlacement}\n            />\n            <Ruler ratioPlacement={this.ratioPlacement} />\n          </div>\n        </div>\n        )}\n      </LayoutWrapper>\n    );\n  }\n};\nexport default AppWrapper(observer(SpeechAnalysis), {\n  mappingMethods: Object.values(methods),\n});\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}