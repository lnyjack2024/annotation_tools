{"ast":null,"code":"import{Container,Sprite,Texture,Graphics,Rectangle}from'pixi.js';import{v4 as uuidv4}from'uuid';import ShapeGraphics from'../../common/shapes/ShapeGraphics';import Layer from'../../common/shapes/Layer';import{hitTesting}from'../../common/shapes/utils';const ZOOM_MIN=0.25;const ZOOM_MAX=100;export let EventAction=/*#__PURE__*/function(EventAction){EventAction[\"SELECTED\"]=\"selected\";EventAction[\"POINTERDOWN\"]=\"pointer-down\";EventAction[\"SCALE_CHANGED\"]=\"scale-changed\";EventAction[\"POSITION_CHANGED\"]=\"position-changed\";return EventAction;}({});class View extends Container{/**\n   * get scale of view\n   * @getter\n   */get viewScale(){return this.stage.scale.x;}/**\n   * set scale of view\n   * @setter\n   */set viewScale(scale){this.stage.scale.set(scale);// update shapes scale\nconst setChildrenScale=children=>{children.forEach(child=>{if(child instanceof ShapeGraphics){// eslint-disable-next-line no-param-reassign\nchild.shape.scale=scale;}else if(child instanceof Container){setChildrenScale(child.children);}});};setChildrenScale(this.shapesLayer.children);this.emit(EventAction.SCALE_CHANGED,scale,this);}/**\n   * is right button clicked\n   * @private\n   */constructor(_ref){var _this;let{id,enableReview,enableSnap=true}=_ref;super();_this=this;/**\n   * view id\n   */this.id=void 0;/**\n   * view stage (similar with PIXI stage)\n   */this.stage=new Container();/**\n   * shapes layer\n   */this.shapesLayer=new Layer();/**\n   * review layer (for review anchors)\n   */this.reviewLayer=void 0;/**\n   * image sprite instance\n   */this.image=new Sprite(Texture.EMPTY);/**\n   * image load error\n   */this.imageLoadError=false;/**\n   * first imge loaded\n   */this.firstLoaded=false;/**\n   * view width (default 400)\n   */this.viewWidth=400;/**\n   * view height (default 300)\n   */this.viewHeight=300;/**\n   * zoom level, default is 1 when image fits the view\n   */this.viewZoom=1;this._rightClicked=false;/**\n   * click position when right button clicked\n   * @private\n   */this._rightClickPoint=null;/**\n   * stage position when right button clicked\n   * @private\n   */this._rightClickPosition=null;/**\n   * is view selected\n   */this.selected=false;/**\n   * view selected changed\n   */this._selectedChanged=false;/**\n   * is view hovered\n   */this.hovered=false;/**\n   * hovered shape\n   */this.hoveredShape=void 0;/**\n   * auto snape enabled\n   * @private\n   */this._autoSnapEnabled=true;/**\n   * process pointer down\n   * @param e\n   */this.processPointerDown=e=>{const selected=this.selected;this.emit(EventAction.SELECTED,e.data.originalEvent,this);this._selectedChanged=this.selected!==selected;if(this.imageLoadError){return;}if(e.data.button===2){const point=e.data.getLocalPosition(this);this._rightClicked=true;this._rightClickPoint=point;this._rightClickPosition=this.stage.position.clone();return;}const localPoint=e.data.getLocalPosition(this.stage);if(this._selectedChanged&&this.hovered){// if selected changed, should get cursor hovered shape\nthis.hitTest(e.data.global,localPoint,e.data.originalEvent.ctrlKey);if(this.hoveredShape){// if hovered, mock pointer down event for the shape\nthis.hoveredShape.processPointerDown(e);}}this.emit(EventAction.POINTERDOWN,localPoint,e.data.originalEvent,this);};/**\n   * process pointer move\n   * @param e\n   */this.processPointerMove=e=>{if(this.imageLoadError||!this.selected){return;}if(this._rightClicked&&this._rightClickPoint&&this._rightClickPosition){const point=e.data.getLocalPosition(this);const offsetX=point.x-this._rightClickPoint.x;const offsetY=point.y-this._rightClickPoint.y;const x=this._rightClickPosition.x+offsetX;const y=this._rightClickPosition.y+offsetY;this.setStagePosition(x,y);return;}if(this._selectedChanged&&this.hoveredShape){// not continue, current is moving shape\nreturn;}const localPoint=e.data.getLocalPosition(this.stage);if(this.hovered){this.hitTest(e.data.global,localPoint,e.data.originalEvent.ctrlKey);}};/**\n   * process pointer up\n   */this.processPointerUp=()=>{this._rightClicked=false;this._rightClickPoint=null;this._rightClickPosition=null;this._selectedChanged=false;};/**\n   * process pointer out\n   */this.processPointerOut=()=>{this.processPointerUp();this.setHoveredShape();};/**\n   * rotate\n   */this.rotate=()=>{if(this.image&&!this.imageLoadError){// set pivot\nconst{width,height}=this.image;this.image.pivot.set(width/2,height/2);// set position\nconst px=width/2;const py=height/2;const{x:ox,y:oy}=this.image.position;this.image.position.set(px,py);const offsetX=px-ox;const offsetY=py-oy;// update stage position\nconst{x,y}=this.getStagePosition();this.setStagePosition(x-offsetX*this.viewScale,y-offsetY*this.viewScale);}};/**\n   * zoom\n   * @param event\n   * @param zoomPoint\n   */this.zoom=function(event,zoomPoint){let step=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0.1;if(_this.imageLoadError||!_this.selected||!_this.hovered){return false;}event.stopPropagation();const zoomPointX=zoomPoint.x-_this.position.x;const zoomPointY=zoomPoint.y-_this.position.y;let newZoom=event.deltaY>0?_this.viewZoom/(1+step):_this.viewZoom*(1+step);newZoom=Math.max(Math.min(newZoom,ZOOM_MAX),ZOOM_MIN);const zoomScale=newZoom/_this.viewZoom;const{x,y}=_this.getStagePosition();_this.setStagePosition(zoomPointX-(zoomPointX-x)*zoomScale,zoomPointY-(zoomPointY-y)*zoomScale);_this.viewZoom=newZoom;_this.viewScale*=zoomScale;return true;};/**\n   * zoom to provided scale\n   * @param scale\n   */this.zoomTo=scale=>{if(this.imageLoadError){return;}const centerX=this.viewWidth/2;const centerY=this.viewHeight/2;let newZoom=this.viewZoom*(scale/this.viewScale);newZoom=Math.max(Math.min(newZoom,ZOOM_MAX),ZOOM_MIN);const zoomScale=newZoom/this.viewZoom;const{x,y}=this.getStagePosition();this.setStagePosition(centerX-(centerX-x)*zoomScale,centerY-(centerY-y)*zoomScale);this.viewZoom=newZoom;this.viewScale*=zoomScale;};/**\n   * fit image to canvas\n   */this.fitImageToView=()=>{if(this.imageLoadError){return;}const{width,height}=this.image;const imageWidth=width;const imageHeight=height;const viewRatio=this.viewWidth/this.viewHeight;const imgRatio=imageWidth/imageHeight;const scale=(viewRatio<imgRatio?this.viewWidth/imageWidth:this.viewHeight/imageHeight)*0.98;this.setStagePosition((this.viewWidth-scale*imageWidth)/2,(this.viewHeight-scale*imageHeight)/2);this.viewScale=scale;this.viewZoom=1;};/**\n   * fit shape to canvas\n   * @param bbox\n   * @param percentage\n   */this.fitShapeToView=function(bbox){let percentage=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0.98;if(_this.imageLoadError){return;}const{left,top,right,bottom}=bbox;const width=right-left;const height=bottom-top;if(width!==0&&height!==0){const oldViewScale=_this.viewScale;const viewRatio=_this.viewWidth/_this.viewHeight;const ratio=width/height;let scale=(viewRatio<ratio?_this.viewWidth/width:_this.viewHeight/height)*percentage;let zoomScale=scale/oldViewScale;let zoomLevel=Math.max(Math.min(_this.viewZoom*zoomScale,ZOOM_MAX),ZOOM_MIN);if(zoomLevel<1){zoomLevel=1;zoomScale=zoomLevel/_this.viewZoom;scale=zoomScale*oldViewScale;}_this.setStagePosition(_this.viewWidth/2-scale*(left+width/2),_this.viewHeight/2-scale*(top+height/2));_this.viewScale=scale;_this.viewZoom*=zoomScale;}};this.id=id||uuidv4();this.interactive=true;this.on('pointerover',()=>{this.hovered=true;});this.on('pointerout',()=>{this.hovered=false;});this.on('pointerdown',this.processPointerDown);this.on('pointermove',this.processPointerMove);this.on('pointerup',this.processPointerUp);this.on('pointerupoutside',this.processPointerUp);this.on('pointerout',this.processPointerOut);this.shapesLayer.sortableChildren=true;this.stage.addChild(this.shapesLayer);if(enableReview){this.reviewLayer=new Container();this.stage.addChild(this.reviewLayer);}this.stage.addChildAt(this.image,0);this.addChild(this.stage);this._autoSnapEnabled=enableSnap;}/**\n   * update position and size\n   * @param x\n   * @param y\n   * @param width\n   * @param height\n   */updatePositionAndSize(x,y,width,height){const positionUpdated=this.x!==x||this.y!==y;const sizeUpdated=this.viewWidth!==width||this.viewHeight!==height;this.x=x;this.y=y;this.viewWidth=width;this.viewHeight=height;this.hitArea=new Rectangle(0,0,width,height);if(positionUpdated||sizeUpdated){this.mask=new Graphics().beginFill(0x000000).drawRect(x,y,width,height).endFill();}}/**\n   * get stage position\n   */getStagePosition(){return{x:this.stage.x,y:this.stage.y};}/**\n   * set stage posistion\n   * @param x\n   * @param y\n   */setStagePosition(x,y){this.stage.x=x;this.stage.y=y;this.emit(EventAction.POSITION_CHANGED,{x,y},this);}/**\n   * set image\n   * @param texture\n   */setImage(texture){// this.image.cacheAsBitmap = false;\nif(this.image.texture){this.image.texture.destroy(true);}this.image.texture=texture;// this.image.cacheAsBitmap = true;\nthis.rotate();if(!this.firstLoaded){this.firstLoaded=true;this.fitImageToView();}}/**\n   * set hovered shape\n   * @param shape\n   */setHoveredShape(shape){if(shape===this.hoveredShape){return;}if(this.hoveredShape&&!this.hoveredShape.destroyed){this.hoveredShape.hovered=false;}this.hoveredShape=shape;if(this.hoveredShape){this.hoveredShape.hovered=true;}}/**\n   * hit test\n   * @param point\n   * @param localPoint\n   * @param ctrlKey\n   */hitTest(point,localPoint){let ctrlKey=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;if(ctrlKey){this.setHoveredShape();this.shapesLayer.setSnappingPoint(null);return;}const{intersection,snappingPoint}=hitTesting(point,localPoint,this.shapesLayer.children);this.setHoveredShape(intersection);this.shapesLayer.setSnappingPoint(this._autoSnapEnabled?snappingPoint:null);}}export default View;","map":{"version":3,"names":["Container","Sprite","Texture","Graphics","Rectangle","v4","uuidv4","ShapeGraphics","Layer","hitTesting","ZOOM_MIN","ZOOM_MAX","EventAction","View","viewScale","stage","scale","x","set","setChildrenScale","children","forEach","child","shape","shapesLayer","emit","SCALE_CHANGED","constructor","_ref","_this","id","enableReview","enableSnap","this","reviewLayer","image","EMPTY","imageLoadError","firstLoaded","viewWidth","viewHeight","viewZoom","_rightClicked","_rightClickPoint","_rightClickPosition","selected","_selectedChanged","hovered","hoveredShape","_autoSnapEnabled","processPointerDown","e","SELECTED","data","originalEvent","button","point","getLocalPosition","position","clone","localPoint","hitTest","global","ctrlKey","POINTERDOWN","processPointerMove","offsetX","offsetY","y","setStagePosition","processPointerUp","processPointerOut","setHoveredShape","rotate","width","height","pivot","px","py","ox","oy","getStagePosition","zoom","event","zoomPoint","step","arguments","length","undefined","stopPropagation","zoomPointX","zoomPointY","newZoom","deltaY","Math","max","min","zoomScale","zoomTo","centerX","centerY","fitImageToView","imageWidth","imageHeight","viewRatio","imgRatio","fitShapeToView","bbox","percentage","left","top","right","bottom","oldViewScale","ratio","zoomLevel","interactive","on","sortableChildren","addChild","addChildAt","updatePositionAndSize","positionUpdated","sizeUpdated","hitArea","mask","beginFill","drawRect","endFill","POSITION_CHANGED","setImage","texture","destroy","destroyed","setSnappingPoint","intersection","snappingPoint"],"sources":["/Users/qzheng/Documents/webroot/annotation_tools/src/components/video-tracking2/shapes/View.ts"],"sourcesContent":["import { Container, Sprite, Texture, Graphics, Point, Rectangle, DisplayObject, InteractionEvent } from 'pixi.js';\nimport { v4 as uuidv4 } from 'uuid';\nimport ShapeGraphics from '../../common/shapes/ShapeGraphics';\nimport Shape from '../../common/shapes/Shape';\nimport Layer from '../../common/shapes/Layer';\nimport { hitTesting } from '../../common/shapes/utils';\n\nconst ZOOM_MIN = 0.25;\nconst ZOOM_MAX = 100;\n\nexport enum EventAction {\n  SELECTED = 'selected',\n  POINTERDOWN = 'pointer-down',\n  SCALE_CHANGED = 'scale-changed',\n  POSITION_CHANGED = 'position-changed',\n}\n\ninterface ViewOptions {\n  id?: string;\n  enableReview?: boolean;\n  enableSnap?: boolean;\n}\n\nclass View extends Container {\n  /**\n   * view id\n   */\n  id: string;\n\n  /**\n   * view stage (similar with PIXI stage)\n   */\n  stage = new Container();\n\n  /**\n   * shapes layer\n   */\n  shapesLayer = new Layer();\n\n  /**\n   * review layer (for review anchors)\n   */\n  reviewLayer?: Container;\n\n  /**\n   * image sprite instance\n   */\n  image = new Sprite(Texture.EMPTY);\n\n  /**\n   * image load error\n   */\n  imageLoadError = false;\n\n  /**\n   * first imge loaded\n   */\n  firstLoaded = false;\n\n  /**\n   * view width (default 400)\n   */\n  viewWidth = 400;\n\n  /**\n   * view height (default 300)\n   */\n  viewHeight = 300;\n\n  /**\n   * zoom level, default is 1 when image fits the view\n   */\n  viewZoom = 1;\n\n  /**\n   * get scale of view\n   * @getter\n   */\n  get viewScale() {\n    return this.stage.scale.x;\n  }\n\n  /**\n   * set scale of view\n   * @setter\n   */\n  set viewScale(scale: number) {\n    this.stage.scale.set(scale);\n    // update shapes scale\n    const setChildrenScale = (children: DisplayObject[]) => {\n      children.forEach((child) => {\n        if (child instanceof ShapeGraphics) {\n          // eslint-disable-next-line no-param-reassign\n          child.shape.scale = scale;\n        } else if (child instanceof Container) {\n          setChildrenScale(child.children);\n        }\n      });\n    };\n    setChildrenScale(this.shapesLayer.children);\n\n    this.emit(EventAction.SCALE_CHANGED, scale, this);\n  }\n\n  /**\n   * is right button clicked\n   * @private\n   */\n  private _rightClicked = false;\n\n  /**\n   * click position when right button clicked\n   * @private\n   */\n  private _rightClickPoint: Point | null = null;\n\n  /**\n   * stage position when right button clicked\n   * @private\n   */\n  private _rightClickPosition: Point | null = null;\n\n  /**\n   * is view selected\n   */\n  selected = false;\n\n  /**\n   * view selected changed\n   */\n  private _selectedChanged = false;\n\n  /**\n   * is view hovered\n   */\n  hovered = false;\n\n  /**\n   * hovered shape\n   */\n  hoveredShape?: Shape<unknown>;\n\n  /**\n   * auto snape enabled\n   * @private\n   */\n  private _autoSnapEnabled = true;\n\n  constructor({ id, enableReview, enableSnap = true }: ViewOptions) {\n    super();\n    this.id = id || uuidv4();\n\n    this.interactive = true;\n    this.on('pointerover', () => {\n      this.hovered = true;\n    });\n    this.on('pointerout', () => {\n      this.hovered = false;\n    });\n    this.on('pointerdown', this.processPointerDown);\n    this.on('pointermove', this.processPointerMove);\n    this.on('pointerup', this.processPointerUp);\n    this.on('pointerupoutside', this.processPointerUp);\n    this.on('pointerout', this.processPointerOut);\n\n    this.shapesLayer.sortableChildren = true;\n    this.stage.addChild(this.shapesLayer);\n    if (enableReview) {\n      this.reviewLayer = new Container();\n      this.stage.addChild(this.reviewLayer);\n    }\n\n    this.stage.addChildAt(this.image, 0);\n    this.addChild(this.stage);\n\n    this._autoSnapEnabled = enableSnap;\n  }\n\n  /**\n   * process pointer down\n   * @param e\n   */\n  processPointerDown = (e: InteractionEvent) => {\n    const selected = this.selected;\n    this.emit(EventAction.SELECTED, e.data.originalEvent, this);\n    this._selectedChanged = this.selected !== selected;\n\n    if (this.imageLoadError) {\n      return;\n    }\n\n    if (e.data.button === 2) {\n      const point = e.data.getLocalPosition(this);\n      this._rightClicked = true;\n      this._rightClickPoint = point;\n      this._rightClickPosition = this.stage.position.clone();\n      return;\n    }\n\n    const localPoint = e.data.getLocalPosition(this.stage);\n    if (this._selectedChanged && this.hovered) {\n      // if selected changed, should get cursor hovered shape\n      this.hitTest(e.data.global, localPoint, e.data.originalEvent.ctrlKey);\n      if (this.hoveredShape) {\n        // if hovered, mock pointer down event for the shape\n        this.hoveredShape.processPointerDown(e);\n      }\n    }\n    this.emit(EventAction.POINTERDOWN, localPoint, e.data.originalEvent, this);\n  };\n\n  /**\n   * process pointer move\n   * @param e\n   */\n  processPointerMove = (e: InteractionEvent) => {\n    if (this.imageLoadError || !this.selected) {\n      return;\n    }\n\n    if (this._rightClicked && this._rightClickPoint && this._rightClickPosition) {\n      const point = e.data.getLocalPosition(this);\n      const offsetX = point.x - this._rightClickPoint.x;\n      const offsetY = point.y - this._rightClickPoint.y;\n      const x = this._rightClickPosition.x + offsetX;\n      const y = this._rightClickPosition.y + offsetY;\n      this.setStagePosition(x, y);\n      return;\n    }\n\n    if (this._selectedChanged && this.hoveredShape) {\n      // not continue, current is moving shape\n      return;\n    }\n\n    const localPoint = e.data.getLocalPosition(this.stage);\n\n    if (this.hovered) {\n      this.hitTest(e.data.global, localPoint, e.data.originalEvent.ctrlKey);\n    }\n  };\n\n  /**\n   * process pointer up\n   */\n  processPointerUp = () => {\n    this._rightClicked = false;\n    this._rightClickPoint = null;\n    this._rightClickPosition = null;\n    this._selectedChanged = false;\n  };\n\n  /**\n   * process pointer out\n   */\n  processPointerOut = () => {\n    this.processPointerUp();\n    this.setHoveredShape();\n  };\n\n  /**\n   * update position and size\n   * @param x\n   * @param y\n   * @param width\n   * @param height\n   */\n  updatePositionAndSize(x: number, y: number, width: number, height: number) {\n    const positionUpdated = this.x !== x || this.y !== y;\n    const sizeUpdated = this.viewWidth !== width || this.viewHeight !== height;\n    this.x = x;\n    this.y = y;\n    this.viewWidth = width;\n    this.viewHeight = height;\n    this.hitArea = new Rectangle(0, 0, width, height);\n    if (positionUpdated || sizeUpdated) {\n      this.mask = new Graphics()\n        .beginFill(0x000000)\n        .drawRect(x, y, width, height)\n        .endFill();\n    }\n  }\n\n  /**\n   * get stage position\n   */\n  getStagePosition() {\n    return {\n      x: this.stage.x,\n      y: this.stage.y,\n    };\n  }\n\n  /**\n   * set stage posistion\n   * @param x\n   * @param y\n   */\n  setStagePosition(x: number, y: number) {\n    this.stage.x = x;\n    this.stage.y = y;\n    this.emit(EventAction.POSITION_CHANGED, { x, y }, this);\n  }\n\n  /**\n   * set image\n   * @param texture\n   */\n  setImage(texture: Texture) {\n    // this.image.cacheAsBitmap = false;\n    if (this.image.texture) {\n      this.image.texture.destroy(true);\n    }\n    this.image.texture = texture;\n    // this.image.cacheAsBitmap = true;\n    this.rotate();\n    if (!this.firstLoaded) {\n      this.firstLoaded = true;\n      this.fitImageToView();\n    }\n  }\n\n  /**\n   * set hovered shape\n   * @param shape\n   */\n  setHoveredShape(shape?: Shape<unknown>) {\n    if (shape === this.hoveredShape) {\n      return;\n    }\n    if (this.hoveredShape && !this.hoveredShape.destroyed) {\n      this.hoveredShape.hovered = false;\n    }\n    this.hoveredShape = shape;\n    if (this.hoveredShape) {\n      this.hoveredShape.hovered = true;\n    }\n  }\n\n  /**\n   * hit test\n   * @param point\n   * @param localPoint\n   * @param ctrlKey\n   */\n  hitTest(point: Point, localPoint: Point, ctrlKey = false) {\n    if (ctrlKey) {\n      this.setHoveredShape();\n      this.shapesLayer.setSnappingPoint(null);\n      return;\n    }\n    const { intersection, snappingPoint } = hitTesting(point, localPoint, this.shapesLayer.children);\n    this.setHoveredShape(intersection);\n    this.shapesLayer.setSnappingPoint(this._autoSnapEnabled ? snappingPoint : null);\n  }\n\n  /**\n   * rotate\n   */\n  rotate = () => {\n    if (this.image && !this.imageLoadError) {\n      // set pivot\n      const { width, height } = this.image;\n      this.image.pivot.set(width / 2, height / 2);\n\n      // set position\n      const px = width / 2;\n      const py = height / 2;\n      const { x: ox, y: oy } = this.image.position;\n      this.image.position.set(px, py);\n      const offsetX = px - ox;\n      const offsetY = py - oy;\n\n      // update stage position\n      const { x, y } = this.getStagePosition();\n      this.setStagePosition(x - offsetX * this.viewScale, y - offsetY * this.viewScale);\n    }\n  };\n\n  /**\n   * zoom\n   * @param event\n   * @param zoomPoint\n   */\n  zoom = (event: WheelEvent, zoomPoint: Point, step = 0.1) => {\n    if (this.imageLoadError || !this.selected || !this.hovered) {\n      return false;\n    }\n    event.stopPropagation();\n    const zoomPointX = zoomPoint.x - this.position.x;\n    const zoomPointY = zoomPoint.y - this.position.y;\n    let newZoom = event.deltaY > 0 ? this.viewZoom / (1 + step) : this.viewZoom * (1 + step);\n    newZoom = Math.max(Math.min(newZoom, ZOOM_MAX), ZOOM_MIN);\n    const zoomScale = newZoom / this.viewZoom;\n    const { x, y } = this.getStagePosition();\n    this.setStagePosition(zoomPointX - (zoomPointX - x) * zoomScale, zoomPointY - (zoomPointY - y) * zoomScale);\n    this.viewZoom = newZoom;\n    this.viewScale *= zoomScale;\n    return true;\n  };\n\n  /**\n   * zoom to provided scale\n   * @param scale\n   */\n  zoomTo = (scale: number) => {\n    if (this.imageLoadError) {\n      return;\n    }\n    const centerX = this.viewWidth / 2;\n    const centerY = this.viewHeight / 2;\n    let newZoom = this.viewZoom * (scale / this.viewScale);\n    newZoom = Math.max(Math.min(newZoom, ZOOM_MAX), ZOOM_MIN);\n    const zoomScale = newZoom / this.viewZoom;\n    const { x, y } = this.getStagePosition();\n    this.setStagePosition(centerX - (centerX - x) * zoomScale, centerY - (centerY - y) * zoomScale);\n    this.viewZoom = newZoom;\n    this.viewScale *= zoomScale;\n  };\n\n  /**\n   * fit image to canvas\n   */\n  fitImageToView = () => {\n    if (this.imageLoadError) {\n      return;\n    }\n    const { width, height } = this.image;\n    const imageWidth = width;\n    const imageHeight = height;\n    const viewRatio = this.viewWidth / this.viewHeight;\n    const imgRatio = imageWidth / imageHeight;\n    const scale = (viewRatio < imgRatio ? this.viewWidth / imageWidth : this.viewHeight / imageHeight) * 0.98;\n    this.setStagePosition((this.viewWidth - scale * imageWidth) / 2, (this.viewHeight - scale * imageHeight) / 2);\n    this.viewScale = scale;\n    this.viewZoom = 1;\n  };\n\n  /**\n   * fit shape to canvas\n   * @param bbox\n   * @param percentage\n   */\n  fitShapeToView = (bbox: { left: number; top: number; right: number; bottom: number }, percentage = 0.98) => {\n    if (this.imageLoadError) {\n      return;\n    }\n    const { left, top, right, bottom } = bbox;\n    const width = right - left;\n    const height = bottom - top;\n    if (width !== 0 && height !== 0) {\n      const oldViewScale = this.viewScale;\n      const viewRatio = this.viewWidth / this.viewHeight;\n      const ratio = width / height;\n      let scale = (viewRatio < ratio ? this.viewWidth / width : this.viewHeight / height) * percentage;\n      let zoomScale = scale / oldViewScale;\n      let zoomLevel = Math.max(Math.min(this.viewZoom * zoomScale, ZOOM_MAX), ZOOM_MIN);\n      if (zoomLevel < 1) {\n        zoomLevel = 1;\n        zoomScale = zoomLevel / this.viewZoom;\n        scale = zoomScale * oldViewScale;\n      }\n      this.setStagePosition(this.viewWidth / 2 - scale * (left + width / 2), this.viewHeight / 2 - scale * (top + height / 2));\n      this.viewScale = scale;\n      this.viewZoom *= zoomScale;\n    }\n  };\n}\n\nexport default View;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}