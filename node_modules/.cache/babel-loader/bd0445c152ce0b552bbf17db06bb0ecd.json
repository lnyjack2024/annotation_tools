{"ast":null,"code":"import{makeAutoObservable}from'mobx';import ReviewItem from'../model/ReviewItem';import{ReviewMode,ReviewResult}from'../types';import{TOOLBAR_HEIGHT,SIDEBAR_WIDTH}from'../constants';import{getToolTypeFromFrameData}from'../utils';import{ToolMode}from'../../../utils/tool-mode';import Anchor,{EventAction}from'../../common/shapes/anchors/Anchor';import Cursor from'../../common/Cursor';import ApproveIcon from'../images/approve.png';import RejectIcon from'../images/reject.png';import SuspendIcon from'../images/suspend.png';import ApproveSelectedIcon from'../images/approve_selected.png';import RejectSelectedIcon from'../images/reject_selected.png';import SuspendSelectedIcon from'../images/suspend_selected.png';function getIconByReviewResultType(type){switch(type){case ReviewResult.APPROVE:return{icon:ApproveIcon,selectedIcon:ApproveSelectedIcon};case ReviewResult.REJECT:return{icon:RejectIcon,selectedIcon:RejectSelectedIcon};case ReviewResult.SUSPEND:return{icon:SuspendIcon,selectedIcon:SuspendSelectedIcon};default:}return{};}function getReviewResultSummary(reviews){const allResults=new Set(reviews.map(r=>r.result));if(allResults.has(ReviewResult.REJECT)){return ReviewResult.REJECT;}if(allResults.has(ReviewResult.SUSPEND)){return ReviewResult.SUSPEND;}if(allResults.has(ReviewResult.APPROVE)){return ReviewResult.APPROVE;}return undefined;}/**\n * store for reviews\n * @class\n */export default class ReviewsStore{/**\n   * review result types based on tool mode\n   * @getter\n   */get reviewResultTypes(){return this.rootStore.jobProxy.toolMode===ToolMode.AUDIT?[ReviewResult.APPROVE,ReviewResult.REJECT,ReviewResult.SUSPEND]:[ReviewResult.APPROVE,ReviewResult.REJECT];}/**\n   * all reviews\n   * @getter\n   */get allReviews(){return Object.values(this.reviews).flatMap(frameReviews=>frameReviews);}/**\n   * warnings count\n   * @getter\n   */get warningCount(){const reviews=this.rootStore.review.allReviews.filter(r=>r.result===ReviewResult.REJECT);return reviews.length;}constructor(rootStore){/**\n   * root store\n   */this.rootStore=void 0;/**\n   * issue types\n   */this.issueTypes=[];/**\n   * all reviews\n   */this.reviews={};/**\n   * layer for reviews\n   */this.reviewLayer=void 0;/**\n   * review layer offset (according to document body)\n   */this.reviewLayerOffset={x:SIDEBAR_WIDTH,y:TOOLBAR_HEIGHT*2};/**\n   * review anchors\n   */this.anchors={};/**\n   * selected review id\n   */this.selectedReviewId='';/**\n   * selected anchor\n   */this.selectedAnchor=null;/**\n   * selected review result type (default is approve)\n   */this.selectedReviewResultType=ReviewResult.APPROVE;/**\n   * is adding review anchor\n   */this.addMode=false;/**\n   * current editing review instance\n   */this.editingReview=null;/**\n   * current hovered review instance\n   */this.hoveredReview=null;/**\n   * hovered anchor\n   */this.hoveredAnchor=null;/**\n   * store id preserved before review edit\n   */this.reviewStoreId='';makeAutoObservable(this,{rootStore:false,reviewLayer:false,reviewLayerOffset:false,anchors:false,selectedReviewId:false,selectedAnchor:false,reviewStoreId:false},{autoBind:true});this.rootStore=rootStore;}/**\n   * init from paylod\n   * @param payload\n   * @param initialReviews\n   */init(payload,initialReviews){if(typeof payload.issue_types==='string'){this.issueTypes=payload.issue_types.split(',').map(i=>i.trim()).filter(i=>!!i);}if(!this.rootStore.isLabeling&&initialReviews&&Array.isArray(initialReviews)){const reviews={};initialReviews.forEach(review=>{const{frameIndex}=review;if(!reviews[frameIndex]){reviews[frameIndex]=[];}const reviewItem=new ReviewItem(review);reviews[frameIndex].push(reviewItem);});this.reviews=reviews;}}/**\n   * get review in current frame by instance item\n   * @param instanceItem\n   * @param camera\n   */getReviewForInstanceItem(instanceItem){let camera=arguments.length>1&&arguments[1]!==undefined?arguments[1]:this.rootStore.frame.currentCamera;let frameIndex=arguments.length>2&&arguments[2]!==undefined?arguments[2]:this.rootStore.frame.currentFrame;if(instanceItem){if(this.reviews[frameIndex]){const reviews=this.reviews[frameIndex].filter(r=>r.camera===camera&&r.instanceItemId===instanceItem.id);return getReviewResultSummary(reviews);}}return undefined;}/**\n   * get total review result for instance item\n   * @param instanceItem\n   * @param camera\n   */getReviewResultForInstanceItem(instanceItem){let camera=arguments.length>1&&arguments[1]!==undefined?arguments[1]:this.rootStore.frame.currentCamera;const reviews=this.allReviews.filter(r=>r.camera===camera&&r.instanceItemId===instanceItem.id);return getReviewResultSummary(reviews);}/**\n   * get total review result for instance\n   * @param instance\n   */getReviewResultForInstance(instance){const reviews=this.allReviews.filter(r=>r.instanceId===instance.id);return getReviewResultSummary(reviews);}/**\n   * get instances json data (for save)\n   */reviewsJSON(){return Object.values(this.reviews).flatMap(reviews=>reviews.map(r=>r.toJSON()));}/**\n   * get review statistics\n   */getReviewStatistics(){const approvedFrameSet=new Set();const rejectedFrameSet=new Set();const rejectedElements=new Set();const issueMap={};const approvedEleMap={};const rejectedEleMap={};const{instances}=this.rootStore.instance;Object.values(this.reviews).forEach(reviews=>{reviews.forEach(review=>{const{result,type,instanceId,instanceItemId,camera,frameIndex}=review;if(result===ReviewResult.REJECT){// reject\nlet eleKey='';if(instanceId&&instanceItemId){var _instances$instanceId,_instances$instanceId2,_instances$instanceId3;if((_instances$instanceId=instances[instanceId])===null||_instances$instanceId===void 0?void 0:(_instances$instanceId2=_instances$instanceId.items[instanceItemId])===null||_instances$instanceId2===void 0?void 0:(_instances$instanceId3=_instances$instanceId2.cameras[camera])===null||_instances$instanceId3===void 0?void 0:_instances$instanceId3.frames[frameIndex]){// shape exists\neleKey=\"\".concat(instanceId,\"-\").concat(instanceItemId,\"-\").concat(camera,\"-\").concat(frameIndex);}}rejectedFrameSet.add(frameIndex);if(eleKey){rejectedElements.add(eleKey);}type===null||type===void 0?void 0:type.forEach(t=>{if(!issueMap[t]){issueMap[t]={count:0,eleSet:new Set()};}issueMap[t].count+=1;if(eleKey){issueMap[t].eleSet.add(eleKey);}});}else{// approve, or suspend\napprovedFrameSet.add(frameIndex);}});});// filter out rejected frames\nnew Set(approvedFrameSet).forEach(frame=>{if(rejectedFrameSet.has(frame)){approvedFrameSet.delete(frame);}});const allInstances=Object.values(instances);for(let i=0;i<allInstances.length;i+=1){const instance=allInstances[i];const items=Object.values(instance.items);for(let j=0;j<items.length;j+=1){const item=items[j];const cameras=Object.values(item.cameras);for(let k=0;k<cameras.length;k+=1){const camera=cameras[k];const frames=Object.values(camera.frames);for(let l=0;l<frames.length;l+=1){const frame=frames[l];const shape=getToolTypeFromFrameData(frame);if(shape){const{frameIndex}=frame;const eleKey=\"\".concat(instance.id,\"-\").concat(item.id,\"-\").concat(camera.camera,\"-\").concat(frameIndex);if(rejectedElements.has(eleKey)){// shape rejected\nif(!rejectedEleMap[shape]){rejectedEleMap[shape]=0;}rejectedEleMap[shape]+=1;}else if(approvedFrameSet.has(frameIndex)||rejectedFrameSet.has(frameIndex)){// shape approved\n// or not reviewed but in frames with review status\nif(!approvedEleMap[shape]){approvedEleMap[shape]=0;}approvedEleMap[shape]+=1;}}}}}}return{issues:Object.keys(issueMap).reduce((acc,curr)=>{const{count,eleSet}=issueMap[curr];acc[curr]={count,elements:eleSet.size};return acc;},{}),frames:{approved:approvedFrameSet.size,rejected:rejectedFrameSet.size},elements:{approved:{...approvedEleMap},rejected:{...rejectedEleMap}}};}/**\n   * set layer for review anchors\n   * @param layer\n   */setReviewLayer(layer){this.reviewLayer=layer;}/**\n   * set layer offset\n   * @param x\n   * @param y\n   */setReviewLayerOffset(x,y){this.reviewLayerOffset.x=x;this.reviewLayerOffset.y=y;}/**\n   * setup anchors in current frame & current camera\n   */setupReviewAnchors(){this.clearAnchors();const{cameraViews,currentFrame}=this.rootStore.frame;(this.reviews[currentFrame]||[]).forEach(review=>{const{id,camera,result,x,y}=review;if(!this.rootStore.isRework||result===ReviewResult.REJECT){// only show reject anchors when rework\nconst cameraView=cameraViews[camera];if(cameraView&&cameraView.reviewLayer){const anchor=this.createReviewAnchor(result,x,y,cameraView.reviewLayer,cameraView.viewScale);if(anchor){this.anchors[id]={anchor,camera};}}}});}/**\n   * create anchor instance\n   * @param type\n   * @param x\n   * @param y\n   * @param container\n   * @param viewScale\n   */createReviewAnchor(type,x,y){let container=arguments.length>3&&arguments[3]!==undefined?arguments[3]:this.reviewLayer;let viewScale=arguments.length>4&&arguments[4]!==undefined?arguments[4]:this.rootStore.config.viewScale;if(container){const{icon,selectedIcon}=getIconByReviewResultType(type);if(icon&&selectedIcon){const anchor=new Anchor({container,scale:viewScale,x,y,img:icon,selectedImg:selectedIcon});this.addAnchorListeners(anchor);return anchor;}}return null;}/**\n   * get review instance by anchor instance\n   * @param anchor\n   */getReviewByAnchor(anchor){const reviewId=Object.keys(this.anchors).find(id=>this.anchors[id].anchor===anchor);if(reviewId){return this.reviews[this.rootStore.frame.currentFrame].find(r=>r.id===reviewId);}return undefined;}/**\n   * add listeners for anchor\n   * @param anchor\n   */addAnchorListeners(anchor){anchor.on(EventAction.SELECTED,a=>{if(this.addMode){return;}const review=this.getReviewByAnchor(a);if(review){this.selectReview(review,a);// select related instance\nlet instance;let instanceItem;if(review.instanceId){instance=this.rootStore.instance.getInstanceById(review.instanceId);if(instance&&review.instanceItemId){instanceItem=instance.items[review.instanceItemId];}}if(instanceItem){this.rootStore.instance.selectInstanceItem(instanceItem);}else if(instance){this.rootStore.instance.selectInstance(instance);}// open modal in review mode\nif(this.rootStore.config.reviewMode===ReviewMode.REVIEW){this.reviewStoreId=this.rootStore.undo.preserve({reviews:[review.toJSON()]});this.setEditingReview(review);this.rootStore.config.setReviewModalVisible(true);}}});anchor.on(EventAction.POINTER_OVER,a=>{if(this.rootStore.config.reviewMode===ReviewMode.LABELING){// only show comment in labeling mode\nconst review=this.getReviewByAnchor(a);if(review){this.setHoveredReview(review,a);}}});anchor.on(EventAction.POINTER_OUT,()=>{this.setHoveredReview(null,null);});}/**\n   * set editing review\n   * @param review\n   */setEditingReview(review){this.editingReview=review;}/**\n   * set hovered review\n   * @param review\n   */setHoveredReview(review,anchor){this.hoveredReview=review;this.hoveredAnchor=anchor;}/**\n   * select review\n   * @param review\n   * @param anchor\n   */selectReview(review,anchor){if(this.selectedAnchor&&this.selectedAnchor!==anchor){this.selectedAnchor.selected=false;}this.selectedReviewId=review.id;this.selectedAnchor=anchor;this.selectedAnchor.selected=true;}/**\n   * unselect review\n   */unselectReview(){if(this.selectedAnchor){this.selectedAnchor.selected=false;}this.selectedReviewId='';this.selectedAnchor=null;}/**\n   * clear all anchors\n   */clearAnchors(){Object.values(this.anchors).forEach(_ref=>{let{anchor}=_ref;anchor.destroy();});this.anchors={};this.selectedReviewId='';this.selectedAnchor=null;this.setEditingReview(null);this.setHoveredReview(null,null);this.reviewStoreId='';}/**\n   * get anchors for camera\n   * @param camera\n   */getAnchorsForCamera(){let camera=arguments.length>0&&arguments[0]!==undefined?arguments[0]:this.rootStore.frame.currentCamera;return Object.values(this.anchors).filter(i=>i.camera===camera);}/**\n   * update anchors' scale\n   * @param scale\n   */updateAnchorsScale(scale){this.getAnchorsForCamera().forEach(_ref2=>{let{anchor}=_ref2;anchor.setScale(scale);});}/**\n   * update anchors' interactive\n   * @param interactive\n   */updateAnchorsInteractive(interactive){Object.values(this.anchors).forEach(_ref3=>{let{anchor}=_ref3;anchor.interactive=interactive;});}/**\n   * activate review tool\n   * @param type\n   */activateReview(type){this.selectedReviewResultType=type;this.setAddMode(true);}/**\n   * activate review tool by hotkey\n   * @param hotkey\n   */activateReviewByHotkey(hotkey){if(hotkey===1){// approve\nthis.activateReview(ReviewResult.APPROVE);}else if(hotkey===2){// reject\nthis.activateReview(ReviewResult.REJECT);}else if(hotkey===3){// suspend\nthis.activateReview(ReviewResult.SUSPEND);}}/**\n   * set review add mode\n   * @param addMode\n   */setAddMode(addMode){this.addMode=addMode;this.rootStore.config.cursor=addMode?Cursor.POINTER:Cursor.DEFAULT;this.updateAnchorsInteractive(!addMode);}/**\n   * add review when click canvas\n   * @param point\n   * @param layer\n   * @param viewScale\n   */addReview(point){let layer=arguments.length>1&&arguments[1]!==undefined?arguments[1]:this.reviewLayer;let viewScale=arguments.length>2&&arguments[2]!==undefined?arguments[2]:this.rootStore.config.viewScale;if(this.addMode){let instanceId;let instanceItemId;const{isSingleSelected,selectedInstances,selectedInstanceItems}=this.rootStore.instance;if(isSingleSelected){// link to the shape\ninstanceItemId=selectedInstanceItems[0].id;instanceId=selectedInstances[0].id;}const anchor=this.createReviewAnchor(this.selectedReviewResultType,point.x,point.y,layer,viewScale);if(anchor){const{currentCamera,currentFrame}=this.rootStore.frame;const review=new ReviewItem({camera:currentCamera,frameIndex:currentFrame,result:this.selectedReviewResultType,instanceId,instanceItemId,position:{x:point.x,y:point.y}});this.anchors[review.id]={anchor,camera:currentCamera};this.selectReview(review,anchor);this.setAddMode(false);if(review.result===ReviewResult.REJECT){// open modal\nthis.reviewStoreId=this.rootStore.undo.preserve();this.setEditingReview(review);this.rootStore.config.setReviewModalVisible(true);}else{// save directly\nthis.insertReview(review);this.unselectReview();}return anchor;}}return null;}/**\n   * insert review\n   * @param review\n   */insertReview(review){const storeId=this.rootStore.undo.preserve();const{frameIndex}=review;if(!this.reviews[frameIndex]){this.reviews[frameIndex]=[];}this.reviews[frameIndex].push(review);this.rootStore.undo.save(storeId,{reviews:[review.toJSON()]});}/**\n   * update review\n   * @param review\n   */updateReview(review){if(this.reviewStoreId){const{frameIndex}=review;if(!this.reviews[frameIndex]){this.reviews[frameIndex]=[];}if(this.reviews[frameIndex].indexOf(review)<0){this.reviews[frameIndex].push(review);}this.rootStore.undo.save(this.reviewStoreId,{reviews:[review.toJSON()]});this.reviewStoreId='';}}/**\n   * delete review\n   * @param review\n   * @param anchor\n   */deleteReview(review,anchor){const{id,frameIndex}=review;const frameReviews=this.reviews[frameIndex]||[];const index=frameReviews.findIndex(r=>r.id===id);let existed=false;if(index>=0){existed=true;frameReviews.splice(index,1);}anchor.destroy();if(this.anchors[id]){delete this.anchors[id];}if(existed&&this.reviewStoreId){this.rootStore.undo.save(this.reviewStoreId);this.reviewStoreId='';}}/**\n   * delete reviews by reviewIds\n   * @param reviewResObj\n   */deleteReviews(reviewResObj){const reviewStoreId=this.rootStore.undo.preserve({reviews:this.reviewsJSON()});const reviewIds=Object.keys(reviewResObj);for(let index=0;index<reviewIds.length;index+=1){const reviewItemId=reviewIds[index];const review=reviewResObj[reviewItemId];const{frameIndex}=review;const frameReviews=this.reviews[frameIndex]||[];const frameReviewIndex=frameReviews.findIndex(r=>r.id===reviewItemId);if(frameReviewIndex>=0){frameReviews.splice(frameReviewIndex,1);}if(this.anchors[reviewItemId]){const anchor=this.anchors[reviewItemId].anchor;anchor.destroy();delete this.anchors[reviewItemId];}}if(reviewStoreId){this.rootStore.undo.save(reviewStoreId,{reviews:this.reviewsJSON()});}}/**\n   * clear all reviews and anchors\n   */clearReviewsAndAnchors(){const reviewStoreId=this.rootStore.undo.preserve({reviews:this.reviewsJSON()});this.reviews={};this.clearAnchors();if(reviewStoreId){this.rootStore.undo.save(reviewStoreId,{reviews:[]});}}// eslint-disable-next-line class-methods-use-this\nupdateReviewResult(review,result,anchor){if(review.result!==result){review.result=result;if(result===ReviewResult.APPROVE){review.type=[];review.comment='';}// update anchor\nconst{icon,selectedIcon}=getIconByReviewResultType(result);if(icon&&selectedIcon){anchor.setImage(icon,selectedIcon);}}}// eslint-disable-next-line class-methods-use-this\nupdateReviewInfo(review,_ref4){let{type,comment,x,y}=_ref4;if(type!==undefined){review.type=[...type];}if(comment!==undefined){review.comment=comment;}if(x!==undefined){review.x=x;}if(y!==undefined){review.y=y;}}}","map":{"version":3,"names":["makeAutoObservable","ReviewItem","ReviewMode","ReviewResult","TOOLBAR_HEIGHT","SIDEBAR_WIDTH","getToolTypeFromFrameData","ToolMode","Anchor","EventAction","Cursor","ApproveIcon","RejectIcon","SuspendIcon","ApproveSelectedIcon","RejectSelectedIcon","SuspendSelectedIcon","getIconByReviewResultType","type","APPROVE","icon","selectedIcon","REJECT","SUSPEND","getReviewResultSummary","reviews","allResults","Set","map","r","result","has","undefined","ReviewsStore","reviewResultTypes","rootStore","jobProxy","toolMode","AUDIT","allReviews","Object","values","flatMap","frameReviews","warningCount","review","filter","length","constructor","issueTypes","reviewLayer","reviewLayerOffset","x","y","anchors","selectedReviewId","selectedAnchor","selectedReviewResultType","addMode","editingReview","hoveredReview","hoveredAnchor","reviewStoreId","autoBind","init","payload","initialReviews","issue_types","split","i","trim","isLabeling","Array","isArray","forEach","frameIndex","reviewItem","push","getReviewForInstanceItem","instanceItem","camera","arguments","frame","currentCamera","currentFrame","instanceItemId","id","getReviewResultForInstanceItem","getReviewResultForInstance","instance","instanceId","reviewsJSON","toJSON","getReviewStatistics","approvedFrameSet","rejectedFrameSet","rejectedElements","issueMap","approvedEleMap","rejectedEleMap","instances","eleKey","_instances$instanceId","_instances$instanceId2","_instances$instanceId3","items","cameras","frames","concat","add","t","count","eleSet","delete","allInstances","j","item","k","l","shape","issues","keys","reduce","acc","curr","elements","size","approved","rejected","setReviewLayer","layer","setReviewLayerOffset","setupReviewAnchors","clearAnchors","cameraViews","isRework","cameraView","anchor","createReviewAnchor","viewScale","container","config","scale","img","selectedImg","addAnchorListeners","getReviewByAnchor","reviewId","find","on","SELECTED","a","selectReview","getInstanceById","selectInstanceItem","selectInstance","reviewMode","REVIEW","undo","preserve","setEditingReview","setReviewModalVisible","POINTER_OVER","LABELING","setHoveredReview","POINTER_OUT","selected","unselectReview","_ref","destroy","getAnchorsForCamera","updateAnchorsScale","_ref2","setScale","updateAnchorsInteractive","interactive","_ref3","activateReview","setAddMode","activateReviewByHotkey","hotkey","cursor","POINTER","DEFAULT","addReview","point","isSingleSelected","selectedInstances","selectedInstanceItems","position","insertReview","storeId","save","updateReview","indexOf","deleteReview","index","findIndex","existed","splice","deleteReviews","reviewResObj","reviewIds","reviewItemId","frameReviewIndex","clearReviewsAndAnchors","updateReviewResult","comment","setImage","updateReviewInfo","_ref4"],"sources":["/Users/qzheng/Documents/webroot/annotation_tools/src/components/video-tracking2/store/ReviewStore.ts"],"sourcesContent":["import { makeAutoObservable } from 'mobx';\nimport { Container, Point } from 'pixi.js';\nimport RootStore from './RootStore';\nimport ReviewItem from '../model/ReviewItem';\nimport Instance from '../model/Instance';\nimport InstanceItem from '../model/InstanceItem';\nimport { Payload, Review, ReviewMode, ReviewResult } from '../types';\nimport { TOOLBAR_HEIGHT, SIDEBAR_WIDTH } from '../constants';\nimport { getToolTypeFromFrameData } from '../utils';\nimport { ToolMode } from '../../../utils/tool-mode';\nimport Anchor, { EventAction } from '../../common/shapes/anchors/Anchor';\nimport Cursor from '../../common/Cursor';\nimport ApproveIcon from '../images/approve.png';\nimport RejectIcon from '../images/reject.png';\nimport SuspendIcon from '../images/suspend.png';\nimport ApproveSelectedIcon from '../images/approve_selected.png';\nimport RejectSelectedIcon from '../images/reject_selected.png';\nimport SuspendSelectedIcon from '../images/suspend_selected.png';\n\nfunction getIconByReviewResultType(type: ReviewResult) {\n  switch (type) {\n    case ReviewResult.APPROVE:\n      return { icon: ApproveIcon, selectedIcon: ApproveSelectedIcon };\n    case ReviewResult.REJECT:\n      return { icon: RejectIcon, selectedIcon: RejectSelectedIcon };\n    case ReviewResult.SUSPEND:\n      return { icon: SuspendIcon, selectedIcon: SuspendSelectedIcon };\n    default:\n  }\n  return {};\n}\n\nfunction getReviewResultSummary(reviews: ReviewItem[]) {\n  const allResults = new Set(reviews.map((r) => r.result));\n  if (allResults.has(ReviewResult.REJECT)) {\n    return ReviewResult.REJECT;\n  }\n  if (allResults.has(ReviewResult.SUSPEND)) {\n    return ReviewResult.SUSPEND;\n  }\n  if (allResults.has(ReviewResult.APPROVE)) {\n    return ReviewResult.APPROVE;\n  }\n  return undefined;\n}\n\n/**\n * store for reviews\n * @class\n */\nexport default class ReviewsStore {\n  /**\n   * root store\n   */\n  rootStore: typeof RootStore;\n\n  /**\n   * issue types\n   */\n  issueTypes: string[] = [];\n\n  /**\n   * all reviews\n   */\n  reviews: { [frameIndex: number]: ReviewItem[] } = {};\n\n  /**\n   * layer for reviews\n   */\n  reviewLayer?: Container;\n\n  /**\n   * review layer offset (according to document body)\n   */\n  reviewLayerOffset = { x: SIDEBAR_WIDTH, y: TOOLBAR_HEIGHT * 2 };\n\n  /**\n   * review anchors\n   */\n  anchors: {\n    [reviewId: string]: {\n      anchor: Anchor;\n      camera: string;\n    };\n  } = {};\n\n  /**\n   * selected review id\n   */\n  selectedReviewId = '';\n\n  /**\n   * selected anchor\n   */\n  selectedAnchor: Anchor | null = null;\n\n  /**\n   * selected review result type (default is approve)\n   */\n  selectedReviewResultType: ReviewResult = ReviewResult.APPROVE;\n\n  /**\n   * is adding review anchor\n   */\n  addMode = false;\n\n  /**\n   * current editing review instance\n   */\n  editingReview: ReviewItem | null = null;\n\n  /**\n   * current hovered review instance\n   */\n  hoveredReview: ReviewItem | null = null;\n\n  /**\n   * hovered anchor\n   */\n  hoveredAnchor: Anchor | null = null;\n\n  /**\n   * store id preserved before review edit\n   */\n  reviewStoreId = '';\n\n  /**\n   * review result types based on tool mode\n   * @getter\n   */\n  get reviewResultTypes() {\n    return this.rootStore.jobProxy!.toolMode === ToolMode.AUDIT ? [\n      ReviewResult.APPROVE,\n      ReviewResult.REJECT,\n      ReviewResult.SUSPEND,\n    ] : [\n      ReviewResult.APPROVE,\n      ReviewResult.REJECT,\n    ];\n  }\n\n  /**\n   * all reviews\n   * @getter\n   */\n  get allReviews() {\n    return Object.values(this.reviews).flatMap((frameReviews) => frameReviews);\n  }\n\n  /**\n   * warnings count\n   * @getter\n   */\n  get warningCount() {\n    const reviews = this.rootStore.review.allReviews.filter((r) => r.result === ReviewResult.REJECT);\n    return reviews.length;\n  }\n\n  constructor(rootStore: typeof RootStore) {\n    makeAutoObservable(this, {\n      rootStore: false,\n      reviewLayer: false,\n      reviewLayerOffset: false,\n      anchors: false,\n      selectedReviewId: false,\n      selectedAnchor: false,\n      reviewStoreId: false,\n    }, {\n      autoBind: true,\n    });\n\n    this.rootStore = rootStore;\n  }\n\n  /**\n   * init from paylod\n   * @param payload\n   * @param initialReviews\n   */\n  init(payload: Payload, initialReviews?: Review[]) {\n    if (typeof payload.issue_types === 'string') {\n      this.issueTypes = payload.issue_types.split(',').map((i) => i.trim()).filter((i) => !!i);\n    }\n    if (!this.rootStore.isLabeling && initialReviews && Array.isArray(initialReviews)) {\n      const reviews: { [frameIndex: number]: ReviewItem[] } = {};\n      initialReviews.forEach((review) => {\n        const { frameIndex } = review;\n        if (!reviews[frameIndex]) {\n          reviews[frameIndex] = [];\n        }\n        const reviewItem = new ReviewItem(review);\n        reviews[frameIndex].push(reviewItem);\n      });\n      this.reviews = reviews;\n    }\n  }\n\n  /**\n   * get review in current frame by instance item\n   * @param instanceItem\n   * @param camera\n   */\n  getReviewForInstanceItem(\n    instanceItem?: InstanceItem | null,\n    camera = this.rootStore.frame.currentCamera,\n    frameIndex = this.rootStore.frame.currentFrame,\n  ) {\n    if (instanceItem) {\n      if (this.reviews[frameIndex]) {\n        const reviews = this.reviews[frameIndex].filter((r) => r.camera === camera && r.instanceItemId === instanceItem.id);\n        return getReviewResultSummary(reviews);\n      }\n    }\n    return undefined;\n  }\n\n  /**\n   * get total review result for instance item\n   * @param instanceItem\n   * @param camera\n   */\n  getReviewResultForInstanceItem(\n    instanceItem: InstanceItem,\n    camera = this.rootStore.frame.currentCamera,\n  ) {\n    const reviews = this.allReviews.filter((r) => r.camera === camera && r.instanceItemId === instanceItem.id);\n    return getReviewResultSummary(reviews);\n  }\n\n  /**\n   * get total review result for instance\n   * @param instance\n   */\n  getReviewResultForInstance(instance: Instance) {\n    const reviews = this.allReviews.filter((r) => r.instanceId === instance.id);\n    return getReviewResultSummary(reviews);\n  }\n\n  /**\n   * get instances json data (for save)\n   */\n  reviewsJSON() {\n    return Object.values(this.reviews).flatMap((reviews) => reviews.map((r) => r.toJSON()));\n  }\n\n  /**\n   * get review statistics\n   */\n  getReviewStatistics() {\n    const approvedFrameSet = new Set<number>();\n    const rejectedFrameSet = new Set<number>();\n    const rejectedElements = new Set<string>();\n    const issueMap: {\n      [type: string]: {\n        count: number;\n        eleSet: Set<string>;\n      }\n    } = {};\n    const approvedEleMap: {\n      [type: string]: number;\n    } = {};\n    const rejectedEleMap: {\n      [type: string]: number;\n    } = {};\n\n    const { instances } = this.rootStore.instance;\n    Object.values(this.reviews).forEach((reviews) => {\n      reviews.forEach((review) => {\n        const { result, type, instanceId, instanceItemId, camera, frameIndex } = review;\n        if (result === ReviewResult.REJECT) {\n          // reject\n          let eleKey = '';\n          if (instanceId && instanceItemId) {\n            if (instances[instanceId]?.items[instanceItemId]?.cameras[camera]?.frames[frameIndex]) {\n              // shape exists\n              eleKey = `${instanceId}-${instanceItemId}-${camera}-${frameIndex}`;\n            }\n          }\n          rejectedFrameSet.add(frameIndex);\n          if (eleKey) {\n            rejectedElements.add(eleKey);\n          }\n          type?.forEach((t) => {\n            if (!issueMap[t]) {\n              issueMap[t] = {\n                count: 0,\n                eleSet: new Set(),\n              };\n            }\n            issueMap[t].count += 1;\n            if (eleKey) {\n              issueMap[t].eleSet.add(eleKey);\n            }\n          });\n        } else {\n          // approve, or suspend\n          approvedFrameSet.add(frameIndex);\n        }\n      });\n    });\n\n    // filter out rejected frames\n    new Set(approvedFrameSet).forEach((frame) => {\n      if (rejectedFrameSet.has(frame)) {\n        approvedFrameSet.delete(frame);\n      }\n    });\n\n    const allInstances = Object.values(instances);\n    for (let i = 0; i < allInstances.length; i += 1) {\n      const instance = allInstances[i];\n      const items = Object.values(instance.items);\n      for (let j = 0; j < items.length; j += 1) {\n        const item = items[j];\n        const cameras = Object.values(item.cameras);\n        for (let k = 0; k < cameras.length; k += 1) {\n          const camera = cameras[k];\n          const frames = Object.values(camera.frames);\n          for (let l = 0; l < frames.length; l += 1) {\n            const frame = frames[l];\n            const shape = getToolTypeFromFrameData(frame);\n            if (shape) {\n              const { frameIndex } = frame;\n              const eleKey = `${instance.id}-${item.id}-${camera.camera}-${frameIndex}`;\n              if (rejectedElements.has(eleKey)) {\n                // shape rejected\n                if (!rejectedEleMap[shape]) {\n                  rejectedEleMap[shape] = 0;\n                }\n                rejectedEleMap[shape] += 1;\n              } else if (approvedFrameSet.has(frameIndex) || rejectedFrameSet.has(frameIndex)) {\n                // shape approved\n                // or not reviewed but in frames with review status\n                if (!approvedEleMap[shape]) {\n                  approvedEleMap[shape] = 0;\n                }\n                approvedEleMap[shape] += 1;\n              }\n            }\n          }\n        }\n      }\n    }\n\n    return {\n      issues: Object.keys(issueMap).reduce((acc, curr) => {\n        const { count, eleSet } = issueMap[curr];\n        acc[curr] = {\n          count,\n          elements: eleSet.size,\n        };\n        return acc;\n      }, {} as {[type: string]: { count: number; elements: number }}),\n      frames: {\n        approved: approvedFrameSet.size,\n        rejected: rejectedFrameSet.size,\n      },\n      elements: {\n        approved: { ...approvedEleMap },\n        rejected: { ...rejectedEleMap },\n      },\n    };\n  }\n\n  /**\n   * set layer for review anchors\n   * @param layer\n   */\n  setReviewLayer(layer: Container) {\n    this.reviewLayer = layer;\n  }\n\n  /**\n   * set layer offset\n   * @param x\n   * @param y\n   */\n  setReviewLayerOffset(x: number, y: number) {\n    this.reviewLayerOffset.x = x;\n    this.reviewLayerOffset.y = y;\n  }\n\n  /**\n   * setup anchors in current frame & current camera\n   */\n  setupReviewAnchors() {\n    this.clearAnchors();\n    const { cameraViews, currentFrame } = this.rootStore.frame;\n    (this.reviews[currentFrame] || []).forEach((review) => {\n      const { id, camera, result, x, y } = review;\n      if (!this.rootStore.isRework || result === ReviewResult.REJECT) {\n        // only show reject anchors when rework\n        const cameraView = cameraViews[camera];\n        if (cameraView && cameraView.reviewLayer) {\n          const anchor = this.createReviewAnchor(result, x, y, cameraView.reviewLayer, cameraView.viewScale);\n          if (anchor) {\n            this.anchors[id] = {\n              anchor,\n              camera,\n            };\n          }\n        }\n      }\n    });\n  }\n\n  /**\n   * create anchor instance\n   * @param type\n   * @param x\n   * @param y\n   * @param container\n   * @param viewScale\n   */\n  createReviewAnchor(type: ReviewResult, x: number, y: number, container = this.reviewLayer, viewScale = this.rootStore.config.viewScale) {\n    if (container) {\n      const { icon, selectedIcon } = getIconByReviewResultType(type);\n      if (icon && selectedIcon) {\n        const anchor = new Anchor({\n          container,\n          scale: viewScale,\n          x,\n          y,\n          img: icon,\n          selectedImg: selectedIcon,\n        });\n        this.addAnchorListeners(anchor);\n        return anchor;\n      }\n    }\n    return null;\n  }\n\n  /**\n   * get review instance by anchor instance\n   * @param anchor\n   */\n  getReviewByAnchor(anchor: Anchor) {\n    const reviewId = Object.keys(this.anchors).find((id) => this.anchors[id].anchor === anchor);\n    if (reviewId) {\n      return this.reviews[this.rootStore.frame.currentFrame].find((r) => r.id === reviewId);\n    }\n    return undefined;\n  }\n\n  /**\n   * add listeners for anchor\n   * @param anchor\n   */\n  addAnchorListeners(anchor: Anchor) {\n    anchor.on(EventAction.SELECTED, (a) => {\n      if (this.addMode) {\n        return;\n      }\n      const review = this.getReviewByAnchor(a);\n      if (review) {\n        this.selectReview(review, a);\n\n        // select related instance\n        let instance;\n        let instanceItem;\n        if (review.instanceId) {\n          instance = this.rootStore.instance.getInstanceById(review.instanceId);\n          if (instance && review.instanceItemId) {\n            instanceItem = instance.items[review.instanceItemId];\n          }\n        }\n        if (instanceItem) {\n          this.rootStore.instance.selectInstanceItem(instanceItem);\n        } else if (instance) {\n          this.rootStore.instance.selectInstance(instance);\n        }\n\n        // open modal in review mode\n        if (this.rootStore.config.reviewMode === ReviewMode.REVIEW) {\n          this.reviewStoreId = this.rootStore.undo.preserve({ reviews: [review.toJSON()] });\n          this.setEditingReview(review);\n          this.rootStore.config.setReviewModalVisible(true);\n        }\n      }\n    });\n    anchor.on(EventAction.POINTER_OVER, (a) => {\n      if (this.rootStore.config.reviewMode === ReviewMode.LABELING) { // only show comment in labeling mode\n        const review = this.getReviewByAnchor(a);\n        if (review) {\n          this.setHoveredReview(review, a);\n        }\n      }\n    });\n    anchor.on(EventAction.POINTER_OUT, () => {\n      this.setHoveredReview(null, null);\n    });\n  }\n\n  /**\n   * set editing review\n   * @param review\n   */\n  setEditingReview(review: ReviewItem | null) {\n    this.editingReview = review;\n  }\n\n  /**\n   * set hovered review\n   * @param review\n   */\n  setHoveredReview(review: ReviewItem | null, anchor: Anchor | null) {\n    this.hoveredReview = review;\n    this.hoveredAnchor = anchor;\n  }\n\n  /**\n   * select review\n   * @param review\n   * @param anchor\n   */\n  selectReview(review: ReviewItem, anchor: Anchor) {\n    if (this.selectedAnchor && this.selectedAnchor !== anchor) {\n      this.selectedAnchor.selected = false;\n    }\n    this.selectedReviewId = review.id;\n    this.selectedAnchor = anchor;\n    this.selectedAnchor.selected = true;\n  }\n\n  /**\n   * unselect review\n   */\n  unselectReview() {\n    if (this.selectedAnchor) {\n      this.selectedAnchor.selected = false;\n    }\n    this.selectedReviewId = '';\n    this.selectedAnchor = null;\n  }\n\n  /**\n   * clear all anchors\n   */\n  clearAnchors() {\n    Object.values(this.anchors).forEach(({ anchor }) => {\n      anchor.destroy();\n    });\n    this.anchors = {};\n    this.selectedReviewId = '';\n    this.selectedAnchor = null;\n    this.setEditingReview(null);\n    this.setHoveredReview(null, null);\n    this.reviewStoreId = '';\n  }\n\n  /**\n   * get anchors for camera\n   * @param camera\n   */\n  getAnchorsForCamera(camera = this.rootStore.frame.currentCamera) {\n    return Object.values(this.anchors).filter((i) => i.camera === camera);\n  }\n\n  /**\n   * update anchors' scale\n   * @param scale\n   */\n  updateAnchorsScale(scale: number) {\n    this.getAnchorsForCamera().forEach(({ anchor }) => {\n      anchor.setScale(scale);\n    });\n  }\n\n  /**\n   * update anchors' interactive\n   * @param interactive\n   */\n  updateAnchorsInteractive(interactive: boolean) {\n    Object.values(this.anchors).forEach(({ anchor }) => {\n      anchor.interactive = interactive;\n    });\n  };\n\n  /**\n   * activate review tool\n   * @param type\n   */\n  activateReview(type: ReviewResult) {\n    this.selectedReviewResultType = type;\n    this.setAddMode(true);\n  }\n\n  /**\n   * activate review tool by hotkey\n   * @param hotkey\n   */\n  activateReviewByHotkey(hotkey: number) {\n    if (hotkey === 1) {\n      // approve\n      this.activateReview(ReviewResult.APPROVE);\n    } else if (hotkey === 2) {\n      // reject\n      this.activateReview(ReviewResult.REJECT);\n    } else if (hotkey === 3) {\n      // suspend\n      this.activateReview(ReviewResult.SUSPEND);\n    }\n  }\n\n  /**\n   * set review add mode\n   * @param addMode\n   */\n  setAddMode(addMode: boolean) {\n    this.addMode = addMode;\n    this.rootStore.config.cursor = addMode ? Cursor.POINTER : Cursor.DEFAULT;\n    this.updateAnchorsInteractive(!addMode);\n  }\n\n  /**\n   * add review when click canvas\n   * @param point\n   * @param layer\n   * @param viewScale\n   */\n  addReview(point: Point, layer = this.reviewLayer, viewScale = this.rootStore.config.viewScale) {\n    if (this.addMode) {\n      let instanceId;\n      let instanceItemId;\n      const { isSingleSelected, selectedInstances, selectedInstanceItems } = this.rootStore.instance;\n      if (isSingleSelected) {\n        // link to the shape\n        instanceItemId = selectedInstanceItems[0].id;\n        instanceId = selectedInstances[0].id;\n      }\n      const anchor = this.createReviewAnchor(this.selectedReviewResultType, point.x, point.y, layer, viewScale);\n      if (anchor) {\n        const { currentCamera, currentFrame } = this.rootStore.frame;\n        const review = new ReviewItem({\n          camera: currentCamera,\n          frameIndex: currentFrame,\n          result: this.selectedReviewResultType,\n          instanceId,\n          instanceItemId,\n          position: { x: point.x, y: point.y },\n        });\n        this.anchors[review.id] = {\n          anchor,\n          camera: currentCamera,\n        };\n        this.selectReview(review, anchor);\n        this.setAddMode(false);\n        if (review.result === ReviewResult.REJECT) {\n          // open modal\n          this.reviewStoreId = this.rootStore.undo.preserve();\n          this.setEditingReview(review);\n          this.rootStore.config.setReviewModalVisible(true);\n        } else {\n          // save directly\n          this.insertReview(review);\n          this.unselectReview();\n        }\n        return anchor;\n      }\n    }\n    return null;\n  }\n\n  /**\n   * insert review\n   * @param review\n   */\n  insertReview(review: ReviewItem) {\n    const storeId = this.rootStore.undo.preserve();\n    const { frameIndex } = review;\n    if (!this.reviews[frameIndex]) {\n      this.reviews[frameIndex] = [];\n    }\n    this.reviews[frameIndex].push(review);\n    this.rootStore.undo.save(storeId, { reviews: [review.toJSON()] });\n  }\n\n  /**\n   * update review\n   * @param review\n   */\n  updateReview(review: ReviewItem) {\n    if (this.reviewStoreId) {\n      const { frameIndex } = review;\n      if (!this.reviews[frameIndex]) {\n        this.reviews[frameIndex] = [];\n      }\n      if (this.reviews[frameIndex].indexOf(review) < 0) {\n        this.reviews[frameIndex].push(review);\n      }\n      this.rootStore.undo.save(this.reviewStoreId, { reviews: [review.toJSON()] });\n      this.reviewStoreId = '';\n    }\n  }\n\n  /**\n   * delete review\n   * @param review\n   * @param anchor\n   */\n  deleteReview(review: ReviewItem, anchor: Anchor) {\n    const { id, frameIndex } = review;\n    const frameReviews = this.reviews[frameIndex] || [];\n    const index = frameReviews.findIndex((r) => r.id === id);\n    let existed = false;\n    if (index >= 0) {\n      existed = true;\n      frameReviews.splice(index, 1);\n    }\n    anchor.destroy();\n    if (this.anchors[id]) {\n      delete this.anchors[id];\n    }\n    if (existed && this.reviewStoreId) {\n      this.rootStore.undo.save(this.reviewStoreId);\n      this.reviewStoreId = '';\n    }\n  }\n\n  /**\n   * delete reviews by reviewIds\n   * @param reviewResObj\n   */\n  deleteReviews(reviewResObj: { [key: string]: ReviewItem }) {\n    const reviewStoreId = this.rootStore.undo.preserve({ reviews: this.reviewsJSON() });\n    const reviewIds = Object.keys(reviewResObj);\n    for (let index = 0; index < reviewIds.length; index += 1) {\n      const reviewItemId = reviewIds[index];\n      const review = reviewResObj[reviewItemId];\n      const { frameIndex } = review;\n      const frameReviews = this.reviews[frameIndex] || [];\n      const frameReviewIndex = frameReviews.findIndex((r) => r.id === reviewItemId);\n      if (frameReviewIndex >= 0) {\n        frameReviews.splice(frameReviewIndex, 1);\n      }\n      if (this.anchors[reviewItemId]) {\n        const anchor = this.anchors[reviewItemId].anchor;\n        anchor.destroy();\n        delete this.anchors[reviewItemId];\n      }\n    }\n    if (reviewStoreId) {\n      this.rootStore.undo.save(reviewStoreId, { reviews: this.reviewsJSON() });\n    }\n  }\n\n  /**\n   * clear all reviews and anchors\n   */\n  clearReviewsAndAnchors() {\n    const reviewStoreId = this.rootStore.undo.preserve({ reviews: this.reviewsJSON() });\n    this.reviews = {};\n    this.clearAnchors();\n    if (reviewStoreId) {\n      this.rootStore.undo.save(reviewStoreId, { reviews: [] });\n    }\n  }\n\n  // eslint-disable-next-line class-methods-use-this\n  updateReviewResult(review: ReviewItem, result: ReviewResult, anchor: Anchor) {\n    if (review.result !== result) {\n      review.result = result;\n      if (result === ReviewResult.APPROVE) {\n        review.type = [];\n        review.comment = '';\n      }\n      // update anchor\n      const { icon, selectedIcon } = getIconByReviewResultType(result);\n      if (icon && selectedIcon) {\n        anchor.setImage(icon, selectedIcon);\n      }\n    }\n  }\n\n  // eslint-disable-next-line class-methods-use-this\n  updateReviewInfo(review: ReviewItem, { type, comment, x, y }: { type?: string[], comment?: string, x?: number, y?: number }) {\n    if (type !== undefined) {\n      review.type = [...type];\n    }\n    if (comment !== undefined) {\n      review.comment = comment;\n    }\n    if (x !== undefined) {\n      review.x = x;\n    }\n    if (y !== undefined) {\n      review.y = y;\n    }\n  }\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}