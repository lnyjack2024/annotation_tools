{"ast":null,"code":"import React,{useEffect,useRef,useState}from'react';const Assistant=_ref=>{let{element,scale=1,crossline,measurementBox,mousePosition}=_ref;const canvas=useRef(null);const drawn=useRef(false);const[position,setPosition]=useState({x:0,y:0});const draw=()=>{if(!crossline&&!measurementBox&&!drawn.current){return;}if(canvas.current){const{width,height,left,top}=canvas.current.getBoundingClientRect();canvas.current.width=width*window.devicePixelRatio;canvas.current.height=height*window.devicePixelRatio;const ctx=canvas.current.getContext('2d');if(ctx){ctx.clearRect(0,0,canvas.current.width,canvas.current.height);drawn.current=false;const p=mousePosition||position;const offsetX=(p.x-left)*window.devicePixelRatio;const offsetY=(p.y-top)*window.devicePixelRatio;if(crossline){ctx.save();ctx.translate(-0.5,-0.5);ctx.strokeStyle='#FF0000';ctx.lineWidth=1*window.devicePixelRatio;ctx.beginPath();ctx.moveTo(offsetX,0);ctx.lineTo(offsetX,canvas.current.height);ctx.moveTo(0,offsetY);ctx.lineTo(canvas.current.width,offsetY);ctx.stroke();ctx.restore();drawn.current=true;}if(measurementBox){const w=measurementBox[0]*scale*window.devicePixelRatio;const h=measurementBox[1]*scale*window.devicePixelRatio;ctx.save();ctx.beginPath();ctx.strokeStyle='#5CDEF0';ctx.lineWidth=1*window.devicePixelRatio;ctx.moveTo(offsetX,offsetY-h/2);ctx.lineTo(offsetX+w/2,offsetY-h/2);ctx.lineTo(offsetX+w/2,offsetY);ctx.moveTo(offsetX-w/2,offsetY);ctx.lineTo(offsetX-w/2,offsetY+h/2);ctx.lineTo(offsetX,offsetY+h/2);ctx.stroke();ctx.restore();drawn.current=true;}}}};useEffect(()=>{if(!mousePosition){// should track mouse position by selft\nconst mousemove=e=>{const{clientX,clientY}=e;setPosition({x:clientX,y:clientY});};const mouseleave=()=>setPosition({x:0,y:0});let ele=window;if(element){const node=document.querySelector(element);if(node){ele=node;}}ele.addEventListener('mousemove',mousemove);ele.addEventListener('mouseleave',mouseleave);return()=>{ele.removeEventListener('mousemove',mousemove);ele.removeEventListener('mouseleave',mouseleave);};}},[]);useEffect(()=>{draw();},[position,scale,crossline,measurementBox,mousePosition]);return/*#__PURE__*/React.createElement(\"canvas\",{ref:canvas,style:{display:'block',width:'100%',height:'100%',position:'absolute',top:0,left:0,pointerEvents:'none'}});};export default Assistant;","map":{"version":3,"names":["React","useEffect","useRef","useState","Assistant","_ref","element","scale","crossline","measurementBox","mousePosition","canvas","drawn","position","setPosition","x","y","draw","current","width","height","left","top","getBoundingClientRect","window","devicePixelRatio","ctx","getContext","clearRect","p","offsetX","offsetY","save","translate","strokeStyle","lineWidth","beginPath","moveTo","lineTo","stroke","restore","w","h","mousemove","e","clientX","clientY","mouseleave","ele","node","document","querySelector","addEventListener","removeEventListener","createElement","ref","style","display","pointerEvents"],"sources":["/Users/qzheng/Documents/webroot/annotation_tools/src/components/common/shapes/assists/Assistant.tsx"],"sourcesContent":["import React, { useEffect, useRef, useState } from 'react';\n\ninterface AssistantProps {\n  element?: string;\n  scale?: number;\n  crossline?: boolean;\n  measurementBox?: number[];\n  mousePosition?: { x: number; y: number };\n}\n\nconst Assistant = ({ element, scale = 1, crossline, measurementBox, mousePosition }: AssistantProps) => {\n  const canvas = useRef<HTMLCanvasElement>(null);\n  const drawn = useRef(false);\n  const [position, setPosition] = useState({ x: 0, y: 0 });\n\n  const draw = () => {\n    if (!crossline && !measurementBox && !drawn.current) {\n      return;\n    }\n    if (canvas.current) {\n      const { width, height, left, top } = canvas.current.getBoundingClientRect();\n      canvas.current.width = width * window.devicePixelRatio;\n      canvas.current.height = height * window.devicePixelRatio;\n\n      const ctx = canvas.current.getContext('2d');\n      if (ctx) {\n        ctx.clearRect(0, 0, canvas.current.width, canvas.current.height);\n        drawn.current = false;\n\n        const p = mousePosition || position;\n        const offsetX = (p.x - left) * window.devicePixelRatio;\n        const offsetY = (p.y - top) * window.devicePixelRatio;\n\n        if (crossline) {\n          ctx.save();\n          ctx.translate(-0.5, -0.5);\n          ctx.strokeStyle = '#FF0000';\n          ctx.lineWidth = 1 * window.devicePixelRatio;\n          ctx.beginPath();\n          ctx.moveTo(offsetX, 0);\n          ctx.lineTo(offsetX, canvas.current.height);\n          ctx.moveTo(0, offsetY);\n          ctx.lineTo(canvas.current.width, offsetY);\n          ctx.stroke();\n          ctx.restore();\n          drawn.current = true;\n        }\n\n        if (measurementBox) {\n          const w = measurementBox[0] * scale * window.devicePixelRatio;\n          const h = measurementBox[1] * scale * window.devicePixelRatio;\n          ctx.save();\n          ctx.beginPath();\n          ctx.strokeStyle = '#5CDEF0';\n          ctx.lineWidth = 1 * window.devicePixelRatio;\n          ctx.moveTo(offsetX, offsetY - h / 2);\n          ctx.lineTo(offsetX + w / 2, offsetY - h / 2);\n          ctx.lineTo(offsetX + w / 2, offsetY);\n          ctx.moveTo(offsetX - w / 2, offsetY);\n          ctx.lineTo(offsetX - w / 2, offsetY + h / 2);\n          ctx.lineTo(offsetX, offsetY + h / 2);\n          ctx.stroke();\n          ctx.restore();\n          drawn.current = true;\n        }\n      }\n    }\n  };\n\n  useEffect(() => {\n    if (!mousePosition) {\n      // should track mouse position by selft\n      const mousemove = (e: Event) => {\n        const { clientX, clientY } = e as MouseEvent;\n        setPosition({ x: clientX, y: clientY });\n      };\n      const mouseleave = () => setPosition({ x: 0, y: 0 });\n      let ele: HTMLElement | Window = window;\n      if (element) {\n        const node = document.querySelector<HTMLElement>(element);\n        if (node) {\n          ele = node;\n        }\n      }\n      ele.addEventListener('mousemove', mousemove);\n      ele.addEventListener('mouseleave', mouseleave);\n      return () => {\n        ele.removeEventListener('mousemove', mousemove);\n        ele.removeEventListener('mouseleave', mouseleave);\n      };\n    }\n  }, []);\n\n  useEffect(() => {\n    draw();\n  }, [position, scale, crossline, measurementBox, mousePosition]);\n\n  return (\n    <canvas\n      ref={canvas}\n      style={{\n        display: 'block',\n        width: '100%',\n        height: '100%',\n        position: 'absolute',\n        top: 0,\n        left: 0,\n        pointerEvents: 'none',\n      }}\n    />\n  );\n};\n\nexport default Assistant;\n"],"mappings":"AAAA,MAAO,CAAAA,KAAK,EAAIC,SAAS,CAAEC,MAAM,CAAEC,QAAQ,KAAQ,OAAO,CAU1D,KAAM,CAAAC,SAAS,CAAGC,IAAA,EAAsF,IAArF,CAAEC,OAAO,CAAEC,KAAK,CAAG,CAAC,CAAEC,SAAS,CAAEC,cAAc,CAAEC,aAA8B,CAAC,CAAAL,IAAA,CACjG,KAAM,CAAAM,MAAM,CAAGT,MAAM,CAAoB,IAAI,CAAC,CAC9C,KAAM,CAAAU,KAAK,CAAGV,MAAM,CAAC,KAAK,CAAC,CAC3B,KAAM,CAACW,QAAQ,CAAEC,WAAW,CAAC,CAAGX,QAAQ,CAAC,CAAEY,CAAC,CAAE,CAAC,CAAEC,CAAC,CAAE,CAAE,CAAC,CAAC,CAExD,KAAM,CAAAC,IAAI,CAAGA,CAAA,GAAM,CACjB,GAAI,CAACT,SAAS,EAAI,CAACC,cAAc,EAAI,CAACG,KAAK,CAACM,OAAO,CAAE,CACnD,OACF,CACA,GAAIP,MAAM,CAACO,OAAO,CAAE,CAClB,KAAM,CAAEC,KAAK,CAAEC,MAAM,CAAEC,IAAI,CAAEC,GAAI,CAAC,CAAGX,MAAM,CAACO,OAAO,CAACK,qBAAqB,CAAC,CAAC,CAC3EZ,MAAM,CAACO,OAAO,CAACC,KAAK,CAAGA,KAAK,CAAGK,MAAM,CAACC,gBAAgB,CACtDd,MAAM,CAACO,OAAO,CAACE,MAAM,CAAGA,MAAM,CAAGI,MAAM,CAACC,gBAAgB,CAExD,KAAM,CAAAC,GAAG,CAAGf,MAAM,CAACO,OAAO,CAACS,UAAU,CAAC,IAAI,CAAC,CAC3C,GAAID,GAAG,CAAE,CACPA,GAAG,CAACE,SAAS,CAAC,CAAC,CAAE,CAAC,CAAEjB,MAAM,CAACO,OAAO,CAACC,KAAK,CAAER,MAAM,CAACO,OAAO,CAACE,MAAM,CAAC,CAChER,KAAK,CAACM,OAAO,CAAG,KAAK,CAErB,KAAM,CAAAW,CAAC,CAAGnB,aAAa,EAAIG,QAAQ,CACnC,KAAM,CAAAiB,OAAO,CAAG,CAACD,CAAC,CAACd,CAAC,CAAGM,IAAI,EAAIG,MAAM,CAACC,gBAAgB,CACtD,KAAM,CAAAM,OAAO,CAAG,CAACF,CAAC,CAACb,CAAC,CAAGM,GAAG,EAAIE,MAAM,CAACC,gBAAgB,CAErD,GAAIjB,SAAS,CAAE,CACbkB,GAAG,CAACM,IAAI,CAAC,CAAC,CACVN,GAAG,CAACO,SAAS,CAAC,CAAC,GAAG,CAAE,CAAC,GAAG,CAAC,CACzBP,GAAG,CAACQ,WAAW,CAAG,SAAS,CAC3BR,GAAG,CAACS,SAAS,CAAG,CAAC,CAAGX,MAAM,CAACC,gBAAgB,CAC3CC,GAAG,CAACU,SAAS,CAAC,CAAC,CACfV,GAAG,CAACW,MAAM,CAACP,OAAO,CAAE,CAAC,CAAC,CACtBJ,GAAG,CAACY,MAAM,CAACR,OAAO,CAAEnB,MAAM,CAACO,OAAO,CAACE,MAAM,CAAC,CAC1CM,GAAG,CAACW,MAAM,CAAC,CAAC,CAAEN,OAAO,CAAC,CACtBL,GAAG,CAACY,MAAM,CAAC3B,MAAM,CAACO,OAAO,CAACC,KAAK,CAAEY,OAAO,CAAC,CACzCL,GAAG,CAACa,MAAM,CAAC,CAAC,CACZb,GAAG,CAACc,OAAO,CAAC,CAAC,CACb5B,KAAK,CAACM,OAAO,CAAG,IAAI,CACtB,CAEA,GAAIT,cAAc,CAAE,CAClB,KAAM,CAAAgC,CAAC,CAAGhC,cAAc,CAAC,CAAC,CAAC,CAAGF,KAAK,CAAGiB,MAAM,CAACC,gBAAgB,CAC7D,KAAM,CAAAiB,CAAC,CAAGjC,cAAc,CAAC,CAAC,CAAC,CAAGF,KAAK,CAAGiB,MAAM,CAACC,gBAAgB,CAC7DC,GAAG,CAACM,IAAI,CAAC,CAAC,CACVN,GAAG,CAACU,SAAS,CAAC,CAAC,CACfV,GAAG,CAACQ,WAAW,CAAG,SAAS,CAC3BR,GAAG,CAACS,SAAS,CAAG,CAAC,CAAGX,MAAM,CAACC,gBAAgB,CAC3CC,GAAG,CAACW,MAAM,CAACP,OAAO,CAAEC,OAAO,CAAGW,CAAC,CAAG,CAAC,CAAC,CACpChB,GAAG,CAACY,MAAM,CAACR,OAAO,CAAGW,CAAC,CAAG,CAAC,CAAEV,OAAO,CAAGW,CAAC,CAAG,CAAC,CAAC,CAC5ChB,GAAG,CAACY,MAAM,CAACR,OAAO,CAAGW,CAAC,CAAG,CAAC,CAAEV,OAAO,CAAC,CACpCL,GAAG,CAACW,MAAM,CAACP,OAAO,CAAGW,CAAC,CAAG,CAAC,CAAEV,OAAO,CAAC,CACpCL,GAAG,CAACY,MAAM,CAACR,OAAO,CAAGW,CAAC,CAAG,CAAC,CAAEV,OAAO,CAAGW,CAAC,CAAG,CAAC,CAAC,CAC5ChB,GAAG,CAACY,MAAM,CAACR,OAAO,CAAEC,OAAO,CAAGW,CAAC,CAAG,CAAC,CAAC,CACpChB,GAAG,CAACa,MAAM,CAAC,CAAC,CACZb,GAAG,CAACc,OAAO,CAAC,CAAC,CACb5B,KAAK,CAACM,OAAO,CAAG,IAAI,CACtB,CACF,CACF,CACF,CAAC,CAEDjB,SAAS,CAAC,IAAM,CACd,GAAI,CAACS,aAAa,CAAE,CAClB;AACA,KAAM,CAAAiC,SAAS,CAAIC,CAAQ,EAAK,CAC9B,KAAM,CAAEC,OAAO,CAAEC,OAAQ,CAAC,CAAGF,CAAe,CAC5C9B,WAAW,CAAC,CAAEC,CAAC,CAAE8B,OAAO,CAAE7B,CAAC,CAAE8B,OAAQ,CAAC,CAAC,CACzC,CAAC,CACD,KAAM,CAAAC,UAAU,CAAGA,CAAA,GAAMjC,WAAW,CAAC,CAAEC,CAAC,CAAE,CAAC,CAAEC,CAAC,CAAE,CAAE,CAAC,CAAC,CACpD,GAAI,CAAAgC,GAAyB,CAAGxB,MAAM,CACtC,GAAIlB,OAAO,CAAE,CACX,KAAM,CAAA2C,IAAI,CAAGC,QAAQ,CAACC,aAAa,CAAc7C,OAAO,CAAC,CACzD,GAAI2C,IAAI,CAAE,CACRD,GAAG,CAAGC,IAAI,CACZ,CACF,CACAD,GAAG,CAACI,gBAAgB,CAAC,WAAW,CAAET,SAAS,CAAC,CAC5CK,GAAG,CAACI,gBAAgB,CAAC,YAAY,CAAEL,UAAU,CAAC,CAC9C,MAAO,IAAM,CACXC,GAAG,CAACK,mBAAmB,CAAC,WAAW,CAAEV,SAAS,CAAC,CAC/CK,GAAG,CAACK,mBAAmB,CAAC,YAAY,CAAEN,UAAU,CAAC,CACnD,CAAC,CACH,CACF,CAAC,CAAE,EAAE,CAAC,CAEN9C,SAAS,CAAC,IAAM,CACdgB,IAAI,CAAC,CAAC,CACR,CAAC,CAAE,CAACJ,QAAQ,CAAEN,KAAK,CAAEC,SAAS,CAAEC,cAAc,CAAEC,aAAa,CAAC,CAAC,CAE/D,mBACEV,KAAA,CAAAsD,aAAA,WACEC,GAAG,CAAE5C,MAAO,CACZ6C,KAAK,CAAE,CACLC,OAAO,CAAE,OAAO,CAChBtC,KAAK,CAAE,MAAM,CACbC,MAAM,CAAE,MAAM,CACdP,QAAQ,CAAE,UAAU,CACpBS,GAAG,CAAE,CAAC,CACND,IAAI,CAAE,CAAC,CACPqC,aAAa,CAAE,MACjB,CAAE,CACH,CAAC,CAEN,CAAC,CAED,cAAe,CAAAtD,SAAS","ignoreList":[]},"metadata":{},"sourceType":"module"}