{"ast":null,"code":"import Paper from'paper';import screenfull from'screenfull';import{v4 as uuid}from'uuid';import{message}from'antd';import{SHAPE_TYPE}from'../components/Canvas';import{CategoryPathShape,LandmarkEditType,ReviewResult,HandleType}from'../types';import{isInput}from'../../../utils';import formatMessage from'../locales';import rootStore from'../store/RootStore';export default class Tool extends Paper.Tool{constructor(editor){super();this.editor=void 0;this.downPoint=null;this.downCenter=null;this.mouseDown=false;this.dragging=false;this.lastClick=-1;this.movingPaths=[];this.movingShapes=[];this.dragType='';this.movingSegments=[];this.movingHandles=undefined;this.affectedCategories=[];this.selectPath=null;this.minArea=3;this.isRightButton=event=>event.event.which===3||event.modifiers.space;this.isCtrlKey=event=>event.event.ctrlKey;this.onMouseDown=event=>{if(this.isRightButton(event)){this.downPoint=Paper.view.projectToView(event.point);this.downCenter=Paper.view.center;return;}if(this.editor){this.mouseDown=true;const currentClick=Date.now();const interval=currentClick-this.lastClick;this.lastClick=currentClick;if(interval<300){var _this$editor$warningB;// db click\nif((_this$editor$warningB=this.editor.warningBtn)===null||_this$editor$warningB===void 0?void 0:_this$editor$warningB.item){const{instanceId,groupName,shapeIds,id}=this.editor.warningBtn.item.data||{};if(instanceId&&groupName&&shapeIds!==undefined){rootStore.review.setSelectedReview({frameIndex:this.editor.props.currentFrame,instanceId,groupName,shapeIds,result:ReviewResult.REJECT});}else if(id){const review=rootStore.review.missingReviews.find(r=>r.id===id);rootStore.review.setSelectedMissingReview(review,true);}}return;}if(rootStore.review.isEnabled&&!rootStore.review.drawMode&&rootStore.review.selectedMissingReview&&rootStore.review.selectedMissingReview.data===undefined){// create missing dot when mouse up\nreturn;}const{type:hitsType}=this.editor.hits||{};if(!this.isCtrlKey(event)&&this.editor.hits&&this.editor.hits.item.data.type!==SHAPE_TYPE.KEYPOINT_BOX){const{instanceId:selectedInstanceId,groupName:selectedGroupName,index,id}=this.editor.hits.item.data;// move start\nif(this.editor.selectedPoints.length>0&&this.editor.isShapeInSelectedShapes(selectedInstanceId,selectedGroupName,index)){// multi points\nthis.movingShapes=this.editor.selectedPoints;}else if(this.editor.selectedRectangles.length>0&&this.editor.isShapeInSelectedShapes(selectedInstanceId,selectedGroupName,id)){// multi rectangles\nthis.movingShapes=this.editor.selectedRectangles;}else if(Object.values(HandleType).includes(hitsType)){const{currentFrame}=this.editor.props;const{handleIn,handleOut,index:segIndex,path:{data:{instanceId,groupName,pointCategory:category,id:pathId,points}}}=this.editor.hits.segment;const pointIndex=points[segIndex];this.movingHandles={actual:hitsType===HandleType.HANDLE_IN?handleIn:handleOut,opposite:hitsType===HandleType.HANDLE_IN?handleOut:handleIn,type:hitsType,pointIndex,pathId,instanceId,groupName,category,frameIndex:currentFrame};}else if(this.editor.hits.item){const{type:hitItemType}=this.editor.hits.item.data;if((hitItemType===SHAPE_TYPE.RECTANGLE_PATH||hitItemType===SHAPE_TYPE.RECTANGLE||hitItemType===SHAPE_TYPE.RECTANGLE_POINT)&&this.editor.hits.item.parent){// rectangle-control\nthis.movingShapes=[this.editor.hits.item.parent];if(hitItemType===SHAPE_TYPE.RECTANGLE_PATH){switch(this.editor.hits.item.data.controlIndex){case 0:this.dragType='top';break;case 1:this.dragType='right';break;case 2:this.dragType='bottom';break;case 3:this.dragType='left';break;default:break;}}else if(hitItemType===SHAPE_TYPE.RECTANGLE_POINT){switch(this.editor.hits.item.data.controlIndex){case 0:this.dragType='tl';break;case 1:this.dragType='tr';break;case 2:this.dragType='br';break;case 3:this.dragType='bl';break;default:break;}}else{this.dragType='center';}}else if(hitItemType===SHAPE_TYPE.KEYPOINT){// single point\nthis.movingShapes=[this.editor.hits.item];}}this.affectedCategories=[];this.movingSegments=[];if(this.movingShapes.length===1){const{instanceId,category,groupName,index:pointIndex,type,id:shapeId}=this.movingShapes[0].data;if(type===SHAPE_TYPE.KEYPOINT){var _this$editor;(_this$editor=this.editor)===null||_this$editor===void 0?void 0:_this$editor.props.setSelectedShape(pointIndex,{instanceId,category,groupName,shapeType:LandmarkEditType.KEYPOINT});}else if(type===SHAPE_TYPE.RECTANGLE_GROUP){var _this$editor2;const{bounds:{topLeft,topRight,bottomRight,bottomLeft}}=this.movingShapes[0].children[0];this.selectPath=new Paper.Path();this.selectPath.data.id=shapeId;this.selectPath.add(topLeft);this.selectPath.add(topRight);this.selectPath.add(bottomRight);this.selectPath.add(bottomLeft);this.selectPath.closed=true;(_this$editor2=this.editor)===null||_this$editor2===void 0?void 0:_this$editor2.props.setSelectedShape(shapeId,{instanceId,category,groupName,shapeType:LandmarkEditType.RECTANGLE});}}if(!rootStore.review.drawMode){this.movingShapes=[];this.selectPath=null;}}else{// select start\nthis.editor.setMultiShapesUnselected();const localPoint=this.editor.getPointInImage(Paper.view.projectToView(event.point));if(this.editor.activeTool===CategoryPathShape.CIRCLE||this.editor.activeTool===CategoryPathShape.RECTANGLE&&!this.editor.canAddShape()){this.selectPath=new Paper.Path({segments:[localPoint],strokeColor:'red',strokeWidth:2,strokeScaling:false});}else if(this.editor.activeTool===CategoryPathShape.RECTANGLE&&this.editor.canAddShape()&&this.editor.canvasContainer.current){var _this$editor3;const{instanceId,category,groupName}=this.editor.props.selectedShapeInfo;const id=uuid();this.selectPath=new Paper.Path();this.selectPath.data.id=id;this.selectPath.add(localPoint);this.selectPath.add(localPoint);this.selectPath.add(localPoint);this.selectPath.add(localPoint);this.selectPath.closed=true;this.editor.addRectangle(this.selectPath,(_this$editor3=this.editor)===null||_this$editor3===void 0?void 0:_this$editor3.props.selectedShapeInfo);const rectangleBox=this.editor.getShapeByKey(instanceId,groupName,id);this.editor.props.setSelectedShape(id,{instanceId,category,groupName,shapeType:LandmarkEditType.RECTANGLE});this.movingShapes.push(rectangleBox);this.dragType='br';this.dragging=true;}}}};this.onMouseDrag=event=>{var _this$editor4,_this$editor4$warning,_this$editor4$warning2,_this$editor5,_this$editor6,_this$editor7,_this$editor7$warning;if(this.isRightButton(event)){if(!this.downPoint||!this.downCenter){this.downPoint=Paper.view.projectToView(event.point);this.downCenter=Paper.view.center;}const rotation=Math.round(Paper.view.rotation);const targetPoint=Paper.view.projectToView(event.point).rotate(-rotation,this.downPoint);const deltaPixel=targetPoint.subtract(this.downPoint);const candidateCenter=this.downCenter.subtract(deltaPixel.divide(Paper.view.zoom));Paper.view.center=candidateCenter;return;}if(rootStore.review.isEnabled&&!rootStore.review.drawMode&&((_this$editor4=this.editor)===null||_this$editor4===void 0?void 0:(_this$editor4$warning=_this$editor4.warningBtn)===null||_this$editor4$warning===void 0?void 0:(_this$editor4$warning2=_this$editor4$warning.item.data)===null||_this$editor4$warning2===void 0?void 0:_this$editor4$warning2.id)){// move missing review\nif(this.editor){const point=this.editor.getPointInImage(Paper.view.projectToView(event.point));this.editor.warningBtn.item.parent.position.set(point);}return;}if(((_this$editor5=this.editor)===null||_this$editor5===void 0?void 0:_this$editor5.props.isReview)||((_this$editor6=this.editor)===null||_this$editor6===void 0?void 0:_this$editor6.props.readonly)||((_this$editor7=this.editor)===null||_this$editor7===void 0?void 0:(_this$editor7$warning=_this$editor7.warningBtn)===null||_this$editor7$warning===void 0?void 0:_this$editor7$warning.item))return;let resize=false;if(this.editor){const localPoint=this.editor.getPointInImage(Paper.view.projectToView(event.point));const localLastPoint=this.editor.getPointInImage(Paper.view.projectToView(event.lastPoint));const offsetX=localPoint.x-localLastPoint.x;const offsetY=localPoint.y-localLastPoint.y;if(Math.abs(offsetX)>0||Math.abs(offsetY)>0){this.dragging=true;}if(this.movingShapes.length>0){// moving\n/* eslint-disable no-param-reassign */this.movingShapes.forEach(movingShape=>{const{frameIndex,instanceId,category,groupName,pointCategory:categoryName,index,type,displayColor}=movingShape.data;if(type===SHAPE_TYPE.RECTANGLE_GROUP&&this.selectPath){var _this$editor8;resize=true;switch(this.dragType){case'tl':this.selectPath.segments[0].point.x+=offsetX;this.selectPath.segments[0].point.y+=offsetY;this.selectPath.segments[1].point.y+=offsetY;this.selectPath.segments[3].point.x+=offsetX;break;case'tr':this.selectPath.segments[1].point.x+=offsetX;this.selectPath.segments[1].point.y+=offsetY;this.selectPath.segments[0].point.y+=offsetY;this.selectPath.segments[2].point.x+=offsetX;break;case'br':this.selectPath.segments[2].point.x+=offsetX;this.selectPath.segments[2].point.y+=offsetY;this.selectPath.segments[3].point.y+=offsetY;this.selectPath.segments[1].point.x+=offsetX;break;case'bl':this.selectPath.segments[3].point.x+=offsetX;this.selectPath.segments[3].point.y+=offsetY;this.selectPath.segments[2].point.y+=offsetY;this.selectPath.segments[0].point.x+=offsetX;break;case'top':this.selectPath.segments[0].point.y+=offsetY;this.selectPath.segments[1].point.y+=offsetY;break;case'right':this.selectPath.segments[1].point.x+=offsetX;this.selectPath.segments[2].point.x+=offsetX;break;case'bottom':this.selectPath.segments[2].point.y+=offsetY;this.selectPath.segments[3].point.y+=offsetY;break;case'left':this.selectPath.segments[3].point.x+=offsetX;this.selectPath.segments[0].point.x+=offsetX;break;case'center':this.selectPath.segments[0].point.x+=offsetX;this.selectPath.segments[0].point.y+=offsetY;this.selectPath.segments[1].point.x+=offsetX;this.selectPath.segments[1].point.y+=offsetY;this.selectPath.segments[2].point.x+=offsetX;this.selectPath.segments[2].point.y+=offsetY;this.selectPath.segments[3].point.x+=offsetX;this.selectPath.segments[3].point.y+=offsetY;break;default:break;}const shapeInfo={instanceId,category,groupName,shapeType:LandmarkEditType.RECTANGLE,displayColor};(_this$editor8=this.editor)===null||_this$editor8===void 0?void 0:_this$editor8.addRectangle(this.selectPath,shapeInfo,false);}else if(type===SHAPE_TYPE.KEYPOINT){var _this$editor9,_this$editor10;const categoryKey=\"\".concat(frameIndex,\"_\").concat(instanceId,\"_\").concat(groupName,\"_\").concat(categoryName);if(((_this$editor9=this.editor)===null||_this$editor9===void 0?void 0:_this$editor9.props.categoryPathShapes[categoryKey])===CategoryPathShape.CIRCLE){const path=this.editor.getPathByCategory(instanceId,groupName,categoryName);if(path&&path.data.isCircle){const pointCategory=this.editor.props.categories.find(c=>c.name===categoryName);if(pointCategory){if(this.affectedCategories.findIndex(affected=>affected.instanceId===instanceId&&affected.groupName===groupName&&affected.pointCategory===categoryName)<0){this.affectedCategories.push({instanceId,category,groupName,pointCategory:categoryName});}const sortedKeys=[...pointCategory.keys].sort((a,b)=>a-b);const pIndex1=sortedKeys[0];const pIndex2=sortedKeys[Math.ceil(sortedKeys.length/2)];if(index!==pIndex1&&index!==pIndex2){return;}}}}(_this$editor10=this.editor)===null||_this$editor10===void 0?void 0:_this$editor10.updatePath(movingShape,{x:movingShape.position.x+offsetX,y:movingShape.position.y+offsetY});movingShape.position.x+=offsetX;movingShape.position.y+=offsetY;}});this.movingSegments.forEach(movingSegment=>{movingSegment.point.x+=offsetX;movingSegment.point.y+=offsetY;});this.affectedCategories.forEach(_ref=>{var _this$editor11;let{instanceId,category,groupName,pointCategory}=_ref;const container={instanceId,category,groupName};(_this$editor11=this.editor)===null||_this$editor11===void 0?void 0:_this$editor11.updateCirclePath(pointCategory,true,container);});/* eslint-enable no-param-reassign */}else if(this.movingHandles){// moving handle point\nthis.movingHandles.actual.x+=offsetX;this.movingHandles.actual.y+=offsetY;this.movingHandles.opposite.x=-this.movingHandles.actual.x;this.movingHandles.opposite.y=-this.movingHandles.actual.y;}else if(this.selectPath){// draw select path\nif(this.editor.activeTool===CategoryPathShape.CIRCLE||this.editor.activeTool===CategoryPathShape.RECTANGLE&&!this.editor.canAddShape()){this.selectPath.add(localPoint);}else if(this.editor.activeTool===CategoryPathShape.RECTANGLE&&!resize){var _this$editor12;this.selectPath.segments[1].point.x+=offsetX;this.selectPath.segments[2].point.x+=offsetX;this.selectPath.segments[2].point.y+=offsetY;this.selectPath.segments[3].point.y+=offsetY;this.editor.addRectangle(this.selectPath,(_this$editor12=this.editor)===null||_this$editor12===void 0?void 0:_this$editor12.props.selectedShapeInfo,false);}}}};this.onMouseUp=event=>{var _this$editor14,_this$editor14$warnin,_this$editor26;if(this.isRightButton(event)){var _this$editor13;(_this$editor13=this.editor)===null||_this$editor13===void 0?void 0:_this$editor13.drag(Paper.view.center);this.downPoint=null;this.downCenter=null;return;}this.mouseDown=false;if(rootStore.review.isEnabled&&!rootStore.review.drawMode&&rootStore.review.selectedMissingReview&&rootStore.review.selectedMissingReview.data===undefined){// create missing dot when mouse up\nif(this.editor){const point=this.editor.getPointInImage(Paper.view.projectToView(event.point));rootStore.review.finishMissingReview(point);}return;}if((_this$editor14=this.editor)===null||_this$editor14===void 0?void 0:(_this$editor14$warnin=_this$editor14.warningBtn)===null||_this$editor14$warnin===void 0?void 0:_this$editor14$warnin.item){const{data,position}=this.editor.warningBtn.item;if(data===null||data===void 0?void 0:data.id){// finish move missing review\nconst review=rootStore.review.missingReviews.find(r=>r.id===data.id);if(review){rootStore.review.updateMissingReview({...review,data:{position:{x:position.x,y:position.y}}});rootStore.review.setSelectedMissingReview(review);}}return;}if(!this.isCtrlKey(event)&&this.movingShapes.length>0){var _this$editor22;// move ends\nif(this.dragging&&this.editor){if(this.editor.activeTool===CategoryPathShape.CIRCLE){var _this$editor17;const otherPoints=[];this.affectedCategories.forEach(_ref2=>{var _this$editor15;let{instanceId,category,groupName,pointCategory}=_ref2;const container={instanceId,category,groupName};const updatedShapes=(_this$editor15=this.editor)===null||_this$editor15===void 0?void 0:_this$editor15.updateCirclePath(pointCategory,true,container);if(updatedShapes){updatedShapes.forEach(_ref3=>{let{shape,index}=_ref3;if(index!==undefined&&shape){var _this$editor16;otherPoints.push({frameIndex:((_this$editor16=this.editor)===null||_this$editor16===void 0?void 0:_this$editor16.props.selectedShapeStatus.frameIndex)||0,instanceId,category,groupName,index,shapeType:LandmarkEditType.KEYPOINT,shape});}});}});(_this$editor17=this.editor)===null||_this$editor17===void 0?void 0:_this$editor17.updatePointsPosition([...this.movingShapes.map(movingPoint=>{const{frameIndex,instanceId,category,groupName,index}=movingPoint.data;return{frameIndex,instanceId,category,groupName,index,shapeType:LandmarkEditType.KEYPOINT,shape:{position:{x:movingPoint.position.x,y:movingPoint.position.y}}};}),...otherPoints]);}else if(this.editor.activeTool===CategoryPathShape.RECTANGLE){var _this$editor18;(_this$editor18=this.editor)===null||_this$editor18===void 0?void 0:_this$editor18.updateRectanglePosition([...this.movingShapes.filter(movingRectangle=>{const{bounds:{width,height}}=movingRectangle.children[0];if(width<this.minArea||height<this.minArea){var _this$editor19;(_this$editor19=this.editor)===null||_this$editor19===void 0?void 0:_this$editor19.deleteSelectedRectangle();message.warning(formatMessage('MIN_SIZE_ALERT'));return false;}return true;}).map(movingRectangle=>{var _this$editor20,_this$editor21;const{instanceId,category,groupName,id,displayColor}=movingRectangle.data;const{bounds:{x,y,width,height}}=movingRectangle.children[0];const groupInfo={frameIndex:((_this$editor20=this.editor)===null||_this$editor20===void 0?void 0:_this$editor20.props.selectedShapeStatus.frameIndex)||0,instanceId,category,groupName};const rectInfo={x,y,width,height,displayColor:displayColor||'#5cdef0'};(_this$editor21=this.editor)===null||_this$editor21===void 0?void 0:_this$editor21.drawRectangle(rectInfo,groupInfo,id);return{...groupInfo,id,shapeType:LandmarkEditType.RECTANGLE,shape:{...rectInfo,id,visible:true// default is visible when point added\n}};})]);}}if(this.selectPath){this.selectPath.remove();this.selectPath=null;}this.movingShapes=[];this.movingSegments=[];this.affectedCategories=[];(_this$editor22=this.editor)===null||_this$editor22===void 0?void 0:_this$editor22.drawWarnings();}else if(this.movingHandles){// handle move ends\nthis.movingHandles=undefined;}else if(this.dragging&&this.selectPath){var _this$editor23;// select ends\nif((_this$editor23=this.editor)===null||_this$editor23===void 0?void 0:_this$editor23.mainLayer){var _this$editor24,_this$editor25;const center=this.editor.mainLayer.localToGlobal(this.selectPath.bounds.center);const hits=this.editor.mainLayer.hitTestAll(center,{fill:true,segments:true,tolerance:this.selectPath.bounds.topLeft.getDistance(this.selectPath.bounds.bottomRight)/2});const selectedPoints=new Set();const selectedRectangles=new Set();let selectedGroup;const isOneGroup=(instanceId,groupName)=>{if(!selectedGroup){selectedGroup=\"\".concat(instanceId,\"_\").concat(groupName);return true;}return\"\".concat(instanceId,\"_\").concat(groupName)===selectedGroup;};hits.forEach(seg=>{if(this.selectPath.contains(seg.item.bounds.center)){if(seg.item.data.type===SHAPE_TYPE.KEYPOINT){if(isOneGroup(seg.item.data.instanceId,seg.item.data.groupName)){selectedPoints.add(seg.item);}}else if(seg.item.data.type===SHAPE_TYPE.RECTANGLE||seg.item.data.type===SHAPE_TYPE.RECTANGLE_POINT||seg.item.data.type===SHAPE_TYPE.RECTANGLE_PATH){if(isOneGroup(seg.item.parent.data.instanceId,seg.item.parent.data.groupName)){selectedRectangles.add(seg.item.parent);}}}});// selected\nif(selectedPoints.size)(_this$editor24=this.editor)===null||_this$editor24===void 0?void 0:_this$editor24.setMultiShapesSelected(Array.from(selectedPoints),CategoryPathShape.CIRCLE);if(selectedRectangles.size)(_this$editor25=this.editor)===null||_this$editor25===void 0?void 0:_this$editor25.setMultiShapesSelected(Array.from(selectedRectangles),CategoryPathShape.RECTANGLE);}this.selectPath.remove();this.selectPath=null;}else if(((_this$editor26=this.editor)===null||_this$editor26===void 0?void 0:_this$editor26.canAddShape())&&this.editor.activeTool===CategoryPathShape.CIRCLE){// add point\nconst point=Paper.view.projectToView(event.point);// if (this.editor?.isPointInImage(point)) {\nthis.editor.addKeypoint(point);// }\n}else if(this.editor&&rootStore.review.drawMode){// clear selection and move next\nthis.editor.props.setNextEmptyShape();}this.dragging=false;};this.handleQa=result=>{var _this$editor27;if((_this$editor27=this.editor)===null||_this$editor27===void 0?void 0:_this$editor27.props.selectedShapeStatus){var _this$editor28,_this$editor30;const{instanceId,groupName,frameIndex,id}=this.editor.props.selectedShapeStatus;let shapeIds=[];if(id!==undefined){shapeIds=[id];}else if(((_this$editor28=this.editor)===null||_this$editor28===void 0?void 0:_this$editor28.selectedPoints.length)>0){var _this$editor29;shapeIds=(_this$editor29=this.editor)===null||_this$editor29===void 0?void 0:_this$editor29.selectedPoints.map(point=>point.data.index);}else if(((_this$editor30=this.editor)===null||_this$editor30===void 0?void 0:_this$editor30.selectedRectangles.length)>0){var _this$editor31;shapeIds=(_this$editor31=this.editor)===null||_this$editor31===void 0?void 0:_this$editor31.selectedRectangles.map(shape=>shape.data.id);}if(shapeIds.length){shapeIds.sort((a,b)=>a-b);if(result!==ReviewResult.REJECT&&!rootStore.review.selectedReview){rootStore.review.setReview({result},{frameIndex,instanceId,groupName,shapeIds,result});}else{rootStore.review.setSelectedReview({frameIndex,instanceId,groupName,shapeIds,result});}if((result===ReviewResult.SUSPEND||result===ReviewResult.APPROVE)&&!rootStore.review.selectedReview){message.success(formatMessage(\"QC_SET_\".concat(result.toLocaleUpperCase())));}}}};this.onKeyDown=_ref4=>{var _this$editor32,_this$editor34,_this$editor35,_this$editor36;let{event}=_ref4;if(isInput())return;const key=event.key.toLowerCase();if(((_this$editor32=this.editor)===null||_this$editor32===void 0?void 0:_this$editor32.props.isReview)&&key!=='v')return;// Judgment modifier keyboard\nif(event.altKey||event.shiftKey){return;}if(rootStore.review.drawMode){this.drawOnKeyDown(event,key);}else if(rootStore.review.isEnabled){this.QaOnKeyDown(event,key);}switch(key){case' ':event.preventDefault();if(rootStore.review.isEnabled){var _this$editor33;(_this$editor33=this.editor)===null||_this$editor33===void 0?void 0:_this$editor33.props.handleChangeDrawMode(!rootStore.review.drawMode);}break;case'f':event.preventDefault();if(screenfull.isEnabled){screenfull.toggle();}break;// case 'g':\n//   event.preventDefault();\n//   if (this.editor && this.editor.gridLayer) {\n//     this.editor.gridLayer.visible = !rootStore.setting.isGridVisible;\n//   }\n//   rootStore.setting.setGridVisible(!rootStore.setting.isGridVisible);\n//   break;\ncase's':event.preventDefault();(_this$editor34=this.editor)===null||_this$editor34===void 0?void 0:_this$editor34.props.onSave();break;case'z':event.preventDefault();if(event.ctrlKey)(_this$editor35=this.editor)===null||_this$editor35===void 0?void 0:_this$editor35.props.handleUndo();break;case'y':event.preventDefault();if(event.ctrlKey)(_this$editor36=this.editor)===null||_this$editor36===void 0?void 0:_this$editor36.props.handleRedo();break;case'v':if(!rootStore.review.selectedReview){event.preventDefault();if(event.ctrlKey){var _this$editor37;(_this$editor37=this.editor)===null||_this$editor37===void 0?void 0:_this$editor37.props.setReview();}}break;default:}};this.QaOnKeyDown=(event,key)=>{var _this$editor38;if((_this$editor38=this.editor)===null||_this$editor38===void 0?void 0:_this$editor38.props.readonly)return;switch(key){case'2':event.preventDefault();this.handleQa(ReviewResult.REJECT);break;case'1':event.preventDefault();this.handleQa(ReviewResult.APPROVE);break;case'3':event.preventDefault();this.handleQa(ReviewResult.SUSPEND);break;default:}};this.drawOnKeyDown=(event,key)=>{var _this$editor39,_this$editor40,_this$editor41,_this$editor42,_this$editor43;if((_this$editor39=this.editor)===null||_this$editor39===void 0?void 0:_this$editor39.props.readonly)return;switch(key){case'delete':case'backspace':event.preventDefault();(_this$editor40=this.editor)===null||_this$editor40===void 0?void 0:_this$editor40.deleteSelectedPoints();(_this$editor41=this.editor)===null||_this$editor41===void 0?void 0:_this$editor41.deleteSelectedRectangle();break;// case 'a':\n//   event.preventDefault();\n//   this.editor?.autoAdjust();\n//   break;\n// case 'c':\n//   event.preventDefault();\n//   this.editor?.switchSmoothMode();\n//   break;\ncase'o':event.preventDefault();(_this$editor42=this.editor)===null||_this$editor42===void 0?void 0:_this$editor42.props.editShapeForm();break;case'p':event.preventDefault();(_this$editor43=this.editor)===null||_this$editor43===void 0?void 0:_this$editor43.props.editGroupForm();break;// case 'r':\n//   event.preventDefault();\n//   this.editor?.setCategoryAsCircle();\n//   break;\n// case 'v':\n//   event.preventDefault();\n//   this.editor?.toggleSelectedPointVisibility();\n//   break;\ndefault:}};this.editor=editor;}};","map":{"version":3,"names":["Paper","screenfull","v4","uuid","message","SHAPE_TYPE","CategoryPathShape","LandmarkEditType","ReviewResult","HandleType","isInput","formatMessage","rootStore","Tool","constructor","editor","downPoint","downCenter","mouseDown","dragging","lastClick","movingPaths","movingShapes","dragType","movingSegments","movingHandles","undefined","affectedCategories","selectPath","minArea","isRightButton","event","which","modifiers","space","isCtrlKey","ctrlKey","onMouseDown","view","projectToView","point","center","currentClick","Date","now","interval","_this$editor$warningB","warningBtn","item","instanceId","groupName","shapeIds","id","data","review","setSelectedReview","frameIndex","props","currentFrame","result","REJECT","missingReviews","find","r","setSelectedMissingReview","isEnabled","drawMode","selectedMissingReview","type","hitsType","hits","KEYPOINT_BOX","selectedInstanceId","selectedGroupName","index","selectedPoints","length","isShapeInSelectedShapes","selectedRectangles","Object","values","includes","handleIn","handleOut","segIndex","path","pointCategory","category","pathId","points","segment","pointIndex","actual","HANDLE_IN","opposite","hitItemType","RECTANGLE_PATH","RECTANGLE","RECTANGLE_POINT","parent","controlIndex","KEYPOINT","shapeId","_this$editor","setSelectedShape","shapeType","RECTANGLE_GROUP","_this$editor2","bounds","topLeft","topRight","bottomRight","bottomLeft","children","Path","add","closed","setMultiShapesUnselected","localPoint","getPointInImage","activeTool","CIRCLE","canAddShape","segments","strokeColor","strokeWidth","strokeScaling","canvasContainer","current","_this$editor3","selectedShapeInfo","addRectangle","rectangleBox","getShapeByKey","push","onMouseDrag","_this$editor4","_this$editor4$warning","_this$editor4$warning2","_this$editor5","_this$editor6","_this$editor7","_this$editor7$warning","rotation","Math","round","targetPoint","rotate","deltaPixel","subtract","candidateCenter","divide","zoom","position","set","isReview","readonly","resize","localLastPoint","lastPoint","offsetX","x","offsetY","y","abs","forEach","movingShape","categoryName","displayColor","_this$editor8","shapeInfo","_this$editor9","_this$editor10","categoryKey","concat","categoryPathShapes","getPathByCategory","isCircle","categories","c","name","findIndex","affected","sortedKeys","keys","sort","a","b","pIndex1","pIndex2","ceil","updatePath","movingSegment","_ref","_this$editor11","container","updateCirclePath","_this$editor12","onMouseUp","_this$editor14","_this$editor14$warnin","_this$editor26","_this$editor13","drag","finishMissingReview","updateMissingReview","_this$editor22","_this$editor17","otherPoints","_ref2","_this$editor15","updatedShapes","_ref3","shape","_this$editor16","selectedShapeStatus","updatePointsPosition","map","movingPoint","_this$editor18","updateRectanglePosition","filter","movingRectangle","width","height","_this$editor19","deleteSelectedRectangle","warning","_this$editor20","_this$editor21","groupInfo","rectInfo","drawRectangle","visible","remove","drawWarnings","_this$editor23","mainLayer","_this$editor24","_this$editor25","localToGlobal","hitTestAll","fill","tolerance","getDistance","Set","selectedGroup","isOneGroup","seg","contains","size","setMultiShapesSelected","Array","from","addKeypoint","setNextEmptyShape","handleQa","_this$editor27","_this$editor28","_this$editor30","_this$editor29","_this$editor31","selectedReview","setReview","SUSPEND","APPROVE","success","toLocaleUpperCase","onKeyDown","_ref4","_this$editor32","_this$editor34","_this$editor35","_this$editor36","key","toLowerCase","altKey","shiftKey","drawOnKeyDown","QaOnKeyDown","preventDefault","_this$editor33","handleChangeDrawMode","toggle","onSave","handleUndo","handleRedo","_this$editor37","_this$editor38","_this$editor39","_this$editor40","_this$editor41","_this$editor42","_this$editor43","deleteSelectedPoints","editShapeForm","editGroupForm"],"sources":["/Users/qzheng/Documents/webroot/annotation_tools/src/components/keypoint/tools/Tool.ts"],"sourcesContent":["import Paper from 'paper';\nimport screenfull from 'screenfull';\nimport { v4 as uuid } from 'uuid';\nimport { message } from 'antd';\nimport Canvas, { SHAPE_TYPE } from '../components/Canvas';\nimport { CategoryPathShape, GroupInfo, LandmarkEditType, UpdatedShape, ReviewResult, HandleType, Group } from '../types';\nimport { isInput } from '../../../utils';\nimport formatMessage from '../locales';\nimport rootStore from '../store/RootStore';\n\nexport interface ToolEventExtend extends paper.ToolEvent {\n  event: MouseEvent;\n  mouseDown: boolean;\n}\n\nexport interface ToolProps extends paper.Tool {\n  mouseDown: boolean;\n}\n\nexport interface MoveHandles extends Group {\n  actual: paper.Point;\n  opposite: paper.Point;\n  type: HandleType;\n  pointIndex: number;\n  pathId: string;\n  frameIndex: number;\n}\n\nexport default class Tool extends Paper.Tool {\n  editor: Canvas | undefined;\n\n  downPoint: paper.Point | null = null;\n\n  downCenter: paper.Point | null = null;\n\n  mouseDown = false;\n\n  dragging = false;\n\n  lastClick = -1;\n\n  movingPaths: paper.Path[] = [];\n\n  movingShapes: paper.Item[] = [];\n\n  dragType = '';\n\n  movingSegments: paper.Segment[] = [];\n\n  movingHandles: MoveHandles | undefined = undefined;\n\n  affectedCategories: { instanceId: string, category: string, groupName: string, pointCategory: string }[] = [];\n\n  selectPath: paper.Path | null = null;\n\n  minArea = 3;\n\n  constructor(editor: Canvas) {\n    super();\n    this.editor = editor;\n  }\n\n  isRightButton = (event: ToolEventExtend) => event.event.which === 3 || event.modifiers.space;\n\n  isCtrlKey = (event: ToolEventExtend) => event.event.ctrlKey;\n\n  onMouseDown = (event: ToolEventExtend) => {\n    if (this.isRightButton(event)) {\n      this.downPoint = Paper.view.projectToView(event.point);\n      this.downCenter = Paper.view.center;\n      return;\n    }\n    if (this.editor) {\n      this.mouseDown = true;\n      const currentClick = Date.now();\n      const interval = currentClick - this.lastClick;\n      this.lastClick = currentClick;\n      if (interval < 300) {\n        // db click\n        if (this.editor.warningBtn?.item) {\n          const { instanceId, groupName, shapeIds, id } = this.editor.warningBtn.item.data || {};\n          if (instanceId && groupName && shapeIds !== undefined) {\n            rootStore.review.setSelectedReview({ frameIndex: this.editor.props.currentFrame, instanceId, groupName, shapeIds, result: ReviewResult.REJECT });\n          } else if (id) {\n            const review = rootStore.review.missingReviews.find((r) => r.id === id);\n            rootStore.review.setSelectedMissingReview(review, true);\n          }\n        }\n        return;\n      }\n      if (rootStore.review.isEnabled && !rootStore.review.drawMode && rootStore.review.selectedMissingReview && rootStore.review.selectedMissingReview.data === undefined) {\n        // create missing dot when mouse up\n        return;\n      }\n      const { type: hitsType } = this.editor.hits || {};\n      if (!this.isCtrlKey(event) && this.editor.hits && this.editor.hits.item.data.type !== SHAPE_TYPE.KEYPOINT_BOX) {\n        const { instanceId: selectedInstanceId, groupName: selectedGroupName, index, id } = this.editor.hits.item.data;\n        // move start\n        if (this.editor.selectedPoints.length > 0 && this.editor.isShapeInSelectedShapes(selectedInstanceId, selectedGroupName, index)) {\n          // multi points\n          this.movingShapes = this.editor.selectedPoints;\n        } else if (this.editor.selectedRectangles.length > 0 && this.editor.isShapeInSelectedShapes(selectedInstanceId, selectedGroupName, id)) {\n          // multi rectangles\n          this.movingShapes = this.editor.selectedRectangles;\n        } else if (Object.values(HandleType).includes(hitsType as HandleType)) {\n          const { currentFrame } = this.editor.props;\n          const { handleIn, handleOut, index: segIndex, path: { data: { instanceId, groupName, pointCategory: category, id: pathId, points } } } = this.editor.hits.segment;\n          const pointIndex = points[segIndex];\n          this.movingHandles = {\n            actual: hitsType === HandleType.HANDLE_IN ? handleIn : handleOut,\n            opposite: hitsType === HandleType.HANDLE_IN ? handleOut : handleIn,\n            type: hitsType as HandleType,\n            pointIndex,\n            pathId,\n            instanceId,\n            groupName,\n            category,\n            frameIndex: currentFrame\n          };\n        } else if (this.editor.hits.item) {\n          const { type: hitItemType } = this.editor.hits.item.data;\n          if (\n            (\n              hitItemType === SHAPE_TYPE.RECTANGLE_PATH ||\n              hitItemType === SHAPE_TYPE.RECTANGLE ||\n              hitItemType === SHAPE_TYPE.RECTANGLE_POINT\n            ) &&\n            this.editor.hits.item.parent\n          ) {\n            // rectangle-control\n            this.movingShapes = [this.editor.hits.item.parent];\n            if (hitItemType === SHAPE_TYPE.RECTANGLE_PATH) {\n              switch (this.editor.hits.item.data.controlIndex) {\n                case 0:\n                  this.dragType = 'top';\n                  break;\n                case 1:\n                  this.dragType = 'right';\n                  break;\n                case 2:\n                  this.dragType = 'bottom';\n                  break;\n                case 3:\n                  this.dragType = 'left';\n                  break;\n                default:\n                  break;\n              }\n            } else if (hitItemType === SHAPE_TYPE.RECTANGLE_POINT) {\n              switch (this.editor.hits.item.data.controlIndex) {\n                case 0:\n                  this.dragType = 'tl';\n                  break;\n                case 1:\n                  this.dragType = 'tr';\n                  break;\n                case 2:\n                  this.dragType = 'br';\n                  break;\n                case 3:\n                  this.dragType = 'bl';\n                  break;\n                default:\n                  break;\n              }\n            } else {\n              this.dragType = 'center';\n            }\n          } else if (hitItemType === SHAPE_TYPE.KEYPOINT) {\n            // single point\n            this.movingShapes = [this.editor.hits.item];\n          }\n        }\n        this.affectedCategories = [];\n        this.movingSegments = [];\n        if (this.movingShapes.length === 1) {\n          const { instanceId, category, groupName, index: pointIndex, type, id: shapeId } = this.movingShapes[0].data;\n          if (type === SHAPE_TYPE.KEYPOINT) {\n            this.editor?.props.setSelectedShape(pointIndex, { instanceId, category, groupName, shapeType: LandmarkEditType.KEYPOINT });\n          } else if (type === SHAPE_TYPE.RECTANGLE_GROUP) {\n            const { bounds: { topLeft, topRight, bottomRight, bottomLeft } } = this.movingShapes[0].children[0];\n            this.selectPath = new Paper.Path();\n            this.selectPath.data.id = shapeId;\n            this.selectPath.add(topLeft);\n            this.selectPath.add(topRight);\n            this.selectPath.add(bottomRight);\n            this.selectPath.add(bottomLeft);\n            this.selectPath.closed = true;\n            this.editor?.props.setSelectedShape(shapeId, { instanceId, category, groupName, shapeType: LandmarkEditType.RECTANGLE });\n          }\n        }\n\n        if (!rootStore.review.drawMode) {\n          this.movingShapes = [];\n          this.selectPath = null;\n        }\n      } else {\n        // select start\n        this.editor.setMultiShapesUnselected();\n        const localPoint = this.editor.getPointInImage(Paper.view.projectToView(event.point));\n        if (this.editor.activeTool === CategoryPathShape.CIRCLE || (this.editor.activeTool === CategoryPathShape.RECTANGLE && !this.editor.canAddShape())) {\n          this.selectPath = new Paper.Path({\n            segments: [localPoint],\n            strokeColor: 'red',\n            strokeWidth: 2,\n            strokeScaling: false,\n          });\n        } else if (\n          this.editor.activeTool === CategoryPathShape.RECTANGLE &&\n          this.editor.canAddShape() &&\n          this.editor.canvasContainer.current\n        ) {\n          const { instanceId, category, groupName } = this.editor.props.selectedShapeInfo as GroupInfo;\n          const id = uuid();\n          this.selectPath = new Paper.Path();\n          this.selectPath.data.id = id;\n          this.selectPath.add(localPoint);\n          this.selectPath.add(localPoint);\n          this.selectPath.add(localPoint);\n          this.selectPath.add(localPoint);\n          this.selectPath.closed = true;\n          this.editor.addRectangle(this.selectPath, this.editor?.props.selectedShapeInfo as GroupInfo);\n          const rectangleBox = this.editor.getShapeByKey(instanceId, groupName, id);\n          this.editor.props.setSelectedShape(id, { instanceId, category, groupName, shapeType: LandmarkEditType.RECTANGLE });\n          this.movingShapes.push(rectangleBox);\n          this.dragType = 'br';\n          this.dragging = true;\n        }\n      }\n    }\n  };\n\n  onMouseDrag = (event: ToolEventExtend) => {\n    if (this.isRightButton(event)) {\n      if (!this.downPoint || !this.downCenter) {\n        this.downPoint = Paper.view.projectToView(event.point);\n        this.downCenter = Paper.view.center;\n      }\n\n      const rotation = Math.round(Paper.view.rotation);\n      const targetPoint = Paper.view.projectToView(event.point).rotate(-rotation, this.downPoint);\n      const deltaPixel = targetPoint.subtract(this.downPoint);\n      const candidateCenter = this.downCenter.subtract(deltaPixel.divide(Paper.view.zoom));\n      Paper.view.center = candidateCenter;\n      return;\n    }\n    if (rootStore.review.isEnabled && !rootStore.review.drawMode && this.editor?.warningBtn?.item.data?.id) {\n      // move missing review\n      if (this.editor) {\n        const point = this.editor.getPointInImage(Paper.view.projectToView(event.point));\n        this.editor.warningBtn.item.parent.position.set(point);\n      }\n      return;\n    }\n    if (this.editor?.props.isReview || this.editor?.props.readonly || this.editor?.warningBtn?.item) return;\n    let resize = false;\n    if (this.editor) {\n      const localPoint = this.editor.getPointInImage(Paper.view.projectToView(event.point));\n      const localLastPoint = this.editor.getPointInImage(Paper.view.projectToView(event.lastPoint));\n      const offsetX = localPoint.x - localLastPoint.x;\n      const offsetY = localPoint.y - localLastPoint.y;\n      if (Math.abs(offsetX) > 0 || Math.abs(offsetY) > 0) {\n        this.dragging = true;\n      }\n\n      if (this.movingShapes.length > 0) {\n        // moving\n        /* eslint-disable no-param-reassign */\n        this.movingShapes.forEach((movingShape) => {\n          const { frameIndex, instanceId, category, groupName, pointCategory: categoryName, index, type, displayColor } = movingShape.data;\n          if (type === SHAPE_TYPE.RECTANGLE_GROUP && this.selectPath) {\n            resize = true;\n            switch (this.dragType) {\n              case 'tl':\n                this.selectPath.segments[0].point.x += offsetX;\n                this.selectPath.segments[0].point.y += offsetY;\n                this.selectPath.segments[1].point.y += offsetY;\n                this.selectPath.segments[3].point.x += offsetX;\n                break;\n              case 'tr':\n                this.selectPath.segments[1].point.x += offsetX;\n                this.selectPath.segments[1].point.y += offsetY;\n                this.selectPath.segments[0].point.y += offsetY;\n                this.selectPath.segments[2].point.x += offsetX;\n                break;\n              case 'br':\n                this.selectPath.segments[2].point.x += offsetX;\n                this.selectPath.segments[2].point.y += offsetY;\n                this.selectPath.segments[3].point.y += offsetY;\n                this.selectPath.segments[1].point.x += offsetX;\n                break;\n              case 'bl':\n                this.selectPath.segments[3].point.x += offsetX;\n                this.selectPath.segments[3].point.y += offsetY;\n                this.selectPath.segments[2].point.y += offsetY;\n                this.selectPath.segments[0].point.x += offsetX;\n                break;\n              case 'top':\n                this.selectPath.segments[0].point.y += offsetY;\n                this.selectPath.segments[1].point.y += offsetY;\n                break;\n              case 'right':\n                this.selectPath.segments[1].point.x += offsetX;\n                this.selectPath.segments[2].point.x += offsetX;\n                break;\n              case 'bottom':\n                this.selectPath.segments[2].point.y += offsetY;\n                this.selectPath.segments[3].point.y += offsetY;\n                break;\n              case 'left':\n                this.selectPath.segments[3].point.x += offsetX;\n                this.selectPath.segments[0].point.x += offsetX;\n                break;\n              case 'center':\n                this.selectPath.segments[0].point.x += offsetX;\n                this.selectPath.segments[0].point.y += offsetY;\n                this.selectPath.segments[1].point.x += offsetX;\n                this.selectPath.segments[1].point.y += offsetY;\n                this.selectPath.segments[2].point.x += offsetX;\n                this.selectPath.segments[2].point.y += offsetY;\n                this.selectPath.segments[3].point.x += offsetX;\n                this.selectPath.segments[3].point.y += offsetY;\n                break;\n              default:\n                break;\n            }\n            const shapeInfo: GroupInfo = {\n              instanceId,\n              category,\n              groupName,\n              shapeType: LandmarkEditType.RECTANGLE,\n              displayColor,\n            };\n            this.editor?.addRectangle(this.selectPath, shapeInfo, false);\n          } else if (type === SHAPE_TYPE.KEYPOINT) {\n            const categoryKey = `${frameIndex}_${instanceId}_${groupName}_${categoryName}`;\n            if (this.editor?.props.categoryPathShapes[categoryKey] === CategoryPathShape.CIRCLE) {\n              const path = this.editor.getPathByCategory(instanceId, groupName, categoryName);\n              if (path && path.data.isCircle) {\n                const pointCategory = this.editor.props.categories.find((c) => c.name === categoryName);\n                if (pointCategory) {\n                  if (\n                    this.affectedCategories.findIndex((affected) => affected.instanceId === instanceId && affected.groupName === groupName && affected.pointCategory === categoryName) < 0) {\n                    this.affectedCategories.push({\n                      instanceId,\n                      category,\n                      groupName,\n                      pointCategory: categoryName\n                    });\n                  }\n                  const sortedKeys = [...pointCategory.keys].sort((a, b) => a - b);\n                  const pIndex1 = sortedKeys[0];\n                  const pIndex2 = sortedKeys[Math.ceil(sortedKeys.length / 2)];\n                  if (index !== pIndex1 && index !== pIndex2) {\n                    return;\n                  }\n                }\n              }\n            }\n            this.editor?.updatePath(movingShape as paper.Shape, { x: movingShape.position.x + offsetX, y: movingShape.position.y + offsetY });\n            movingShape.position.x += offsetX;\n            movingShape.position.y += offsetY;\n          }\n        });\n        this.movingSegments.forEach((movingSegment) => {\n          movingSegment.point.x += offsetX;\n          movingSegment.point.y += offsetY;\n        });\n        this.affectedCategories.forEach(({ instanceId, category, groupName, pointCategory }) => {\n          const container = { instanceId, category, groupName };\n          this.editor?.updateCirclePath(pointCategory, true, container);\n        });\n        /* eslint-enable no-param-reassign */\n      } else if (this.movingHandles) {\n        // moving handle point\n        this.movingHandles.actual.x += offsetX;\n        this.movingHandles.actual.y += offsetY;\n        this.movingHandles.opposite.x = -this.movingHandles.actual.x;\n        this.movingHandles.opposite.y = -this.movingHandles.actual.y;\n      } else if (this.selectPath) {\n        // draw select path\n        if (this.editor.activeTool === CategoryPathShape.CIRCLE || (this.editor.activeTool === CategoryPathShape.RECTANGLE && !this.editor.canAddShape())) {\n          this.selectPath.add(localPoint);\n        } else if (this.editor.activeTool === CategoryPathShape.RECTANGLE && !resize) {\n          this.selectPath.segments[1].point.x += offsetX;\n          this.selectPath.segments[2].point.x += offsetX;\n          this.selectPath.segments[2].point.y += offsetY;\n          this.selectPath.segments[3].point.y += offsetY;\n          this.editor.addRectangle(this.selectPath, this.editor?.props.selectedShapeInfo as GroupInfo, false);\n        }\n      }\n    }\n  };\n\n  onMouseUp = (event: ToolEventExtend) => {\n    if (this.isRightButton(event)) {\n      this.editor?.drag(Paper.view.center);\n      this.downPoint = null;\n      this.downCenter = null;\n      return;\n    }\n    this.mouseDown = false;\n    if (rootStore.review.isEnabled && !rootStore.review.drawMode && rootStore.review.selectedMissingReview && rootStore.review.selectedMissingReview.data === undefined) {\n      // create missing dot when mouse up\n      if (this.editor) {\n        const point = this.editor.getPointInImage(Paper.view.projectToView(event.point));\n        rootStore.review.finishMissingReview(point);\n      }\n      return;\n    }\n    if (this.editor?.warningBtn?.item) {\n      const { data, position } = this.editor.warningBtn.item;\n      if (data?.id) {\n        // finish move missing review\n        const review = rootStore.review.missingReviews.find((r) => r.id === data.id);\n        if (review) {\n          rootStore.review.updateMissingReview({\n            ...review,\n            data: {\n              position: { x: position.x, y: position.y },\n            },\n          });\n          rootStore.review.setSelectedMissingReview(review);\n        }\n      }\n      return;\n    }\n    if (!this.isCtrlKey(event) && this.movingShapes.length > 0) {\n      // move ends\n      if (this.dragging && this.editor) {\n        if (this.editor.activeTool === CategoryPathShape.CIRCLE) {\n          const otherPoints: UpdatedShape[] = [];\n          this.affectedCategories.forEach(({ instanceId, category, groupName, pointCategory }) => {\n            const container = { instanceId, category, groupName };\n            const updatedShapes = this.editor?.updateCirclePath(pointCategory, true, container);\n            if (updatedShapes) {\n              updatedShapes.forEach(({ shape, index }) => {\n                if (index !== undefined && shape) {\n                  otherPoints.push({\n                    frameIndex: this.editor?.props.selectedShapeStatus.frameIndex || 0,\n                    instanceId,\n                    category,\n                    groupName,\n                    index,\n                    shapeType: LandmarkEditType.KEYPOINT,\n                    shape\n                  });\n                }\n              });\n            }\n          });\n          this.editor?.updatePointsPosition([...this.movingShapes.map((movingPoint) => {\n            const { frameIndex, instanceId, category, groupName, index } = movingPoint.data;\n            return {\n              frameIndex,\n              instanceId,\n              category,\n              groupName,\n              index,\n              shapeType: LandmarkEditType.KEYPOINT,\n              shape: { position: { x: movingPoint.position.x, y: movingPoint.position.y } }\n            };\n          }), ...otherPoints]);\n        } else if (this.editor.activeTool === CategoryPathShape.RECTANGLE) {\n          this.editor?.updateRectanglePosition([...this.movingShapes.filter((movingRectangle) => {\n            const { bounds: { width, height } } = movingRectangle.children[0];\n            if (width < this.minArea || height < this.minArea) {\n              this.editor?.deleteSelectedRectangle();\n              message.warning(formatMessage('MIN_SIZE_ALERT'));\n              return false;\n            }\n            return true;\n          }).map((movingRectangle) => {\n            const { instanceId, category, groupName, id, displayColor } = movingRectangle.data;\n            const { bounds: { x, y, width, height } } = movingRectangle.children[0];\n            const groupInfo = { frameIndex: this.editor?.props.selectedShapeStatus.frameIndex || 0, instanceId, category, groupName };\n            const rectInfo = {\n              x,\n              y,\n              width,\n              height,\n              displayColor: displayColor || '#5cdef0',\n            };\n            this.editor?.drawRectangle(rectInfo, groupInfo, id);\n            return {\n              ...groupInfo,\n              id,\n              shapeType: LandmarkEditType.RECTANGLE,\n              shape: {\n                ...rectInfo,\n                id,\n                visible: true, // default is visible when point added\n              },\n            };\n          })]);\n        }\n      }\n      if (this.selectPath) {\n        this.selectPath.remove();\n        this.selectPath = null;\n      }\n      this.movingShapes = [];\n      this.movingSegments = [];\n      this.affectedCategories = [];\n      this.editor?.drawWarnings();\n    } else if (this.movingHandles) {\n      // handle move ends\n      this.movingHandles = undefined;\n    } else if (this.dragging && this.selectPath) {\n      // select ends\n      if (this.editor?.mainLayer) {\n        const center = this.editor.mainLayer.localToGlobal(this.selectPath.bounds.center);\n        const hits = this.editor.mainLayer.hitTestAll(center, {\n          fill: true,\n          segments: true,\n          tolerance: this.selectPath.bounds.topLeft.getDistance(this.selectPath.bounds.bottomRight) / 2,\n        });\n\n        const selectedPoints: Set<paper.Shape> = new Set();\n        const selectedRectangles: Set<paper.Group> = new Set();\n        let selectedGroup: string | undefined;\n        const isOneGroup = (instanceId: string, groupName: string) => {\n          if (!selectedGroup) {\n            selectedGroup = `${instanceId}_${groupName}`;\n            return true;\n          }\n          return `${instanceId}_${groupName}` === selectedGroup;\n        };\n        hits.forEach((seg) => {\n          if (this.selectPath!.contains(seg.item.bounds.center)) {\n            if (seg.item.data.type === SHAPE_TYPE.KEYPOINT) {\n              if (isOneGroup(seg.item.data.instanceId, seg.item.data.groupName)) {\n                selectedPoints.add(seg.item as paper.Shape);\n              }\n            } else if (\n              seg.item.data.type === SHAPE_TYPE.RECTANGLE ||\n              seg.item.data.type === SHAPE_TYPE.RECTANGLE_POINT ||\n              seg.item.data.type === SHAPE_TYPE.RECTANGLE_PATH\n            ) {\n              if (isOneGroup(seg.item.parent.data.instanceId, seg.item.parent.data.groupName)) {\n                selectedRectangles.add(seg.item.parent as paper.Group);\n              }\n            }\n          }\n        });\n\n        // selected\n        if (selectedPoints.size) this.editor?.setMultiShapesSelected(Array.from(selectedPoints), CategoryPathShape.CIRCLE);\n        if (selectedRectangles.size) this.editor?.setMultiShapesSelected(Array.from(selectedRectangles), CategoryPathShape.RECTANGLE);\n      }\n      this.selectPath.remove();\n      this.selectPath = null;\n    } else if (this.editor?.canAddShape() && this.editor.activeTool === CategoryPathShape.CIRCLE) {\n      // add point\n      const point = Paper.view.projectToView(event.point);\n      // if (this.editor?.isPointInImage(point)) {\n      this.editor.addKeypoint(point);\n      // }\n    } else if (this.editor && rootStore.review.drawMode) {\n      // clear selection and move next\n      this.editor.props.setNextEmptyShape();\n    }\n    this.dragging = false;\n  };\n\n  handleQa = (result: ReviewResult) => {\n    if (this.editor?.props.selectedShapeStatus) {\n      const { instanceId, groupName, frameIndex, id } = this.editor.props.selectedShapeStatus;\n      let shapeIds = [];\n      if (id !== undefined) {\n        shapeIds = [id];\n      } else if (this.editor?.selectedPoints.length > 0) {\n        shapeIds = this.editor?.selectedPoints.map((point) => point.data.index);\n      } else if (this.editor?.selectedRectangles.length > 0) {\n        shapeIds = this.editor?.selectedRectangles.map((shape) => shape.data.id);\n      }\n      if (shapeIds.length) {\n        shapeIds.sort((a, b) => a - b);\n        if (result !== ReviewResult.REJECT && !rootStore.review.selectedReview) {\n          rootStore.review.setReview(\n            { result },\n            {\n              frameIndex,\n              instanceId,\n              groupName,\n              shapeIds,\n              result\n            }\n          );\n        } else {\n          rootStore.review.setSelectedReview({\n            frameIndex,\n            instanceId,\n            groupName,\n            shapeIds,\n            result\n          });\n        }\n        if ((result === ReviewResult.SUSPEND || result === ReviewResult.APPROVE) && !rootStore.review.selectedReview) {\n          message.success(formatMessage(`QC_SET_${result.toLocaleUpperCase()}`));\n        }\n      }\n    }\n  };\n\n  onKeyDown = ({ event }: { event: KeyboardEvent }) => {\n    if (isInput()) return;\n    const key = event.key.toLowerCase();\n    if (this.editor?.props.isReview && key !== 'v') return;\n    // Judgment modifier keyboard\n    if (event.altKey || event.shiftKey) {\n      return;\n    }\n\n    if (rootStore.review.drawMode) {\n      this.drawOnKeyDown(event, key);\n    } else if (rootStore.review.isEnabled) {\n      this.QaOnKeyDown(event, key);\n    }\n\n    switch (key) {\n      case ' ':\n        event.preventDefault();\n        if (rootStore.review.isEnabled) {\n          this.editor?.props.handleChangeDrawMode(!rootStore.review.drawMode);\n        }\n        break;\n      case 'f':\n        event.preventDefault();\n        if (screenfull.isEnabled) {\n          screenfull.toggle();\n        }\n        break;\n      // case 'g':\n      //   event.preventDefault();\n      //   if (this.editor && this.editor.gridLayer) {\n      //     this.editor.gridLayer.visible = !rootStore.setting.isGridVisible;\n      //   }\n      //   rootStore.setting.setGridVisible(!rootStore.setting.isGridVisible);\n      //   break;\n      case 's':\n        event.preventDefault();\n        this.editor?.props.onSave();\n        break;\n      case 'z':\n        event.preventDefault();\n        if (event.ctrlKey) this.editor?.props.handleUndo();\n        break;\n      case 'y':\n        event.preventDefault();\n        if (event.ctrlKey) this.editor?.props.handleRedo();\n        break;\n      case 'v':\n        if (!rootStore.review.selectedReview) {\n          event.preventDefault();\n          if (event.ctrlKey) {\n            this.editor?.props.setReview();\n          }\n        }\n        break;\n      default:\n    }\n  };\n\n  QaOnKeyDown = (event: KeyboardEvent, key: string) => {\n    if (this.editor?.props.readonly) return;\n    switch (key) {\n      case '2':\n        event.preventDefault();\n        this.handleQa(ReviewResult.REJECT);\n        break;\n      case '1':\n        event.preventDefault();\n        this.handleQa(ReviewResult.APPROVE);\n        break;\n      case '3':\n        event.preventDefault();\n        this.handleQa(ReviewResult.SUSPEND);\n        break;\n      default:\n    }\n  };\n\n  drawOnKeyDown = (event: KeyboardEvent, key: string) => {\n    if (this.editor?.props.readonly) return;\n    switch (key) {\n      case 'delete':\n      case 'backspace':\n        event.preventDefault();\n        this.editor?.deleteSelectedPoints();\n        this.editor?.deleteSelectedRectangle();\n        break;\n      // case 'a':\n      //   event.preventDefault();\n      //   this.editor?.autoAdjust();\n      //   break;\n      // case 'c':\n      //   event.preventDefault();\n      //   this.editor?.switchSmoothMode();\n      //   break;\n      case 'o':\n        event.preventDefault();\n        this.editor?.props.editShapeForm();\n        break;\n      case 'p':\n        event.preventDefault();\n        this.editor?.props.editGroupForm();\n        break;\n      // case 'r':\n      //   event.preventDefault();\n      //   this.editor?.setCategoryAsCircle();\n      //   break;\n      // case 'v':\n      //   event.preventDefault();\n      //   this.editor?.toggleSelectedPointVisibility();\n      //   break;\n      default:\n    }\n  };\n};\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}