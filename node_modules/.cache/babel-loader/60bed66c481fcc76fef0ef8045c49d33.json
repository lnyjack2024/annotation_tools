{"ast":null,"code":"/* eslint-disable class-methods-use-this */import React from'react';import hexToRgba from'hex-to-rgba';import WaveSurfer from'wavesurfer.js/dist/wavesurfer';import TimelinePlugin from'wavesurfer.js/dist/plugin/wavesurfer.timeline.min.js';import RegionsPlugin from'wavesurfer.js/dist/plugin/wavesurfer.regions.min.js';import CursorPlugin from'wavesurfer.js/dist/plugin/wavesurfer.cursor.min.js';import MinimapPlugin from'wavesurfer.js/src/plugin/minimap';import{connect}from'react-redux';import{v4 as uuid}from'uuid';import{cloneDeep}from'lodash';import{notification,Modal}from'antd';import{defaultColor,formatTimestamp,translate,triggerForm,StyleConfigMode,getConfigColor}from'../../constants';import{getWavesurfers,setPlayingState,setVideoValid,deleteLine,pushLine,setLineRole,parseSegments,setErrorMsg,setAudioErrorMsg,appendSegment,updateSegment,deleteSegment,setSegments,updateLineRole,updateVideoInfo,setLoading}from'../../redux/action';import'./WavesurferComp.scss';import{createLine,createSegment,isInput}from'../../redux/reducer/segmentController';import{isAnnotationReadonly}from'../../../../utils/tool-mode';import{formatTimeCallback,primaryLabelInterval,secondaryLabelInterval,timeInterval}from'../utils/TimelineUtil';import i18n from'../../locales';notification.config({top:60});export const ANCHOR_MOVEMENT_STEP=0.01;class WavesurferComp extends React.Component{constructor(){super();this.tempRegion=undefined;this.insertLine=data=>{// eslint-disable-next-line prefer-const\nconst{segmentIndex,role:currentRole,attributes,region:currentRegion}=data;const{ontology,styleConfig}=this.props;const segment=this.currentSegments[segmentIndex];const region=currentRegion||this.getRegionById(segment===null||segment===void 0?void 0:segment.id);if(region){var _styleConfig$groups;const role=currentRole||'none';let configColor='';if(attributes&&(styleConfig===null||styleConfig===void 0?void 0:(_styleConfig$groups=styleConfig.groups)===null||_styleConfig$groups===void 0?void 0:_styleConfig$groups.length)>0){configColor=getConfigColor(attributes,styleConfig.groups);}const color=hexToRgba(configColor||ontology.get(role)||defaultColor.defaultWhite,role==='none'&&!configColor?0:defaultColor.defaultAlpha);region.element.classList.add('line-region');const mark=document.createElement('div');mark.className='line-mark';mark.style.background=color;region.element.appendChild(mark);Array.from(region.element.getElementsByClassName('line-mark')).forEach((line,index,array)=>{const height=100/array.length;const top=height*index;line.style.height=\"\".concat(height,\"%\");line.style.top=\"\".concat(top,\"%\");});}};this.setCurrentZoom=newZoom=>{if(newZoom){this.current.zoom=newZoom;}const{zoom,videoIndex,wavesurfer}=this.current;if(wavesurfer){const duration=this.wavesurfers[videoIndex].getDuration();const cursorTime=this.getCursorTime();const currentTime=wavesurfer.getCurrentTime();const{offsetWidth}=wavesurfer.container;const{offsetLeft}=wavesurfer.cursor.cursor;const totalWidth=offsetWidth*zoom;const pxPerSec=totalWidth/duration;wavesurfer.zoom(pxPerSec);this.setCurrentScroll(cursorTime<0?currentTime:cursorTime,cursorTime<0?offsetWidth/2:offsetLeft,false);}};this.handleKeyDown=e=>{if(!e.key)return;if(window.disableLongAudioHotKeys)return;if(isInput())return;if(isAnnotationReadonly(this.props.toolMode))return;if(e.altKey&&this.props.segmentOverlap){this.altKeyDown=true;if(this.hoveredRegion){this.hoveredRegion.drag=false;this.hoveredRegion.resize=false;}}switch(e.keyCode){case 8:// backspace\ncase 46:// delete\nif(e.ctrlKey){this.clearAll();}else{this.deleteCurrentSegment();}break;case 90:// z\nif(e.ctrlKey){this.recallHistory('undo');}break;case 89:// y\nif(e.ctrlKey){this.recallHistory('redo');}break;default:}};this.handleKeyUp=e=>{if(!e.altKey){this.altKeyDown=false;Object.values(this.current.wavesurfer.regions.list).forEach(region=>{region.drag=true;region.resize=true;});}};this.handleRegionCreated=region=>{if(this.tempRegion)this.tempRegion.remove();region.element.classList.add('line-region');const mark=document.createElement('div');mark.className='line-mark';mark.style.height='100%';region.element.appendChild(mark);};this.handleRegionUpdate=region=>{const{annotateDisabled}=this.props;if(annotateDisabled){if(region)region.remove();return;}if(!this.props.segmentOverlap&&!region.temp){const overlappedRegions=Object.values(this.current.wavesurfer.regions.list).filter(r=>!(r.end<=region.start||r.start>=region.end)&&r!==region);if(overlappedRegions.length>0){// has overlapping\nconst minStart=Math.min(...overlappedRegions.map(r=>r.start));const maxEnd=Math.max(...overlappedRegions.map(r=>r.end));if(this.updatingRegionStart===region.start){// drag end handler\nif(region.end>minStart){region.update({end:minStart});}}else if(this.updatingRegionEnd===region.end){// drag start handler\nif(region.start<maxEnd){region.update({start:maxEnd});}}else if(region.start<this.updatingRegionStart){// move left\nregion.update({start:maxEnd,end:region.end-region.start+maxEnd});}else if(region.start>this.updatingRegionStart){// move right\nregion.update({start:region.start-region.end+minStart,end:minStart});}}}this.updatingRegionStart=region.start;this.updatingRegionEnd=region.end;this.updateRegionElement(region);};this.handleRegionEdit=(region,e)=>{const{annotateDisabled,toolMode}=this.props;const readonly=isAnnotationReadonly(toolMode)||annotateDisabled;if((readonly||(e===null||e===void 0?void 0:e.buttons)===2||(e===null||e===void 0?void 0:e.button)===2)&&!region.data.id){var _this$current$wavesur;region.temp=true;region.update({color:hexToRgba(defaultColor.defaultGray,0.2)});this.tempRegion=region;(_this$current$wavesur=this.current.wavesurfer)===null||_this$current$wavesur===void 0?void 0:_this$current$wavesur.play(region.start,region.end);this.props.setCurrentSegment({index:-1});}if(region.temp)return;this.updatingRegionStart=null;this.updatingRegionEn=null;const{id}=region.data;const duration=this.current.wavesurfer.getDuration();region.start=Math.max(region.start,0);region.end=Math.min(region.end,duration);const{minSegmentLength,segmentConfig,lineConfig}=this.props;if(!id){// create region\nif(region.end-region.start<minSegmentLength){region.remove();return;}const segment=createSegment(region.start,region.end,segmentConfig,lineConfig);// eslint-disable-next-line no-param-reassign\nregion.data.id=segment.id;region.play();this.props.appendSegment({segment});this.addHistory('segment',{segmentIndex:this.props.currentSegment,nextSegment:cloneDeep(segment),region});}else{// update region\nconst segmentIndex=this.getSegmentIndexById(id);if(segmentIndex>=0){const segment=this.currentSegments[segmentIndex];const prevSegment=cloneDeep(segment);let{start,end}=region;if(end-start<minSegmentLength){const draggingStart=end===segment.end;const draggingEnd=start===segment.start;if(draggingStart){start=end-minSegmentLength;}else if(draggingEnd){end=start+minSegmentLength;}}region.update({start,end});segment.start=start;segment.end=end;this.props.updateSegment({segment});this.addHistory('segment',{segmentIndex,prevSegment,nextSegment:cloneDeep(segment),region});}}};this.renderSegments=()=>{const{videos,results}=this.props;videos.forEach((v,i)=>{if(v.ready){this.wavesurfers[i].clearRegions();this.initRegion(i,results[i]);}});};this.wavesurfers=[];this.undoList=[];this.redoList=[];this.container={minimap:null,// Minimap container\nwaveform:null,// Waveform container\ntimeline:null,// Timeline container\naudioContainer:null,// Cursor container\nvideoContainer:null// Video container\n};this.current={zoom:1,videoIndex:0,wavesurfer:null,undoList:null,redoList:null,segmentSelected:null};this.updatingRegionStart=null;this.updatingRegionEnd=null;this.altKeyDown=false;this.hoveredRegion=null;this.state={cursorTime:0// seconds\n};}get currentSegments(){return this.props.results[this.current.videoIndex];}componentDidMount(){this.props.getWavesurfers({wavesurfers:this});this.timer=setInterval(()=>{if(!this.props.isPlaying)return;const{wavesurfer}=this.current;const currentTime=wavesurfer.getCurrentTime();const duration=wavesurfer.getDuration();wavesurfer.timestamp.innerText=\"\".concat(formatTimestamp(currentTime),\"/\").concat(formatTimestamp(duration));this.setCurrentScroll(currentTime,0,true);},200);window.addEventListener('resize',this.setCurrentZoom);window.addEventListener('keydown',this.handleKeyDown);window.addEventListener('keyup',this.handleKeyUp);window.addEventListener('contextmenu',this.onContextmenu);}onContextmenu(e){e.preventDefault();}shouldComponentUpdate(nextProps){const currSeg=this.props.results[this.props.currentVideo][this.props.currentSegment];const nextSeg=nextProps.results[nextProps.currentVideo][nextProps.currentSegment];// return !isEqual(currSeg, nextSeg);\nreturn(currSeg===null||currSeg===void 0?void 0:currSeg.id)!==(nextSeg===null||nextSeg===void 0?void 0:nextSeg.id)||nextProps.isLoadedAlaw!==this.props.isLoadedAlaw;}componentDidUpdate(){if(this.props.isLoadedAlaw){this.initWaveSurfer();}else{this.setCurrentSegment(this.props.currentSegment);}}componentWillUnmount(){if(this.timer){clearInterval(this.timer);this.timer=null;}window.removeEventListener('resize',this.setCurrentZoom);window.removeEventListener('keydown',this.handleKeyDown);window.removeEventListener('keyup',this.handleKeyUp);window.removeEventListener('contextmenu',this.onContextmenu);if(Array.isArray(this.container.audioContainer)){this.container.audioContainer.forEach(c=>{if(c){c.removeEventListener('mousemove',this.updateMeasurement);c.removeEventListener('wheel',this.updateMeasurement);}});}}getAudioContainer(waveform,timeline,audioContainer,minimap){this.container.waveform=waveform;this.container.timeline=timeline;this.container.audioContainer=audioContainer;this.container.minimap=minimap;if(this.container.videoContainer){this.initWaveSurfer();}}getVideoContainer(videoContainer){this.container.videoContainer=videoContainer;if(this.container.waveform){this.initWaveSurfer();}}getCursorTime(){return this.state.cursorTime;}getSegmentIndexById(id){return this.currentSegments.findIndex(seg=>seg.id===id);}getRegionById(id){return Object.values(this.current.wavesurfer.regions.list).find(r=>r.data.id===id);}initWaveSurfer(){const size=this.props.videos.length;const urls=[];for(let i=0;i<size;i+=1){if(this.props.videos[i].loaded&&!this.wavesurfers[i]){this.wavesurfers[i]=WaveSurfer.create({container:this.container.waveform[i],autoCenter:false,backend:'MediaElement',normalize:true,loopSelection:true,scrollParent:true,backgroundColor:defaultColor.defaultGray,waveColor:defaultColor.darkGray,progressColor:defaultColor.darkGray,cursorColor:defaultColor.defaultRed,pixelRatio:1,maxCanvasWidth:4000,plugins:[RegionsPlugin.create(),CursorPlugin.create({width:'1px',height:'10px',container:this.container.audioContainer[i],color:defaultColor.defaultGreen,showTime:true,opacity:1,customShowTimeStyle:{color:defaultColor.defaultGreen,fontSize:'14px',paddingLeft:'5px',position:'absolute',bottom:'3px'},formatTimeCallback:sec=>{this.setState({cursorTime:sec});return formatTimestamp(sec);}}),TimelinePlugin.create({container:this.container.timeline[i],primaryFontColor:defaultColor.defaultWhite,secondaryFontColor:defaultColor.defaultWhite,primaryColor:defaultColor.defaultWhite,secondaryColor:defaultColor.defaultWhite,fontSize:'10',notchPercentHeight:30,timeInterval,primaryLabelInterval,secondaryLabelInterval,formatTimeCallback}),MinimapPlugin.create({container:this.container.minimap[i]})]});urls[i]=this.container.videoContainer[i];this.wavesurfers[i].on('ready',()=>{this.wavesurfers[i].pause();this.wavesurfers[i].enableDragSelection({color:hexToRgba(this.props.ontology.get('none'),defaultColor.defaultAlpha)});let segments;try{segments=this.parseSegments(i);}catch(e){this.props.setErrorMsg({errorMsg:e.toString()});return;}this.props.setLoading(false);this.initRegion(i,segments);this.initMiniMap(i);if(i===0){this.setNewVideo();}this.wavesurfers[i].on('play',()=>this.handlePlayPause());this.wavesurfers[i].on('pause',()=>this.handlePlayPause());this.wavesurfers[i].on('region-created',this.handleRegionCreated);this.wavesurfers[i].on('region-updated',region=>this.handleRegionUpdate(region));this.wavesurfers[i].on('region-update-end',(region,e)=>this.handleRegionEdit(region,e));this.wavesurfers[i].on('region-out',region=>this.handleRegionOut(region));this.wavesurfers[i].on('region-in',region=>this.handleRegionIn(region));this.wavesurfers[i].on('region-click',(region,e)=>this.handleRegionClick(region,e));this.wavesurfers[i].on('region-contextmenu',(_,e)=>e.preventDefault());this.wavesurfers[i].on('region-mouseenter',region=>{this.hoveredRegion=region;if(this.altKeyDown){this.hoveredRegion.drag=false;this.hoveredRegion.resize=false;}});this.wavesurfers[i].on('region-mouseleave',()=>{this.hoveredRegion=null;});this.props.setVideoValid({index:i});this.props.updateVideoInfo({index:i,duration:this.wavesurfers[i].getDuration()});});this.wavesurfers[i].on('error',error=>{notification.error({message:\"\".concat(translate('AUDIO_ERROR'),\" \").concat(translate('RECORD_PREFIX')).concat(i+1)});console.log('error',urls[i].src,error);this.props.setAudioErrorMsg({index:i,errorMsg:\"\".concat(translate('AUDIO_ERROR'),\" \").concat(translate('RECORD_PREFIX')).concat(i+1,\" \").concat(urls[i].src,\" \").concat(error)});this.wavesurfers[i].destroy();if(i===size-1){this.props.setLoading(false);}});this.wavesurfers[i].on('redraw',this.props.setXScroll);this.undoList[i]=[];this.redoList[i]=[];this.container.audioContainer[i].addEventListener('mousemove',()=>this.updateMeasurement(i));this.container.audioContainer[i].addEventListener('wheel',()=>this.updateMeasurement(i));this.wavesurfers[i].load(this.container.videoContainer[i]);}}}initRegion(videoIndex,segments){// setup initial regions\nconst wavesurfer=this.wavesurfers[videoIndex];const{toolMode,ontology}=this.props;const readonly=isAnnotationReadonly(toolMode);for(let segmentIndex=0;segmentIndex<segments.length;segmentIndex+=1){const segment=segments[segmentIndex];const region=wavesurfer.addRegion({start:segment.start,end:segment.end,color:hexToRgba(ontology.get('none'),defaultColor.defaultAlpha),drag:!readonly,resize:!readonly});region.data={id:segment.id};segment.content.forEach((line,lineIndex)=>{var _this$props$styleConf;const attributes=((_this$props$styleConf=this.props.styleConfig)===null||_this$props$styleConf===void 0?void 0:_this$props$styleConf.mode)===StyleConfigMode.segment?segment.attributes:line.attributes;this.insertLine({videoIndex,segmentIndex,region,lineIndex,role:line.role,attributes});});this.updateRegionElement(region);}}deleteLine(data){const{segmentIndex,lineIndex}=data;const segment=this.currentSegments[segmentIndex];const region=this.getRegionById(segment.id);if(region){var _removeEle$;const lineEleArray=Array.from(region.element.getElementsByClassName('line-mark'));const removeEle=lineEleArray.splice(lineIndex,1);(_removeEle$=removeEle[0])===null||_removeEle$===void 0?void 0:_removeEle$.remove();lineEleArray.forEach((line,index,array)=>{const height=100/array.length;const top=height*index;line.style.height=\"\".concat(height,\"%\");line.style.top=\"\".concat(top,\"%\");});}}initMiniMap(i){const wave=this.container.minimap[i].getElementsByTagName('wave')[0];const timestamp=document.createElement('div');const currentTime=this.wavesurfers[i].getDuration();timestamp.className='wavesurfer-timestamp';timestamp.innerText=\"00:00.000/\".concat(formatTimestamp(currentTime));wave.appendChild(timestamp);this.wavesurfers[i].timestamp=timestamp;}parseSegments(videoIndex){const{results,ontology,lineConfig,segmentConfig,keyAttribute,minSegmentLength}=this.props;const segments=results[videoIndex];const wavesurfer=this.wavesurfers[videoIndex];const duration=wavesurfer.getDuration();const segmentConfigValidKeys=segmentConfig.fields.map(value=>value.name);const{updatedValues:updateLineValues}=triggerForm(lineConfig,{});const{updatedValues:updateSegmentValues}=triggerForm(segmentConfig,{});if(keyAttribute){segmentConfigValidKeys.push(keyAttribute.name);}const lineConfigValidKeys=lineConfig.fields.map(value=>value.name);const ontologyValidKeys=[];ontology.forEach((value,key)=>{ontologyValidKeys.push(key);});const segmentsMap={};for(let i=0;i<segments.length;i+=1){const segment=segments[i];// validate start/end time nan\nif(segment.start){const startNum=Number(segment.start);if(Number.isNaN(startNum)){throw new Error(\"\".concat(translate('PAYLOAD_ERROR_SEGMENT_START_END_NAN'),\" [start NAN] \").concat(JSON.stringify(segment)));}segment.start=startNum;}if(segment.end){const endNum=Number(segment.end);if(Number.isNaN(endNum)){throw new Error(\"\".concat(translate('PAYLOAD_ERROR_SEGMENT_START_END_NAN'),\" [end NAN] \").concat(JSON.stringify(segment)));}segment.end=endNum;}// validate segment id\nsegment.id=segment.id||uuid();// validate segment start & end\nif(segment.start===null||segment.start===undefined||segment.end===null||segment.end===undefined){throw new Error(\"\".concat(translate('PAYLOAD_ERROR_SEGMENT_START_END_INVALID'),\" \").concat(JSON.stringify(segment)));}if(segment.end>duration){segment.end=duration;// eslint-disable-next-line no-console\nconsole.log(\"\".concat(translate('PAYLOAD_ERROR_SEGMENT_LENGTH_OVERFLOW'),\" \").concat(JSON.stringify(segment),\" set as max=\").concat(duration));}if(segment.start<0||segment.end<0||segment.start>segment.end||segment.end-segment.start<minSegmentLength){segments.splice(i,1);i-=1;// throw new Error(`${translate('PAYLOAD_ERROR_SEGMENT_START_END_INVALID')} ${JSON.stringify(segment)}`);\n}// validate segment attribute\nsegment.attributes={...updateSegmentValues,...segment.attributes};Object.keys(segment.attributes).forEach(key=>{if(segmentConfigValidKeys.indexOf(key)<0){// throw new Error(`${translate('PAYLOAD_ERROR_INVALID_ATTRIBUTE')}: ${key}`);\ndelete segment.attributes[key];}});if(segment.content==null||!segment.content[0])segment.content=[createLine('none',lineConfig)];segment.content.forEach((line,index,arr)=>{line.role=line.role||'none';line.attributes={...updateLineValues,...line.attributes};if(ontologyValidKeys.indexOf(line.role)<0){line.role='none';// throw new Error(`${translate('PAYLOAD_ERROR_INVALID_ROLE')}: ${line.role}`);\n}Object.keys(line.attributes).forEach(key=>{if(lineConfigValidKeys.indexOf(key)<0){// throw new Error(`${translate('PAYLOAD_ERROR_INVALID_ATTRIBUTE')}: ${key}`);\ndelete line.attributes[key];}});});segmentsMap[segment.id]=segment;}const newSegments=Object.values(segmentsMap).sort((a,b)=>a.start-b.start);if(!this.props.segmentOverlap){for(let i=0;i<newSegments.length-1;i+=1){const currSeg=newSegments[i];const nextSeg=newSegments[i+1];if(currSeg.end>nextSeg.start){currSeg.end=nextSeg.start;}}}this.props.parseSegments({videoIndex,segments:newSegments});return newSegments;}playVideo(){this.current.wavesurfer.play();}pauseVideo(){this.current.wavesurfer.pause();}forwardVideo(){this.current.wavesurfer.skipForward(0.5);}backwardVideo(){this.current.wavesurfer.skipBackward(0.5);}setCurrentSpeed(speed){var _this$current$wavesur2;(_this$current$wavesur2=this.current.wavesurfer)===null||_this$current$wavesur2===void 0?void 0:_this$current$wavesur2.setPlaybackRate(speed);}setPlayMode(){// mode\n}setNewVideo(){const{videoIndex}=this.current;if(this.wavesurfers[videoIndex].isDestroyed){// eslint-disable-next-line no-console\nconsole.error('Video destroyed:',videoIndex);return;}this.current.wavesurfer=this.wavesurfers[videoIndex];this.current.zoom=this.props.videos[videoIndex].zoom;this.current.undoList=this.undoList[videoIndex];this.current.redoList=this.redoList[videoIndex];this.setCurrentZoom();}setCurrentVideo(newVideoIndex){const{videoIndex}=this.current;this.wavesurfers[videoIndex].pause();this.current.videoIndex=newVideoIndex;this.setNewVideo();}setCurrentScroll(){let destTime=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;let offsetLeft=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;let boundaryCheck=arguments.length>2?arguments[2]:undefined;const{wavesurfer}=this.current;const{scrollLeft}=wavesurfer.container.lastChild;const{offsetWidth}=wavesurfer.container;const{minPxPerSec}=wavesurfer.params;const scrollTime=destTime-(offsetLeft-offsetWidth/2)/minPxPerSec;const duration=wavesurfer.getDuration();if(!boundaryCheck){wavesurfer.drawer.recenter(scrollTime/duration);}else{const rightBoundaryTime=(scrollLeft+offsetWidth)/minPxPerSec;const leftBoundaryTime=scrollLeft/minPxPerSec;if(destTime<leftBoundaryTime||destTime>rightBoundaryTime){wavesurfer.drawer.recenter(scrollTime/duration);}}}setCurrentSegment(currentSegment,start){const segment=this.currentSegments[currentSegment];if(!segment){Object.values(this.current.wavesurfer.regions.list).forEach(r=>r.element.classList.remove('selected'));this.current.segmentSelected=null;return;}const region=this.getRegionById(segment.id);if(region){if(region!==this.current.segmentSelected){Object.values(this.current.wavesurfer.regions.list).forEach(r=>r.element.classList.remove('selected'));region.element.classList.add('selected');this.current.segmentSelected=region;}const s=start||region.start;this.seekCurrentAudio(s);this.setCurrentScroll(s,0,true);}if(this.props.currentPlayMode!=='overallLoop'){this.current.wavesurfer.play();}}setLineColor(videoIndex,segmentIndex,lineIndex,role,prevRole,type){if(videoIndex===this.current.videoIndex){const{styleConfig,results}=this.props;const segments=results[videoIndex];const segment=segments[segmentIndex];const region=this.getRegionById(segment.id);if(region){var _styleConfig$groups2;let color=this.props.ontology.get(role);if((styleConfig===null||styleConfig===void 0?void 0:(_styleConfig$groups2=styleConfig.groups)===null||_styleConfig$groups2===void 0?void 0:_styleConfig$groups2.length)>0){var _segment$content$line;const attributes=(styleConfig===null||styleConfig===void 0?void 0:styleConfig.mode)===StyleConfigMode.line?(_segment$content$line=segment.content[lineIndex])===null||_segment$content$line===void 0?void 0:_segment$content$line.attributes:segment.attributes;color=getConfigColor(attributes,styleConfig.groups)||color;}this.setLineEleColor(segment,region,lineIndex,color);if(type!=='history'){this.addHistory('setLineColor',{videoIndex,segmentIndex,lineIndex,role:prevRole,actionType:'history'});}}}}setSegmentColor(videoIndex,segmentIndex,lines,color){const segment=this.props.results[videoIndex][segmentIndex];const region=this.getRegionById(segment.id);if(region){for(let i=0;i<lines.length;i+=1){const lineIndex=lines[i];this.setLineEleColor(segment,region,lineIndex,color);}}}setLineEleColor(segment,region,lineIndex,color){const line=segment.content[lineIndex];const roleColor=this.props.ontology.get(line.role);const rgba=hexToRgba(color||roleColor||defaultColor.defaultWhite,!color&&line.role==='none'?0:defaultColor.defaultAlpha);const lineElement=region.element.getElementsByClassName('line-mark')[lineIndex];if(lineElement){lineElement.style.background=rgba;}}setSegmentStartEnd(videoIndex,segmentIndex,start,end){if(videoIndex===this.current.videoIndex){const segments=this.props.results[videoIndex];const segment=segments[segmentIndex];const prevSegment=cloneDeep(segment);const region=this.getRegionById(segment.id);if(region){region.update({start,end});}this.addHistory('segment',{segmentIndex,prevSegment,nextSegment:cloneDeep(segment),region});}}seekCurrentAudio(){let currentTime=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;const{wavesurfer}=this.current;const duration=wavesurfer.getDuration();wavesurfer.backend.seekTo(Math.min(Math.max(currentTime,0),duration));}deleteCurrentSegment(){const{currentSegment}=this.props;const segment=this.currentSegments[currentSegment];if(segment){const region=this.getRegionById(segment.id);this.addHistory('segment',{segmentIndex:currentSegment,prevSegment:cloneDeep(segment),region});if(region){region.remove();}this.props.deleteSegment({segmentIndex:currentSegment});const currentTime=this.current.wavesurfer.getCurrentTime();const currentSegmentIndex=this.currentSegments.findIndex(seg=>seg.start<=currentTime&&seg.end>=currentTime);this.props.setCurrentSegment({index:currentSegmentIndex,start:currentTime});this.current.segmentSelected=null;}}handlePlayPause(){this.props.setPlayingState({isPlaying:this.current.wavesurfer.isPlaying()});}handleRegionOut(region){const segment=this.currentSegments[this.props.currentSegment];if(!segment&&!(region===null||region===void 0?void 0:region.temp)){return;}const currentRegion=region.temp?region:this.getRegionById(segment===null||segment===void 0?void 0:segment.id);if(currentRegion===region){if(this.props.currentPlayMode==='overallLoop'){this.props.setCurrentSegment({index:-1});}else if(this.props.currentPlayMode==='regionLoop'){this.seekCurrentAudio(region.start);this.setCurrentScroll(region.start,0,true);}else if(this.props.currentPlayMode==='regionPlay'){this.current.wavesurfer.pause();this.seekCurrentAudio(region.end);}}}handleRegionIn(region){if(this.props.currentPlayMode==='overallLoop'){const segmentIndex=this.getSegmentIndexById(region.data.id);const currentTime=this.current.wavesurfer.getCurrentTime();if(segmentIndex!==this.props.currentSegment&&segmentIndex>=0){this.props.setCurrentSegment({index:segmentIndex,start:currentTime});}}}handleRegionClick(region,e){e.stopPropagation();const segmentIndex=this.getSegmentIndexById(region.data.id);if(segmentIndex>=0){const cursorTime=this.getCursorTime();const start=cursorTime>0&&(e.altKey||e.ctrlKey)||this.props.currentPlayMode==='overallLoop'?cursorTime:null;this.props.setCurrentSegment({index:segmentIndex,start});if(this.tempRegion)this.tempRegion.remove();}else if(region){var _this$current$wavesur3;(_this$current$wavesur3=this.current.wavesurfer)===null||_this$current$wavesur3===void 0?void 0:_this$current$wavesur3.play(region.start,region.end);}}clearAll(){Modal.confirm({className:'modal-root',title:i18n.translate('COMMON_CLAER_CONFIRM_TITLE'),content:i18n.translate('COMMON_CLAER_CONFIRM_DESC'),autoFocusButton:null,okText:i18n.translate('COMMON_CLAER_CONFIRM_SURE'),okType:'danger',cancelText:i18n.translate('COMMON_CLAER_CONFIRM_CANCEL'),onOk:()=>{const{currentSegment}=this.props;const{videoIndex}=this.current;const segments=cloneDeep(this.currentSegments);this.props.setSegments({videoIndex,segments:[]});this.wavesurfers[videoIndex].clearRegions();this.addHistory('clear_all',{after:{videoIndex,currentIndex:-1,segments:[]},before:{videoIndex,currentIndex:currentSegment,segments}});}});}addHistory(type,data){// update redo list each time\nthis.current.redoList=[];this.current.undoList.push({type,data});if(this.current.undoList.length>50){this.current.undoList.shift();}}recallHistory(action){const{undoList,redoList}=this.current;const recallList=action==='undo'?undoList:redoList;if(!recallList.length){return;}this.props.setCurrentSegment({index:-1});const recallItem=recallList.pop();const{type,data}=recallItem;switch(type){case'segment':{const{segmentIndex,prevSegment,nextSegment,region}=data;const currSegment=action==='undo'?prevSegment:nextSegment;const otherSegment=action==='undo'?nextSegment:prevSegment;if(currSegment&&otherSegment){this.props.updateSegment({segment:currSegment});const currentRegion=this.getRegionById(currSegment.id);currentRegion.update({start:currSegment.start,end:currSegment.end});}else if(region&&currSegment&&!otherSegment){this.props.appendSegment({segmentIndex,segment:currSegment});const currentRegion=this.current.wavesurfer.regions.add(region);this.updateRegionElement(currentRegion);}else if(region&&!currSegment&&otherSegment){this.props.deleteSegment({segmentIndex});const currentRegion=this.getRegionById(otherSegment.id);currentRegion.remove();}break;}case'clear_all':{const{before,after}=data;const{videoIndex,currentIndex,segments}=action==='undo'?before:after;this.wavesurfers[videoIndex].clearRegions();this.props.setSegments({videoIndex,segments});this.initRegion(videoIndex,segments);this.props.setCurrentSegment(currentIndex);break;}case'pushLine':this.props.deleteLine({...data,actionType:'history'});break;case'deleteLine':this.props.pushLine({...data,actionType:'history'});break;case'setLineColor':this.props.setLineRole({...data,actionType:'history'});break;default:break;}if(recallItem.type==='pushLine'){recallItem.type='deleteLine';}else if(recallItem.type==='deleteLine'){recallItem.type='pushLine';}if(recallItem.type==='setLineColor'){const[nextRole,role]=[data.role,data.nextRole];recallItem.data.role=role;recallItem.data.nextRole=nextRole;}(action==='undo'?redoList:undoList).push(recallItem);}updateRegionElement(region){const{element,start,end}=region;element.classList.add('dragged-region');if(this.props.spaceLine>0){const offset=this.props.spaceLine/(end-start);let startLine=element.querySelector('.space-line.space-line-start');let endLine=element.querySelector('.space-line.space-line-end');if(offset<0.5){if(!startLine){startLine=document.createElement('div');startLine.className='space-line space-line-start';element.appendChild(startLine);}if(!endLine){endLine=document.createElement('div');endLine.className='space-line space-line-end';element.appendChild(endLine);}startLine.style.left=\"\".concat(offset*100,\"%\");endLine.style.right=\"\".concat(offset*100,\"%\");}else{if(startLine){startLine.remove();}if(endLine){endLine.remove();}}}}updateMeasurement(index){if(this.current.videoIndex===index){// current video\nlet cursorHelper=this.container.audioContainer[index].getElementsByClassName('audio-cursor-helper')[0];if(this.props.selectedMeasurement<0){if(cursorHelper){cursorHelper.remove();}}else{const{zoom,wavesurfer}=this.current;if(!cursorHelper){var _wavesurfer$cursor;cursorHelper=document.createElement('div');cursorHelper.className='audio-cursor-helper';wavesurfer===null||wavesurfer===void 0?void 0:(_wavesurfer$cursor=wavesurfer.cursor)===null||_wavesurfer$cursor===void 0?void 0:_wavesurfer$cursor.cursor.appendChild(cursorHelper);}// calc width\nconst duration=wavesurfer.getDuration();const{offsetWidth}=wavesurfer.container;const totalWidth=offsetWidth*zoom;const width=totalWidth/duration*this.props.selectedMeasurement;cursorHelper.style.width=\"\".concat(width,\"px\");cursorHelper.style.left=\"-\".concat(width/2,\"px\");}}}render(){return null;}}const mapStateToProps=state=>({videos:state.videos,results:state.results,segmentConfig:state.segmentConfig,lineConfig:state.lineConfig,ontology:state.ontology,currentSegment:state.currentSegment,currentVideo:state.currentVideo,currentPlayMode:state.currentPlayMode,minSegmentLength:state.minSegmentLength,isPlaying:state.isPlaying,toolMode:state.toolMode,spaceLine:state.spaceLine,selectedMeasurement:state.selectedMeasurement,segmentOverlap:state.segmentOverlap,keyAttribute:state.keyAttribute,annotateDisabled:state.annotateDisabled,isLoadedAlaw:state.isLoadedAlaw,styleConfig:state.styleConfig});const mapDispatchToProps={getWavesurfers,setPlayingState,setVideoValid,deleteLine,pushLine,setLineRole,parseSegments,setErrorMsg,setAudioErrorMsg,appendSegment,updateSegment,deleteSegment,setSegments,updateLineRole,updateVideoInfo,setLoading};export default connect(mapStateToProps,mapDispatchToProps,null,{forwardRef:true})(WavesurferComp);","map":{"version":3,"names":["React","hexToRgba","WaveSurfer","TimelinePlugin","RegionsPlugin","CursorPlugin","MinimapPlugin","connect","v4","uuid","cloneDeep","notification","Modal","defaultColor","formatTimestamp","translate","triggerForm","StyleConfigMode","getConfigColor","getWavesurfers","setPlayingState","setVideoValid","deleteLine","pushLine","setLineRole","parseSegments","setErrorMsg","setAudioErrorMsg","appendSegment","updateSegment","deleteSegment","setSegments","updateLineRole","updateVideoInfo","setLoading","createLine","createSegment","isInput","isAnnotationReadonly","formatTimeCallback","primaryLabelInterval","secondaryLabelInterval","timeInterval","i18n","config","top","ANCHOR_MOVEMENT_STEP","WavesurferComp","Component","constructor","tempRegion","undefined","insertLine","data","segmentIndex","role","currentRole","attributes","region","currentRegion","ontology","styleConfig","props","segment","currentSegments","getRegionById","id","_styleConfig$groups","configColor","groups","length","color","get","defaultWhite","defaultAlpha","element","classList","add","mark","document","createElement","className","style","background","appendChild","Array","from","getElementsByClassName","forEach","line","index","array","height","concat","setCurrentZoom","newZoom","current","zoom","videoIndex","wavesurfer","duration","wavesurfers","getDuration","cursorTime","getCursorTime","currentTime","getCurrentTime","offsetWidth","container","offsetLeft","cursor","totalWidth","pxPerSec","setCurrentScroll","handleKeyDown","e","key","window","disableLongAudioHotKeys","toolMode","altKey","segmentOverlap","altKeyDown","hoveredRegion","drag","resize","keyCode","ctrlKey","clearAll","deleteCurrentSegment","recallHistory","handleKeyUp","Object","values","regions","list","handleRegionCreated","remove","handleRegionUpdate","annotateDisabled","temp","overlappedRegions","filter","r","end","start","minStart","Math","min","map","maxEnd","max","updatingRegionStart","update","updatingRegionEnd","updateRegionElement","handleRegionEdit","readonly","buttons","button","_this$current$wavesur","defaultGray","play","setCurrentSegment","updatingRegionEn","minSegmentLength","segmentConfig","lineConfig","addHistory","currentSegment","nextSegment","getSegmentIndexById","prevSegment","draggingStart","draggingEnd","renderSegments","videos","results","v","i","ready","clearRegions","initRegion","undoList","redoList","minimap","waveform","timeline","audioContainer","videoContainer","segmentSelected","state","componentDidMount","timer","setInterval","isPlaying","timestamp","innerText","addEventListener","onContextmenu","preventDefault","shouldComponentUpdate","nextProps","currSeg","currentVideo","nextSeg","isLoadedAlaw","componentDidUpdate","initWaveSurfer","componentWillUnmount","clearInterval","removeEventListener","isArray","c","updateMeasurement","getAudioContainer","getVideoContainer","findIndex","seg","find","size","urls","loaded","create","autoCenter","backend","normalize","loopSelection","scrollParent","backgroundColor","waveColor","darkGray","progressColor","cursorColor","defaultRed","pixelRatio","maxCanvasWidth","plugins","width","defaultGreen","showTime","opacity","customShowTimeStyle","fontSize","paddingLeft","position","bottom","sec","setState","primaryFontColor","secondaryFontColor","primaryColor","secondaryColor","notchPercentHeight","on","pause","enableDragSelection","segments","errorMsg","toString","initMiniMap","setNewVideo","handlePlayPause","handleRegionOut","handleRegionIn","handleRegionClick","_","error","message","console","log","src","destroy","setXScroll","load","addRegion","content","lineIndex","_this$props$styleConf","mode","_removeEle$","lineEleArray","removeEle","splice","wave","getElementsByTagName","keyAttribute","segmentConfigValidKeys","fields","value","name","updatedValues","updateLineValues","updateSegmentValues","push","lineConfigValidKeys","ontologyValidKeys","segmentsMap","startNum","Number","isNaN","Error","JSON","stringify","endNum","keys","indexOf","arr","newSegments","sort","a","b","playVideo","pauseVideo","forwardVideo","skipForward","backwardVideo","skipBackward","setCurrentSpeed","speed","_this$current$wavesur2","setPlaybackRate","setPlayMode","isDestroyed","setCurrentVideo","newVideoIndex","destTime","arguments","boundaryCheck","scrollLeft","lastChild","minPxPerSec","params","scrollTime","drawer","recenter","rightBoundaryTime","leftBoundaryTime","s","seekCurrentAudio","currentPlayMode","setLineColor","prevRole","type","_styleConfig$groups2","_segment$content$line","setLineEleColor","actionType","setSegmentColor","lines","roleColor","rgba","lineElement","setSegmentStartEnd","seekTo","currentSegmentIndex","stopPropagation","_this$current$wavesur3","confirm","title","autoFocusButton","okText","okType","cancelText","onOk","after","currentIndex","before","shift","action","recallList","recallItem","pop","currSegment","otherSegment","nextRole","spaceLine","offset","startLine","querySelector","endLine","left","right","cursorHelper","selectedMeasurement","_wavesurfer$cursor","render","mapStateToProps","mapDispatchToProps","forwardRef"],"sources":["/Users/qzheng/Documents/webroot/annotation_tools/src/components/long-audio/components/WavesurferComp/DragWavesurferComp.jsx"],"sourcesContent":["/* eslint-disable class-methods-use-this */\nimport React from 'react';\nimport hexToRgba from 'hex-to-rgba';\nimport WaveSurfer from 'wavesurfer.js/dist/wavesurfer';\nimport TimelinePlugin from 'wavesurfer.js/dist/plugin/wavesurfer.timeline.min.js';\nimport RegionsPlugin from 'wavesurfer.js/dist/plugin/wavesurfer.regions.min.js';\nimport CursorPlugin from 'wavesurfer.js/dist/plugin/wavesurfer.cursor.min.js';\nimport MinimapPlugin from 'wavesurfer.js/src/plugin/minimap';\nimport { connect } from 'react-redux';\nimport { v4 as uuid } from 'uuid';\nimport { cloneDeep } from 'lodash';\nimport { notification, Modal } from 'antd';\nimport { defaultColor, formatTimestamp, translate, triggerForm, StyleConfigMode, getConfigColor } from '../../constants';\nimport {\n  getWavesurfers,\n  setPlayingState,\n  setVideoValid,\n  deleteLine,\n  pushLine,\n  setLineRole,\n  parseSegments,\n  setErrorMsg,\n  setAudioErrorMsg,\n  appendSegment,\n  updateSegment,\n  deleteSegment,\n  setSegments,\n  updateLineRole,\n  updateVideoInfo,\n  setLoading,\n} from '../../redux/action';\nimport './WavesurferComp.scss';\nimport { createLine, createSegment, isInput } from '../../redux/reducer/segmentController';\nimport { isAnnotationReadonly } from '../../../../utils/tool-mode';\nimport { formatTimeCallback, primaryLabelInterval, secondaryLabelInterval, timeInterval } from '../utils/TimelineUtil';\nimport i18n from '../../locales';\n\nnotification.config({ top: 60 });\nexport const ANCHOR_MOVEMENT_STEP = 0.01;\n\nclass WavesurferComp extends React.Component {\n  tempRegion = undefined;\n\n  constructor() {\n    super();\n    this.wavesurfers = [];\n    this.undoList = [];\n    this.redoList = [];\n    this.container = {\n      minimap: null, // Minimap container\n      waveform: null, // Waveform container\n      timeline: null, // Timeline container\n      audioContainer: null, // Cursor container\n      videoContainer: null, // Video container\n    };\n    this.current = {\n      zoom: 1,\n      videoIndex: 0,\n      wavesurfer: null,\n      undoList: null,\n      redoList: null,\n      segmentSelected: null,\n    };\n    this.updatingRegionStart = null;\n    this.updatingRegionEnd = null;\n    this.altKeyDown = false;\n    this.hoveredRegion = null;\n    this.state = {\n      cursorTime: 0, // seconds\n    };\n  }\n\n  get currentSegments() {\n    return this.props.results[this.current.videoIndex];\n  }\n\n  componentDidMount() {\n    this.props.getWavesurfers({ wavesurfers: this });\n    this.timer = setInterval(() => {\n      if (!this.props.isPlaying) return;\n      const { wavesurfer } = this.current;\n      const currentTime = wavesurfer.getCurrentTime();\n      const duration = wavesurfer.getDuration();\n      wavesurfer.timestamp.innerText = `${formatTimestamp(currentTime)}/${formatTimestamp(duration)}`;\n      this.setCurrentScroll(currentTime, 0, true);\n    }, 200);\n    window.addEventListener('resize', this.setCurrentZoom);\n    window.addEventListener('keydown', this.handleKeyDown);\n    window.addEventListener('keyup', this.handleKeyUp);\n    window.addEventListener('contextmenu', this.onContextmenu);\n  }\n\n  onContextmenu(e) {\n    e.preventDefault();\n  }\n\n  shouldComponentUpdate(nextProps) {\n    const currSeg = this.props.results[this.props.currentVideo][this.props.currentSegment];\n    const nextSeg = nextProps.results[nextProps.currentVideo][nextProps.currentSegment];\n    // return !isEqual(currSeg, nextSeg);\n    return currSeg?.id !== nextSeg?.id || nextProps.isLoadedAlaw !== this.props.isLoadedAlaw;\n  }\n\n  componentDidUpdate() {\n    if (this.props.isLoadedAlaw) {\n      this.initWaveSurfer();\n    } else {\n      this.setCurrentSegment(this.props.currentSegment);\n    }\n  }\n\n  componentWillUnmount() {\n    if (this.timer) {\n      clearInterval(this.timer);\n      this.timer = null;\n    }\n    window.removeEventListener('resize', this.setCurrentZoom);\n    window.removeEventListener('keydown', this.handleKeyDown);\n    window.removeEventListener('keyup', this.handleKeyUp);\n    window.removeEventListener('contextmenu', this.onContextmenu);\n    if (Array.isArray(this.container.audioContainer)) {\n      this.container.audioContainer.forEach((c) => {\n        if (c) {\n          c.removeEventListener('mousemove', this.updateMeasurement);\n          c.removeEventListener('wheel', this.updateMeasurement);\n        }\n      });\n    }\n  }\n\n  getAudioContainer(waveform, timeline, audioContainer, minimap) {\n    this.container.waveform = waveform;\n    this.container.timeline = timeline;\n    this.container.audioContainer = audioContainer;\n    this.container.minimap = minimap;\n    if (this.container.videoContainer) {\n      this.initWaveSurfer();\n    }\n  }\n\n  getVideoContainer(videoContainer) {\n    this.container.videoContainer = videoContainer;\n    if (this.container.waveform) {\n      this.initWaveSurfer();\n    }\n  }\n\n  getCursorTime() {\n    return this.state.cursorTime;\n  }\n\n  getSegmentIndexById(id) {\n    return this.currentSegments.findIndex((seg) => seg.id === id);\n  }\n\n  getRegionById(id) {\n    return Object.values(this.current.wavesurfer.regions.list).find((r) => r.data.id === id);\n  }\n\n  initWaveSurfer() {\n    const size = this.props.videos.length;\n    const urls = [];\n    for (let i = 0; i < size; i += 1) {\n      if (this.props.videos[i].loaded && !this.wavesurfers[i]) {\n        this.wavesurfers[i] = WaveSurfer.create({\n          container: this.container.waveform[i],\n          autoCenter: false,\n          backend: 'MediaElement',\n          normalize: true,\n          loopSelection: true,\n          scrollParent: true,\n          backgroundColor: defaultColor.defaultGray,\n          waveColor: defaultColor.darkGray,\n          progressColor: defaultColor.darkGray,\n          cursorColor: defaultColor.defaultRed,\n          pixelRatio: 1,\n          maxCanvasWidth: 4000,\n          plugins: [\n            RegionsPlugin.create(),\n            CursorPlugin.create({\n              width: '1px',\n              height: '10px',\n              container: this.container.audioContainer[i],\n              color: defaultColor.defaultGreen,\n              showTime: true,\n              opacity: 1,\n              customShowTimeStyle: {\n                color: defaultColor.defaultGreen,\n                fontSize: '14px',\n                paddingLeft: '5px',\n                position: 'absolute',\n                bottom: '3px',\n              },\n              formatTimeCallback: (sec) => {\n                this.setState({ cursorTime: sec });\n                return formatTimestamp(sec);\n              },\n            }),\n            TimelinePlugin.create({\n              container: this.container.timeline[i],\n              primaryFontColor: defaultColor.defaultWhite,\n              secondaryFontColor: defaultColor.defaultWhite,\n              primaryColor: defaultColor.defaultWhite,\n              secondaryColor: defaultColor.defaultWhite,\n              fontSize: '10',\n              notchPercentHeight: 30,\n              timeInterval,\n              primaryLabelInterval,\n              secondaryLabelInterval,\n              formatTimeCallback,\n            }),\n            MinimapPlugin.create({\n              container: this.container.minimap[i],\n            }),\n          ],\n        });\n        urls[i] = this.container.videoContainer[i];\n\n        this.wavesurfers[i].on('ready', () => {\n          this.wavesurfers[i].pause();\n          this.wavesurfers[i].enableDragSelection({\n            color: hexToRgba(this.props.ontology.get('none'), defaultColor.defaultAlpha),\n          });\n\n          let segments;\n          try {\n            segments = this.parseSegments(i);\n          } catch (e) {\n            this.props.setErrorMsg({ errorMsg: e.toString() });\n            return;\n          }\n          this.props.setLoading(false);\n          this.initRegion(i, segments);\n          this.initMiniMap(i);\n          if (i === 0) {\n            this.setNewVideo();\n          }\n          this.wavesurfers[i].on('play', () => this.handlePlayPause());\n          this.wavesurfers[i].on('pause', () => this.handlePlayPause());\n          this.wavesurfers[i].on('region-created', this.handleRegionCreated);\n          this.wavesurfers[i].on('region-updated', (region) => this.handleRegionUpdate(region));\n          this.wavesurfers[i].on('region-update-end', (region, e) => this.handleRegionEdit(region, e));\n          this.wavesurfers[i].on('region-out', (region) => this.handleRegionOut(region));\n          this.wavesurfers[i].on('region-in', (region) => this.handleRegionIn(region));\n          this.wavesurfers[i].on('region-click', (region, e) => this.handleRegionClick(region, e));\n          this.wavesurfers[i].on('region-contextmenu', (_, e) => e.preventDefault());\n          this.wavesurfers[i].on('region-mouseenter', (region) => {\n            this.hoveredRegion = region;\n            if (this.altKeyDown) {\n              this.hoveredRegion.drag = false;\n              this.hoveredRegion.resize = false;\n            }\n          });\n          this.wavesurfers[i].on('region-mouseleave', () => {\n            this.hoveredRegion = null;\n          });\n          this.props.setVideoValid({ index: i });\n          this.props.updateVideoInfo({ index: i, duration: this.wavesurfers[i].getDuration() });\n        });\n        this.wavesurfers[i].on('error', (error) => {\n          notification.error({ message: `${translate('AUDIO_ERROR')} ${translate('RECORD_PREFIX')}${i + 1}` });\n          console.log('error', urls[i].src, error);\n          this.props.setAudioErrorMsg({\n            index: i,\n            errorMsg: `${translate('AUDIO_ERROR')} ${translate('RECORD_PREFIX')}${i + 1} ${urls[i].src} ${error}`\n          });\n          this.wavesurfers[i].destroy();\n          if (i === size - 1) {\n            this.props.setLoading(false);\n          }\n        });\n        this.wavesurfers[i].on('redraw', this.props.setXScroll);\n        this.undoList[i] = [];\n        this.redoList[i] = [];\n\n        this.container.audioContainer[i].addEventListener('mousemove', () => this.updateMeasurement(i));\n        this.container.audioContainer[i].addEventListener('wheel', () => this.updateMeasurement(i));\n        this.wavesurfers[i].load(this.container.videoContainer[i]);\n      }\n    }\n  }\n\n  initRegion(videoIndex, segments) {\n    // setup initial regions\n    const wavesurfer = this.wavesurfers[videoIndex];\n    const { toolMode, ontology } = this.props;\n    const readonly = isAnnotationReadonly(toolMode);\n    for (let segmentIndex = 0; segmentIndex < segments.length; segmentIndex += 1) {\n      const segment = segments[segmentIndex];\n      const region = wavesurfer.addRegion({\n        start: segment.start,\n        end: segment.end,\n        color: hexToRgba(ontology.get('none'), defaultColor.defaultAlpha),\n        drag: !readonly,\n        resize: !readonly,\n      });\n      region.data = { id: segment.id };\n      segment.content.forEach((line, lineIndex) => {\n        const attributes = this.props.styleConfig?.mode === StyleConfigMode.segment ? segment.attributes : line.attributes;\n        this.insertLine({\n          videoIndex,\n          segmentIndex,\n          region,\n          lineIndex,\n          role: line.role,\n          attributes,\n        });\n      });\n      this.updateRegionElement(region);\n    }\n  }\n\n  insertLine = (data) => {\n    // eslint-disable-next-line prefer-const\n    const { segmentIndex, role: currentRole, attributes, region: currentRegion } = data;\n    const { ontology, styleConfig } = this.props;\n    const segment = this.currentSegments[segmentIndex];\n    const region = currentRegion || this.getRegionById(segment?.id);\n    if (region) {\n      const role = currentRole || 'none';\n      let configColor = '';\n      if (attributes && styleConfig?.groups?.length > 0) {\n        configColor = getConfigColor(attributes, styleConfig.groups);\n      }\n      const color = hexToRgba(\n        configColor || ontology.get(role) || defaultColor.defaultWhite,\n        (role === 'none' && !configColor) ? 0 : defaultColor.defaultAlpha\n      );\n      region.element.classList.add('line-region');\n      const mark = document.createElement('div');\n      mark.className = 'line-mark';\n      mark.style.background = color;\n      region.element.appendChild(mark);\n      Array.from(region.element.getElementsByClassName('line-mark')).forEach((line, index, array) => {\n        const height = 100 / array.length;\n        const top = height * index;\n        line.style.height = `${height}%`;\n        line.style.top = `${top}%`;\n      });\n    }\n  };\n\n  deleteLine(data) {\n    const { segmentIndex, lineIndex } = data;\n    const segment = this.currentSegments[segmentIndex];\n    const region = this.getRegionById(segment.id);\n    if (region) {\n      const lineEleArray = Array.from(region.element.getElementsByClassName('line-mark'));\n      const removeEle = lineEleArray.splice(lineIndex, 1);\n      removeEle[0]?.remove();\n      lineEleArray.forEach((line, index, array) => {\n        const height = 100 / array.length;\n        const top = height * index;\n        line.style.height = `${height}%`;\n        line.style.top = `${top}%`;\n      });\n    }\n  }\n\n  initMiniMap(i) {\n    const wave = this.container.minimap[i].getElementsByTagName('wave')[0];\n    const timestamp = document.createElement('div');\n    const currentTime = this.wavesurfers[i].getDuration();\n    timestamp.className = 'wavesurfer-timestamp';\n    timestamp.innerText = `00:00.000/${formatTimestamp(currentTime)}`;\n    wave.appendChild(timestamp);\n    this.wavesurfers[i].timestamp = timestamp;\n  }\n\n  parseSegments(videoIndex) {\n    const { results, ontology, lineConfig, segmentConfig, keyAttribute, minSegmentLength } = this.props;\n    const segments = results[videoIndex];\n    const wavesurfer = this.wavesurfers[videoIndex];\n    const duration = wavesurfer.getDuration();\n    const segmentConfigValidKeys = segmentConfig.fields.map((value) => value.name);\n    const { updatedValues: updateLineValues } = triggerForm(lineConfig, {});\n    const { updatedValues: updateSegmentValues } = triggerForm(segmentConfig, {});\n    if (keyAttribute) {\n      segmentConfigValidKeys.push(keyAttribute.name);\n    }\n    const lineConfigValidKeys = lineConfig.fields.map((value) => value.name);\n    const ontologyValidKeys = [];\n    ontology.forEach((value, key) => {\n      ontologyValidKeys.push(key);\n    });\n    const segmentsMap = {};\n    for (let i = 0; i < segments.length; i += 1) {\n      const segment = segments[i];\n      // validate start/end time nan\n      if (segment.start) {\n        const startNum = Number(segment.start);\n        if (Number.isNaN(startNum)) {\n          throw new Error(`${translate('PAYLOAD_ERROR_SEGMENT_START_END_NAN')} [start NAN] ${JSON.stringify(segment)}`);\n        }\n        segment.start = startNum;\n      }\n      if (segment.end) {\n        const endNum = Number(segment.end);\n        if (Number.isNaN(endNum)) {\n          throw new Error(`${translate('PAYLOAD_ERROR_SEGMENT_START_END_NAN')} [end NAN] ${JSON.stringify(segment)}`);\n        }\n        segment.end = endNum;\n      }\n      // validate segment id\n      segment.id = segment.id || uuid();\n      // validate segment start & end\n      if (segment.start === null || segment.start === undefined || segment.end === null || segment.end === undefined) {\n        throw new Error(`${translate('PAYLOAD_ERROR_SEGMENT_START_END_INVALID')} ${JSON.stringify(segment)}`);\n      }\n      if (segment.end > duration) {\n        segment.end = duration;\n        // eslint-disable-next-line no-console\n        console.log(`${translate('PAYLOAD_ERROR_SEGMENT_LENGTH_OVERFLOW')} ${JSON.stringify(segment)} set as max=${duration}`);\n      }\n      if (segment.start < 0 || segment.end < 0 || segment.start > segment.end || segment.end - segment.start < minSegmentLength) {\n        segments.splice(i, 1);\n        i -= 1;\n        // throw new Error(`${translate('PAYLOAD_ERROR_SEGMENT_START_END_INVALID')} ${JSON.stringify(segment)}`);\n      }\n      // validate segment attribute\n      segment.attributes = {\n        ...updateSegmentValues,\n        ...segment.attributes,\n      };\n      Object.keys(segment.attributes).forEach((key) => {\n        if (segmentConfigValidKeys.indexOf(key) < 0) {\n          // throw new Error(`${translate('PAYLOAD_ERROR_INVALID_ATTRIBUTE')}: ${key}`);\n          delete segment.attributes[key];\n        }\n      });\n      if (segment.content == null || !segment.content[0]) segment.content = [createLine('none', lineConfig)];\n      segment.content.forEach((line, index, arr) => {\n        line.role = line.role || 'none';\n        line.attributes = {\n          ...updateLineValues,\n          ...line.attributes,\n        };\n        if (ontologyValidKeys.indexOf(line.role) < 0) {\n          line.role = 'none';\n          // throw new Error(`${translate('PAYLOAD_ERROR_INVALID_ROLE')}: ${line.role}`);\n        }\n        Object.keys(line.attributes).forEach((key) => {\n          if (lineConfigValidKeys.indexOf(key) < 0) {\n            // throw new Error(`${translate('PAYLOAD_ERROR_INVALID_ATTRIBUTE')}: ${key}`);\n            delete line.attributes[key];\n          }\n        });\n      });\n      segmentsMap[segment.id] = segment;\n    }\n    const newSegments = Object.values(segmentsMap).sort((a, b) => a.start - b.start);\n    if (!this.props.segmentOverlap) {\n      for (let i = 0; i < newSegments.length - 1; i += 1) {\n        const currSeg = newSegments[i];\n        const nextSeg = newSegments[i + 1];\n        if (currSeg.end > nextSeg.start) {\n          currSeg.end = nextSeg.start;\n        }\n      }\n    }\n    this.props.parseSegments({\n      videoIndex,\n      segments: newSegments,\n    });\n    return newSegments;\n  }\n\n  playVideo() {\n    this.current.wavesurfer.play();\n  }\n\n  pauseVideo() {\n    this.current.wavesurfer.pause();\n  }\n\n  forwardVideo() {\n    this.current.wavesurfer.skipForward(0.5);\n  }\n\n  backwardVideo() {\n    this.current.wavesurfer.skipBackward(0.5);\n  }\n\n  setCurrentSpeed(speed) {\n    this.current.wavesurfer?.setPlaybackRate(speed);\n  }\n\n  setPlayMode() {\n    // mode\n  }\n\n  setNewVideo() {\n    const { videoIndex } = this.current;\n    if (this.wavesurfers[videoIndex].isDestroyed) {\n      // eslint-disable-next-line no-console\n      console.error('Video destroyed:', videoIndex);\n      return;\n    }\n    this.current.wavesurfer = this.wavesurfers[videoIndex];\n    this.current.zoom = this.props.videos[videoIndex].zoom;\n    this.current.undoList = this.undoList[videoIndex];\n    this.current.redoList = this.redoList[videoIndex];\n    this.setCurrentZoom();\n  }\n\n  setCurrentVideo(newVideoIndex) {\n    const { videoIndex } = this.current;\n    this.wavesurfers[videoIndex].pause();\n    this.current.videoIndex = newVideoIndex;\n    this.setNewVideo();\n  }\n\n  setCurrentZoom = (newZoom) => {\n    if (newZoom) {\n      this.current.zoom = newZoom;\n    }\n    const { zoom, videoIndex, wavesurfer } = this.current;\n    if (wavesurfer) {\n      const duration = this.wavesurfers[videoIndex].getDuration();\n      const cursorTime = this.getCursorTime();\n      const currentTime = wavesurfer.getCurrentTime();\n      const { offsetWidth } = wavesurfer.container;\n      const { offsetLeft } = wavesurfer.cursor.cursor;\n      const totalWidth = offsetWidth * zoom;\n      const pxPerSec = totalWidth / duration;\n      wavesurfer.zoom(pxPerSec);\n      this.setCurrentScroll(\n        cursorTime < 0 ? currentTime : cursorTime,\n        cursorTime < 0 ? offsetWidth / 2 : offsetLeft,\n        false,\n      );\n    }\n  };\n\n  setCurrentScroll(destTime = 0, offsetLeft = 0, boundaryCheck) {\n    const { wavesurfer } = this.current;\n    const { scrollLeft } = wavesurfer.container.lastChild;\n    const { offsetWidth } = wavesurfer.container;\n    const { minPxPerSec } = wavesurfer.params;\n    const scrollTime = destTime - (offsetLeft - offsetWidth / 2) / minPxPerSec;\n    const duration = wavesurfer.getDuration();\n    if (!boundaryCheck) {\n      wavesurfer.drawer.recenter(scrollTime / duration);\n    } else {\n      const rightBoundaryTime = (scrollLeft + offsetWidth) / minPxPerSec;\n      const leftBoundaryTime = scrollLeft / minPxPerSec;\n      if (destTime < leftBoundaryTime || destTime > rightBoundaryTime) {\n        wavesurfer.drawer.recenter(scrollTime / duration);\n      }\n    }\n  }\n\n  setCurrentSegment(currentSegment, start) {\n    const segment = this.currentSegments[currentSegment];\n    if (!segment) {\n      Object.values(this.current.wavesurfer.regions.list).forEach((r) => r.element.classList.remove('selected'));\n      this.current.segmentSelected = null;\n      return;\n    }\n    const region = this.getRegionById(segment.id);\n    if (region) {\n      if (region !== this.current.segmentSelected) {\n        Object.values(this.current.wavesurfer.regions.list).forEach((r) => r.element.classList.remove('selected'));\n        region.element.classList.add('selected');\n        this.current.segmentSelected = region;\n      }\n      const s = start || region.start;\n      this.seekCurrentAudio(s);\n      this.setCurrentScroll(s, 0, true);\n    }\n    if (this.props.currentPlayMode !== 'overallLoop') {\n      this.current.wavesurfer.play();\n    }\n  }\n\n  setLineColor(videoIndex, segmentIndex, lineIndex, role, prevRole, type) {\n    if (videoIndex === this.current.videoIndex) {\n      const { styleConfig, results } = this.props;\n      const segments = results[videoIndex];\n      const segment = segments[segmentIndex];\n      const region = this.getRegionById(segment.id);\n      if (region) {\n        let color = this.props.ontology.get(role);\n        if (styleConfig?.groups?.length > 0) {\n          const attributes = styleConfig?.mode === StyleConfigMode.line ? segment.content[lineIndex]?.attributes : segment.attributes;\n          color = getConfigColor(attributes, styleConfig.groups) || color;\n        }\n        this.setLineEleColor(segment, region, lineIndex, color);\n        if (type !== 'history') {\n          this.addHistory('setLineColor', { videoIndex, segmentIndex, lineIndex, role: prevRole, actionType: 'history' });\n        }\n      }\n    }\n  }\n\n  setSegmentColor(videoIndex, segmentIndex, lines, color) {\n    const segment = this.props.results[videoIndex][segmentIndex];\n    const region = this.getRegionById(segment.id);\n    if (region) {\n      for (let i = 0; i < lines.length; i += 1) {\n        const lineIndex = lines[i];\n        this.setLineEleColor(segment, region, lineIndex, color);\n      }\n    }\n  }\n\n  setLineEleColor(segment, region, lineIndex, color) {\n    const line = segment.content[lineIndex];\n    const roleColor = this.props.ontology.get(line.role);\n    const rgba = hexToRgba(\n      color || roleColor || defaultColor.defaultWhite,\n      !color && line.role === 'none' ? 0 : defaultColor.defaultAlpha\n    );\n    const lineElement = region.element.getElementsByClassName('line-mark')[lineIndex];\n    if (lineElement) {\n      lineElement.style.background = rgba;\n    }\n  }\n\n  setSegmentStartEnd(videoIndex, segmentIndex, start, end) {\n    if (videoIndex === this.current.videoIndex) {\n      const segments = this.props.results[videoIndex];\n      const segment = segments[segmentIndex];\n      const prevSegment = cloneDeep(segment);\n      const region = this.getRegionById(segment.id);\n      if (region) {\n        region.update({ start, end });\n      }\n      this.addHistory('segment', {\n        segmentIndex,\n        prevSegment,\n        nextSegment: cloneDeep(segment),\n        region,\n      });\n    }\n  }\n\n  seekCurrentAudio(currentTime = 0) {\n    const { wavesurfer } = this.current;\n    const duration = wavesurfer.getDuration();\n    wavesurfer.backend.seekTo(Math.min(Math.max(currentTime, 0), duration));\n  }\n\n  deleteCurrentSegment() {\n    const { currentSegment } = this.props;\n    const segment = this.currentSegments[currentSegment];\n    if (segment) {\n      const region = this.getRegionById(segment.id);\n      this.addHistory('segment', {\n        segmentIndex: currentSegment,\n        prevSegment: cloneDeep(segment),\n        region,\n      });\n      if (region) {\n        region.remove();\n      }\n      this.props.deleteSegment({ segmentIndex: currentSegment });\n      const currentTime = this.current.wavesurfer.getCurrentTime();\n      const currentSegmentIndex = this.currentSegments.findIndex((seg) => seg.start <= currentTime && seg.end >= currentTime);\n      this.props.setCurrentSegment({ index: currentSegmentIndex, start: currentTime });\n      this.current.segmentSelected = null;\n    }\n  }\n\n  handleKeyDown = (e) => {\n    if (!e.key) return;\n    if (window.disableLongAudioHotKeys) return;\n    if (isInput()) return;\n    if (isAnnotationReadonly(this.props.toolMode)) return;\n    if (e.altKey && this.props.segmentOverlap) {\n      this.altKeyDown = true;\n      if (this.hoveredRegion) {\n        this.hoveredRegion.drag = false;\n        this.hoveredRegion.resize = false;\n      }\n    }\n    switch (e.keyCode) {\n      case 8: // backspace\n      case 46: // delete\n        if (e.ctrlKey) {\n          this.clearAll();\n        } else {\n          this.deleteCurrentSegment();\n        }\n        break;\n      case 90: // z\n        if (e.ctrlKey) {\n          this.recallHistory('undo');\n        }\n        break;\n      case 89: // y\n        if (e.ctrlKey) {\n          this.recallHistory('redo');\n        }\n        break;\n      default:\n    }\n  };\n\n  handleKeyUp = (e) => {\n    if (!e.altKey) {\n      this.altKeyDown = false;\n      Object.values(this.current.wavesurfer.regions.list).forEach((region) => {\n        region.drag = true;\n        region.resize = true;\n      });\n    }\n  };\n\n  handlePlayPause() {\n    this.props.setPlayingState({\n      isPlaying: this.current.wavesurfer.isPlaying(),\n    });\n  }\n\n  handleRegionCreated = (region) => {\n    if (this.tempRegion) this.tempRegion.remove();\n    region.element.classList.add('line-region');\n    const mark = document.createElement('div');\n    mark.className = 'line-mark';\n    mark.style.height = '100%';\n    region.element.appendChild(mark);\n  };\n\n  handleRegionUpdate = (region) => {\n    const { annotateDisabled } = this.props;\n    if (annotateDisabled) {\n      if (region) region.remove();\n      return;\n    }\n    if (!this.props.segmentOverlap && !region.temp) {\n      const overlappedRegions = Object.values(this.current.wavesurfer.regions.list).filter((r) => !(r.end <= region.start || r.start >= region.end) && r !== region);\n      if (overlappedRegions.length > 0) {\n        // has overlapping\n        const minStart = Math.min(...overlappedRegions.map((r) => r.start));\n        const maxEnd = Math.max(...overlappedRegions.map((r) => r.end));\n        if (this.updatingRegionStart === region.start) {\n          // drag end handler\n          if (region.end > minStart) {\n            region.update({ end: minStart });\n          }\n        } else if (this.updatingRegionEnd === region.end) {\n          // drag start handler\n          if (region.start < maxEnd) {\n            region.update({ start: maxEnd });\n          }\n        } else if (region.start < this.updatingRegionStart) {\n          // move left\n          region.update({ start: maxEnd, end: region.end - region.start + maxEnd });\n        } else if (region.start > this.updatingRegionStart) {\n          // move right\n          region.update({ start: region.start - region.end + minStart, end: minStart });\n        }\n      }\n    }\n    this.updatingRegionStart = region.start;\n    this.updatingRegionEnd = region.end;\n    this.updateRegionElement(region);\n  };\n\n  handleRegionEdit = (region, e) => {\n    const { annotateDisabled, toolMode } = this.props;\n    const readonly = isAnnotationReadonly(toolMode) || annotateDisabled;\n    if ((readonly || (e?.buttons === 2 || e?.button === 2)) && !region.data.id) {\n      region.temp = true;\n      region.update({\n        color: hexToRgba(defaultColor.defaultGray, 0.2),\n      });\n      this.tempRegion = region;\n      this.current.wavesurfer?.play(region.start, region.end);\n      this.props.setCurrentSegment({ index: -1 });\n    }\n    if (region.temp) return;\n    this.updatingRegionStart = null;\n    this.updatingRegionEn = null;\n\n    const { id } = region.data;\n    const duration = this.current.wavesurfer.getDuration();\n    region.start = Math.max(region.start, 0);\n    region.end = Math.min(region.end, duration);\n    const { minSegmentLength, segmentConfig, lineConfig } = this.props;\n    if (!id) {\n      // create region\n      if (region.end - region.start < minSegmentLength) {\n        region.remove();\n        return;\n      }\n      const segment = createSegment(region.start, region.end, segmentConfig, lineConfig);\n      // eslint-disable-next-line no-param-reassign\n      region.data.id = segment.id;\n      region.play();\n      this.props.appendSegment({ segment });\n      this.addHistory('segment', {\n        segmentIndex: this.props.currentSegment,\n        nextSegment: cloneDeep(segment),\n        region,\n      });\n    } else {\n      // update region\n      const segmentIndex = this.getSegmentIndexById(id);\n      if (segmentIndex >= 0) {\n        const segment = this.currentSegments[segmentIndex];\n        const prevSegment = cloneDeep(segment);\n        let { start, end } = region;\n        if (end - start < minSegmentLength) {\n          const draggingStart = end === segment.end;\n          const draggingEnd = start === segment.start;\n          if (draggingStart) {\n            start = end - minSegmentLength;\n          } else if (draggingEnd) {\n            end = start + minSegmentLength;\n          }\n        }\n        region.update({ start, end });\n        segment.start = start;\n        segment.end = end;\n        this.props.updateSegment({ segment });\n        this.addHistory('segment', {\n          segmentIndex,\n          prevSegment,\n          nextSegment: cloneDeep(segment),\n          region,\n        });\n      }\n    }\n  };\n\n  handleRegionOut(region) {\n    const segment = this.currentSegments[this.props.currentSegment];\n    if (!segment && !region?.temp) {\n      return;\n    }\n    const currentRegion = region.temp ? region : this.getRegionById(segment?.id);\n    if (currentRegion === region) {\n      if (this.props.currentPlayMode === 'overallLoop') {\n        this.props.setCurrentSegment({ index: -1 });\n      } else if (this.props.currentPlayMode === 'regionLoop') {\n        this.seekCurrentAudio(region.start);\n        this.setCurrentScroll(region.start, 0, true);\n      } else if (this.props.currentPlayMode === 'regionPlay') {\n        this.current.wavesurfer.pause();\n        this.seekCurrentAudio(region.end);\n      }\n    }\n  }\n\n  handleRegionIn(region) {\n    if (this.props.currentPlayMode === 'overallLoop') {\n      const segmentIndex = this.getSegmentIndexById(region.data.id);\n      const currentTime = this.current.wavesurfer.getCurrentTime();\n      if (segmentIndex !== this.props.currentSegment && segmentIndex >= 0) {\n        this.props.setCurrentSegment({ index: segmentIndex, start: currentTime });\n      }\n    }\n  }\n\n  handleRegionClick(region, e) {\n    e.stopPropagation();\n    const segmentIndex = this.getSegmentIndexById(region.data.id);\n    if (segmentIndex >= 0) {\n      const cursorTime = this.getCursorTime();\n      const start = ((cursorTime > 0 && (e.altKey || e.ctrlKey)) || this.props.currentPlayMode === 'overallLoop') ? cursorTime : null;\n      this.props.setCurrentSegment({ index: segmentIndex, start });\n      if (this.tempRegion) this.tempRegion.remove();\n    } else if (region) {\n      this.current.wavesurfer?.play(region.start, region.end);\n    }\n  }\n\n  clearAll() {\n    Modal.confirm({\n      className: 'modal-root',\n      title: i18n.translate('COMMON_CLAER_CONFIRM_TITLE'),\n      content: i18n.translate('COMMON_CLAER_CONFIRM_DESC'),\n      autoFocusButton: null,\n      okText: i18n.translate('COMMON_CLAER_CONFIRM_SURE'),\n      okType: 'danger',\n      cancelText: i18n.translate('COMMON_CLAER_CONFIRM_CANCEL'),\n      onOk: () => {\n        const { currentSegment } = this.props;\n        const { videoIndex } = this.current;\n        const segments = cloneDeep(this.currentSegments);\n        this.props.setSegments({ videoIndex, segments: [] });\n        this.wavesurfers[videoIndex].clearRegions();\n        this.addHistory('clear_all', {\n          after: {\n            videoIndex,\n            currentIndex: -1,\n            segments: []\n          },\n          before: {\n            videoIndex,\n            currentIndex: currentSegment,\n            segments\n          },\n        });\n      },\n    });\n  }\n\n  addHistory(type, data) {\n    // update redo list each time\n    this.current.redoList = [];\n    this.current.undoList.push({ type, data });\n    if (this.current.undoList.length > 50) {\n      this.current.undoList.shift();\n    }\n  }\n\n  recallHistory(action) {\n    const { undoList, redoList } = this.current;\n    const recallList = action === 'undo' ? undoList : redoList;\n    if (!recallList.length) {\n      return;\n    }\n    this.props.setCurrentSegment({ index: -1 });\n    const recallItem = recallList.pop();\n    const { type, data } = recallItem;\n    switch (type) {\n      case 'segment': {\n        const { segmentIndex, prevSegment, nextSegment, region } = data;\n        const currSegment = action === 'undo' ? prevSegment : nextSegment;\n        const otherSegment = action === 'undo' ? nextSegment : prevSegment;\n        if (currSegment && otherSegment) {\n          this.props.updateSegment({ segment: currSegment });\n          const currentRegion = this.getRegionById(currSegment.id);\n          currentRegion.update({ start: currSegment.start, end: currSegment.end });\n        } else if (region && currSegment && !otherSegment) {\n          this.props.appendSegment({ segmentIndex, segment: currSegment });\n          const currentRegion = this.current.wavesurfer.regions.add(region);\n          this.updateRegionElement(currentRegion);\n        } else if (region && !currSegment && otherSegment) {\n          this.props.deleteSegment({ segmentIndex });\n          const currentRegion = this.getRegionById(otherSegment.id);\n          currentRegion.remove();\n        }\n        break;\n      }\n      case 'clear_all': {\n        const { before, after } = data;\n        const { videoIndex, currentIndex, segments } = action === 'undo' ? before : after;\n        this.wavesurfers[videoIndex].clearRegions();\n        this.props.setSegments({ videoIndex, segments });\n        this.initRegion(videoIndex, segments);\n        this.props.setCurrentSegment(currentIndex);\n        break;\n      }\n      case 'pushLine':\n        this.props.deleteLine({ ...data, actionType: 'history' });\n        break;\n      case 'deleteLine':\n        this.props.pushLine({ ...data, actionType: 'history' });\n        break;\n      case 'setLineColor':\n        this.props.setLineRole({ ...data, actionType: 'history' });\n        break;\n      default:\n        break;\n    }\n    if (recallItem.type === 'pushLine') {\n      recallItem.type = 'deleteLine';\n    } else if (recallItem.type === 'deleteLine') {\n      recallItem.type = 'pushLine';\n    } if (recallItem.type === 'setLineColor') {\n      const [nextRole, role] = [data.role, data.nextRole];\n      recallItem.data.role = role;\n      recallItem.data.nextRole = nextRole;\n    }\n\n    (action === 'undo' ? redoList : undoList).push(recallItem);\n  }\n\n  updateRegionElement(region) {\n    const { element, start, end } = region;\n    element.classList.add('dragged-region');\n    if (this.props.spaceLine > 0) {\n      const offset = this.props.spaceLine / (end - start);\n      let startLine = element.querySelector('.space-line.space-line-start');\n      let endLine = element.querySelector('.space-line.space-line-end');\n      if (offset < 0.5) {\n        if (!startLine) {\n          startLine = document.createElement('div');\n          startLine.className = 'space-line space-line-start';\n          element.appendChild(startLine);\n        }\n        if (!endLine) {\n          endLine = document.createElement('div');\n          endLine.className = 'space-line space-line-end';\n          element.appendChild(endLine);\n        }\n        startLine.style.left = `${offset * 100}%`;\n        endLine.style.right = `${offset * 100}%`;\n      } else {\n        if (startLine) {\n          startLine.remove();\n        }\n        if (endLine) {\n          endLine.remove();\n        }\n      }\n    }\n  }\n\n  updateMeasurement(index) {\n    if (this.current.videoIndex === index) {\n      // current video\n      let cursorHelper = this.container.audioContainer[index].getElementsByClassName('audio-cursor-helper')[0];\n      if (this.props.selectedMeasurement < 0) {\n        if (cursorHelper) {\n          cursorHelper.remove();\n        }\n      } else {\n        const { zoom, wavesurfer } = this.current;\n        if (!cursorHelper) {\n          cursorHelper = document.createElement('div');\n          cursorHelper.className = 'audio-cursor-helper';\n          wavesurfer?.cursor?.cursor.appendChild(cursorHelper);\n        }\n        // calc width\n        const duration = wavesurfer.getDuration();\n        const { offsetWidth } = wavesurfer.container;\n        const totalWidth = offsetWidth * zoom;\n        const width = (totalWidth / duration) * this.props.selectedMeasurement;\n        cursorHelper.style.width = `${width}px`;\n        cursorHelper.style.left = `-${width / 2}px`;\n      }\n    }\n  }\n\n  renderSegments = () => {\n    const { videos, results } = this.props;\n    videos.forEach((v, i) => {\n      if (v.ready) {\n        this.wavesurfers[i].clearRegions();\n        this.initRegion(i, results[i]);\n      }\n    });\n  };\n\n  render() { return null; }\n}\n\nconst mapStateToProps = (state) => ({\n  videos: state.videos,\n  results: state.results,\n  segmentConfig: state.segmentConfig,\n  lineConfig: state.lineConfig,\n  ontology: state.ontology,\n  currentSegment: state.currentSegment,\n  currentVideo: state.currentVideo,\n  currentPlayMode: state.currentPlayMode,\n  minSegmentLength: state.minSegmentLength,\n  isPlaying: state.isPlaying,\n  toolMode: state.toolMode,\n  spaceLine: state.spaceLine,\n  selectedMeasurement: state.selectedMeasurement,\n  segmentOverlap: state.segmentOverlap,\n  keyAttribute: state.keyAttribute,\n  annotateDisabled: state.annotateDisabled,\n  isLoadedAlaw: state.isLoadedAlaw,\n  styleConfig: state.styleConfig,\n});\nconst mapDispatchToProps = {\n  getWavesurfers,\n  setPlayingState,\n  setVideoValid,\n  deleteLine,\n  pushLine,\n  setLineRole,\n  parseSegments,\n  setErrorMsg,\n  setAudioErrorMsg,\n  appendSegment,\n  updateSegment,\n  deleteSegment,\n  setSegments,\n  updateLineRole,\n  updateVideoInfo,\n  setLoading,\n};\nexport default connect(mapStateToProps, mapDispatchToProps, null, { forwardRef: true })(WavesurferComp);\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}