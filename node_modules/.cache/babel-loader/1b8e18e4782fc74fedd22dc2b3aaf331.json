{"ast":null,"code":"var _jsxFileName = \"/Users/qzheng/Documents/webroot/annotation_tools/src/components/video-tracking2/components/attributes/PointAttributes.tsx\";\nimport React, { useRef, useState } from 'react';\nimport { toJS } from 'mobx';\nimport { observer } from 'mobx-react';\nimport cx from 'classnames';\nimport { Up, Pencil } from '../../../common/icons';\nimport AttributeValueItem from './AttributeValueItem';\nimport store from '../../store/RootStore';\nimport i18n from '../../locales';\nimport { parseFields } from '../../utils';\nimport './PointAttributes.scss';\nconst PointAttributes = observer(() => {\n  var _toJS$points$selected;\n  const [collapsed, setCollapsed] = useState(false);\n\n  // refs\n  const ref = useRef(null);\n  const {\n    selectedShapes,\n    selectedPointIndex\n  } = store.shape;\n  if (selectedShapes.length !== 1 || selectedPointIndex < 0) {\n    // no selected point\n    return null;\n  }\n  const selectedShape = selectedShapes[0];\n  const {\n    instanceItem\n  } = store.shape.shapes[selectedShape.uid];\n  const frameData = instanceItem.cameras[store.frame.currentCamera].frames[store.frame.currentFrame];\n  if (!frameData) {\n    return null;\n  }\n  const {\n    pointLabelConfig\n  } = instanceItem.categoryItemRef;\n  if (!pointLabelConfig) {\n    // no config\n    return null;\n  }\n  const pointUserData = ((_toJS$points$selected = toJS(frameData.shape).points[selectedPointIndex]) === null || _toJS$points$selected === void 0 ? void 0 : _toJS$points$selected.userData) || {};\n  const fieldsMap = parseFields(pointLabelConfig);\n  const attrKeys = Object.keys(pointUserData);\n  const fieldKeys = Object.keys(fieldsMap);\n  const renderAttrs = () => {\n    const legacyKeys = attrKeys.filter(key => !fieldKeys.includes(key));\n    return /*#__PURE__*/React.createElement(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 48,\n        columnNumber: 7\n      }\n    }, [...fieldKeys, ...legacyKeys].map(key => attrKeys.includes(key) && /*#__PURE__*/React.createElement(AttributeValueItem, {\n      key: key,\n      fieldName: key,\n      fieldsMap: fieldsMap,\n      values: pointUserData,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 50,\n        columnNumber: 11\n      }\n    })));\n  };\n  return /*#__PURE__*/React.createElement(\"div\", {\n    className: cx('collapse-panel point-attributes-panel', {\n      collapsed\n    }),\n    ref: ref,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 62,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"collapse-panel-title space-between\",\n    onClick: () => setCollapsed(!collapsed),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 63,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(\"span\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 67,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"collapse-panel-collapse-icon\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 68,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(Up, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 69,\n      columnNumber: 13\n    }\n  })), i18n.translate('POINT_ATTRIBUTES')), /*#__PURE__*/React.createElement(\"span\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 73,\n      columnNumber: 9\n    }\n  }, !store.readonly && /*#__PURE__*/React.createElement(\"div\", {\n    className: \"collapse-panel-icon\",\n    onClick: e => {\n      e.stopPropagation();\n      store.config.setPointAttributesModalVisible(true);\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 75,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(Pencil, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 82,\n      columnNumber: 15\n    }\n  })))), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"collapse-panel-content\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 87,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"point-title\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 88,\n      columnNumber: 9\n    }\n  }, i18n.translate('POINT_INDEX_LABEL', {\n    values: {\n      index: selectedPointIndex + 1\n    }\n  })), renderAttrs()));\n});\nexport default PointAttributes;","map":{"version":3,"names":["React","useRef","useState","toJS","observer","cx","Up","Pencil","AttributeValueItem","store","i18n","parseFields","PointAttributes","_toJS$points$selected","collapsed","setCollapsed","ref","selectedShapes","selectedPointIndex","shape","length","selectedShape","instanceItem","shapes","uid","frameData","cameras","frame","currentCamera","frames","currentFrame","pointLabelConfig","categoryItemRef","pointUserData","points","userData","fieldsMap","attrKeys","Object","keys","fieldKeys","renderAttrs","legacyKeys","filter","key","includes","createElement","__self","__source","fileName","_jsxFileName","lineNumber","columnNumber","map","fieldName","values","className","onClick","translate","readonly","e","stopPropagation","config","setPointAttributesModalVisible","index"],"sources":["/Users/qzheng/Documents/webroot/annotation_tools/src/components/video-tracking2/components/attributes/PointAttributes.tsx"],"sourcesContent":["import React, { useRef, useState } from 'react';\nimport { toJS } from 'mobx';\nimport { observer } from 'mobx-react';\nimport cx from 'classnames';\nimport { Up, Pencil } from '../../../common/icons';\nimport AttributeValueItem from './AttributeValueItem';\nimport store from '../../store/RootStore';\nimport i18n from '../../locales';\nimport { parseFields } from '../../utils';\nimport { PolygonData } from '../../../common/shapes/Polygon';\nimport { LineData } from '../../../common/shapes/Line';\nimport './PointAttributes.scss';\n\nconst PointAttributes = observer(() => {\n  const [collapsed, setCollapsed] = useState(false);\n\n  // refs\n  const ref = useRef<HTMLDivElement>(null);\n\n  const { selectedShapes, selectedPointIndex } = store.shape;\n  if (selectedShapes.length !== 1 || selectedPointIndex < 0) {\n    // no selected point\n    return null;\n  }\n\n  const selectedShape = selectedShapes[0];\n  const { instanceItem } = store.shape.shapes[selectedShape.uid];\n  const frameData = instanceItem.cameras[store.frame.currentCamera].frames[store.frame.currentFrame];\n  if (!frameData) {\n    return null;\n  }\n\n  const { pointLabelConfig } = instanceItem.categoryItemRef;\n  if (!pointLabelConfig) {\n    // no config\n    return null;\n  }\n\n  const pointUserData = toJS(frameData.shape as PolygonData | LineData).points[selectedPointIndex]?.userData || {};\n\n  const fieldsMap = parseFields(pointLabelConfig);\n  const attrKeys = Object.keys(pointUserData);\n  const fieldKeys = Object.keys(fieldsMap);\n\n  const renderAttrs = () => {\n    const legacyKeys = attrKeys.filter((key) => !fieldKeys.includes(key));\n    return (\n      <div>\n        {[...fieldKeys, ...legacyKeys].map((key) => attrKeys.includes(key) && (\n          <AttributeValueItem\n            key={key}\n            fieldName={key}\n            fieldsMap={fieldsMap}\n            values={pointUserData}\n          />\n        ))}\n      </div>\n    );\n  };\n\n  return (\n    <div className={cx('collapse-panel point-attributes-panel', { collapsed })} ref={ref}>\n      <div\n        className=\"collapse-panel-title space-between\"\n        onClick={() => setCollapsed(!collapsed)}\n      >\n        <span>\n          <div className=\"collapse-panel-collapse-icon\">\n            <Up />\n          </div>\n          {i18n.translate('POINT_ATTRIBUTES')}\n        </span>\n        <span>\n          {!store.readonly && (\n            <div\n              className=\"collapse-panel-icon\"\n              onClick={(e) => {\n                e.stopPropagation();\n                store.config.setPointAttributesModalVisible(true);\n              }}\n            >\n              <Pencil />\n            </div>\n          )}\n        </span>\n      </div>\n      <div className=\"collapse-panel-content\">\n        <div className=\"point-title\">{i18n.translate('POINT_INDEX_LABEL', { values: { index: selectedPointIndex + 1 } })}</div>\n        {renderAttrs()}\n      </div>\n    </div>\n  );\n});\n\nexport default PointAttributes;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}