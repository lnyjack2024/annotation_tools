{"ast":null,"code":"import React,{useEffect,useState}from'react';import{Input}from'antd';import ShapeMenu from'../../../common/sidebar/ShapeMenu';import store from'../../store/RootStore';import i18n from'../../locales';const InstanceItemMenu=_ref=>{let{instanceItem,camera,position,visible,onClose}=_ref;const[showRange,setShowRange]=useState(false);const[start,setStart]=useState('');const[end,setEnd]=useState('');useEffect(()=>{if(showRange){const{currentFrame}=store.frame;setStart(\"\".concat(currentFrame+1));setEnd(\"\".concat(currentFrame+1));}},[showRange]);const deleteByType=type=>{store.instance.deleteFramesFromInstanceItemByType(instanceItem,type,camera);};const deleteByRange=()=>{const startFrame=Number(start)-1;const endFrame=Number(end)-1;const frames=Array.from({length:endFrame-startFrame+1}).map((_,i)=>startFrame+i);store.instance.deleteFramesFromInstanceItem(instanceItem,frames,camera);setShowRange(false);};const fixStart=()=>{const startFrame=Number(start)-1;if(startFrame>=store.frame.frameCount){setStart(\"\".concat(store.frame.frameCount));}};const fixEnd=()=>{const startFrame=Number(start)-1;const endFrame=Number(end)-1;if(endFrame<startFrame){setEnd(start);}else if(endFrame>store.frame.frameCount){setEnd(\"\".concat(store.frame.frameCount));}};const menuItems=[[{label:i18n.translate('DELETE_CURRENT_FRAME'),disabled:store.readonly,onClick:()=>deleteByType()},{label:i18n.translate('DELETE_FOLLOWING_FRAMES_UNTIL_KEY'),disabled:store.readonly,onClick:()=>deleteByType('key')},{label:i18n.translate('DELETE_FOLLOWING_FRAMES'),disabled:store.readonly,onClick:()=>deleteByType('following')},{label:i18n.translate('DELETE_RANGE_FRAMES'),disabled:store.readonly,onClick:()=>setShowRange(true)},{label:i18n.translate('DELETE_ALL_FRAMES'),disabled:store.readonly,onClick:()=>deleteByType('all')}]];return/*#__PURE__*/React.createElement(React.Fragment,null,visible&&/*#__PURE__*/React.createElement(ShapeMenu,{position:position,items:menuItems,onClose:onClose}),showRange&&/*#__PURE__*/React.createElement(\"div\",{className:\"shape-menu-mask\"},/*#__PURE__*/React.createElement(\"div\",{className:\"shape-menu-popover\"},/*#__PURE__*/React.createElement(\"div\",{className:\"shape-menu-popover__title\"},i18n.translate('DELETE_RANGE_FRAMES')),/*#__PURE__*/React.createElement(\"div\",{className:\"shape-menu-popover__content\"},/*#__PURE__*/React.createElement(\"div\",{style:{paddingBottom:8}},i18n.translate('DELETE_RANGE_FRAMES_INFO')),/*#__PURE__*/React.createElement(\"div\",null,i18n.translate('DELETE_RANGE_FRAMES_FROM'),i18n.translate('DELETE_RANGE_FRAMES_NO'),/*#__PURE__*/React.createElement(Input,{size:\"small\",value:start,onChange:e=>{const{value}=e.target;if(!value||/^[1-9]\\d*$/.test(value)){setStart(value);}},onBlur:fixStart}),i18n.translate('DELETE_RANGE_FRAMES_FRAME'),i18n.translate('DELETE_RANGE_FRAMES_TO'),i18n.translate('DELETE_RANGE_FRAMES_NO'),/*#__PURE__*/React.createElement(Input,{size:\"small\",value:end,onChange:e=>{const{value}=e.target;if(!value||/^[1-9]\\d*$/.test(value)){setEnd(value);}},onBlur:fixEnd}),i18n.translate('DELETE_RANGE_FRAMES_FRAME'))),/*#__PURE__*/React.createElement(\"div\",{className:\"shape-menu-popover__action\"},/*#__PURE__*/React.createElement(\"div\",{className:\"shape-menu-popover__btn\",onClick:()=>setShowRange(false)},i18n.translate('COMMON_CANCEL')),/*#__PURE__*/React.createElement(\"div\",{className:\"shape-menu-popover__btn save\",onClick:deleteByRange},i18n.translate('COMMON_OK'))))));};export default InstanceItemMenu;","map":{"version":3,"names":["React","useEffect","useState","Input","ShapeMenu","store","i18n","InstanceItemMenu","_ref","instanceItem","camera","position","visible","onClose","showRange","setShowRange","start","setStart","end","setEnd","currentFrame","frame","concat","deleteByType","type","instance","deleteFramesFromInstanceItemByType","deleteByRange","startFrame","Number","endFrame","frames","Array","from","length","map","_","i","deleteFramesFromInstanceItem","fixStart","frameCount","fixEnd","menuItems","label","translate","disabled","readonly","onClick","createElement","Fragment","items","className","style","paddingBottom","size","value","onChange","e","target","test","onBlur"],"sources":["/Users/qzheng/Documents/webroot/annotation_tools/src/components/video-tracking2/components/sidebar/InstanceItemMenu.tsx"],"sourcesContent":["import React, { useEffect, useState } from 'react';\nimport { Input } from 'antd';\nimport ShapeMenu from '../../../common/sidebar/ShapeMenu';\nimport InstanceItem from '../../model/InstanceItem';\nimport store from '../../store/RootStore';\nimport i18n from '../../locales';\n\ninterface InstanceItemMenuProps {\n  instanceItem: InstanceItem;\n  camera: string;\n  position: { x: number; y: number };\n  visible: boolean;\n  onClose: () => void;\n}\n\nconst InstanceItemMenu = ({ instanceItem, camera, position, visible, onClose }: InstanceItemMenuProps) => {\n  const [showRange, setShowRange] = useState(false);\n  const [start, setStart] = useState('');\n  const [end, setEnd] = useState('');\n\n  useEffect(() => {\n    if (showRange) {\n      const { currentFrame } = store.frame;\n      setStart(`${currentFrame + 1}`);\n      setEnd(`${currentFrame + 1}`);\n    }\n  }, [showRange]);\n\n  const deleteByType = (type?: 'key' | 'following' | 'all') => {\n    store.instance.deleteFramesFromInstanceItemByType(instanceItem, type, camera);\n  };\n\n  const deleteByRange = () => {\n    const startFrame = Number(start) - 1;\n    const endFrame = Number(end) - 1;\n    const frames = Array.from({ length: endFrame - startFrame + 1 }).map((_, i) => startFrame + i);\n    store.instance.deleteFramesFromInstanceItem(instanceItem, frames, camera);\n    setShowRange(false);\n  };\n\n  const fixStart = () => {\n    const startFrame = Number(start) - 1;\n    if (startFrame >= store.frame.frameCount) {\n      setStart(`${store.frame.frameCount}`);\n    }\n  };\n\n  const fixEnd = () => {\n    const startFrame = Number(start) - 1;\n    const endFrame = Number(end) - 1;\n    if (endFrame < startFrame) {\n      setEnd(start);\n    } else if (endFrame > store.frame.frameCount) {\n      setEnd(`${store.frame.frameCount}`);\n    }\n  };\n\n  const menuItems = [\n    [\n      { label: i18n.translate('DELETE_CURRENT_FRAME'), disabled: store.readonly, onClick: () => deleteByType() },\n      { label: i18n.translate('DELETE_FOLLOWING_FRAMES_UNTIL_KEY'), disabled: store.readonly, onClick: () => deleteByType('key') },\n      { label: i18n.translate('DELETE_FOLLOWING_FRAMES'), disabled: store.readonly, onClick: () => deleteByType('following') },\n      { label: i18n.translate('DELETE_RANGE_FRAMES'), disabled: store.readonly, onClick: () => setShowRange(true) },\n      { label: i18n.translate('DELETE_ALL_FRAMES'), disabled: store.readonly, onClick: () => deleteByType('all') },\n    ],\n  ];\n  return (\n    <>\n      {visible && (\n        <ShapeMenu position={position} items={menuItems} onClose={onClose} />\n      )}\n      {showRange && (\n        <div className=\"shape-menu-mask\">\n          <div className=\"shape-menu-popover\">\n            <div className=\"shape-menu-popover__title\">\n              {i18n.translate('DELETE_RANGE_FRAMES')}\n            </div>\n            <div className=\"shape-menu-popover__content\">\n              <div style={{ paddingBottom: 8 }}>\n                {i18n.translate('DELETE_RANGE_FRAMES_INFO')}\n              </div>\n              <div>\n                {i18n.translate('DELETE_RANGE_FRAMES_FROM')}\n                {i18n.translate('DELETE_RANGE_FRAMES_NO')}\n                <Input\n                  size=\"small\"\n                  value={start}\n                  onChange={(e) => {\n                    const { value } = e.target;\n                    if (!value || /^[1-9]\\d*$/.test(value)) {\n                      setStart(value);\n                    }\n                  }}\n                  onBlur={fixStart}\n                />\n                {i18n.translate('DELETE_RANGE_FRAMES_FRAME')}\n                {i18n.translate('DELETE_RANGE_FRAMES_TO')}\n                {i18n.translate('DELETE_RANGE_FRAMES_NO')}\n                <Input\n                  size=\"small\"\n                  value={end}\n                  onChange={(e) => {\n                    const { value } = e.target;\n                    if (!value || /^[1-9]\\d*$/.test(value)) {\n                      setEnd(value);\n                    }\n                  }}\n                  onBlur={fixEnd}\n                />\n                {i18n.translate('DELETE_RANGE_FRAMES_FRAME')}\n              </div>\n            </div>\n            <div className=\"shape-menu-popover__action\">\n              <div className=\"shape-menu-popover__btn\" onClick={() => setShowRange(false)}>\n                {i18n.translate('COMMON_CANCEL')}\n              </div>\n              <div className=\"shape-menu-popover__btn save\" onClick={deleteByRange}>\n                {i18n.translate('COMMON_OK')}\n              </div>\n            </div>\n          </div>\n        </div>\n      )}\n    </>\n  );\n};\n\nexport default InstanceItemMenu;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}