{"ast":null,"code":"import React from'react';import{observer}from'mobx-react';import{toJS}from'mobx';import{Button,ConfigProvider}from'antd';import EasyForm from'@appen-china/easy-form';import Modal from'../../../common/modal/Modal';import store from'../../store/RootStore';import i18n from'../../locales';import{setInitialValues}from'../../utils';import'./AttributesModal.scss';class PointAttributesModal extends React.Component{constructor(){super(...arguments);/**\n   * form container\n   */this.ref=React.createRef();/**\n   * when instance values submit\n   * @param values\n   */this.onFrameValuesSubmit=values=>{const{selectedShapes,selectedPointIndex}=store.shape;const selectedShape=selectedShapes[0];store.shape.setPointUserData(selectedShape,selectedPointIndex,values);store.config.setPointAttributesModalVisible(false);};/**\n   * submit button click\n   */this.submit=()=>{var _this$ref$current;const buttons=(_this$ref$current=this.ref.current)===null||_this$ref$current===void 0?void 0:_this$ref$current.querySelectorAll('button.easyform-btn.form-btn-submit');buttons===null||buttons===void 0?void 0:buttons.forEach(btn=>{btn.click();});};}render(){var _toJS$points$selected;const{pointAttributesModalVisible}=store.config;const{selectedShapes,selectedPointIndex}=store.shape;if(!pointAttributesModalVisible||selectedShapes.length!==1||selectedPointIndex<0){// no selected point\nreturn null;}const selectedShape=selectedShapes[0];const{instanceItem}=store.shape.shapes[selectedShape.uid];const frameData=instanceItem.cameras[store.frame.currentCamera].frames[store.frame.currentFrame];const{pointLabelConfig}=instanceItem.categoryItemRef;if(!frameData||!pointLabelConfig){return null;}const pointUserData=((_toJS$points$selected=toJS(frameData.shape).points[selectedPointIndex])===null||_toJS$points$selected===void 0?void 0:_toJS$points$selected.userData)||{};const pointFields=setInitialValues(pointLabelConfig.fields,pointUserData);return/*#__PURE__*/React.createElement(Modal,{visible:true,draggable:true,closable:false,dragId:\"video-tracking-attributes\",className:\"attributes-form\",title:\"\".concat(instanceItem.label,\" - \").concat(i18n.translate('POINT_INDEX_LABEL',{values:{index:selectedPointIndex+1}})),onClose:()=>store.config.setPointAttributesModalVisible(false),onMaskClick:this.submit},/*#__PURE__*/React.createElement(\"div\",{ref:this.ref,className:\"attributes-form-content\"},/*#__PURE__*/React.createElement(EasyForm,{theme:\"dark\",fields:pointFields,conditions:pointLabelConfig.conditions,effects:pointLabelConfig.effects,rules:pointLabelConfig.rules,onSubmit:this.onFrameValuesSubmit})),/*#__PURE__*/React.createElement(\"div\",{className:\"attributes-form-footer\"},/*#__PURE__*/React.createElement(ConfigProvider,{prefixCls:\"easyform\"},/*#__PURE__*/React.createElement(Button,{type:\"primary\",onClick:this.submit},i18n.translate('COMMON_SUBMIT')))));}}export default observer(PointAttributesModal);","map":{"version":3,"names":["React","observer","toJS","Button","ConfigProvider","EasyForm","Modal","store","i18n","setInitialValues","PointAttributesModal","Component","constructor","arguments","ref","createRef","onFrameValuesSubmit","values","selectedShapes","selectedPointIndex","shape","selectedShape","setPointUserData","config","setPointAttributesModalVisible","submit","_this$ref$current","buttons","current","querySelectorAll","forEach","btn","click","render","_toJS$points$selected","pointAttributesModalVisible","length","instanceItem","shapes","uid","frameData","cameras","frame","currentCamera","frames","currentFrame","pointLabelConfig","categoryItemRef","pointUserData","points","userData","pointFields","fields","createElement","visible","draggable","closable","dragId","className","title","concat","label","translate","index","onClose","onMaskClick","theme","conditions","effects","rules","onSubmit","prefixCls","type","onClick"],"sources":["/Users/qzheng/Documents/webroot/annotation_tools/src/components/video-tracking2/components/attributes/PointAttributesModal.tsx"],"sourcesContent":["import React from 'react';\nimport { observer } from 'mobx-react';\nimport { toJS } from 'mobx';\nimport { Button, ConfigProvider } from 'antd';\nimport EasyForm from '@appen-china/easy-form';\nimport Modal from '../../../common/modal/Modal';\nimport store from '../../store/RootStore';\nimport i18n from '../../locales';\nimport { setInitialValues } from '../../utils';\nimport { PolygonData } from '../../../common/shapes/Polygon';\nimport { LineData } from '../../../common/shapes/Line';\nimport './AttributesModal.scss';\n\nclass PointAttributesModal extends React.Component {\n  /**\n   * form container\n   */\n  ref = React.createRef<HTMLDivElement>();\n\n  /**\n   * when instance values submit\n   * @param values\n   */\n  onFrameValuesSubmit = (values: any) => {\n    const { selectedShapes, selectedPointIndex } = store.shape;\n    const selectedShape = selectedShapes[0];\n    store.shape.setPointUserData(selectedShape, selectedPointIndex, values);\n    store.config.setPointAttributesModalVisible(false);\n  };\n\n  /**\n   * submit button click\n   */\n  submit = () => {\n    const buttons = this.ref.current?.querySelectorAll('button.easyform-btn.form-btn-submit');\n    buttons?.forEach((btn) => {\n      (btn as HTMLButtonElement).click();\n    });\n  };\n\n  render() {\n    const { pointAttributesModalVisible } = store.config;\n    const { selectedShapes, selectedPointIndex } = store.shape;\n    if (!pointAttributesModalVisible || selectedShapes.length !== 1 || selectedPointIndex < 0) {\n      // no selected point\n      return null;\n    }\n\n    const selectedShape = selectedShapes[0];\n    const { instanceItem } = store.shape.shapes[selectedShape.uid];\n    const frameData = instanceItem.cameras[store.frame.currentCamera].frames[store.frame.currentFrame];\n    const { pointLabelConfig } = instanceItem.categoryItemRef;\n    if (!frameData || !pointLabelConfig) {\n      return null;\n    }\n\n    const pointUserData = toJS(frameData.shape as PolygonData | LineData).points[selectedPointIndex]?.userData || {};\n    const pointFields = setInitialValues(pointLabelConfig.fields, pointUserData);\n    return (\n      <Modal\n        visible\n        draggable\n        closable={false}\n        dragId=\"video-tracking-attributes\"\n        className=\"attributes-form\"\n        title={`${instanceItem.label} - ${i18n.translate('POINT_INDEX_LABEL', { values: { index: selectedPointIndex + 1 } })}`}\n        onClose={() => store.config.setPointAttributesModalVisible(false)}\n        onMaskClick={this.submit}\n      >\n        <div ref={this.ref} className=\"attributes-form-content\">\n          <EasyForm\n            theme=\"dark\"\n            fields={pointFields}\n            conditions={pointLabelConfig.conditions}\n            effects={pointLabelConfig.effects}\n            rules={pointLabelConfig.rules}\n            onSubmit={this.onFrameValuesSubmit}\n          />\n        </div>\n        <div className=\"attributes-form-footer\">\n          <ConfigProvider prefixCls=\"easyform\">\n            <Button type=\"primary\" onClick={this.submit}>\n              {i18n.translate('COMMON_SUBMIT')}\n            </Button>\n          </ConfigProvider>\n        </div>\n      </Modal>\n    );\n  }\n}\n\nexport default observer(PointAttributesModal);\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}