{"ast":null,"code":"import{useState,useRef,useEffect,useCallback}from'react';import{getNextState}from'./utils';export default function useAsyncState(init){const[state,setState]=useState(init);const list=useRef([]);useEffect(()=>{list.current.forEach(v=>v(state));list.current=[];},[state]);const action=useCallback(nextState=>new Promise(resolve=>{setState(prevState=>{// const nextState = value instanceof Function ? value(prevState) : value;\nif(nextState===prevState){resolve(nextState);}else{list.current.push(resolve);}return nextState;});}),[setState]);const asyncSetState=useCallback(async value=>{const preState=await getNextState(setState);const nextState=value instanceof Function?await value(preState):value;return action(nextState);},[]);return[state,asyncSetState];}","map":{"version":3,"names":["useState","useRef","useEffect","useCallback","getNextState","useAsyncState","init","state","setState","list","current","forEach","v","action","nextState","Promise","resolve","prevState","push","asyncSetState","value","preState","Function"],"sources":["/Users/qzheng/Documents/webroot/annotation_tools/src/components/keypoint/useAsyncState.ts"],"sourcesContent":["import { useState, useRef, useEffect, useCallback } from 'react';\nimport { getNextState } from './utils';\n\ntype SetStateAction<S> = (\n  prevState: S | ((prevState: S) => S | Promise<S>)\n) => Promise<S>;\ntype AsyncAction<S> = (value: S) => Promise<S>;\n\nexport default function useAsyncState<S>(init: S | (() => S)): [S, SetStateAction<S>] {\n  const [state, setState] = useState<S>(init);\n\n  const list = useRef<Array<(state: S) => void>>([]);\n\n  useEffect(() => {\n    list.current.forEach((v) => v(state));\n    list.current = [];\n  }, [state]);\n\n  const action: AsyncAction<S> = useCallback(\n    (nextState: S) => new Promise<S>((resolve) => {\n      setState((prevState) => {\n        // const nextState = value instanceof Function ? value(prevState) : value;\n\n        if (nextState === prevState) {\n          resolve(nextState);\n        } else {\n          list.current.push(resolve);\n        }\n\n        return nextState;\n      });\n    }),\n    [setState]\n  );\n\n  const asyncSetState: SetStateAction<S> = useCallback(\n    async (value: S | ((prevState: S) => S | Promise<S>)) => {\n      const preState = await getNextState(setState);\n      const nextState =\n        value instanceof Function ? await value(preState) : value;\n      return action(nextState);\n    },\n    []\n  );\n\n  return [state, asyncSetState];\n}\n"],"mappings":"AAAA,OAASA,QAAQ,CAAEC,MAAM,CAAEC,SAAS,CAAEC,WAAW,KAAQ,OAAO,CAChE,OAASC,YAAY,KAAQ,SAAS,CAOtC,cAAe,SAAS,CAAAC,aAAaA,CAAIC,IAAmB,CAA0B,CACpF,KAAM,CAACC,KAAK,CAAEC,QAAQ,CAAC,CAAGR,QAAQ,CAAIM,IAAI,CAAC,CAE3C,KAAM,CAAAG,IAAI,CAAGR,MAAM,CAA4B,EAAE,CAAC,CAElDC,SAAS,CAAC,IAAM,CACdO,IAAI,CAACC,OAAO,CAACC,OAAO,CAAEC,CAAC,EAAKA,CAAC,CAACL,KAAK,CAAC,CAAC,CACrCE,IAAI,CAACC,OAAO,CAAG,EAAE,CACnB,CAAC,CAAE,CAACH,KAAK,CAAC,CAAC,CAEX,KAAM,CAAAM,MAAsB,CAAGV,WAAW,CACvCW,SAAY,EAAK,GAAI,CAAAC,OAAO,CAAKC,OAAO,EAAK,CAC5CR,QAAQ,CAAES,SAAS,EAAK,CACtB;AAEA,GAAIH,SAAS,GAAKG,SAAS,CAAE,CAC3BD,OAAO,CAACF,SAAS,CAAC,CACpB,CAAC,IAAM,CACLL,IAAI,CAACC,OAAO,CAACQ,IAAI,CAACF,OAAO,CAAC,CAC5B,CAEA,MAAO,CAAAF,SAAS,CAClB,CAAC,CAAC,CACJ,CAAC,CAAC,CACF,CAACN,QAAQ,CACX,CAAC,CAED,KAAM,CAAAW,aAAgC,CAAGhB,WAAW,CAClD,KAAO,CAAAiB,KAA6C,EAAK,CACvD,KAAM,CAAAC,QAAQ,CAAG,KAAM,CAAAjB,YAAY,CAACI,QAAQ,CAAC,CAC7C,KAAM,CAAAM,SAAS,CACbM,KAAK,WAAY,CAAAE,QAAQ,CAAG,KAAM,CAAAF,KAAK,CAACC,QAAQ,CAAC,CAAGD,KAAK,CAC3D,MAAO,CAAAP,MAAM,CAACC,SAAS,CAAC,CAC1B,CAAC,CACD,EACF,CAAC,CAED,MAAO,CAACP,KAAK,CAAEY,aAAa,CAAC,CAC/B","ignoreList":[]},"metadata":{},"sourceType":"module"}