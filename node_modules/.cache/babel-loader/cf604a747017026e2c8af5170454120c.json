{"ast":null,"code":"import React,{useState,useEffect,useRef}from'react';import{observer}from'mobx-react';import EasyForm from'@appen-china/easy-form';import store from'../../store/RootStore';import{setInitialValues}from'../../utils';import'./AttributesModal.scss';const InstanceItemAttributesForm=observer(_ref=>{let{instanceItem,onSubmit}=_ref;// FIXME: use current camera cause multiple cameras not supported yet\nconst{currentCamera,currentFrame,isSingleCamera,cameraNames}=store.frame;const frameData=instanceItem.cameras[currentCamera].frames[currentFrame];const{labelConfig:config}=instanceItem.categoryItemRef;// fields\nconst[fields,setFields]=useState([]);// field -> applied frames mapping\nconst fieldFramesMap=useRef({});// set initial ocr text\nuseEffect(()=>{setFields(setInitialValues((config===null||config===void 0?void 0:config.fields)||[],frameData===null||frameData===void 0?void 0:frameData.attributes));},[]);const handleSubmit=attributes=>{const allValues={attributes};onSubmit(allValues,fieldFramesMap.current);};if(!store.instance.isInstanceItemAttributesEnabled(instanceItem)){return null;}return/*#__PURE__*/React.createElement(\"div\",{className:\"attributes-form-section\"},/*#__PURE__*/React.createElement(\"div\",{className:\"attributes-form-section__title\"},\"\".concat(instanceItem.itemLabel).concat(isSingleCamera?'':\"-C\".concat(cameraNames.indexOf(currentCamera)+1))),/*#__PURE__*/React.createElement(\"div\",{className:\"attributes-form-section__content\"},config&&/*#__PURE__*/React.createElement(\"div\",{className:\"attributes-form-section__item\"},/*#__PURE__*/React.createElement(EasyForm,{theme:\"dark\",fields:fields,conditions:config.conditions,effects:config.effects,rules:config.rules,onSubmit:v=>handleSubmit(v)}))),!config&&/*#__PURE__*/React.createElement(\"div\",{style:{display:'none'}},/*#__PURE__*/React.createElement(\"button\",{className:\"easyform-btn form-btn-submit\",onClick:()=>handleSubmit()})));});export default InstanceItemAttributesForm;","map":{"version":3,"names":["React","useState","useEffect","useRef","observer","EasyForm","store","setInitialValues","InstanceItemAttributesForm","_ref","instanceItem","onSubmit","currentCamera","currentFrame","isSingleCamera","cameraNames","frame","frameData","cameras","frames","labelConfig","config","categoryItemRef","fields","setFields","fieldFramesMap","attributes","handleSubmit","allValues","current","instance","isInstanceItemAttributesEnabled","createElement","className","concat","itemLabel","indexOf","theme","conditions","effects","rules","v","style","display","onClick"],"sources":["/Users/qzheng/Documents/webroot/annotation_tools/src/components/video-tracking2/components/attributes/InstanceItemAttributesForm.tsx"],"sourcesContent":["import React, { useState, useEffect, useRef } from 'react';\nimport { observer } from 'mobx-react';\nimport EasyForm from '@appen-china/easy-form';\nimport { Field } from '@appen-china/easy-form/es/types';\nimport InstanceItem from '../../model/InstanceItem';\nimport store from '../../store/RootStore';\nimport { setInitialValues } from '../../utils';\nimport './AttributesModal.scss';\n\ninterface InstanceItemAttributesFormProps {\n  instanceItem: InstanceItem;\n  onSubmit: (values: { attributes?: any }, fieldFramesMap: { [field: string]: number[] }) => void;\n}\n\nconst InstanceItemAttributesForm = observer(({ instanceItem, onSubmit }: InstanceItemAttributesFormProps) => {\n  // FIXME: use current camera cause multiple cameras not supported yet\n  const { currentCamera, currentFrame, isSingleCamera, cameraNames } = store.frame;\n  const frameData = instanceItem.cameras[currentCamera].frames[currentFrame];\n  const { labelConfig: config } = instanceItem.categoryItemRef;\n\n  // fields\n  const [fields, setFields] = useState<Field[]>([]);\n  // field -> applied frames mapping\n  const fieldFramesMap = useRef<{ [field: string]: number[] }>({});\n\n  // set initial ocr text\n  useEffect(() => {\n    setFields(setInitialValues(config?.fields || [], frameData?.attributes));\n  }, []);\n\n  const handleSubmit = (attributes?: any) => {\n    const allValues: { attributes?: any } = { attributes };\n    onSubmit(allValues, fieldFramesMap.current);\n  };\n\n  if (!store.instance.isInstanceItemAttributesEnabled(instanceItem)) {\n    return null;\n  }\n\n  return (\n    <div className=\"attributes-form-section\">\n      <div className=\"attributes-form-section__title\">\n        {`${instanceItem.itemLabel}${isSingleCamera ? '' : `-C${cameraNames.indexOf(currentCamera) + 1}`}`}\n      </div>\n      <div className=\"attributes-form-section__content\">\n        {config && (\n          <div className=\"attributes-form-section__item\">\n            <EasyForm\n              theme=\"dark\"\n              fields={fields}\n              conditions={config.conditions}\n              effects={config.effects}\n              rules={config.rules}\n              onSubmit={(v) => handleSubmit(v)}\n            />\n          </div>\n        )}\n      </div>\n      {!config && (\n        <div style={{ display: 'none' }}>\n          {/* eslint-disable-next-line jsx-a11y/control-has-associated-label */}\n          <button className=\"easyform-btn form-btn-submit\" onClick={() => handleSubmit()} />\n        </div>\n      )}\n    </div>\n  );\n});\n\nexport default InstanceItemAttributesForm;\n"],"mappings":"AAAA,MAAO,CAAAA,KAAK,EAAIC,QAAQ,CAAEC,SAAS,CAAEC,MAAM,KAAQ,OAAO,CAC1D,OAASC,QAAQ,KAAQ,YAAY,CACrC,MAAO,CAAAC,QAAQ,KAAM,wBAAwB,CAG7C,MAAO,CAAAC,KAAK,KAAM,uBAAuB,CACzC,OAASC,gBAAgB,KAAQ,aAAa,CAC9C,MAAO,wBAAwB,CAO/B,KAAM,CAAAC,0BAA0B,CAAGJ,QAAQ,CAACK,IAAA,EAAiE,IAAhE,CAAEC,YAAY,CAAEC,QAA0C,CAAC,CAAAF,IAAA,CACtG;AACA,KAAM,CAAEG,aAAa,CAAEC,YAAY,CAAEC,cAAc,CAAEC,WAAY,CAAC,CAAGT,KAAK,CAACU,KAAK,CAChF,KAAM,CAAAC,SAAS,CAAGP,YAAY,CAACQ,OAAO,CAACN,aAAa,CAAC,CAACO,MAAM,CAACN,YAAY,CAAC,CAC1E,KAAM,CAAEO,WAAW,CAAEC,MAAO,CAAC,CAAGX,YAAY,CAACY,eAAe,CAE5D;AACA,KAAM,CAACC,MAAM,CAAEC,SAAS,CAAC,CAAGvB,QAAQ,CAAU,EAAE,CAAC,CACjD;AACA,KAAM,CAAAwB,cAAc,CAAGtB,MAAM,CAAgC,CAAC,CAAC,CAAC,CAEhE;AACAD,SAAS,CAAC,IAAM,CACdsB,SAAS,CAACjB,gBAAgB,CAAC,CAAAc,MAAM,SAANA,MAAM,iBAANA,MAAM,CAAEE,MAAM,GAAI,EAAE,CAAEN,SAAS,SAATA,SAAS,iBAATA,SAAS,CAAES,UAAU,CAAC,CAAC,CAC1E,CAAC,CAAE,EAAE,CAAC,CAEN,KAAM,CAAAC,YAAY,CAAID,UAAgB,EAAK,CACzC,KAAM,CAAAE,SAA+B,CAAG,CAAEF,UAAW,CAAC,CACtDf,QAAQ,CAACiB,SAAS,CAAEH,cAAc,CAACI,OAAO,CAAC,CAC7C,CAAC,CAED,GAAI,CAACvB,KAAK,CAACwB,QAAQ,CAACC,+BAA+B,CAACrB,YAAY,CAAC,CAAE,CACjE,MAAO,KAAI,CACb,CAEA,mBACEV,KAAA,CAAAgC,aAAA,QAAKC,SAAS,CAAC,yBAAyB,eACtCjC,KAAA,CAAAgC,aAAA,QAAKC,SAAS,CAAC,gCAAgC,KAAAC,MAAA,CACzCxB,YAAY,CAACyB,SAAS,EAAAD,MAAA,CAAGpB,cAAc,CAAG,EAAE,MAAAoB,MAAA,CAAQnB,WAAW,CAACqB,OAAO,CAACxB,aAAa,CAAC,CAAG,CAAC,CAAE,CAC7F,CAAC,cACNZ,KAAA,CAAAgC,aAAA,QAAKC,SAAS,CAAC,kCAAkC,EAC9CZ,MAAM,eACLrB,KAAA,CAAAgC,aAAA,QAAKC,SAAS,CAAC,+BAA+B,eAC5CjC,KAAA,CAAAgC,aAAA,CAAC3B,QAAQ,EACPgC,KAAK,CAAC,MAAM,CACZd,MAAM,CAAEA,MAAO,CACfe,UAAU,CAAEjB,MAAM,CAACiB,UAAW,CAC9BC,OAAO,CAAElB,MAAM,CAACkB,OAAQ,CACxBC,KAAK,CAAEnB,MAAM,CAACmB,KAAM,CACpB7B,QAAQ,CAAG8B,CAAC,EAAKd,YAAY,CAACc,CAAC,CAAE,CAClC,CACE,CAEJ,CAAC,CACL,CAACpB,MAAM,eACNrB,KAAA,CAAAgC,aAAA,QAAKU,KAAK,CAAE,CAAEC,OAAO,CAAE,MAAO,CAAE,eAE9B3C,KAAA,CAAAgC,aAAA,WAAQC,SAAS,CAAC,8BAA8B,CAACW,OAAO,CAAEA,CAAA,GAAMjB,YAAY,CAAC,CAAE,CAAE,CAC9E,CAEJ,CAAC,CAEV,CAAC,CAAC,CAEF,cAAe,CAAAnB,0BAA0B","ignoreList":[]},"metadata":{},"sourceType":"module"}