{"ast":null,"code":"import React from'react';import{observer}from'mobx-react';import{reaction,makeObservable,observable,action}from'mobx';import{Point,Texture,utils}from'pixi.js';import ResizeObserver from'resize-observer-polyfill';import imageLoader from'blueimp-load-image';import OperationNavigator from'../toolbar/OperationNavigator';import Assistant from'../../../common/shapes/assists/Assistant';import store from'../../store/RootStore';import i18n from'../../locales';import{NAVIGATOR_HEIGHT,CAMERA_VIEW,CAMERA_VIEW_LABELS}from'../../constants';import'./CamerasContainer.scss';class CamerasContainer extends React.Component{constructor(props){super(props);/**\n   * canvas dom container\n   */this.container=React.createRef();/**\n   * cameras dom container\n   */this.camerasContainer=React.createRef();/**\n   * cancellable image loader\n   */this.cancellableLoaders=[];/**\n   * loaded count for current frame\n   */this.loadedCount=0;/**\n   * reactions\n   */this.reactionDisposers=[];/**\n   * mouse position\n   */this.mousePosition={x:-1,y:-1};/**\n   * image load errors\n   */this.imageLoadErrors={};/**\n   * update mouse position\n   * @param e\n   */this.updateMousePosition=e=>{const{clientX,clientY}=e;this.mousePosition={x:clientX,y:clientY};};/**\n   * resize\n   */this.resize=()=>{const{width,height}=this.getContainerSize();this.props.app.renderer.resize(width,height);this.props.app.render();// update camera views\nObject.values(store.frame.cameraViews).forEach((cameraView,i)=>{this.updateCameraBounds(cameraView,i);if(store.fullscreenRequested){cameraView.fitImageToView();}});// delay to set to false to wait fullscreen finish\nsetTimeout(()=>{store.fullscreenRequested=false;},0);};/**\n   * on resource loaded\n   * @param name\n   * @param index\n   * @param url\n   * @param data\n   */this.onLoaded=(name,index,url,data)=>{const error=data instanceof Event&&data.type==='error';const cameraView=store.frame.cameraViews[name];if(cameraView){const{currentCamera,currentFrame,updateImageSize}=store.frame;if(currentCamera===name){this.props.app.stage.addChild(cameraView);}else{this.props.app.stage.removeChild(cameraView);}cameraView.imageLoadError=error;this.updateCameraBounds(cameraView,index);let texture;if(!error){texture=Texture.from(data);cameraView.setImage(texture);}updateImageSize(name,currentFrame,error?-1:texture.width,error?-1:texture.height);}this.imageLoadErrors[name]=error?i18n.translate('COMMON_IMAGE_ERROR',{values:{image:url||i18n.translate('COMMON_EMPTY')}}):'';this.loadedCount+=1;this.checkLoaded();};/**\n   * wheel\n   */this.wheel=event=>{event.stopPropagation();const{currentCameraView}=store.frame;if(currentCameraView){const point=this.mapScreenToStagePosition(event.clientX,event.clientY);const localPoint=this.mapStageToLocalPosition(point);currentCameraView.zoom(event.nativeEvent,localPoint);}};makeObservable(this,{mousePosition:observable,imageLoadErrors:observable,updateMousePosition:action,onLoaded:action});this.reactionDisposers.push(reaction(()=>[store.initialized,store.frame.currentFrame],()=>{// when initialized, or frame changes\nthis.updateCameras();}));}componentDidMount(){window.addEventListener('mousemove',this.updateMousePosition);if(this.container.current){new ResizeObserver(this.resize).observe(this.container.current);this.props.app.renderer.on('resolution-changed',this.resize);// setup view\nthis.container.current.appendChild(this.props.app.view);this.resize();this.updateCameras();}}componentWillUnmount(){window.removeEventListener('mousemove',this.updateMousePosition);this.props.app.renderer.off('resolution-changed',this.resize);this.reactionDisposers.forEach(disposer=>disposer());// remove camera views\nObject.values(store.frame.cameraViews).forEach(view=>{this.props.app.stage.removeChild(view);});}/**\n   * get container's size, defualt is 800 * 600\n   */getContainerSize(){// default size is 800 * 600\nconst size={width:800,height:600};if(this.container.current){size.width=this.container.current.clientWidth;size.height=this.container.current.clientHeight;}return size;}/**\n   * update cameras for current frame\n   */updateCameras(){const{cameras,currentFrame}=store.frame;utils.clearTextureCache();this.cancellableLoaders.forEach(loader=>{loader.cancel();});this.cancellableLoaders=[];this.loadedCount=0;Object.keys(cameras).forEach((camera,i)=>{const url=cameras[camera][currentFrame]||'';const loader={cancelled:false,cancel(){this.cancelled=true;},load(){return new Promise((resove,reject)=>{imageLoader(url,data=>{if(!this.cancelled){resove(data);}else{reject();}},{canvas:true,orientation:true,crossOrigin:'anonymous'});});}};loader.load().then(data=>this.onLoaded(camera,i,url,data)).catch(()=>{// canceled\n});this.cancellableLoaders.push(loader);});}/**\n   * update camera bounds\n   * @param cameraView\n   * @param index\n   */updateCameraBounds(cameraView,index){const x=0;const y=0;const{width,height}=this.props.app.screen;cameraView.updatePositionAndSize(x,y,width,height);const cameraDom=document.getElementById(\"\".concat(CAMERA_VIEW,\"-\").concat(cameraView.id));if(cameraDom){cameraDom.style.left=\"\".concat(x,\"px\");cameraDom.style.top=\"\".concat(y,\"px\");cameraDom.style.width=\"\".concat(width,\"px\");cameraDom.style.height=\"\".concat(height,\"px\");}}/**\n   * check all cameras loaded in current frame\n   */checkLoaded(){const{cameras,onFrameLoaded}=store.frame;if(this.loadedCount===Object.keys(cameras).length){onFrameLoaded();}}/**\n   * update all cameras bounds\n   */updateAllCameraViewsBounds(){const{cameraViews}=store.frame;Object.values(cameraViews).forEach((cameraView,i)=>{this.updateCameraBounds(cameraView,i);});}/**\n   * map screen position to stage position as a PIXI point\n   * @param x screen position x\n   * @param y screen position y\n   */mapScreenToStagePosition(x,y){const point=new Point();this.props.app.renderer.plugins.interaction.mapPositionToPoint(point,x,y);return point;}/**\n   * map stage position to local posistion as a PIXI point\n   * @param point\n   */mapStageToLocalPosition(point){return this.props.app.stage.toLocal(point);}render(){const{cursor,viewScale,crossLineVisible,activeMeasurementBox}=store.config;const{currentCamera,currentCameraView}=store.frame;return/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(OperationNavigator,{onViewReset:()=>currentCameraView===null||currentCameraView===void 0?void 0:currentCameraView.fitImageToView(),setViewScale:scale=>currentCameraView===null||currentCameraView===void 0?void 0:currentCameraView.zoomTo(scale)}),/*#__PURE__*/React.createElement(\"div\",{style:{width:'100%',height:\"calc(100% - \".concat(NAVIGATOR_HEIGHT,\"px)\"),position:'relative',cursor}},/*#__PURE__*/React.createElement(\"div\",{ref:this.container,className:\"canvas-container\",style:{width:'100%',height:'100%'},onContextMenu:e=>e.preventDefault(),onWheel:this.wheel}),/*#__PURE__*/React.createElement(\"div\",{ref:this.camerasContainer,className:\"cameras-container\"},/*#__PURE__*/React.createElement(\"div\",{id:\"\".concat(CAMERA_VIEW,\"-\").concat(currentCamera),className:\"camera-view selected single\"},/*#__PURE__*/React.createElement(\"div\",{id:\"\".concat(CAMERA_VIEW_LABELS,\"-\").concat(currentCamera),className:\"shape-labels-container label-mode\"}),/*#__PURE__*/React.createElement(Assistant,{scale:viewScale,crossline:crossLineVisible,measurementBox:activeMeasurementBox,mousePosition:this.mousePosition}),/*#__PURE__*/React.createElement(\"div\",{className:\"outer-border\"},/*#__PURE__*/React.createElement(\"div\",{className:\"inner-border\"},this.imageLoadErrors[currentCamera]&&/*#__PURE__*/React.createElement(\"div\",{className:\"error\"},this.imageLoadErrors[currentCamera])))))));}}export default observer(CamerasContainer);","map":{"version":3,"names":["React","observer","reaction","makeObservable","observable","action","Point","Texture","utils","ResizeObserver","imageLoader","OperationNavigator","Assistant","store","i18n","NAVIGATOR_HEIGHT","CAMERA_VIEW","CAMERA_VIEW_LABELS","CamerasContainer","Component","constructor","props","container","createRef","camerasContainer","cancellableLoaders","loadedCount","reactionDisposers","mousePosition","x","y","imageLoadErrors","updateMousePosition","e","clientX","clientY","resize","width","height","getContainerSize","app","renderer","render","Object","values","frame","cameraViews","forEach","cameraView","i","updateCameraBounds","fullscreenRequested","fitImageToView","setTimeout","onLoaded","name","index","url","data","error","Event","type","currentCamera","currentFrame","updateImageSize","stage","addChild","removeChild","imageLoadError","texture","from","setImage","translate","image","checkLoaded","wheel","event","stopPropagation","currentCameraView","point","mapScreenToStagePosition","localPoint","mapStageToLocalPosition","zoom","nativeEvent","push","initialized","updateCameras","componentDidMount","window","addEventListener","current","observe","on","appendChild","view","componentWillUnmount","removeEventListener","off","disposer","size","clientWidth","clientHeight","cameras","clearTextureCache","loader","cancel","keys","camera","cancelled","load","Promise","resove","reject","canvas","orientation","crossOrigin","then","catch","screen","updatePositionAndSize","cameraDom","document","getElementById","concat","id","style","left","top","onFrameLoaded","length","updateAllCameraViewsBounds","plugins","interaction","mapPositionToPoint","toLocal","cursor","viewScale","crossLineVisible","activeMeasurementBox","config","createElement","Fragment","onViewReset","setViewScale","scale","zoomTo","position","ref","className","onContextMenu","preventDefault","onWheel","crossline","measurementBox"],"sources":["/Users/qzheng/Documents/webroot/annotation_tools/src/components/video-tracking2/components/cameras/CamerasContainer.tsx"],"sourcesContent":["import React from 'react';\nimport { observer } from 'mobx-react';\nimport { reaction, IReactionDisposer, makeObservable, observable, action } from 'mobx';\nimport { Application, Point, Texture, utils } from 'pixi.js';\nimport ResizeObserver from 'resize-observer-polyfill';\nimport imageLoader from 'blueimp-load-image';\nimport OperationNavigator from '../toolbar/OperationNavigator';\nimport Assistant from '../../../common/shapes/assists/Assistant';\nimport type View from '../../shapes/View';\nimport store from '../../store/RootStore';\nimport i18n from '../../locales';\nimport { NAVIGATOR_HEIGHT, CAMERA_VIEW, CAMERA_VIEW_LABELS } from '../../constants';\nimport './CamerasContainer.scss';\n\ninterface CancellableLoader {\n  cancelled: boolean;\n  cancel: () => void;\n  load: () => Promise<Event | HTMLCanvasElement | HTMLImageElement>;\n}\n\ninterface CamerasContainerProps {\n  app: Application;\n}\n\nclass CamerasContainer extends React.Component<CamerasContainerProps> {\n  /**\n   * canvas dom container\n   */\n  container = React.createRef<HTMLDivElement>();\n\n  /**\n   * cameras dom container\n   */\n  camerasContainer = React.createRef<HTMLDivElement>();\n\n  /**\n   * cancellable image loader\n   */\n  cancellableLoaders: CancellableLoader[] = [];\n\n  /**\n   * loaded count for current frame\n   */\n  loadedCount = 0;\n\n  /**\n   * reactions\n   */\n  reactionDisposers: IReactionDisposer[] = [];\n\n  /**\n   * mouse position\n   */\n  mousePosition = {\n    x: -1,\n    y: -1,\n  };\n\n  /**\n   * image load errors\n   */\n  imageLoadErrors: {\n    [camera: string]: string;\n  } = {};\n\n  constructor(props: CamerasContainerProps) {\n    super(props);\n\n    makeObservable(this, {\n      mousePosition: observable,\n      imageLoadErrors: observable,\n      updateMousePosition: action,\n      onLoaded: action,\n    });\n\n    this.reactionDisposers.push(reaction(\n      () => [store.initialized, store.frame.currentFrame],\n      () => {\n        // when initialized, or frame changes\n        this.updateCameras();\n      },\n    ));\n  }\n\n  componentDidMount() {\n    window.addEventListener('mousemove', this.updateMousePosition);\n    if (this.container.current) {\n      new ResizeObserver(this.resize).observe(this.container.current);\n      this.props.app.renderer.on('resolution-changed', this.resize);\n\n      // setup view\n      this.container.current.appendChild(this.props.app.view);\n      this.resize();\n      this.updateCameras();\n    }\n  }\n\n  componentWillUnmount() {\n    window.removeEventListener('mousemove', this.updateMousePosition);\n    this.props.app.renderer.off('resolution-changed', this.resize);\n    this.reactionDisposers.forEach((disposer) => disposer());\n    // remove camera views\n    Object.values(store.frame.cameraViews).forEach((view) => {\n      this.props.app.stage.removeChild(view);\n    });\n  }\n\n  /**\n   * update mouse position\n   * @param e\n   */\n  updateMousePosition = (e: MouseEvent) => {\n    const { clientX, clientY } = e;\n    this.mousePosition = {\n      x: clientX,\n      y: clientY,\n    };\n  };\n\n  /**\n   * get container's size, defualt is 800 * 600\n   */\n  getContainerSize() {\n    // default size is 800 * 600\n    const size = {\n      width: 800,\n      height: 600,\n    };\n    if (this.container.current) {\n      size.width = this.container.current.clientWidth;\n      size.height = this.container.current.clientHeight;\n    }\n    return size;\n  }\n\n  /**\n   * resize\n   */\n  resize = () => {\n    const { width, height } = this.getContainerSize();\n    this.props.app.renderer.resize(width, height);\n    this.props.app.render();\n\n    // update camera views\n    Object.values(store.frame.cameraViews).forEach((cameraView, i) => {\n      this.updateCameraBounds(cameraView, i);\n      if (store.fullscreenRequested) {\n        cameraView.fitImageToView();\n      }\n    });\n\n    // delay to set to false to wait fullscreen finish\n    setTimeout(() => {\n      store.fullscreenRequested = false;\n    }, 0);\n  };\n\n  /**\n   * update cameras for current frame\n   */\n  updateCameras() {\n    const { cameras, currentFrame } = store.frame;\n\n    utils.clearTextureCache();\n    this.cancellableLoaders.forEach((loader) => {\n      loader.cancel();\n    });\n    this.cancellableLoaders = [];\n    this.loadedCount = 0;\n\n    Object.keys(cameras).forEach((camera, i) => {\n      const url = cameras[camera][currentFrame] || '';\n      const loader: CancellableLoader = {\n        cancelled: false,\n        cancel() {\n          this.cancelled = true;\n        },\n        load() {\n          return new Promise((resove, reject) => {\n            imageLoader(url, (data) => {\n              if (!this.cancelled) {\n                resove(data);\n              } else {\n                reject();\n              }\n            }, {\n              canvas: true,\n              orientation: true,\n              crossOrigin: 'anonymous',\n            });\n          });\n        }\n      };\n      loader\n        .load()\n        .then((data) => this.onLoaded(camera, i, url, data))\n        .catch(() => {\n          // canceled\n        });\n      this.cancellableLoaders.push(loader);\n    });\n  }\n\n  /**\n   * update camera bounds\n   * @param cameraView\n   * @param index\n   */\n  updateCameraBounds(cameraView: View, index: number) {\n    const x = 0;\n    const y = 0;\n    const { width, height } = this.props.app.screen;\n    cameraView.updatePositionAndSize(x, y, width, height);\n    const cameraDom = document.getElementById(`${CAMERA_VIEW}-${cameraView.id}`);\n    if (cameraDom) {\n      cameraDom.style.left = `${x}px`;\n      cameraDom.style.top = `${y}px`;\n      cameraDom.style.width = `${width}px`;\n      cameraDom.style.height = `${height}px`;\n    }\n  }\n\n  /**\n   * on resource loaded\n   * @param name\n   * @param index\n   * @param url\n   * @param data\n   */\n  onLoaded = (name: string, index: number, url: string, data: Event | HTMLCanvasElement | HTMLImageElement) => {\n    const error = data instanceof Event && data.type === 'error';\n    const cameraView = store.frame.cameraViews[name];\n    if (cameraView) {\n      const { currentCamera, currentFrame, updateImageSize } = store.frame;\n\n      if (currentCamera === name) {\n        this.props.app.stage.addChild(cameraView);\n      } else {\n        this.props.app.stage.removeChild(cameraView);\n      }\n\n      cameraView.imageLoadError = error;\n      this.updateCameraBounds(cameraView, index);\n\n      let texture: Texture;\n      if (!error) {\n        texture = Texture.from(data as HTMLCanvasElement);\n        cameraView.setImage(texture);\n      }\n      updateImageSize(name, currentFrame, error ? -1 : texture!.width, error ? -1 : texture!.height);\n    }\n    this.imageLoadErrors[name] = error\n      ? i18n.translate('COMMON_IMAGE_ERROR', { values: { image: url || i18n.translate('COMMON_EMPTY') } })\n      : '';\n    this.loadedCount += 1;\n    this.checkLoaded();\n  };\n\n  /**\n   * check all cameras loaded in current frame\n   */\n  checkLoaded() {\n    const { cameras, onFrameLoaded } = store.frame;\n    if (this.loadedCount === Object.keys(cameras).length) {\n      onFrameLoaded();\n    }\n  }\n\n  /**\n   * update all cameras bounds\n   */\n  updateAllCameraViewsBounds() {\n    const { cameraViews } = store.frame;\n    Object.values(cameraViews).forEach((cameraView, i) => {\n      this.updateCameraBounds(cameraView, i);\n    });\n  }\n\n  /**\n   * wheel\n   */\n  wheel = (event: React.WheelEvent) => {\n    event.stopPropagation();\n    const { currentCameraView } = store.frame;\n    if (currentCameraView) {\n      const point = this.mapScreenToStagePosition(event.clientX, event.clientY);\n      const localPoint = this.mapStageToLocalPosition(point);\n      currentCameraView.zoom(event.nativeEvent, localPoint);\n    }\n  };\n\n  /**\n   * map screen position to stage position as a PIXI point\n   * @param x screen position x\n   * @param y screen position y\n   */\n  mapScreenToStagePosition(x: number, y: number) {\n    const point = new Point();\n    this.props.app.renderer.plugins.interaction.mapPositionToPoint(point, x, y);\n    return point;\n  }\n\n  /**\n   * map stage position to local posistion as a PIXI point\n   * @param point\n   */\n  mapStageToLocalPosition(point: Point) {\n    return this.props.app.stage.toLocal(point);\n  }\n\n  render() {\n    const { cursor, viewScale, crossLineVisible, activeMeasurementBox } = store.config;\n    const { currentCamera, currentCameraView } = store.frame;\n    return (\n      <>\n        <OperationNavigator\n          onViewReset={() => currentCameraView?.fitImageToView()}\n          setViewScale={(scale) => currentCameraView?.zoomTo(scale)}\n        />\n        <div\n          style={{\n            width: '100%',\n            height: `calc(100% - ${NAVIGATOR_HEIGHT}px)`,\n            position: 'relative',\n            cursor,\n          }}\n        >\n          <div\n            ref={this.container}\n            className=\"canvas-container\"\n            style={{ width: '100%', height: '100%' }}\n            onContextMenu={(e) => e.preventDefault()}\n            onWheel={this.wheel}\n          />\n          <div\n            ref={this.camerasContainer}\n            className=\"cameras-container\"\n          >\n            <div\n              id={`${CAMERA_VIEW}-${currentCamera}`}\n              className=\"camera-view selected single\"\n            >\n              <div\n                id={`${CAMERA_VIEW_LABELS}-${currentCamera}`}\n                className=\"shape-labels-container label-mode\"\n              />\n              <Assistant\n                scale={viewScale}\n                crossline={crossLineVisible}\n                measurementBox={activeMeasurementBox}\n                mousePosition={this.mousePosition}\n              />\n              <div className=\"outer-border\">\n                <div className=\"inner-border\">\n                  {this.imageLoadErrors[currentCamera] && (\n                    <div className=\"error\">\n                      {this.imageLoadErrors[currentCamera]}\n                    </div>\n                  )}\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n      </>\n    );\n  }\n}\n\nexport default observer(CamerasContainer);\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}