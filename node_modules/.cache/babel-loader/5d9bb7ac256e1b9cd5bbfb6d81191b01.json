{"ast":null,"code":"var _jsxFileName = \"/Users/qzheng/Documents/webroot/annotation_tools/src/components/video-tracking2/components/attributes/InstanceItemAttributes.tsx\";\nimport React, { useState, useEffect } from 'react';\nimport { observer } from 'mobx-react';\nimport cx from 'classnames';\nimport AttributeValueItem from './AttributeValueItem';\nimport ShapeIcon from '../sidebar/ShapeIcon';\nimport Formula from '../../../common/latex/Formula';\nimport HighlightHelper from '../../../common/latex/HighlightHelper';\nimport store from '../../store/RootStore';\nimport i18n from '../../locales';\nimport { containsRTLLanguage, getSnapshot } from '../../utils';\nimport './InstanceAttributes.scss';\nconst InstanceItemAttributes = observer(({\n  instanceItem,\n  fieldsMap\n}) => {\n  // FIXME: use current camera cause multiple cameras not supported yet\n  const {\n    currentCamera,\n    currentFrame,\n    isSingleCamera,\n    cameraNames\n  } = store.frame;\n  const cameraData = instanceItem.cameras[currentCamera];\n  const {\n    frames = {}\n  } = cameraData || {};\n  const frameData = frames[currentFrame];\n  const {\n    attributes\n  } = frameData || {};\n  const {\n    shapeType,\n    isOCR,\n    isFormula\n  } = frameData || frames[cameraData === null || cameraData === void 0 ? void 0 : cameraData.getNearestKeyFrame(currentFrame)] || {};\n  const isEmpty = !frameData;\n\n  // ocr snapshot\n  const [snapshot, setSnapshot] = useState('');\n  // get snapshot for ocr\n  useEffect(() => {\n    if (frameData && (frameData.isOCR || frameData.isFormula)) {\n      const getCurrentSnapshot = async () => {\n        try {\n          const url = await getSnapshot(store.frame.frames[currentFrame], frameData.shape);\n          setSnapshot(url);\n        } catch (e) {\n          setSnapshot('');\n        }\n      };\n      getCurrentSnapshot();\n    }\n  }, [frameData === null || frameData === void 0 ? void 0 : frameData.shape]);\n  const attrKeys = Object.keys(attributes || {});\n  const fieldKeys = Object.keys(fieldsMap || {});\n  const legacyKeys = attrKeys.filter(key => !fieldKeys.includes(key));\n  return /*#__PURE__*/React.createElement(\"div\", {\n    className: \"section\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 51,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: cx('section-title', {\n      empty: isEmpty\n    }),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 52,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"section-title__icon\",\n    style: {\n      color: instanceItem.categoryItemRef.displayColor\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 57,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(ShapeIcon, {\n    shapeType: shapeType,\n    isOCR: isOCR,\n    isFormula: isFormula,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 61,\n      columnNumber: 11\n    }\n  })), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"section-title__label\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 63,\n      columnNumber: 9\n    }\n  }, `${instanceItem.itemLabel}${isSingleCamera ? '' : `-C${cameraNames.indexOf(currentCamera) + 1}`}`, isEmpty && i18n.translate('EMPTY_LABEL'))), (frameData === null || frameData === void 0 ? void 0 : frameData.isOCR) && /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"ocr-snapshot\",\n    style: {\n      backgroundImage: `url(${snapshot})`,\n      height: 60,\n      marginBottom: 4\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 70,\n      columnNumber: 11\n    }\n  }), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"value-item\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 78,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"value-item-label\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 79,\n      columnNumber: 13\n    }\n  }, `${i18n.translate('TEXT_LABEL')}:`)), /*#__PURE__*/React.createElement(\"div\", {\n    dir: containsRTLLanguage(frameData.OCRText) ? 'rtl' : 'ltr',\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 81,\n      columnNumber: 11\n    }\n  }, frameData.OCRText)), (frameData === null || frameData === void 0 ? void 0 : frameData.isFormula) && /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"ocr-snapshot\",\n    style: {\n      backgroundImage: `url(${snapshot})`,\n      height: 60,\n      marginBottom: 4\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 88,\n      columnNumber: 11\n    }\n  }), frameData.formulaText && /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(HighlightHelper, {\n    text: frameData.formulaText,\n    style: {\n      backgroundColor: '#252935',\n      borderRadius: 2,\n      fontSize: 12,\n      padding: 4,\n      marginBottom: 4,\n      overflow: 'auto',\n      wordBreak: 'break-word'\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 98,\n      columnNumber: 15\n    }\n  }), /*#__PURE__*/React.createElement(Formula, {\n    className: \"formula-container\",\n    style: {\n      fontSize: 12,\n      marginBottom: 4\n    },\n    text: frameData.formulaText,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 110,\n      columnNumber: 15\n    }\n  }))), [...fieldKeys, ...legacyKeys].map(key => attrKeys.includes(key) && /*#__PURE__*/React.createElement(AttributeValueItem, {\n    key: key,\n    fieldName: key,\n    fieldsMap: fieldsMap,\n    values: attributes,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 123,\n      columnNumber: 9\n    }\n  })));\n});\nexport default InstanceItemAttributes;","map":{"version":3,"names":["React","useState","useEffect","observer","cx","AttributeValueItem","ShapeIcon","Formula","HighlightHelper","store","i18n","containsRTLLanguage","getSnapshot","InstanceItemAttributes","instanceItem","fieldsMap","currentCamera","currentFrame","isSingleCamera","cameraNames","frame","cameraData","cameras","frames","frameData","attributes","shapeType","isOCR","isFormula","getNearestKeyFrame","isEmpty","snapshot","setSnapshot","getCurrentSnapshot","url","shape","e","attrKeys","Object","keys","fieldKeys","legacyKeys","filter","key","includes","createElement","className","__self","__source","fileName","_jsxFileName","lineNumber","columnNumber","empty","style","color","categoryItemRef","displayColor","itemLabel","indexOf","translate","Fragment","backgroundImage","height","marginBottom","dir","OCRText","formulaText","text","backgroundColor","borderRadius","fontSize","padding","overflow","wordBreak","map","fieldName","values"],"sources":["/Users/qzheng/Documents/webroot/annotation_tools/src/components/video-tracking2/components/attributes/InstanceItemAttributes.tsx"],"sourcesContent":["import React, { useState, useEffect, useMemo } from 'react';\nimport { observer } from 'mobx-react';\nimport cx from 'classnames';\nimport AttributeValueItem from './AttributeValueItem';\nimport ShapeIcon from '../sidebar/ShapeIcon';\nimport Formula from '../../../common/latex/Formula';\nimport HighlightHelper from '../../../common/latex/HighlightHelper';\nimport InstanceItem from '../../model/InstanceItem';\nimport store from '../../store/RootStore';\nimport i18n from '../../locales';\nimport { containsRTLLanguage, getSnapshot } from '../../utils';\nimport { FieldConfig } from '../../types';\nimport './InstanceAttributes.scss';\n\ninterface InstanceItemAttributesProps {\n  instanceItem: InstanceItem;\n  fieldsMap: { [fieldName: string]: FieldConfig };\n}\n\nconst InstanceItemAttributes = observer(({ instanceItem, fieldsMap }: InstanceItemAttributesProps) => {\n  // FIXME: use current camera cause multiple cameras not supported yet\n  const { currentCamera, currentFrame, isSingleCamera, cameraNames } = store.frame;\n  const cameraData = instanceItem.cameras[currentCamera];\n  const { frames = {} } = cameraData || {};\n  const frameData = frames[currentFrame];\n  const { attributes } = frameData || {};\n  const { shapeType, isOCR, isFormula } = frameData || frames[cameraData?.getNearestKeyFrame(currentFrame)] || {};\n  const isEmpty = !frameData;\n\n  // ocr snapshot\n  const [snapshot, setSnapshot] = useState('');\n  // get snapshot for ocr\n  useEffect(() => {\n    if (frameData && (frameData.isOCR || frameData.isFormula)) {\n      const getCurrentSnapshot = async () => {\n        try {\n          const url = await getSnapshot(store.frame.frames[currentFrame], frameData.shape);\n          setSnapshot(url);\n        } catch (e) {\n          setSnapshot('');\n        }\n      };\n      getCurrentSnapshot();\n    }\n  }, [frameData?.shape]);\n\n  const attrKeys = Object.keys(attributes || {});\n  const fieldKeys = Object.keys(fieldsMap || {});\n  const legacyKeys = attrKeys.filter((key) => !fieldKeys.includes(key));\n  return (\n    <div className=\"section\">\n      <div\n        className={cx('section-title', {\n          empty: isEmpty,\n        })}\n      >\n        <div\n          className=\"section-title__icon\"\n          style={{ color: instanceItem.categoryItemRef.displayColor }}\n        >\n          <ShapeIcon shapeType={shapeType} isOCR={isOCR} isFormula={isFormula} />\n        </div>\n        <div className=\"section-title__label\">\n          {`${instanceItem.itemLabel}${isSingleCamera ? '' : `-C${cameraNames.indexOf(currentCamera) + 1}`}`}\n          {isEmpty && i18n.translate('EMPTY_LABEL')}\n        </div>\n      </div>\n      {frameData?.isOCR && (\n        <>\n          <div\n            className=\"ocr-snapshot\"\n            style={{\n              backgroundImage: `url(${snapshot})`,\n              height: 60,\n              marginBottom: 4,\n            }}\n          />\n          <div className=\"value-item\">\n            <div className=\"value-item-label\">{`${i18n.translate('TEXT_LABEL')}:`}</div>\n          </div>\n          <div dir={containsRTLLanguage(frameData.OCRText) ? 'rtl' : 'ltr'}>\n            {frameData.OCRText}\n          </div>\n        </>\n      )}\n      {frameData?.isFormula && (\n        <>\n          <div\n            className=\"ocr-snapshot\"\n            style={{\n              backgroundImage: `url(${snapshot})`,\n              height: 60,\n              marginBottom: 4,\n            }}\n          />\n          {frameData.formulaText && (\n            <>\n              <HighlightHelper\n                text={frameData.formulaText}\n                style={{\n                  backgroundColor: '#252935',\n                  borderRadius: 2,\n                  fontSize: 12,\n                  padding: 4,\n                  marginBottom: 4,\n                  overflow: 'auto',\n                  wordBreak: 'break-word',\n                }}\n              />\n              <Formula\n                className=\"formula-container\"\n                style={{\n                  fontSize: 12,\n                  marginBottom: 4,\n                }}\n                text={frameData.formulaText}\n              />\n            </>\n          )}\n        </>\n      )}\n      {[...fieldKeys, ...legacyKeys].map((key) => attrKeys.includes(key) && (\n        <AttributeValueItem key={key} fieldName={key} fieldsMap={fieldsMap} values={attributes} />\n      ))}\n    </div>\n  );\n});\n\nexport default InstanceItemAttributes;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}