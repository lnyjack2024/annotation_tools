{"ast":null,"code":"import { EditorState, Modifier } from 'draft-js';\nimport { CODE_BLOCK_TYPE } from '../constants';\nexport default function backspaceCommandHandler(editorState, setEditorState) {\n  const selection = editorState.getSelection();\n  const start = selection.getStartKey();\n  const end = selection.getEndKey();\n  const startOffset = selection.getStartOffset();\n  const endOffset = selection.getEndOffset();\n  if (start === end && startOffset === endOffset && startOffset === 0) {\n    // anchor is at the beginning of the line\n    const currentContent = editorState.getCurrentContent();\n    const currBlock = currentContent.getBlockForKey(start);\n    if ((currBlock === null || currBlock === void 0 ? void 0 : currBlock.getType()) === CODE_BLOCK_TYPE) {\n      const lastBlock = currentContent.getBlockBefore(currBlock.getKey());\n      if ((lastBlock === null || lastBlock === void 0 ? void 0 : lastBlock.getType()) === CODE_BLOCK_TYPE) {\n        // merge block to last block\n        const lastBlockKey = lastBlock.getKey();\n        const lastBlockLen = lastBlock.getLength();\n        const newContent = Modifier.removeRange(currentContent, selection.merge({\n          anchorKey: lastBlockKey,\n          anchorOffset: lastBlockLen,\n          focusOffset: 0\n        }), 'backward');\n        setEditorState(EditorState.push(editorState, newContent, 'remove-range'));\n        return 'handled';\n      }\n    }\n  }\n  return 'not-handled';\n}","map":{"version":3,"names":["EditorState","Modifier","CODE_BLOCK_TYPE","backspaceCommandHandler","editorState","setEditorState","selection","getSelection","start","getStartKey","end","getEndKey","startOffset","getStartOffset","endOffset","getEndOffset","currentContent","getCurrentContent","currBlock","getBlockForKey","getType","lastBlock","getBlockBefore","getKey","lastBlockKey","lastBlockLen","getLength","newContent","removeRange","merge","anchorKey","anchorOffset","focusOffset","push"],"sources":["/Users/qzheng/Documents/webroot/annotation_tools/src/components/common/llm/input/command-handlers/backspace.ts"],"sourcesContent":["import { DraftHandleValue, EditorState, Modifier } from 'draft-js';\nimport { CODE_BLOCK_TYPE } from '../constants';\n\nexport default function backspaceCommandHandler(\n  editorState: EditorState,\n  setEditorState: React.Dispatch<React.SetStateAction<EditorState>>,\n): DraftHandleValue {\n  const selection = editorState.getSelection();\n  const start = selection.getStartKey();\n  const end = selection.getEndKey();\n  const startOffset = selection.getStartOffset();\n  const endOffset = selection.getEndOffset();\n  if (start === end && startOffset === endOffset && startOffset === 0) {\n    // anchor is at the beginning of the line\n    const currentContent = editorState.getCurrentContent();\n    const currBlock = currentContent.getBlockForKey(start);\n    if (currBlock?.getType() === CODE_BLOCK_TYPE) {\n      const lastBlock = currentContent.getBlockBefore(currBlock.getKey());\n      if (lastBlock?.getType() === CODE_BLOCK_TYPE) {\n        // merge block to last block\n        const lastBlockKey = lastBlock.getKey();\n        const lastBlockLen = lastBlock.getLength();\n        const newContent = Modifier.removeRange(currentContent, selection.merge({\n          anchorKey: lastBlockKey,\n          anchorOffset: lastBlockLen,\n          focusOffset: 0,\n        }), 'backward');\n        setEditorState(EditorState.push(editorState, newContent, 'remove-range'));\n        return 'handled';\n      }\n    }\n  }\n  return 'not-handled';\n}\n"],"mappings":"AAAA,SAA2BA,WAAW,EAAEC,QAAQ,QAAQ,UAAU;AAClE,SAASC,eAAe,QAAQ,cAAc;AAE9C,eAAe,SAASC,uBAAuBA,CAC7CC,WAAwB,EACxBC,cAAiE,EAC/C;EAClB,MAAMC,SAAS,GAAGF,WAAW,CAACG,YAAY,CAAC,CAAC;EAC5C,MAAMC,KAAK,GAAGF,SAAS,CAACG,WAAW,CAAC,CAAC;EACrC,MAAMC,GAAG,GAAGJ,SAAS,CAACK,SAAS,CAAC,CAAC;EACjC,MAAMC,WAAW,GAAGN,SAAS,CAACO,cAAc,CAAC,CAAC;EAC9C,MAAMC,SAAS,GAAGR,SAAS,CAACS,YAAY,CAAC,CAAC;EAC1C,IAAIP,KAAK,KAAKE,GAAG,IAAIE,WAAW,KAAKE,SAAS,IAAIF,WAAW,KAAK,CAAC,EAAE;IACnE;IACA,MAAMI,cAAc,GAAGZ,WAAW,CAACa,iBAAiB,CAAC,CAAC;IACtD,MAAMC,SAAS,GAAGF,cAAc,CAACG,cAAc,CAACX,KAAK,CAAC;IACtD,IAAI,CAAAU,SAAS,aAATA,SAAS,uBAATA,SAAS,CAAEE,OAAO,CAAC,CAAC,MAAKlB,eAAe,EAAE;MAC5C,MAAMmB,SAAS,GAAGL,cAAc,CAACM,cAAc,CAACJ,SAAS,CAACK,MAAM,CAAC,CAAC,CAAC;MACnE,IAAI,CAAAF,SAAS,aAATA,SAAS,uBAATA,SAAS,CAAED,OAAO,CAAC,CAAC,MAAKlB,eAAe,EAAE;QAC5C;QACA,MAAMsB,YAAY,GAAGH,SAAS,CAACE,MAAM,CAAC,CAAC;QACvC,MAAME,YAAY,GAAGJ,SAAS,CAACK,SAAS,CAAC,CAAC;QAC1C,MAAMC,UAAU,GAAG1B,QAAQ,CAAC2B,WAAW,CAACZ,cAAc,EAAEV,SAAS,CAACuB,KAAK,CAAC;UACtEC,SAAS,EAAEN,YAAY;UACvBO,YAAY,EAAEN,YAAY;UAC1BO,WAAW,EAAE;QACf,CAAC,CAAC,EAAE,UAAU,CAAC;QACf3B,cAAc,CAACL,WAAW,CAACiC,IAAI,CAAC7B,WAAW,EAAEuB,UAAU,EAAE,cAAc,CAAC,CAAC;QACzE,OAAO,SAAS;MAClB;IACF;EACF;EACA,OAAO,aAAa;AACtB","ignoreList":[]},"metadata":{},"sourceType":"module"}