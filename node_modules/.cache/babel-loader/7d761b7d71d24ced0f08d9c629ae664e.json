{"ast":null,"code":"import React,{useContext,useMemo}from'react';import EasyForm from'@appen-china/easy-form';import{parseFields}from'src/utils/form';import{Button}from'antd';import{DeleteOutlined,FormOutlined}from'@ant-design/icons';import AttributeValueItem from'../attributes-config/AttributeValueItem';import LocaleContext from'../locales/context';import translate from'../locales';const AttributesItemConfig=_ref=>{let{config,attributes,attributesEditing,attributesEditable,onEdit,onDelete,onChange}=_ref;const locale=useContext(LocaleContext);const fieldsMap=useMemo(()=>parseFields(config),[config]);// fields with initial value\nconst fieldsWithInitialValue=useMemo(()=>((config===null||config===void 0?void 0:config.fields)||[]).map(field=>({...field,...(attributes&&attributes[field.name]!==undefined&&{defaultValue:attributes[field.name]})})),[config,attributes]);const handleValuesChange=(changedValues,values)=>{if(!values||values.length===0){// empty form\nonChange(undefined);}else{onChange(values);}};const renderAttributes=()=>{if(!config){return null;}if(!attributes){return/*#__PURE__*/React.createElement(\"div\",{className:\"values-empty\",onClick:e=>{if(onEdit){e.stopPropagation();onEdit();}}},translate(locale,'CHAT_ATTR_EMPTY'));}const fieldKeys=Object.keys(fieldsMap);const attrKeys=attributes?Object.keys(attributes):[];const legacyKeys=attrKeys.filter(key=>!fieldKeys.includes(key));return/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(\"div\",{className:\"value-content\"},[...fieldKeys,...legacyKeys].map(key=>attrKeys.includes(key)&&/*#__PURE__*/React.createElement(AttributeValueItem,{compact:true,key:key,fieldName:key,fieldsMap:fieldsMap,values:attributes}))),attributesEditable&&/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(Button,{size:\"small\",type:\"link\",icon:/*#__PURE__*/React.createElement(FormOutlined,null),onClick:e=>{if(onEdit){e.stopPropagation();onEdit();}}}),/*#__PURE__*/React.createElement(Button,{size:\"small\",type:\"link\",className:\"delete_btn\",icon:/*#__PURE__*/React.createElement(DeleteOutlined,null),onClick:e=>{if(onDelete){e.stopPropagation();onDelete();}}})));};return/*#__PURE__*/React.createElement(\"div\",{className:\"llm-chat-item-content-attributes\",onClick:e=>{if(attributesEditing){e.stopPropagation();}}},attributesEditing?/*#__PURE__*/React.createElement(EasyForm,{fields:fieldsWithInitialValue,conditions:config===null||config===void 0?void 0:config.conditions,effects:config===null||config===void 0?void 0:config.effects,rules:config===null||config===void 0?void 0:config.rules,onChange:handleValuesChange,onSubmit:()=>{},footerVisible:false}):renderAttributes());};export default AttributesItemConfig;","map":{"version":3,"names":["React","useContext","useMemo","EasyForm","parseFields","Button","DeleteOutlined","FormOutlined","AttributeValueItem","LocaleContext","translate","AttributesItemConfig","_ref","config","attributes","attributesEditing","attributesEditable","onEdit","onDelete","onChange","locale","fieldsMap","fieldsWithInitialValue","fields","map","field","name","undefined","defaultValue","handleValuesChange","changedValues","values","length","renderAttributes","createElement","className","onClick","e","stopPropagation","fieldKeys","Object","keys","attrKeys","legacyKeys","filter","key","includes","Fragment","compact","fieldName","size","type","icon","conditions","effects","rules","onSubmit","footerVisible"],"sources":["/Users/qzheng/Documents/webroot/annotation_tools/src/components/common/llm/chat/AttributesItem.tsx"],"sourcesContent":["import React, { useContext, useMemo } from 'react';\nimport EasyForm from '@appen-china/easy-form';\nimport { FormConfig } from '@appen-china/easy-form/es/types';\nimport { parseFields } from 'src/utils/form';\nimport { Button } from 'antd';\nimport { DeleteOutlined, FormOutlined } from '@ant-design/icons';\nimport AttributeValueItem from '../attributes-config/AttributeValueItem';\nimport LocaleContext from '../locales/context';\nimport translate from '../locales';\n\ninterface AttributesItemConfigProps {\n  config: FormConfig;\n  attributesEditing?: boolean;\n  attributes?: {[key: string]: any};\n  attributesEditable: boolean;\n  onChange: (val: any) => void;\n  onEdit?: () => void;\n  onDelete?: () => void;\n}\n\nconst AttributesItemConfig: React.FC<AttributesItemConfigProps> = ({ config, attributes, attributesEditing, attributesEditable, onEdit, onDelete, onChange }) => {\n  const locale = useContext(LocaleContext);\n  const fieldsMap = useMemo(() => parseFields(config), [config]);\n  // fields with initial value\n  const fieldsWithInitialValue = useMemo(() => (config?.fields || []).map((field) => ({\n    ...field,\n    ...attributes && attributes[field.name] !== undefined && {\n      defaultValue: attributes[field.name],\n    }\n  })), [config, attributes]);\n\n  const handleValuesChange = (changedValues:any, values: any) => {\n    if (!values || values.length === 0) {\n      // empty form\n      onChange(undefined);\n    } else {\n      onChange(values);\n    }\n  };\n\n  const renderAttributes = () => {\n    if (!config) {\n      return null;\n    }\n    if (!attributes) {\n      return (\n        <div\n          className=\"values-empty\"\n          onClick={(e) => {\n            if (onEdit) {\n              e.stopPropagation();\n              onEdit();\n            }\n          }}\n        >\n          {translate(locale, 'CHAT_ATTR_EMPTY')}\n        </div>\n      );\n    }\n    const fieldKeys = Object.keys(fieldsMap);\n    const attrKeys = attributes ? Object.keys(attributes) : [];\n    const legacyKeys = attrKeys.filter((key) => !fieldKeys.includes(key));\n\n    return (\n      <>\n        <div className=\"value-content\">\n          {\n            [...fieldKeys, ...legacyKeys].map((key) => attrKeys.includes(key) && (\n              <AttributeValueItem\n                compact\n                key={key}\n                fieldName={key}\n                fieldsMap={fieldsMap}\n                values={attributes}\n              />\n            ))\n          }\n        </div>\n        {attributesEditable && (\n          <>\n            <Button\n              size=\"small\"\n              type=\"link\"\n              icon={<FormOutlined />}\n              onClick={(e) => {\n                if (onEdit) {\n                  e.stopPropagation();\n                  onEdit();\n                }\n              }}\n            />\n            <Button\n              size=\"small\"\n              type=\"link\"\n              className=\"delete_btn\"\n              icon={<DeleteOutlined />}\n              onClick={(e) => {\n                if (onDelete) {\n                  e.stopPropagation();\n                  onDelete();\n                }\n              }}\n            />\n          </>\n        )}\n      </>\n    );\n  };\n\n  return (\n    <div className=\"llm-chat-item-content-attributes\" onClick={(e) => { if (attributesEditing) { e.stopPropagation(); } }}>\n      {attributesEditing ? (\n        <EasyForm\n          fields={fieldsWithInitialValue}\n          conditions={config?.conditions}\n          effects={config?.effects}\n          rules={config?.rules}\n          onChange={handleValuesChange}\n          onSubmit={() => {}}\n          footerVisible={false}\n        />\n      ) : renderAttributes()}\n    </div>\n  );\n};\nexport default AttributesItemConfig;\n"],"mappings":"AAAA,MAAO,CAAAA,KAAK,EAAIC,UAAU,CAAEC,OAAO,KAAQ,OAAO,CAClD,MAAO,CAAAC,QAAQ,KAAM,wBAAwB,CAE7C,OAASC,WAAW,KAAQ,gBAAgB,CAC5C,OAASC,MAAM,KAAQ,MAAM,CAC7B,OAASC,cAAc,CAAEC,YAAY,KAAQ,mBAAmB,CAChE,MAAO,CAAAC,kBAAkB,KAAM,yCAAyC,CACxE,MAAO,CAAAC,aAAa,KAAM,oBAAoB,CAC9C,MAAO,CAAAC,SAAS,KAAM,YAAY,CAYlC,KAAM,CAAAC,oBAAyD,CAAGC,IAAA,EAA+F,IAA9F,CAAEC,MAAM,CAAEC,UAAU,CAAEC,iBAAiB,CAAEC,kBAAkB,CAAEC,MAAM,CAAEC,QAAQ,CAAEC,QAAS,CAAC,CAAAP,IAAA,CAC1J,KAAM,CAAAQ,MAAM,CAAGnB,UAAU,CAACQ,aAAa,CAAC,CACxC,KAAM,CAAAY,SAAS,CAAGnB,OAAO,CAAC,IAAME,WAAW,CAACS,MAAM,CAAC,CAAE,CAACA,MAAM,CAAC,CAAC,CAC9D;AACA,KAAM,CAAAS,sBAAsB,CAAGpB,OAAO,CAAC,IAAM,CAAC,CAAAW,MAAM,SAANA,MAAM,iBAANA,MAAM,CAAEU,MAAM,GAAI,EAAE,EAAEC,GAAG,CAAEC,KAAK,GAAM,CAClF,GAAGA,KAAK,CACR,IAAGX,UAAU,EAAIA,UAAU,CAACW,KAAK,CAACC,IAAI,CAAC,GAAKC,SAAS,EAAI,CACvDC,YAAY,CAAEd,UAAU,CAACW,KAAK,CAACC,IAAI,CACrC,CAAC,CACH,CAAC,CAAC,CAAC,CAAE,CAACb,MAAM,CAAEC,UAAU,CAAC,CAAC,CAE1B,KAAM,CAAAe,kBAAkB,CAAGA,CAACC,aAAiB,CAAEC,MAAW,GAAK,CAC7D,GAAI,CAACA,MAAM,EAAIA,MAAM,CAACC,MAAM,GAAK,CAAC,CAAE,CAClC;AACAb,QAAQ,CAACQ,SAAS,CAAC,CACrB,CAAC,IAAM,CACLR,QAAQ,CAACY,MAAM,CAAC,CAClB,CACF,CAAC,CAED,KAAM,CAAAE,gBAAgB,CAAGA,CAAA,GAAM,CAC7B,GAAI,CAACpB,MAAM,CAAE,CACX,MAAO,KAAI,CACb,CACA,GAAI,CAACC,UAAU,CAAE,CACf,mBACEd,KAAA,CAAAkC,aAAA,QACEC,SAAS,CAAC,cAAc,CACxBC,OAAO,CAAGC,CAAC,EAAK,CACd,GAAIpB,MAAM,CAAE,CACVoB,CAAC,CAACC,eAAe,CAAC,CAAC,CACnBrB,MAAM,CAAC,CAAC,CACV,CACF,CAAE,EAEDP,SAAS,CAACU,MAAM,CAAE,iBAAiB,CACjC,CAAC,CAEV,CACA,KAAM,CAAAmB,SAAS,CAAGC,MAAM,CAACC,IAAI,CAACpB,SAAS,CAAC,CACxC,KAAM,CAAAqB,QAAQ,CAAG5B,UAAU,CAAG0B,MAAM,CAACC,IAAI,CAAC3B,UAAU,CAAC,CAAG,EAAE,CAC1D,KAAM,CAAA6B,UAAU,CAAGD,QAAQ,CAACE,MAAM,CAAEC,GAAG,EAAK,CAACN,SAAS,CAACO,QAAQ,CAACD,GAAG,CAAC,CAAC,CAErE,mBACE7C,KAAA,CAAAkC,aAAA,CAAAlC,KAAA,CAAA+C,QAAA,mBACE/C,KAAA,CAAAkC,aAAA,QAAKC,SAAS,CAAC,eAAe,EAE1B,CAAC,GAAGI,SAAS,CAAE,GAAGI,UAAU,CAAC,CAACnB,GAAG,CAAEqB,GAAG,EAAKH,QAAQ,CAACI,QAAQ,CAACD,GAAG,CAAC,eAC/D7C,KAAA,CAAAkC,aAAA,CAAC1B,kBAAkB,EACjBwC,OAAO,MACPH,GAAG,CAAEA,GAAI,CACTI,SAAS,CAAEJ,GAAI,CACfxB,SAAS,CAAEA,SAAU,CACrBU,MAAM,CAAEjB,UAAW,CACpB,CACF,CAEA,CAAC,CACLE,kBAAkB,eACjBhB,KAAA,CAAAkC,aAAA,CAAAlC,KAAA,CAAA+C,QAAA,mBACE/C,KAAA,CAAAkC,aAAA,CAAC7B,MAAM,EACL6C,IAAI,CAAC,OAAO,CACZC,IAAI,CAAC,MAAM,CACXC,IAAI,cAAEpD,KAAA,CAAAkC,aAAA,CAAC3B,YAAY,KAAE,CAAE,CACvB6B,OAAO,CAAGC,CAAC,EAAK,CACd,GAAIpB,MAAM,CAAE,CACVoB,CAAC,CAACC,eAAe,CAAC,CAAC,CACnBrB,MAAM,CAAC,CAAC,CACV,CACF,CAAE,CACH,CAAC,cACFjB,KAAA,CAAAkC,aAAA,CAAC7B,MAAM,EACL6C,IAAI,CAAC,OAAO,CACZC,IAAI,CAAC,MAAM,CACXhB,SAAS,CAAC,YAAY,CACtBiB,IAAI,cAAEpD,KAAA,CAAAkC,aAAA,CAAC5B,cAAc,KAAE,CAAE,CACzB8B,OAAO,CAAGC,CAAC,EAAK,CACd,GAAInB,QAAQ,CAAE,CACZmB,CAAC,CAACC,eAAe,CAAC,CAAC,CACnBpB,QAAQ,CAAC,CAAC,CACZ,CACF,CAAE,CACH,CACD,CAEJ,CAAC,CAEP,CAAC,CAED,mBACElB,KAAA,CAAAkC,aAAA,QAAKC,SAAS,CAAC,kCAAkC,CAACC,OAAO,CAAGC,CAAC,EAAK,CAAE,GAAItB,iBAAiB,CAAE,CAAEsB,CAAC,CAACC,eAAe,CAAC,CAAC,CAAE,CAAE,CAAE,EACnHvB,iBAAiB,cAChBf,KAAA,CAAAkC,aAAA,CAAC/B,QAAQ,EACPoB,MAAM,CAAED,sBAAuB,CAC/B+B,UAAU,CAAExC,MAAM,SAANA,MAAM,iBAANA,MAAM,CAAEwC,UAAW,CAC/BC,OAAO,CAAEzC,MAAM,SAANA,MAAM,iBAANA,MAAM,CAAEyC,OAAQ,CACzBC,KAAK,CAAE1C,MAAM,SAANA,MAAM,iBAANA,MAAM,CAAE0C,KAAM,CACrBpC,QAAQ,CAAEU,kBAAmB,CAC7B2B,QAAQ,CAAEA,CAAA,GAAM,CAAC,CAAE,CACnBC,aAAa,CAAE,KAAM,CACtB,CAAC,CACAxB,gBAAgB,CAAC,CAClB,CAAC,CAEV,CAAC,CACD,cAAe,CAAAtB,oBAAoB","ignoreList":[]},"metadata":{},"sourceType":"module"}