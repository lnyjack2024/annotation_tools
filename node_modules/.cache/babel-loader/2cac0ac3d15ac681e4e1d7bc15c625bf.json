{"ast":null,"code":"var _jsxFileName = \"/Users/qzheng/Documents/webroot/annotation_tools/src/components/video-tracking2/components/attributes/InstanceAttributes.tsx\";\nimport React from 'react';\nimport { action, makeObservable, observable } from 'mobx';\nimport { observer } from 'mobx-react';\nimport cx from 'classnames';\nimport InstanceItemAttributes from './InstanceItemAttributes';\nimport { Up, Pencil } from '../../../common/icons';\nimport store from '../../store/RootStore';\nimport i18n from '../../locales';\nimport { parseFields } from '../../utils';\nimport './InstanceAttributes.scss';\nimport AttributeValueItem from './AttributeValueItem';\nclass InstanceAttributes extends React.Component {\n  constructor(props) {\n    super(props);\n    /**\n     * fields map for instance & its items\n     */\n    this.fieldsMap = {};\n    /**\n     * collapsed\n     */\n    this.collapsed = false;\n    this.toggleCollapsed = () => {\n      this.collapsed = !this.collapsed;\n    };\n    makeObservable(this, {\n      fieldsMap: observable,\n      collapsed: observable,\n      updateFieldsMap: action,\n      toggleCollapsed: action\n    });\n    this.updateFieldsMap();\n  }\n  componentDidUpdate(prevProps) {\n    if (prevProps.instance.id !== this.props.instance.id) {\n      this.updateFieldsMap();\n    }\n  }\n  updateFieldsMap() {\n    const {\n      children = [],\n      labelConfigDynamic\n    } = this.props.instance.categoryRef;\n    this.fieldsMap = {\n      dynamicInstance: parseFields(labelConfigDynamic)\n    };\n    // get label config for all items\n    children.forEach(child => {\n      this.fieldsMap[child.name] = parseFields(child.labelConfig);\n    });\n  }\n  render() {\n    const {\n      instance,\n      instanceItem\n    } = this.props;\n    const {\n      label: labelName\n    } = instance;\n    const dynamicAttributes = store.instance.getCurrentDynamicAttributesByInstance(instance);\n    const attrKeysDynamic = Object.keys(dynamicAttributes || {});\n    const fieldKeysDynamic = Object.keys(this.fieldsMap.dynamicInstance);\n    const legacyKeysDynamic = attrKeysDynamic.filter(key => !fieldKeysDynamic.includes(key));\n    return /*#__PURE__*/React.createElement(\"div\", {\n      className: cx('collapse-panel instance-attributes-panel', {\n        collapsed: this.collapsed\n      }),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 76,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"collapse-panel-title space-between\",\n      onClick: this.toggleCollapsed,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 81,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(\"span\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 85,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"collapse-panel-collapse-icon\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 86,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(Up, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 87,\n        columnNumber: 15\n      }\n    })), i18n.translate('INSTANCE_ATTRIBUTES_INSTANCE', {\n      values: {\n        frame: store.frame.currentFrame + 1\n      }\n    })), /*#__PURE__*/React.createElement(\"span\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 93,\n        columnNumber: 11\n      }\n    }, !store.readonly && store.instance.isAttributesEnabled(instance, instanceItem) && /*#__PURE__*/React.createElement(\"div\", {\n      className: \"collapse-panel-icon\",\n      onClick: e => {\n        e.stopPropagation();\n        store.config.setAttributesModalVisible(true);\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 95,\n        columnNumber: 15\n      }\n    }, /*#__PURE__*/React.createElement(Pencil, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 102,\n        columnNumber: 17\n      }\n    })))), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"collapse-panel-content\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 107,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"section\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 108,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"section-title\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 111,\n        columnNumber: 13\n      }\n    }, labelName), [...fieldKeysDynamic, ...legacyKeysDynamic].map(key => attrKeysDynamic.includes(key) && /*#__PURE__*/React.createElement(AttributeValueItem, {\n      key: key,\n      fieldName: key,\n      fieldsMap: this.fieldsMap.dynamicInstance,\n      values: dynamicAttributes,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 116,\n        columnNumber: 15\n      }\n    }))), instanceItem && /*#__PURE__*/React.createElement(InstanceItemAttributes, {\n      instanceItem: instanceItem,\n      fieldsMap: this.fieldsMap[instanceItem.name],\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 126,\n        columnNumber: 13\n      }\n    }), !instanceItem && Object.values(instance.items).filter(i => {\n      const cameras = Object.keys(i.cameras).filter(c => !i.cameras[c].isEmpty);\n      return cameras.includes(store.frame.currentCamera);\n    }).map(item => /*#__PURE__*/React.createElement(InstanceItemAttributes, {\n      key: item.id,\n      instanceItem: item,\n      fieldsMap: this.fieldsMap[item.name],\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 138,\n        columnNumber: 15\n      }\n    }))));\n  }\n}\nexport default observer(InstanceAttributes);","map":{"version":3,"names":["React","action","makeObservable","observable","observer","cx","InstanceItemAttributes","Up","Pencil","store","i18n","parseFields","AttributeValueItem","InstanceAttributes","Component","constructor","props","fieldsMap","collapsed","toggleCollapsed","updateFieldsMap","componentDidUpdate","prevProps","instance","id","children","labelConfigDynamic","categoryRef","dynamicInstance","forEach","child","name","labelConfig","render","instanceItem","label","labelName","dynamicAttributes","getCurrentDynamicAttributesByInstance","attrKeysDynamic","Object","keys","fieldKeysDynamic","legacyKeysDynamic","filter","key","includes","createElement","className","__self","__source","fileName","_jsxFileName","lineNumber","columnNumber","onClick","translate","values","frame","currentFrame","readonly","isAttributesEnabled","e","stopPropagation","config","setAttributesModalVisible","map","fieldName","items","i","cameras","c","isEmpty","currentCamera","item"],"sources":["/Users/qzheng/Documents/webroot/annotation_tools/src/components/video-tracking2/components/attributes/InstanceAttributes.tsx"],"sourcesContent":["import React from 'react';\nimport { action, makeObservable, observable } from 'mobx';\nimport { observer } from 'mobx-react';\nimport cx from 'classnames';\nimport InstanceItemAttributes from './InstanceItemAttributes';\nimport { Up, Pencil } from '../../../common/icons';\nimport store from '../../store/RootStore';\nimport i18n from '../../locales';\nimport { parseFields } from '../../utils';\nimport { FieldConfig } from '../../types';\nimport Instance from '../../model/Instance';\nimport InstanceItem from '../../model/InstanceItem';\nimport './InstanceAttributes.scss';\nimport AttributeValueItem from './AttributeValueItem';\n\ninterface InstanceAttributesProps {\n  instance: Instance;\n  instanceItem?: InstanceItem;\n}\n\nclass InstanceAttributes extends React.Component<InstanceAttributesProps> {\n  /**\n   * fields map for instance & its items\n   */\n  fieldsMap: {\n    [type: string]: { [fieldName: string]: FieldConfig }\n  } = {};\n\n  /**\n   * collapsed\n   */\n  collapsed = false;\n\n  constructor(props: InstanceAttributesProps) {\n    super(props);\n\n    makeObservable(this, {\n      fieldsMap: observable,\n      collapsed: observable,\n      updateFieldsMap: action,\n      toggleCollapsed: action,\n    });\n\n    this.updateFieldsMap();\n  }\n\n  componentDidUpdate(prevProps: InstanceAttributesProps) {\n    if (prevProps.instance.id !== this.props.instance.id) {\n      this.updateFieldsMap();\n    }\n  }\n\n  updateFieldsMap() {\n    const { children = [], labelConfigDynamic } = this.props.instance.categoryRef;\n    this.fieldsMap = {\n      dynamicInstance: parseFields(labelConfigDynamic)\n    };\n    // get label config for all items\n    children.forEach((child) => {\n      this.fieldsMap[child.name] = parseFields(child.labelConfig);\n    });\n  }\n\n  toggleCollapsed = () => {\n    this.collapsed = !this.collapsed;\n  };\n\n  render() {\n    const { instance, instanceItem } = this.props;\n    const { label: labelName } = instance;\n    const dynamicAttributes = store.instance.getCurrentDynamicAttributesByInstance(instance);\n    const attrKeysDynamic = Object.keys(dynamicAttributes || {});\n    const fieldKeysDynamic = Object.keys(this.fieldsMap.dynamicInstance);\n    const legacyKeysDynamic = attrKeysDynamic.filter((key) => !fieldKeysDynamic.includes(key));\n    return (\n      <div\n        className={cx('collapse-panel instance-attributes-panel', {\n          collapsed: this.collapsed,\n        })}\n      >\n        <div\n          className=\"collapse-panel-title space-between\"\n          onClick={this.toggleCollapsed}\n        >\n          <span>\n            <div className=\"collapse-panel-collapse-icon\">\n              <Up />\n            </div>\n            {i18n.translate('INSTANCE_ATTRIBUTES_INSTANCE', {\n              values: { frame: store.frame.currentFrame + 1 },\n            })}\n          </span>\n          <span>\n            {!store.readonly && store.instance.isAttributesEnabled(instance, instanceItem) && (\n              <div\n                className=\"collapse-panel-icon\"\n                onClick={(e) => {\n                  e.stopPropagation();\n                  store.config.setAttributesModalVisible(true);\n                }}\n              >\n                <Pencil />\n              </div>\n            )}\n          </span>\n        </div>\n        <div className=\"collapse-panel-content\">\n          <div\n            className=\"section\"\n          >\n            <div className=\"section-title\">\n              {labelName}\n            </div>\n            {\n              [...fieldKeysDynamic, ...legacyKeysDynamic].map((key) => attrKeysDynamic.includes(key) && (\n              <AttributeValueItem\n                key={key}\n                fieldName={key}\n                fieldsMap={this.fieldsMap.dynamicInstance}\n                values={dynamicAttributes}\n              />\n              ))\n            }\n          </div>\n          {instanceItem && (\n            <InstanceItemAttributes\n              instanceItem={instanceItem}\n              fieldsMap={this.fieldsMap[instanceItem.name]}\n            />\n          )}\n          {!instanceItem &&\n          Object.values(instance.items)\n            .filter((i) => {\n              const cameras = Object.keys(i.cameras).filter((c) => !i.cameras[c].isEmpty);\n              return cameras.includes(store.frame.currentCamera);\n            })\n            .map((item) => (\n              <InstanceItemAttributes\n                key={item.id}\n                instanceItem={item}\n                fieldsMap={this.fieldsMap[item.name]}\n              />\n            ))}\n        </div>\n      </div>\n    );\n  }\n}\n\nexport default observer(InstanceAttributes);\n"],"mappings":";AAAA,OAAOA,KAAK,MAAM,OAAO;AACzB,SAASC,MAAM,EAAEC,cAAc,EAAEC,UAAU,QAAQ,MAAM;AACzD,SAASC,QAAQ,QAAQ,YAAY;AACrC,OAAOC,EAAE,MAAM,YAAY;AAC3B,OAAOC,sBAAsB,MAAM,0BAA0B;AAC7D,SAASC,EAAE,EAAEC,MAAM,QAAQ,uBAAuB;AAClD,OAAOC,KAAK,MAAM,uBAAuB;AACzC,OAAOC,IAAI,MAAM,eAAe;AAChC,SAASC,WAAW,QAAQ,aAAa;AAIzC,OAAO,2BAA2B;AAClC,OAAOC,kBAAkB,MAAM,sBAAsB;AAOrD,MAAMC,kBAAkB,SAASb,KAAK,CAACc,SAAS,CAA0B;EAaxEC,WAAWA,CAACC,KAA8B,EAAE;IAC1C,KAAK,CAACA,KAAK,CAAC;IAbd;AACF;AACA;IAFE,KAGAC,SAAS,GAEL,CAAC,CAAC;IAEN;AACF;AACA;IAFE,KAGAC,SAAS,GAAG,KAAK;IAAA,KAgCjBC,eAAe,GAAG,MAAM;MACtB,IAAI,CAACD,SAAS,GAAG,CAAC,IAAI,CAACA,SAAS;IAClC,CAAC;IA7BChB,cAAc,CAAC,IAAI,EAAE;MACnBe,SAAS,EAAEd,UAAU;MACrBe,SAAS,EAAEf,UAAU;MACrBiB,eAAe,EAAEnB,MAAM;MACvBkB,eAAe,EAAElB;IACnB,CAAC,CAAC;IAEF,IAAI,CAACmB,eAAe,CAAC,CAAC;EACxB;EAEAC,kBAAkBA,CAACC,SAAkC,EAAE;IACrD,IAAIA,SAAS,CAACC,QAAQ,CAACC,EAAE,KAAK,IAAI,CAACR,KAAK,CAACO,QAAQ,CAACC,EAAE,EAAE;MACpD,IAAI,CAACJ,eAAe,CAAC,CAAC;IACxB;EACF;EAEAA,eAAeA,CAAA,EAAG;IAChB,MAAM;MAAEK,QAAQ,GAAG,EAAE;MAAEC;IAAmB,CAAC,GAAG,IAAI,CAACV,KAAK,CAACO,QAAQ,CAACI,WAAW;IAC7E,IAAI,CAACV,SAAS,GAAG;MACfW,eAAe,EAAEjB,WAAW,CAACe,kBAAkB;IACjD,CAAC;IACD;IACAD,QAAQ,CAACI,OAAO,CAAEC,KAAK,IAAK;MAC1B,IAAI,CAACb,SAAS,CAACa,KAAK,CAACC,IAAI,CAAC,GAAGpB,WAAW,CAACmB,KAAK,CAACE,WAAW,CAAC;IAC7D,CAAC,CAAC;EACJ;EAMAC,MAAMA,CAAA,EAAG;IACP,MAAM;MAAEV,QAAQ;MAAEW;IAAa,CAAC,GAAG,IAAI,CAAClB,KAAK;IAC7C,MAAM;MAAEmB,KAAK,EAAEC;IAAU,CAAC,GAAGb,QAAQ;IACrC,MAAMc,iBAAiB,GAAG5B,KAAK,CAACc,QAAQ,CAACe,qCAAqC,CAACf,QAAQ,CAAC;IACxF,MAAMgB,eAAe,GAAGC,MAAM,CAACC,IAAI,CAACJ,iBAAiB,IAAI,CAAC,CAAC,CAAC;IAC5D,MAAMK,gBAAgB,GAAGF,MAAM,CAACC,IAAI,CAAC,IAAI,CAACxB,SAAS,CAACW,eAAe,CAAC;IACpE,MAAMe,iBAAiB,GAAGJ,eAAe,CAACK,MAAM,CAAEC,GAAG,IAAK,CAACH,gBAAgB,CAACI,QAAQ,CAACD,GAAG,CAAC,CAAC;IAC1F,oBACE7C,KAAA,CAAA+C,aAAA;MACEC,SAAS,EAAE3C,EAAE,CAAC,0CAA0C,EAAE;QACxDa,SAAS,EAAE,IAAI,CAACA;MAClB,CAAC,CAAE;MAAA+B,MAAA;MAAAC,QAAA;QAAAC,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA;IAAA,gBAEHtD,KAAA,CAAA+C,aAAA;MACEC,SAAS,EAAC,oCAAoC;MAC9CO,OAAO,EAAE,IAAI,CAACpC,eAAgB;MAAA8B,MAAA;MAAAC,QAAA;QAAAC,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA;IAAA,gBAE9BtD,KAAA,CAAA+C,aAAA;MAAAE,MAAA;MAAAC,QAAA;QAAAC,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA;IAAA,gBACEtD,KAAA,CAAA+C,aAAA;MAAKC,SAAS,EAAC,8BAA8B;MAAAC,MAAA;MAAAC,QAAA;QAAAC,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA;IAAA,gBAC3CtD,KAAA,CAAA+C,aAAA,CAACxC,EAAE;MAAA0C,MAAA;MAAAC,QAAA;QAAAC,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA;IAAA,CAAE,CACF,CAAC,EACL5C,IAAI,CAAC8C,SAAS,CAAC,8BAA8B,EAAE;MAC9CC,MAAM,EAAE;QAAEC,KAAK,EAAEjD,KAAK,CAACiD,KAAK,CAACC,YAAY,GAAG;MAAE;IAChD,CAAC,CACG,CAAC,eACP3D,KAAA,CAAA+C,aAAA;MAAAE,MAAA;MAAAC,QAAA;QAAAC,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA;IAAA,GACG,CAAC7C,KAAK,CAACmD,QAAQ,IAAInD,KAAK,CAACc,QAAQ,CAACsC,mBAAmB,CAACtC,QAAQ,EAAEW,YAAY,CAAC,iBAC5ElC,KAAA,CAAA+C,aAAA;MACEC,SAAS,EAAC,qBAAqB;MAC/BO,OAAO,EAAGO,CAAC,IAAK;QACdA,CAAC,CAACC,eAAe,CAAC,CAAC;QACnBtD,KAAK,CAACuD,MAAM,CAACC,yBAAyB,CAAC,IAAI,CAAC;MAC9C,CAAE;MAAAhB,MAAA;MAAAC,QAAA;QAAAC,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA;IAAA,gBAEFtD,KAAA,CAAA+C,aAAA,CAACvC,MAAM;MAAAyC,MAAA;MAAAC,QAAA;QAAAC,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA;IAAA,CAAE,CACN,CAEH,CACH,CAAC,eACNtD,KAAA,CAAA+C,aAAA;MAAKC,SAAS,EAAC,wBAAwB;MAAAC,MAAA;MAAAC,QAAA;QAAAC,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA;IAAA,gBACrCtD,KAAA,CAAA+C,aAAA;MACEC,SAAS,EAAC,SAAS;MAAAC,MAAA;MAAAC,QAAA;QAAAC,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA;IAAA,gBAEnBtD,KAAA,CAAA+C,aAAA;MAAKC,SAAS,EAAC,eAAe;MAAAC,MAAA;MAAAC,QAAA;QAAAC,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA;IAAA,GAC3BlB,SACE,CAAC,EAEJ,CAAC,GAAGM,gBAAgB,EAAE,GAAGC,iBAAiB,CAAC,CAACuB,GAAG,CAAErB,GAAG,IAAKN,eAAe,CAACO,QAAQ,CAACD,GAAG,CAAC,iBACtF7C,KAAA,CAAA+C,aAAA,CAACnC,kBAAkB;MACjBiC,GAAG,EAAEA,GAAI;MACTsB,SAAS,EAAEtB,GAAI;MACf5B,SAAS,EAAE,IAAI,CAACA,SAAS,CAACW,eAAgB;MAC1C6B,MAAM,EAAEpB,iBAAkB;MAAAY,MAAA;MAAAC,QAAA;QAAAC,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA;IAAA,CAC3B,CACA,CAEA,CAAC,EACLpB,YAAY,iBACXlC,KAAA,CAAA+C,aAAA,CAACzC,sBAAsB;MACrB4B,YAAY,EAAEA,YAAa;MAC3BjB,SAAS,EAAE,IAAI,CAACA,SAAS,CAACiB,YAAY,CAACH,IAAI,CAAE;MAAAkB,MAAA;MAAAC,QAAA;QAAAC,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA;IAAA,CAC9C,CACF,EACA,CAACpB,YAAY,IACdM,MAAM,CAACiB,MAAM,CAAClC,QAAQ,CAAC6C,KAAK,CAAC,CAC1BxB,MAAM,CAAEyB,CAAC,IAAK;MACb,MAAMC,OAAO,GAAG9B,MAAM,CAACC,IAAI,CAAC4B,CAAC,CAACC,OAAO,CAAC,CAAC1B,MAAM,CAAE2B,CAAC,IAAK,CAACF,CAAC,CAACC,OAAO,CAACC,CAAC,CAAC,CAACC,OAAO,CAAC;MAC3E,OAAOF,OAAO,CAACxB,QAAQ,CAACrC,KAAK,CAACiD,KAAK,CAACe,aAAa,CAAC;IACpD,CAAC,CAAC,CACDP,GAAG,CAAEQ,IAAI,iBACR1E,KAAA,CAAA+C,aAAA,CAACzC,sBAAsB;MACrBuC,GAAG,EAAE6B,IAAI,CAAClD,EAAG;MACbU,YAAY,EAAEwC,IAAK;MACnBzD,SAAS,EAAE,IAAI,CAACA,SAAS,CAACyD,IAAI,CAAC3C,IAAI,CAAE;MAAAkB,MAAA;MAAAC,QAAA;QAAAC,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA;IAAA,CACtC,CACF,CACA,CACF,CAAC;EAEV;AACF;AAEA,eAAelD,QAAQ,CAACS,kBAAkB,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module"}