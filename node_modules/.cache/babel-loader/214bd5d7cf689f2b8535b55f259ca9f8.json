{"ast":null,"code":"import React,{useEffect,useRef,useState}from'react';import cx from'classnames';import'./ShapeMenu.scss';const ShapeMenu=_ref=>{let{position,items,onClose}=_ref;const menuRef=useRef(null);const[pos,setPos]=useState(position);useEffect(()=>{const listener=e=>{var _menuRef$current;if(!((_menuRef$current=menuRef.current)===null||_menuRef$current===void 0?void 0:_menuRef$current.contains(e.target))){onClose();}};window.addEventListener('mousedown',listener);return()=>{window.removeEventListener('mousedown',listener);};},[]);useEffect(()=>{if(menuRef.current){const{top,height,left,width}=menuRef.current.getBoundingClientRect();let{x,y}=position;if(left+width>window.innerWidth){x=window.innerWidth-width;}if(top+height>window.innerHeight){y=window.innerHeight-height;}setPos({x,y});}else{setPos(position);}},[position]);return/*#__PURE__*/React.createElement(\"div\",{ref:menuRef,className:\"shape-menu\",style:{top:pos.y,left:pos.x},onContextMenu:e=>e.preventDefault()},items.map((sectionItems,index)=>{var _sectionItems$;return/*#__PURE__*/React.createElement(\"div\",{key:(_sectionItems$=sectionItems[0])===null||_sectionItems$===void 0?void 0:_sectionItems$.label},index!==0&&/*#__PURE__*/React.createElement(\"div\",{className:\"divider\"}),sectionItems.map(item=>/*#__PURE__*/React.createElement(\"div\",{key:item.label,className:cx('shape-menu-item',{disabled:item.disabled}),onClick:()=>{if(!item.disabled){item.onClick();onClose();}}},item.label)));}));};export default ShapeMenu;","map":{"version":3,"names":["React","useEffect","useRef","useState","cx","ShapeMenu","_ref","position","items","onClose","menuRef","pos","setPos","listener","e","_menuRef$current","current","contains","target","window","addEventListener","removeEventListener","top","height","left","width","getBoundingClientRect","x","y","innerWidth","innerHeight","createElement","ref","className","style","onContextMenu","preventDefault","map","sectionItems","index","_sectionItems$","key","label","item","disabled","onClick"],"sources":["/Users/qzheng/Documents/webroot/annotation_tools/src/components/common/sidebar/ShapeMenu.tsx"],"sourcesContent":["import React, { useEffect, useRef, useState } from 'react';\nimport cx from 'classnames';\nimport './ShapeMenu.scss';\n\ninterface ShapeMenuProps {\n  position: { x: number; y: number };\n  items: {\n    label: string;\n    disabled?: boolean;\n    onClick: () => void;\n  }[][];\n  onClose: () => void;\n}\n\nconst ShapeMenu = ({ position, items, onClose }: ShapeMenuProps) => {\n  const menuRef = useRef<HTMLDivElement>(null);\n  const [pos, setPos] = useState(position);\n\n  useEffect(() => {\n    const listener = (e: MouseEvent) => {\n      if (!menuRef.current?.contains(e.target as Node)) {\n        onClose();\n      }\n    };\n    window.addEventListener('mousedown', listener);\n    return () => {\n      window.removeEventListener('mousedown', listener);\n    };\n  }, []);\n\n  useEffect(() => {\n    if (menuRef.current) {\n      const { top, height, left, width } = menuRef.current.getBoundingClientRect();\n      let { x, y } = position;\n      if (left + width > window.innerWidth) {\n        x = window.innerWidth - width;\n      }\n      if (top + height > window.innerHeight) {\n        y = window.innerHeight - height;\n      }\n      setPos({ x, y });\n    } else {\n      setPos(position);\n    }\n  }, [position]);\n\n  return (\n    <div\n      ref={menuRef}\n      className=\"shape-menu\"\n      style={{ top: pos.y, left: pos.x }}\n      onContextMenu={(e) => e.preventDefault()}\n    >\n      {items.map((sectionItems, index) => (\n        <div key={sectionItems[0]?.label}>\n          {index !== 0 && <div className=\"divider\" />}\n          {sectionItems.map((item) => (\n            <div\n              key={item.label}\n              className={cx('shape-menu-item', {\n                disabled: item.disabled,\n              })}\n              onClick={() => {\n                if (!item.disabled) {\n                  item.onClick();\n                  onClose();\n                }\n              }}\n            >\n              {item.label}\n            </div>\n          ))}\n        </div>\n      ))}\n    </div>\n  );\n};\n\nexport default ShapeMenu;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}