{"ast":null,"code":"import{makeAutoObservable,runInAction,toJS}from'mobx';import{v4 as uuidv4}from'uuid';import{Modal,message}from'antd';import{cloneDeep,findLastIndex}from'lodash';import{validate as validateForm}from'@appen-china/easy-form/es/utils';import{Base64}from'js-base64';import i18n from'./locales';import MDialogueItem from'./models/DialogueItem';import ValidationStore from'./validationStore';import{ReviewMode}from'./types';import{ChatItemType}from'../common/llm/chat/ChatItem';import{InputType}from'../common/llm/input/InputWrapper';import{contentToPlainText,isContentEmpty,parseContent}from'../common/llm/helper';import{LLMModel,RankingType}from'../common/llm/types';import{ToolMode,isAnnotationReadonly,isPreview,isReviewEditable,isRework,isTemplatePreview}from'../../utils/tool-mode';class Store{get hasError(){return this._hasError||this.hasRankError||this.hasItemAttrError;}set hasError(val){this._hasError=val;if(!val){this.hasRankError=val;this.hasItemAttrError=val;}}/**\n   * item rank has error\n   */ /**\n   * next dialogue item type\n   */get nextDialogueItemType(){if(this.dialogue.length===0){return ChatItemType.Q;}const last=this.dialogue[this.dialogue.length-1];return last.type===ChatItemType.A?ChatItemType.Q:ChatItemType.A;}/**\n   * can add dialogue item\n   */get canAddDialogueItem(){if(this.readonly||!this.addible){return false;}return true;}/**\n   * current editor types\n   */get currentEditorTypes(){var _this$selectedDialogu;const type=this.isAdding?this.nextDialogueItemType:(_this$selectedDialogu=this.selectedDialogueItem)===null||_this$selectedDialogu===void 0?void 0:_this$selectedDialogu.type;return type===ChatItemType.A?this.editorTypes.A:this.editorTypes.Q;}/**\n   * is tool readonly (annotate not allowed)\n   */get readonly(){return isAnnotationReadonly(this.jobProxy.toolMode)||this.reviewMode===ReviewMode.REVIEW;}/**\n   * is tool annotate allowed\n   */get annotatable(){return!isAnnotationReadonly(this.jobProxy.toolMode);}/**\n   * is tool review enabled\n   */get reviewable(){return isReviewEditable(this.jobProxy.toolMode);}/**\n   * is tool in labeling mode or template preview mode\n   */get isLabeling(){return this.jobProxy.toolMode===ToolMode.LABELING||this.isTemplatePreview;}/**\n   * is tool in rework mode\n   */get isRework(){return isRework(this.jobProxy.toolMode);}/**\n   * is tool in preview mode\n   */get isPreview(){return isPreview(this.jobProxy.toolMode);}/**\n   * is tool in template preview mode\n   */get isTemplatePreview(){return isTemplatePreview(this.jobProxy.toolMode);}isOriginalDialogue(val){let forceToolModeCheck=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;if(forceToolModeCheck&&this.isLabeling){return true;}return typeof val==='boolean'?val:this.isLabeling;}constructor(){/**\n   * job proxy\n   */this.jobProxy=void 0;/**\n   * is tool initialized\n   */this.initialized=false;/**\n   * labeling or review mode\n   */this.reviewMode=ReviewMode.LABELING;/**\n   * instruction\n   */this.instruction=[];/**\n   * dialogue\n   */this.dialogue=[];/**\n   * subject\n   */this.subject=void 0;/**\n   * [config] global rank\n   */this.attributes=void 0;/**\n   * [config] global rank config\n   */this.attributesConfig='';/**\n   * [config] item attributes  config\n   */this.itemAttributesConfig=void 0;/**\n   * current selected dialogue item\n   */this.selectedDialogueItem=void 0;/**\n   * is editing\n   */this.isEditing=false;/**\n   * is adding\n   */this.isAdding=false;/**\n   * is ranking\n   */this.isRanking=false;/**\n   * is attributes editing\n   */this.isItemAttributesEditing=false;/**\n   * has error\n   */this._hasError=false;this.hasRankError=false;/**\n   * item attributes has error\n   */this.hasItemAttrError=false;/**\n   * [config] options for subject selection\n   */this.subjectOptions=[];/**\n   * [config] dialogue rank\n   */this.ranking=false;/**\n   * [config] ranking type (score / mark)\n   */this.rankingType=RankingType.SCORE;/**\n   * [config] options for ranking\n   */this.rankingOptions=[];/**\n   * [config] dialogue editable (only control original answers)\n   */this.editable=false;/**\n   * [config] can add new dialogue\n   */this.addible=false;/**\n   * [config] model used when add dialogue item\n   */this.addModel=LLMModel.NONUSE;/**\n   * validation\n   */this.validation=void 0;/**\n * validation config\n */this.validationConfig={script:false};/**\n   * submit check\n   */this.submitCheck=false;/**\n   * editor types\n   */this.editorTypes={Q:[InputType.DEFAULT],A:[InputType.DEFAULT]};this.validateResult=()=>{// 1) check dialogue item value\n// 2) check dialogue item rank\n// 3) check dialogue item attributes\n// 4) check dialogue limit\nlet newlyAddedRoundsCount=0;this.dialogue.forEach(dialogueItem=>{if(!dialogueItem.original){if(isContentEmpty(dialogueItem.value)){this.selectedDialogueItem=dialogueItem;this.isEditing=true;this.hasError=true;throw new Error(i18n.translate('CHAT_ITEM_EMPTY_ERROR'));}if(dialogueItem.type===ChatItemType.A){newlyAddedRoundsCount+=1;}}if(dialogueItem.type===ChatItemType.A){if(this.ranking&&this.rankingType===RankingType.SCORE&&this.rankingOptions.some(o=>{var _dialogueItem$rank,_dialogueItem$rank$sc;return((_dialogueItem$rank=dialogueItem.rank)===null||_dialogueItem$rank===void 0?void 0:(_dialogueItem$rank$sc=_dialogueItem$rank.scores)===null||_dialogueItem$rank$sc===void 0?void 0:_dialogueItem$rank$sc[o])===undefined;})){this.selectedDialogueItem=dialogueItem;this.isRanking=true;this.hasRankError=true;throw new Error(i18n.translate('CHAT_ITEM_RANK_EMPTY_ERROR'));}if(this.itemAttributesConfig){const{attributes}=dialogueItem;if(attributes){const validateRes=validateForm(this.itemAttributesConfig,attributes);if(!validateRes){this.selectedDialogueItem=dialogueItem;this.isItemAttributesEditing=true;this.hasItemAttrError=true;throw new Error(i18n.translate('CHAT_ITEM_ATTR_EMPTY_ERROR'));}}}}});};this.setSubject=subject=>{this.subject=subject;};this.setAttributesConfig=attributes=>{this.attributes=attributes;};this.validate=()=>{var _this$selectedDialogu2;if(this.isAdding){this.catchSaveError();throw new Error('should finish adding');}if(((_this$selectedDialogu2=this.selectedDialogueItem)===null||_this$selectedDialogu2===void 0?void 0:_this$selectedDialogu2.type)===ChatItemType.A){if(this.isRanking&&this.rankingType===RankingType.SCORE&&this.rankingOptions.some(o=>{var _this$selectedDialogu3,_this$selectedDialogu4,_this$selectedDialogu5;return((_this$selectedDialogu3=this.selectedDialogueItem)===null||_this$selectedDialogu3===void 0?void 0:(_this$selectedDialogu4=_this$selectedDialogu3.rank)===null||_this$selectedDialogu4===void 0?void 0:(_this$selectedDialogu5=_this$selectedDialogu4.scores)===null||_this$selectedDialogu5===void 0?void 0:_this$selectedDialogu5[o])===undefined;})){this.catchRankError();throw new Error('should finish ranking');}if(this.isItemAttributesEditing&&this.itemAttributesConfig){const{attributes}=this.selectedDialogueItem;if(attributes){const validateRes=validateForm(this.itemAttributesConfig,attributes);if(!validateRes){this.catchItemAttributesError();throw new Error('should finish the item attributes form');}}}}};this.validateItem=()=>{try{this.validate();this.hasError=false;this.isRanking=false;this.isItemAttributesEditing=false;}catch(e){// validate failed\n}};this.selectDialogueItem=dialogueItem=>{var _this$selectedDialogu6;if(((_this$selectedDialogu6=this.selectedDialogueItem)===null||_this$selectedDialogu6===void 0?void 0:_this$selectedDialogu6.id)===dialogueItem.id){return;}try{this.validate();this.hasError=false;this.selectedDialogueItem=dialogueItem;this.isEditing=false;this.isRanking=false;this.isItemAttributesEditing=false;}catch(e){// validate failed\n}};this.addDialogueItem=()=>{if(this.readonly||!this.canAddDialogueItem){return;}try{this.validate();this.hasError=false;this.selectedDialogueItem=undefined;this.isEditing=false;this.isRanking=false;this.isItemAttributesEditing=false;this.isAdding=true;}catch(e){// validate failed\n}};this.getDialogueItemContent=()=>{const currentDialogue=[...this.dialogue];const lastQuestionItem=currentDialogue.reverse().find(item=>item.type===ChatItemType.Q);if(lastQuestionItem){const content=contentToPlainText(lastQuestionItem.value);return[{role:'user',content}];}return null;};this.editDialogueItem=dialogueItem=>{var _this$selectedDialogu7;if(this.readonly||dialogueItem.original&&!this.editable){return;}if(((_this$selectedDialogu7=this.selectedDialogueItem)===null||_this$selectedDialogu7===void 0?void 0:_this$selectedDialogu7.id)===dialogueItem.id){this.isEditing=true;return;}try{this.validate();this.hasError=false;this.selectedDialogueItem=dialogueItem;this.isRanking=false;this.isItemAttributesEditing=false;this.isEditing=true;}catch(e){// validate failed\n}};this.saveDialogueItem=value=>{if(this.readonly){return;}if(this.isAdding){// add new dialogue item\nconst newItem=new MDialogueItem({id:uuidv4(),type:this.nextDialogueItemType,original:false,value});this.dialogue.push(newItem);this.selectedDialogueItem=newItem;if(!this.readonly&&this.ranking&&newItem.type===ChatItemType.A){this.isRanking=true;}}else if(this.isEditing&&this.selectedDialogueItem){// update dialogue item\nthis.selectedDialogueItem.value=value;}this.cancelSaveDialogueItem();};this.updateDialogueItem=(dialogueItem,value)=>{if(this.readonly||this.isAdding||this.isEditing){return;}dialogueItem.value=value;};this.cancelSaveDialogueItem=()=>{this.isEditing=false;this.isAdding=false;};this.catchSaveError=msg=>{this.hasError=true;message.error(msg||i18n.translate('CHAT_ITEM_EMPTY_ERROR'));};this.rankDialogueItem=dialogueItem=>{if(this.readonly||!this.ranking||dialogueItem.type===ChatItemType.Q){return;}try{var _this$selectedDialogu8;this.validate();this.hasError=false;if(((_this$selectedDialogu8=this.selectedDialogueItem)===null||_this$selectedDialogu8===void 0?void 0:_this$selectedDialogu8.id)!==dialogueItem.id){this.isItemAttributesEditing=false;}this.selectedDialogueItem=dialogueItem;this.isEditing=false;this.isRanking=true;}catch(e){// validate failed\n}};this.saveRank=(dialogueItem,rank)=>{var _this$selectedDialogu9;if(this.readonly){return;}if(((_this$selectedDialogu9=this.selectedDialogueItem)===null||_this$selectedDialogu9===void 0?void 0:_this$selectedDialogu9.id)!==dialogueItem.id){try{this.validate();this.hasError=false;this.isItemAttributesEditing=false;}catch(e){// validate failed\nreturn;}}this.isRanking=true;this.selectedDialogueItem=dialogueItem;this.selectedDialogueItem.rank=rank;};this.onItemAttributesEdit=dialogueItem=>{var _this$selectedDialogu10;if(this.readonly||!this.itemAttributesConfig||dialogueItem.type===ChatItemType.Q){return;}try{this.validate();this.hasError=false;}catch(e){// validate failed\nreturn;}if(((_this$selectedDialogu10=this.selectedDialogueItem)===null||_this$selectedDialogu10===void 0?void 0:_this$selectedDialogu10.id)!==dialogueItem.id){this.isRanking=false;}this.selectedDialogueItem=dialogueItem;this.isEditing=false;this.isItemAttributesEditing=true;};this.setItemAttributes=(dialogueItem,attributes)=>{var _this$selectedDialogu11;if(this.readonly){return;}if(((_this$selectedDialogu11=this.selectedDialogueItem)===null||_this$selectedDialogu11===void 0?void 0:_this$selectedDialogu11.id)!==dialogueItem.id){try{this.validate();this.hasError=false;}catch(e){// validate failed\nreturn;}}this.selectedDialogueItem=dialogueItem;this.selectedDialogueItem.attributes=attributes;};this.deleteItemAttributes=dialogueItem=>{Modal.confirm({title:i18n.translate('CHAT_ITEM_DEL_TITLE'),okText:i18n.translate('CHAT_ITEM_DEL_OK'),cancelText:i18n.translate('CHAT_ITEM_DEL_CANCEL'),onOk:()=>{this.setItemAttributes(dialogueItem,undefined);this.isItemAttributesEditing=false;}});};this.saveItemAttributes=(dialogueItem,attributes)=>{this.setItemAttributes(dialogueItem,attributes);this.isItemAttributesEditing=true;};this.catchRankError=msg=>{this.hasRankError=true;message.error(msg||i18n.translate('CHAT_ITEM_RANK_EMPTY_ERROR'));};this.catchItemAttributesError=msg=>{this.hasItemAttrError=true;message.error(msg||i18n.translate('CHAT_ITEM_ATTR_EMPTY_ERROR'));};makeAutoObservable(this,{jobProxy:false});}async init(payload){this.initConfig(payload);this.initValidate();try{await this.loadResult();}catch(e){// load error\n}runInAction(()=>{this.initialized=true;});}initConfig(payload){// subject\nif(typeof payload.subjects==='string'){const subjectsSplits=payload.subjects.split(',').map(i=>i.trim()).filter(i=>!!i);if(subjectsSplits.length>0){this.subjectOptions=Array.from(new Set(subjectsSplits));}}// attributes_config\nif(typeof payload.attributes_config==='string'){this.attributesConfig=payload.attributes_config;}// item_attributes_config\nif(typeof payload.item_attributes_config==='string'){const configStr=Base64.decode(payload.item_attributes_config||'');if(configStr){try{const parsedConfig=JSON.parse(configStr);this.itemAttributesConfig=parsedConfig;}catch(error){// parse error\n}}}// ranking\nthis.ranking=payload.ranking===true||payload.ranking==='true';if(this.ranking){if(Object.values(RankingType).includes(payload.ranking_type)){this.rankingType=payload.ranking_type;}if(typeof payload.ranking_options==='string'){const optionsSplits=payload.ranking_options.split(',').map(i=>i.trim()).filter(i=>!!i);if(optionsSplits.length>0){this.rankingOptions=[...optionsSplits];}}}// editable\nthis.editable=payload.editable===true||payload.editable==='true';// addible\nthis.addible=payload.addible===true||payload.addible==='true';if(this.addible){if(Object.values(LLMModel).includes(payload.add_model)){this.addModel=payload.add_model;}}}initValidate(){this.validation=new ValidationStore(this);}async loadResult(){const savedResult=await this.jobProxy.loadSavedResult();const reviewFromResult=await this.jobProxy.loadReviewFrom();const result=savedResult||reviewFromResult;if(!result){return;}if(result.auditId){this.jobProxy.setAuditId(result.auditId);}const{desc,dialogue,chat,attributes,instruction}=result;if(typeof desc==='string'&&desc){this.subject=desc;}if(attributes){this.attributes=attributes;}this.instruction=parseContent(instruction);this.parseDialogue(dialogue,chat,!savedResult);}async saveResult(){let submit=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;if(submit&&this.annotatable){this.validateResult();}return this.jobProxy.saveResult({instruction:toJS(this.instruction),attributes:toJS(this.attributes),desc:this.subject,dialogue:this.dialogue.map(dialogueItem=>dialogueItem.toJSON()),modelInput:this.generateModelInput(),auditId:this.jobProxy.auditId,templateConfig:this.jobProxy.templateConfig},submit);}saveReviews(){let submit=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;}// TODO:\nparseDialogue(dialogue,chat){let isFromReviewFrom=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;const list=[];if(Array.isArray(dialogue)&&dialogue.length>0){let lastItemType=ChatItemType.A;dialogue.forEach(item=>{let{type}=item;if(Object.values(ChatItemType).indexOf(type)<0){type=lastItemType===ChatItemType.A?ChatItemType.Q:ChatItemType.A;}const original=this.isOriginalDialogue(item.original,isFromReviewFrom);const value=parseContent(item.value);let originalValue;if(item.originalValue){originalValue=parseContent(item.originalValue);}else if(original){originalValue=value;}if(type===lastItemType){// merge value to last item if same type with last item\nconst lastItem=list[list.length-1];if(lastItem){lastItem.value.push(...value);if(originalValue){if(lastItem.originalValue){lastItem.originalValue.push(...originalValue);}else{lastItem.originalValue=originalValue;}}}}else{list.push(new MDialogueItem({id:item.id||uuidv4(),type,original,value,originalValue,rank:item.rank,model:item.model,attributes:item.attributes}));}lastItemType=type;});const lastOriginalIndex=findLastIndex(list,i=>i.original);let i=0;while(i<lastOriginalIndex){// fix original value\nlist[i].original=true;if(!list[i].originalValue){// miss original value\nlist[i].originalValue=cloneDeep(list[i].value);}i+=1;}}else if(Array.isArray(chat)&&chat.length>0){chat.forEach(item=>{const{input,output}=item;if(input!==undefined&&output!==undefined){const inputContent=parseContent(input);list.push(new MDialogueItem({id:uuidv4(),type:ChatItemType.Q,original:this.isLabeling,value:inputContent,...(this.isLabeling&&{originalValue:inputContent})}));const ouputContent=parseContent(output);list.push(new MDialogueItem({id:uuidv4(),type:ChatItemType.A,original:this.isLabeling,value:ouputContent,...(this.isLabeling&&{originalValue:ouputContent})}));}});}this.dialogue=list;}generateModelInput(){const chat=[];const start=this.dialogue.findIndex(i=>i.type===ChatItemType.Q);for(let i=start;i<this.dialogue.length;i+=2){const q=this.dialogue[i];const a=this.dialogue[i+1];if(q&&a){chat.push({input:contentToPlainText(q.value),output:contentToPlainText(a.value),rank:toJS(a.rank),attributes:toJS(a.attributes)});}}return{desc:this.subject,attributes:toJS(this.attributes),chat};}}export default new Store();","map":{"version":3,"names":["makeAutoObservable","runInAction","toJS","v4","uuidv4","Modal","message","cloneDeep","findLastIndex","validate","validateForm","Base64","i18n","MDialogueItem","ValidationStore","ReviewMode","ChatItemType","InputType","contentToPlainText","isContentEmpty","parseContent","LLMModel","RankingType","ToolMode","isAnnotationReadonly","isPreview","isReviewEditable","isRework","isTemplatePreview","Store","hasError","_hasError","hasRankError","hasItemAttrError","val","nextDialogueItemType","dialogue","length","Q","last","type","A","canAddDialogueItem","readonly","addible","currentEditorTypes","_this$selectedDialogu","isAdding","selectedDialogueItem","editorTypes","jobProxy","toolMode","reviewMode","REVIEW","annotatable","reviewable","isLabeling","LABELING","isOriginalDialogue","forceToolModeCheck","arguments","undefined","constructor","initialized","instruction","subject","attributes","attributesConfig","itemAttributesConfig","isEditing","isRanking","isItemAttributesEditing","subjectOptions","ranking","rankingType","SCORE","rankingOptions","editable","addModel","NONUSE","validation","validationConfig","script","submitCheck","DEFAULT","validateResult","newlyAddedRoundsCount","forEach","dialogueItem","original","value","Error","translate","some","o","_dialogueItem$rank","_dialogueItem$rank$sc","rank","scores","validateRes","setSubject","setAttributesConfig","_this$selectedDialogu2","catchSaveError","_this$selectedDialogu3","_this$selectedDialogu4","_this$selectedDialogu5","catchRankError","catchItemAttributesError","validateItem","e","selectDialogueItem","_this$selectedDialogu6","id","addDialogueItem","getDialogueItemContent","currentDialogue","lastQuestionItem","reverse","find","item","content","role","editDialogueItem","_this$selectedDialogu7","saveDialogueItem","newItem","push","cancelSaveDialogueItem","updateDialogueItem","msg","error","rankDialogueItem","_this$selectedDialogu8","saveRank","_this$selectedDialogu9","onItemAttributesEdit","_this$selectedDialogu10","setItemAttributes","_this$selectedDialogu11","deleteItemAttributes","confirm","title","okText","cancelText","onOk","saveItemAttributes","init","payload","initConfig","initValidate","loadResult","subjects","subjectsSplits","split","map","i","trim","filter","Array","from","Set","attributes_config","item_attributes_config","configStr","decode","parsedConfig","JSON","parse","Object","values","includes","ranking_type","ranking_options","optionsSplits","add_model","savedResult","loadSavedResult","reviewFromResult","loadReviewFrom","result","auditId","setAuditId","desc","chat","parseDialogue","saveResult","submit","toJSON","modelInput","generateModelInput","templateConfig","saveReviews","isFromReviewFrom","list","isArray","lastItemType","indexOf","originalValue","lastItem","model","lastOriginalIndex","input","output","inputContent","ouputContent","start","findIndex","q","a"],"sources":["/Users/qzheng/Documents/webroot/annotation_tools/src/components/dialogue/store.ts"],"sourcesContent":["import { makeAutoObservable, runInAction, toJS } from 'mobx';\nimport { v4 as uuidv4 } from 'uuid';\nimport { Modal, message } from 'antd';\nimport { cloneDeep, findLastIndex } from 'lodash';\nimport { validate as validateForm } from '@appen-china/easy-form/es/utils';\nimport { FormConfig } from '@appen-china/easy-form/es/types';\nimport { Base64 } from 'js-base64';\nimport i18n from './locales';\nimport MDialogueItem from './models/DialogueItem';\nimport ValidationStore from './validationStore';\nimport { Chat, Payload, ReviewMode } from './types';\nimport { ChatItemType } from '../common/llm/chat/ChatItem';\nimport { InputType } from '../common/llm/input/InputWrapper';\nimport { contentToPlainText, isContentEmpty, parseContent } from '../common/llm/helper';\nimport { Content, LLMModel, Rank, RankingType } from '../common/llm/types';\nimport JobProxy from '../../libs/JobProxy';\nimport { ToolMode, isAnnotationReadonly, isPreview, isReviewEditable, isRework, isTemplatePreview } from '../../utils/tool-mode';\n\nclass Store {\n  /**\n   * job proxy\n   */\n  jobProxy?: JobProxy;\n\n  /**\n   * is tool initialized\n   */\n  initialized = false;\n\n  /**\n   * labeling or review mode\n   */\n  reviewMode = ReviewMode.LABELING;\n\n  /**\n   * instruction\n   */\n  instruction: Content = [];\n\n  /**\n   * dialogue\n   */\n  dialogue: MDialogueItem[] = [];\n\n  /**\n   * subject\n   */\n  subject?: string;\n\n  /**\n   * [config] global rank\n   */\n  attributes: { [key: string]: any; } | undefined;\n\n  /**\n   * [config] global rank config\n   */\n  attributesConfig = '';\n\n  /**\n   * [config] item attributes  config\n   */\n  itemAttributesConfig?: FormConfig;\n\n  /**\n   * current selected dialogue item\n   */\n  selectedDialogueItem?: MDialogueItem;\n\n  /**\n   * is editing\n   */\n  isEditing = false;\n\n  /**\n   * is adding\n   */\n  isAdding = false;\n\n  /**\n   * is ranking\n   */\n  isRanking = false;\n\n  /**\n   * is attributes editing\n   */\n  isItemAttributesEditing = false;\n\n  /**\n   * has error\n   */\n  _hasError = false;\n\n  get hasError() {\n    return this._hasError || this.hasRankError || this.hasItemAttrError;\n  }\n\n  set hasError(val: boolean) {\n    this._hasError = val;\n    if (!val) {\n      this.hasRankError = val;\n      this.hasItemAttrError = val;\n    }\n  }\n\n  /**\n   * item rank has error\n   */\n  hasRankError = false;\n\n  /**\n   * item attributes has error\n   */\n  hasItemAttrError = false;\n\n  /**\n   * [config] options for subject selection\n   */\n  subjectOptions: string[] = [];\n\n  /**\n   * [config] dialogue rank\n   */\n  ranking = false;\n\n  /**\n   * [config] ranking type (score / mark)\n   */\n  rankingType = RankingType.SCORE;\n\n  /**\n   * [config] options for ranking\n   */\n  rankingOptions: string[] = [];\n\n  /**\n   * [config] dialogue editable (only control original answers)\n   */\n  editable = false;\n\n  /**\n   * [config] can add new dialogue\n   */\n  addible = false;\n\n  /**\n   * [config] model used when add dialogue item\n   */\n  addModel = LLMModel.NONUSE;\n\n  /**\n   * validation\n   */\n  validation: ValidationStore | undefined;\n\n  /**\n * validation config\n */\n  validationConfig = { script: false };\n\n  /**\n   * submit check\n   */\n  submitCheck = false;\n\n  /**\n   * editor types\n   */\n  editorTypes = {\n    Q: [InputType.DEFAULT],\n    A: [InputType.DEFAULT],\n  };\n\n  /**\n   * next dialogue item type\n   */\n  get nextDialogueItemType() {\n    if (this.dialogue.length === 0) {\n      return ChatItemType.Q;\n    }\n    const last = this.dialogue[this.dialogue.length - 1];\n    return last.type === ChatItemType.A ? ChatItemType.Q : ChatItemType.A;\n  }\n\n  /**\n   * can add dialogue item\n   */\n  get canAddDialogueItem() {\n    if (this.readonly || !this.addible) {\n      return false;\n    }\n\n    return true;\n  }\n\n  /**\n   * current editor types\n   */\n  get currentEditorTypes() {\n    const type = this.isAdding ? this.nextDialogueItemType : this.selectedDialogueItem?.type;\n    return type === ChatItemType.A ? this.editorTypes.A : this.editorTypes.Q;\n  }\n\n  /**\n   * is tool readonly (annotate not allowed)\n   */\n  get readonly() {\n    return isAnnotationReadonly(this.jobProxy!.toolMode) || this.reviewMode === ReviewMode.REVIEW;\n  }\n\n  /**\n   * is tool annotate allowed\n   */\n  get annotatable() {\n    return !isAnnotationReadonly(this.jobProxy!.toolMode);\n  }\n\n  /**\n   * is tool review enabled\n   */\n  get reviewable() {\n    return isReviewEditable(this.jobProxy!.toolMode);\n  }\n\n  /**\n   * is tool in labeling mode or template preview mode\n   */\n  get isLabeling() {\n    return this.jobProxy!.toolMode === ToolMode.LABELING || this.isTemplatePreview;\n  }\n\n  /**\n   * is tool in rework mode\n   */\n  get isRework() {\n    return isRework(this.jobProxy!.toolMode);\n  }\n\n  /**\n   * is tool in preview mode\n   */\n  get isPreview() {\n    return isPreview(this.jobProxy!.toolMode);\n  }\n\n  /**\n   * is tool in template preview mode\n   */\n  get isTemplatePreview() {\n    return isTemplatePreview(this.jobProxy!.toolMode);\n  }\n\n  isOriginalDialogue(val: unknown, forceToolModeCheck = false) {\n    if (forceToolModeCheck && this.isLabeling) {\n      return true;\n    }\n    return typeof val === 'boolean' ? val : this.isLabeling;\n  }\n\n  constructor() {\n    makeAutoObservable(this, {\n      jobProxy: false,\n    });\n  }\n\n  async init(payload: Payload) {\n    this.initConfig(payload);\n    this.initValidate();\n\n    try {\n      await this.loadResult();\n    } catch (e) {\n      // load error\n    }\n\n    runInAction(() => {\n      this.initialized = true;\n    });\n  }\n\n  initConfig(payload: Payload) {\n    // subject\n    if (typeof payload.subjects === 'string') {\n      const subjectsSplits = payload.subjects.split(',').map((i) => i.trim()).filter((i) => !!i);\n      if (subjectsSplits.length > 0) {\n        this.subjectOptions = Array.from(new Set(subjectsSplits));\n      }\n    }\n    // attributes_config\n    if (typeof payload.attributes_config === 'string') {\n      this.attributesConfig = payload.attributes_config;\n    }\n\n    // item_attributes_config\n    if (typeof payload.item_attributes_config === 'string') {\n      const configStr = Base64.decode(payload.item_attributes_config || '');\n      if (configStr) {\n        try {\n          const parsedConfig = JSON.parse(configStr);\n          this.itemAttributesConfig = parsedConfig;\n        } catch (error) {\n          // parse error\n        }\n      }\n    }\n\n    // ranking\n    this.ranking = payload.ranking === true || payload.ranking === 'true';\n    if (this.ranking) {\n      if (Object.values(RankingType).includes(payload.ranking_type as RankingType)) {\n        this.rankingType = payload.ranking_type as RankingType;\n      }\n      if (typeof payload.ranking_options === 'string') {\n        const optionsSplits = payload.ranking_options.split(',').map((i) => i.trim()).filter((i) => !!i);\n        if (optionsSplits.length > 0) {\n          this.rankingOptions = [...optionsSplits];\n        }\n      }\n    }\n\n    // editable\n    this.editable = payload.editable === true || payload.editable === 'true';\n\n    // addible\n    this.addible = payload.addible === true || payload.addible === 'true';\n    if (this.addible) {\n      if (Object.values(LLMModel).includes(payload.add_model as LLMModel)) {\n        this.addModel = payload.add_model as LLMModel;\n      }\n    }\n  }\n\n  initValidate() {\n    this.validation = new ValidationStore(this);\n  }\n\n  async loadResult() {\n    const savedResult = await this.jobProxy!.loadSavedResult();\n    const reviewFromResult = await this.jobProxy!.loadReviewFrom();\n\n    const result = savedResult || reviewFromResult;\n    if (!result) {\n      return;\n    }\n    if (result.auditId) {\n      this.jobProxy!.setAuditId(result.auditId);\n    }\n\n    const { desc, dialogue, chat, attributes, instruction } = result;\n    if (typeof desc === 'string' && desc) {\n      this.subject = desc;\n    }\n\n    if (attributes) {\n      this.attributes = attributes;\n    }\n    this.instruction = parseContent(instruction);\n    this.parseDialogue(dialogue, chat, !savedResult);\n  }\n\n  async saveResult(submit = false) {\n    if (submit && this.annotatable) {\n      this.validateResult();\n    }\n\n    return this.jobProxy!.saveResult({\n      instruction: toJS(this.instruction),\n      attributes: toJS(this.attributes),\n      desc: this.subject,\n      dialogue: this.dialogue.map((dialogueItem) => dialogueItem.toJSON()),\n      modelInput: this.generateModelInput(),\n      auditId: this.jobProxy!.auditId,\n      templateConfig: this.jobProxy!.templateConfig,\n    }, submit);\n  }\n\n  saveReviews(submit = false) {\n    // TODO:\n  }\n\n  parseDialogue(dialogue: unknown, chat: unknown, isFromReviewFrom = false) {\n    const list: MDialogueItem[] = [];\n    if (Array.isArray(dialogue) && dialogue.length > 0) {\n      let lastItemType = ChatItemType.A;\n      dialogue.forEach((item) => {\n        let { type } = item;\n        if (Object.values(ChatItemType).indexOf(type) < 0) {\n          type = lastItemType === ChatItemType.A ? ChatItemType.Q : ChatItemType.A;\n        }\n        const original = this.isOriginalDialogue(item.original, isFromReviewFrom);\n        const value = parseContent(item.value);\n        let originalValue;\n        if (item.originalValue) {\n          originalValue = parseContent(item.originalValue);\n        } else if (original) {\n          originalValue = value;\n        }\n        if (type === lastItemType) {\n          // merge value to last item if same type with last item\n          const lastItem = list[list.length - 1];\n          if (lastItem) {\n            lastItem.value.push(...value);\n            if (originalValue) {\n              if (lastItem.originalValue) {\n                lastItem.originalValue.push(...originalValue);\n              } else {\n                lastItem.originalValue = originalValue;\n              }\n            }\n          }\n        } else {\n          list.push(new MDialogueItem({\n            id: item.id || uuidv4(),\n            type,\n            original,\n            value,\n            originalValue,\n            rank: item.rank,\n            model: item.model,\n            attributes: item.attributes,\n          }));\n        }\n        lastItemType = type;\n      });\n      const lastOriginalIndex = findLastIndex(list, (i) => i.original);\n      let i = 0;\n      while (i < lastOriginalIndex) {\n        // fix original value\n        list[i].original = true;\n        if (!list[i].originalValue) {\n          // miss original value\n          list[i].originalValue = cloneDeep(list[i].value);\n        }\n        i += 1;\n      }\n    } else if (Array.isArray(chat) && chat.length > 0) {\n      chat.forEach((item) => {\n        const { input, output } = item;\n        if (input !== undefined && output !== undefined) {\n          const inputContent = parseContent(input);\n          list.push(new MDialogueItem({\n            id: uuidv4(),\n            type: ChatItemType.Q,\n            original: this.isLabeling,\n            value: inputContent,\n            ...this.isLabeling && {\n              originalValue: inputContent,\n            },\n          }));\n\n          const ouputContent = parseContent(output);\n          list.push(new MDialogueItem({\n            id: uuidv4(),\n            type: ChatItemType.A,\n            original: this.isLabeling,\n            value: ouputContent,\n            ...this.isLabeling && {\n              originalValue: ouputContent,\n            },\n          }));\n        }\n      });\n    }\n    this.dialogue = list;\n  }\n\n  generateModelInput() {\n    const chat: Chat = [];\n    const start = this.dialogue.findIndex((i) => i.type === ChatItemType.Q);\n    for (let i = start; i < this.dialogue.length; i += 2) {\n      const q = this.dialogue[i];\n      const a = this.dialogue[i + 1];\n      if (q && a) {\n        chat.push({\n          input: contentToPlainText(q.value),\n          output: contentToPlainText(a.value),\n          rank: toJS(a.rank),\n          attributes: toJS(a.attributes),\n        });\n      }\n    }\n    return {\n      desc: this.subject,\n      attributes: toJS(this.attributes),\n      chat,\n    };\n  }\n\n  validateResult = () => {\n    // 1) check dialogue item value\n    // 2) check dialogue item rank\n    // 3) check dialogue item attributes\n    // 4) check dialogue limit\n    let newlyAddedRoundsCount = 0;\n    this.dialogue.forEach((dialogueItem) => {\n      if (!dialogueItem.original) {\n        if (isContentEmpty(dialogueItem.value)) {\n          this.selectedDialogueItem = dialogueItem;\n          this.isEditing = true;\n          this.hasError = true;\n          throw new Error(i18n.translate('CHAT_ITEM_EMPTY_ERROR'));\n        }\n        if (dialogueItem.type === ChatItemType.A) {\n          newlyAddedRoundsCount += 1;\n        }\n      }\n      if (dialogueItem.type === ChatItemType.A) {\n        if (this.ranking && this.rankingType === RankingType.SCORE\n          && this.rankingOptions.some((o) => dialogueItem.rank?.scores?.[o] === undefined)) {\n          this.selectedDialogueItem = dialogueItem;\n          this.isRanking = true;\n          this.hasRankError = true;\n          throw new Error(i18n.translate('CHAT_ITEM_RANK_EMPTY_ERROR'));\n        }\n        if (this.itemAttributesConfig) {\n          const { attributes } = dialogueItem;\n          if (attributes) {\n            const validateRes = validateForm(this.itemAttributesConfig, attributes);\n            if (!validateRes) {\n              this.selectedDialogueItem = dialogueItem;\n              this.isItemAttributesEditing = true;\n              this.hasItemAttrError = true;\n              throw new Error(i18n.translate('CHAT_ITEM_ATTR_EMPTY_ERROR'));\n            }\n          }\n        }\n      }\n    });\n  };\n\n  setSubject = (subject: string) => {\n    this.subject = subject;\n  };\n\n  setAttributesConfig = (attributes: any) => {\n    this.attributes = attributes;\n  };\n\n  validate = () => {\n    if (this.isAdding) {\n      this.catchSaveError();\n      throw new Error('should finish adding');\n    }\n    if (this.selectedDialogueItem?.type === ChatItemType.A) {\n      if (this.isRanking && this.rankingType === RankingType.SCORE\n        && this.rankingOptions.some((o) => this.selectedDialogueItem?.rank?.scores?.[o] === undefined)) {\n        this.catchRankError();\n        throw new Error('should finish ranking');\n      }\n      if (this.isItemAttributesEditing && this.itemAttributesConfig) {\n        const { attributes } = this.selectedDialogueItem;\n        if (attributes) {\n          const validateRes = validateForm(this.itemAttributesConfig, attributes);\n          if (!validateRes) {\n            this.catchItemAttributesError();\n            throw new Error('should finish the item attributes form');\n          }\n        }\n      }\n    }\n  };\n\n  validateItem = () => {\n    try {\n      this.validate();\n      this.hasError = false;\n      this.isRanking = false;\n      this.isItemAttributesEditing = false;\n    } catch (e) {\n      // validate failed\n    }\n  };\n\n  selectDialogueItem = (dialogueItem: MDialogueItem) => {\n    if (this.selectedDialogueItem?.id === dialogueItem.id) {\n      return;\n    }\n    try {\n      this.validate();\n      this.hasError = false;\n      this.selectedDialogueItem = dialogueItem;\n      this.isEditing = false;\n      this.isRanking = false;\n      this.isItemAttributesEditing = false;\n    } catch (e) {\n      // validate failed\n    }\n  };\n\n  addDialogueItem = () => {\n    if (this.readonly || !this.canAddDialogueItem) {\n      return;\n    }\n    try {\n      this.validate();\n      this.hasError = false;\n      this.selectedDialogueItem = undefined;\n      this.isEditing = false;\n      this.isRanking = false;\n      this.isItemAttributesEditing = false;\n      this.isAdding = true;\n    } catch (e) {\n      // validate failed\n    }\n  };\n\n  getDialogueItemContent = () => {\n    const currentDialogue = [...this.dialogue];\n    const lastQuestionItem = currentDialogue.reverse().find((item) => item.type === ChatItemType.Q);\n    if (lastQuestionItem) {\n      const content = contentToPlainText(lastQuestionItem.value);\n      return [\n        {\n          role: 'user',\n          content,\n        }\n      ];\n    }\n    return null;\n  };\n\n  editDialogueItem = (dialogueItem: MDialogueItem) => {\n    if (this.readonly || (dialogueItem.original && !this.editable)) {\n      return;\n    }\n    if (this.selectedDialogueItem?.id === dialogueItem.id) {\n      this.isEditing = true;\n      return;\n    }\n    try {\n      this.validate();\n      this.hasError = false;\n      this.selectedDialogueItem = dialogueItem;\n      this.isRanking = false;\n      this.isItemAttributesEditing = false;\n      this.isEditing = true;\n    } catch (e) {\n      // validate failed\n    }\n  };\n\n  saveDialogueItem = (value: Content) => {\n    if (this.readonly) {\n      return;\n    }\n    if (this.isAdding) {\n      // add new dialogue item\n      const newItem = new MDialogueItem({\n        id: uuidv4(),\n        type: this.nextDialogueItemType,\n        original: false,\n        value,\n      });\n      this.dialogue.push(newItem);\n      this.selectedDialogueItem = newItem;\n      if (!this.readonly && this.ranking && newItem.type === ChatItemType.A) {\n        this.isRanking = true;\n      }\n    } else if (this.isEditing && this.selectedDialogueItem) {\n      // update dialogue item\n      this.selectedDialogueItem.value = value;\n    }\n    this.cancelSaveDialogueItem();\n  };\n\n  updateDialogueItem = (dialogueItem: MDialogueItem, value: Content) => {\n    if (this.readonly || this.isAdding || this.isEditing) {\n      return;\n    }\n    dialogueItem.value = value;\n  };\n\n  cancelSaveDialogueItem = () => {\n    this.isEditing = false;\n    this.isAdding = false;\n  };\n\n  catchSaveError = (msg?: string) => {\n    this.hasError = true;\n    message.error(msg || i18n.translate('CHAT_ITEM_EMPTY_ERROR'));\n  };\n\n  rankDialogueItem = (dialogueItem: MDialogueItem) => {\n    if (this.readonly || !this.ranking || dialogueItem.type === ChatItemType.Q) {\n      return;\n    }\n    try {\n      this.validate();\n      this.hasError = false;\n      if (this.selectedDialogueItem?.id !== dialogueItem.id) {\n        this.isItemAttributesEditing = false;\n      }\n      this.selectedDialogueItem = dialogueItem;\n      this.isEditing = false;\n      this.isRanking = true;\n    } catch (e) {\n      // validate failed\n    }\n  };\n\n  saveRank = (dialogueItem: MDialogueItem, rank: Rank) => {\n    if (this.readonly) {\n      return;\n    }\n    if (this.selectedDialogueItem?.id !== dialogueItem.id) {\n      try {\n        this.validate();\n        this.hasError = false;\n        this.isItemAttributesEditing = false;\n      } catch (e) {\n        // validate failed\n        return;\n      }\n    }\n    this.isRanking = true;\n    this.selectedDialogueItem = dialogueItem;\n    this.selectedDialogueItem.rank = rank;\n  };\n\n  onItemAttributesEdit = (dialogueItem: MDialogueItem) => {\n    if (this.readonly || !this.itemAttributesConfig || dialogueItem.type === ChatItemType.Q) {\n      return;\n    }\n    try {\n      this.validate();\n      this.hasError = false;\n    } catch (e) {\n      // validate failed\n      return;\n    }\n    if (this.selectedDialogueItem?.id !== dialogueItem.id) {\n      this.isRanking = false;\n    }\n    this.selectedDialogueItem = dialogueItem;\n    this.isEditing = false;\n    this.isItemAttributesEditing = true;\n  };\n\n  setItemAttributes = (dialogueItem: MDialogueItem, attributes: any) => {\n    if (this.readonly) {\n      return;\n    }\n    if (this.selectedDialogueItem?.id !== dialogueItem.id) {\n      try {\n        this.validate();\n        this.hasError = false;\n      } catch (e) {\n        // validate failed\n        return;\n      }\n    }\n    this.selectedDialogueItem = dialogueItem;\n    this.selectedDialogueItem.attributes = attributes;\n  };\n\n  deleteItemAttributes = (dialogueItem: MDialogueItem) => {\n    Modal.confirm({\n      title: i18n.translate('CHAT_ITEM_DEL_TITLE'),\n      okText: i18n.translate('CHAT_ITEM_DEL_OK'),\n      cancelText: i18n.translate('CHAT_ITEM_DEL_CANCEL'),\n      onOk: () => {\n        this.setItemAttributes(dialogueItem, undefined);\n        this.isItemAttributesEditing = false;\n      }\n    });\n  };\n\n  saveItemAttributes = (dialogueItem: MDialogueItem, attributes: any) => {\n    this.setItemAttributes(dialogueItem, attributes);\n    this.isItemAttributesEditing = true;\n  };\n\n  catchRankError = (msg?: string) => {\n    this.hasRankError = true;\n    message.error(msg || i18n.translate('CHAT_ITEM_RANK_EMPTY_ERROR'));\n  };\n\n  catchItemAttributesError = (msg?: string) => {\n    this.hasItemAttrError = true;\n    message.error(msg || i18n.translate('CHAT_ITEM_ATTR_EMPTY_ERROR'));\n  };\n}\n\nexport default new Store();\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}