{"ast":null,"code":"import _applyDecoratedDescriptor from \"/Users/qzheng/Documents/webroot/annotation_tools/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/applyDecoratedDescriptor\";\nvar _class;\nimport { observable, computed, action, makeObservable } from 'mobx';\nlet UndoStore = (_class = class UndoStore {\n  constructor(rootStore) {\n    this.rootStore = void 0;\n    this.savedStatus = [];\n    this.pointer = 0;\n    this.actionPointer = 0;\n    makeObservable(this, {\n      pointer: observable,\n      undo: action,\n      redo: action,\n      saveStatus: action\n    });\n    this.rootStore = rootStore;\n  }\n  get undoDisabled() {\n    return this.pointer <= 0;\n  }\n  get redoDisabled() {\n    return this.pointer >= this.savedStatus.length;\n  }\n  undo() {\n    if (this.pointer > 0) {\n      this.pointer -= 1;\n      this.actionPointer -= 1;\n      return this.savedStatus[this.pointer];\n    }\n    return null;\n  }\n  redo() {\n    if (this.pointer < this.savedStatus.length) {\n      this.pointer += 1;\n      this.actionPointer += 1;\n      return this.savedStatus[this.pointer - 1];\n    }\n    return null;\n  }\n  saveStatus(before, after, insertPrev = false) {\n    this.savedStatus = this.savedStatus.slice(0, this.pointer);\n    const lenIndex = this.savedStatus.length - 1;\n    if (insertPrev && lenIndex >= 0) {\n      const {\n        before: prevBefore,\n        after: prevAfter\n      } = this.savedStatus[lenIndex];\n      this.savedStatus[lenIndex] = {\n        before: [...prevBefore, ...before],\n        after: [...prevAfter, ...after]\n      };\n    } else {\n      this.savedStatus.push({\n        before,\n        after\n      });\n      if (this.savedStatus.length > 30) {\n        this.savedStatus.shift();\n      } else {\n        this.pointer += 1;\n      }\n    }\n    this.actionPointer += 1;\n  }\n}, (_applyDecoratedDescriptor(_class.prototype, \"undoDisabled\", [computed], Object.getOwnPropertyDescriptor(_class.prototype, \"undoDisabled\"), _class.prototype), _applyDecoratedDescriptor(_class.prototype, \"redoDisabled\", [computed], Object.getOwnPropertyDescriptor(_class.prototype, \"redoDisabled\"), _class.prototype)), _class);\nexport default UndoStore;","map":{"version":3,"names":["observable","computed","action","makeObservable","UndoStore","_class","constructor","rootStore","savedStatus","pointer","actionPointer","undo","redo","saveStatus","undoDisabled","redoDisabled","length","before","after","insertPrev","slice","lenIndex","prevBefore","prevAfter","push","shift","_applyDecoratedDescriptor","prototype","Object","getOwnPropertyDescriptor"],"sources":["/Users/qzheng/Documents/webroot/annotation_tools/src/components/keypoint/store/UndoStore.ts"],"sourcesContent":["import { observable, computed, action, makeObservable } from 'mobx';\nimport { RootStoreType } from './RootStore';\nimport { UpdatedShape, CategoryPathShapeStatus, InstanceStatus, GroupStatus, Review, HandleStatus } from '../types';\n\nexport interface StatusItem {\n  before: Status[];\n  after: Status[];\n}\n\nexport type Status =\n  { type: 'shape'; status: UpdatedShape; } |\n  { type: 'pointCategory-path-shape'; status: CategoryPathShapeStatus; } |\n  { type: 'instance'; status: InstanceStatus; } |\n  { type: 'group'; status: GroupStatus; } |\n  { type: 'reviews'; status: Review[]; } |\n  { type: 'handle'; status: HandleStatus[]; };\n\nclass UndoStore {\n  rootStore: RootStoreType;\n\n  savedStatus: StatusItem[] = [];\n\n  pointer = 0;\n\n  actionPointer = 0;\n\n  constructor(rootStore: RootStoreType) {\n    makeObservable(this, {\n      pointer: observable,\n      undo: action,\n      redo: action,\n      saveStatus: action\n    });\n    this.rootStore = rootStore;\n  }\n\n  @computed get undoDisabled() {\n    return this.pointer <= 0;\n  }\n\n  @computed get redoDisabled() {\n    return this.pointer >= this.savedStatus.length;\n  }\n\n  undo() {\n    if (this.pointer > 0) {\n      this.pointer -= 1;\n      this.actionPointer -= 1;\n      return this.savedStatus[this.pointer];\n    }\n    return null;\n  }\n\n  redo() {\n    if (this.pointer < this.savedStatus.length) {\n      this.pointer += 1;\n      this.actionPointer += 1;\n      return this.savedStatus[this.pointer - 1];\n    }\n    return null;\n  }\n\n  saveStatus(before: Status[], after: Status[], insertPrev = false) {\n    this.savedStatus = this.savedStatus.slice(0, this.pointer);\n    const lenIndex = this.savedStatus.length - 1;\n    if (insertPrev && lenIndex >= 0) {\n      const { before: prevBefore, after: prevAfter } = this.savedStatus[lenIndex];\n      this.savedStatus[lenIndex] = {\n        before: [...prevBefore, ...before],\n        after: [...prevAfter, ...after]\n      };\n    } else {\n      this.savedStatus.push({ before, after });\n      if (this.savedStatus.length > 30) {\n        this.savedStatus.shift();\n      } else {\n        this.pointer += 1;\n      }\n    }\n    this.actionPointer += 1;\n  }\n}\n\nexport default UndoStore;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}