{"ast":null,"code":"import * as alawmulaw from 'alawmulaw';\nimport { parseAlawPcmToAudioData } from './pcm';\nimport { RunningMode } from '../types';\nimport * as storage from './storage';\nexport const store = storage;\nexport function checkRunningMode() {\n  let inIframe = false;\n  try {\n    inIframe = window.self !== window.top;\n  } catch (e) {\n    inIframe = false;\n  }\n  return inIframe ? RunningMode.IFRAME : RunningMode.STANDALONE;\n}\n;\nexport function fetchResultByUrl(url) {\n  return new Promise((resolve, reject) => {\n    fetch(url, {\n      cache: 'no-store'\n    }).then(res => {\n      if (res.ok) {\n        return res.json();\n      }\n      reject(new Error('http request error'));\n    }).then(data => resolve(data)).catch(e => reject(e));\n  });\n}\nexport function preloadImage(src, crossOrigin = '') {\n  const img = new Image();\n  img.crossOrigin = crossOrigin;\n  img.src = src;\n}\nexport function isAppenCloud() {\n  const {\n    hostname\n  } = window.location;\n  return hostname.endsWith('.appen.com.cn');\n}\nexport function getOrigin() {\n  const {\n    origin\n  } = window.location;\n  switch (origin) {\n    case 'https://tools-dev.appen.com.cn':\n    case 'http://tools.devk.appen.com.cn':\n      return 'https://request-proxy-dev.appen.com.cn';\n    case 'https://tools-stg.appen.com.cn':\n    case 'http://tools.stg.appen.com.cn':\n      return 'https://request-proxy-stg.appen.com.cn';\n    case 'https://tools.appen.com.cn':\n      return 'https://request-proxy.appen.com.cn';\n    default:\n  }\n  return '';\n}\nexport function runScript(id, data) {\n  const origin = getOrigin();\n  return new Promise(resolve => {\n    fetch(`${origin}/ai/v1/script/invoke?id=${id}`, {\n      method: 'POST',\n      credentials: 'include',\n      headers: {\n        'content-type': 'application/json'\n      },\n      body: JSON.stringify(data)\n    }).then(resp => {\n      if (resp.status !== 200) {\n        resolve({\n          error: `Failed to run script: ${id}`\n        });\n      }\n      return resp.json();\n    }).then(res => {\n      if (res.data && res.data.status === 'SUCCESS') {\n        try {\n          const parsedData = JSON.parse(res.data.result);\n          resolve(parsedData);\n        } catch (e) {\n          resolve({\n            error: `Failed to parse result for script: ${id}`\n          });\n        }\n      }\n      resolve({\n        error: `Failed to run script: ${id}`\n      });\n    }).catch(() => {\n      resolve({\n        error: `Failed to run script: ${id}`\n      });\n    });\n  });\n}\nexport async function runCustomValidation(scriptIds, resultLink) {\n  const results = [];\n  let hasCustomError = false;\n  const customResults = await Promise.all(scriptIds.map(scriptId => runScript(scriptId, resultLink)));\n  customResults.forEach(customResult => {\n    if (!customResult.error && Array.isArray(customResult)) {\n      customResult.forEach(item => {\n        results.push({\n          id: item.id,\n          message: item.message,\n          frames: item.frames,\n          info: {\n            ...item.info\n          },\n          blockSubmit: item.blockSubmit\n        });\n      });\n    } else {\n      hasCustomError = true;\n    }\n  });\n  return {\n    results,\n    hasCustomError\n  };\n}\nexport const isInput = () => {\n  var _document$activeEleme;\n  return document.activeElement.tagName === 'INPUT' && (document.activeElement.type === 'text' || document.activeElement.type === 'number') || document.activeElement.tagName === 'TEXTAREA' || ((_document$activeEleme = document.activeElement) === null || _document$activeEleme === void 0 ? void 0 : _document$activeEleme.getAttribute('contenteditable')) === 'true';\n};\nexport const lawToWav = (buffer, format) => {\n  const alawOriginData = new Uint8Array(buffer);\n  const decodeAlaw = format === 'alaw' ? alawmulaw.alaw.decode(alawOriginData) : alawmulaw.mulaw.decode(alawOriginData);\n  const audioBuffer = parseAlawPcmToAudioData(decodeAlaw.buffer);\n  return audioBuffer;\n};\nexport function containsRTLLanguage(text = '') {\n  // https://en.wikipedia.org/wiki/Arabic_script_in_Unicode\n  return Array.from(text).some(c => {\n    const code = c.codePointAt(0);\n    return code !== undefined && (code >= 0x0600 && code <= 0x06ff || code >= 0x0750 && code <= 0x077f || code >= 0x08a0 && code <= 0x08ff || code >= 0xfb50 && code <= 0xfdff || code >= 0xfe70 && code <= 0xfeff || code >= 0x10e60 && code <= 0x10e7f || code >= 0x1ec70 && code <= 0x1ecbf || code >= 0x1ed00 && code <= 0x1ed4f || code >= 0x1ee00 && code <= 0x1eeff);\n  });\n}","map":{"version":3,"names":["alawmulaw","parseAlawPcmToAudioData","RunningMode","storage","store","checkRunningMode","inIframe","window","self","top","e","IFRAME","STANDALONE","fetchResultByUrl","url","Promise","resolve","reject","fetch","cache","then","res","ok","json","Error","data","catch","preloadImage","src","crossOrigin","img","Image","isAppenCloud","hostname","location","endsWith","getOrigin","origin","runScript","id","method","credentials","headers","body","JSON","stringify","resp","status","error","parsedData","parse","result","runCustomValidation","scriptIds","resultLink","results","hasCustomError","customResults","all","map","scriptId","forEach","customResult","Array","isArray","item","push","message","frames","info","blockSubmit","isInput","_document$activeEleme","document","activeElement","tagName","type","getAttribute","lawToWav","buffer","format","alawOriginData","Uint8Array","decodeAlaw","alaw","decode","mulaw","audioBuffer","containsRTLLanguage","text","from","some","c","code","codePointAt","undefined"],"sources":["/Users/qzheng/Documents/webroot/annotation_tools/src/utils/index.ts"],"sourcesContent":["import * as alawmulaw from 'alawmulaw';\nimport { parseAlawPcmToAudioData } from './pcm';\nimport { RunningMode } from '../types';\nimport * as storage from './storage';\n\nexport const store = storage;\n\nexport function checkRunningMode() {\n  let inIframe = false;\n  try {\n    inIframe = window.self !== window.top;\n  } catch (e) {\n    inIframe = false;\n  }\n  return inIframe ? RunningMode.IFRAME : RunningMode.STANDALONE;\n};\n\nexport function fetchResultByUrl(url: string) {\n  return new Promise((resolve, reject) => {\n    fetch(url, {\n      cache: 'no-store',\n    })\n      .then((res) => {\n        if (res.ok) {\n          return res.json();\n        }\n        reject(new Error('http request error'));\n      })\n      .then((data) => resolve(data))\n      .catch((e) => reject(e));\n  });\n}\n\nexport function preloadImage(src: string, crossOrigin = '') {\n  const img = new Image();\n  img.crossOrigin = crossOrigin;\n  img.src = src;\n}\n\nexport function isAppenCloud() {\n  const { hostname } = window.location;\n  return hostname.endsWith('.appen.com.cn');\n}\n\nexport function getOrigin() {\n  const { origin } = window.location;\n  switch (origin) {\n    case 'https://tools-dev.appen.com.cn':\n    case 'http://tools.devk.appen.com.cn':\n      return 'https://request-proxy-dev.appen.com.cn';\n    case 'https://tools-stg.appen.com.cn':\n    case 'http://tools.stg.appen.com.cn':\n      return 'https://request-proxy-stg.appen.com.cn';\n    case 'https://tools.appen.com.cn':\n      return 'https://request-proxy.appen.com.cn';\n    default:\n  }\n  return '';\n}\n\nexport function runScript(id: string, data: string) {\n  const origin = getOrigin();\n  return new Promise((resolve) => {\n    fetch(`${origin}/ai/v1/script/invoke?id=${id}`, {\n      method: 'POST',\n      credentials: 'include',\n      headers: {\n        'content-type': 'application/json',\n      },\n      body: JSON.stringify(data),\n    }).then((resp) => {\n      if (resp.status !== 200) {\n        resolve({ error: `Failed to run script: ${id}` });\n      }\n      return resp.json();\n    }).then((res) => {\n      if (res.data && res.data.status === 'SUCCESS') {\n        try {\n          const parsedData = JSON.parse(res.data.result);\n          resolve(parsedData);\n        } catch (e) {\n          resolve({ error: `Failed to parse result for script: ${id}` });\n        }\n      }\n      resolve({ error: `Failed to run script: ${id}` });\n    }).catch(() => {\n      resolve({ error: `Failed to run script: ${id}` });\n    });\n  });\n}\n\nexport async function runCustomValidation(scriptIds: string[], resultLink: string) {\n  const results: any[] = [];\n  let hasCustomError = false;\n  const customResults = await Promise.all(scriptIds.map((scriptId) => runScript(scriptId, resultLink)));\n  customResults.forEach((customResult: any) => {\n    if (!customResult.error && Array.isArray(customResult)) {\n      customResult.forEach((item) => {\n        results.push({\n          id: item.id,\n          message: item.message,\n          frames: item.frames,\n          info: { ...item.info },\n          blockSubmit: item.blockSubmit,\n        });\n      });\n    } else {\n      hasCustomError = true;\n    }\n  });\n\n  return { results, hasCustomError };\n}\n\nexport const isInput = () => (document.activeElement as HTMLFormElement).tagName === 'INPUT' &&\n  ((document.activeElement as HTMLFormElement).type === 'text' || (document.activeElement as HTMLFormElement).type === 'number') ||\n  (document.activeElement as HTMLFormElement).tagName === 'TEXTAREA' || document.activeElement?.getAttribute('contenteditable') === 'true';\n\nexport const lawToWav = (buffer: ArrayBuffer, format: 'alaw' | 'ulaw') => {\n  const alawOriginData = new Uint8Array(buffer);\n  const decodeAlaw = format === 'alaw' ?\n    alawmulaw.alaw.decode(alawOriginData) :\n    alawmulaw.mulaw.decode(alawOriginData);\n  const audioBuffer = parseAlawPcmToAudioData(decodeAlaw.buffer);\n  return audioBuffer;\n};\n\nexport function containsRTLLanguage(text = '') {\n  // https://en.wikipedia.org/wiki/Arabic_script_in_Unicode\n  return Array.from(text).some((c) => {\n    const code = c.codePointAt(0);\n    return code !== undefined && (\n      (code >= 0x0600 && code <= 0x06ff) ||\n      (code >= 0x0750 && code <= 0x077f) ||\n      (code >= 0x08a0 && code <= 0x08ff) ||\n      (code >= 0xfb50 && code <= 0xfdff) ||\n      (code >= 0xfe70 && code <= 0xfeff) ||\n      (code >= 0x10e60 && code <= 0x10e7f) ||\n      (code >= 0x1ec70 && code <= 0x1ecbf) ||\n      (code >= 0x1ed00 && code <= 0x1ed4f) ||\n      (code >= 0x1ee00 && code <= 0x1eeff)\n    );\n  });\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}