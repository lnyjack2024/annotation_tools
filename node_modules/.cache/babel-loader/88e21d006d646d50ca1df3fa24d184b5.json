{"ast":null,"code":"var _class;import React from'react';import{observer}from'mobx-react';import CommonValidator from'../../common/tabs-menu/Validator';import formatMessage from'../locales';import rootStore from'../store/RootStore';import{ValidationType,ReviewResult}from'../types';import'./Validator.scss';let Validator=observer(_class=class Validator extends React.Component{constructor(){super(...arguments);this.handleAction=warning=>{const{setFrame,setSelectedShape,selectGroup}=this.props;const{id,groupName,shapeIds,data,frames}=warning;setFrame(frames[0]);if(data===null||data===void 0?void 0:data.position){var _this$props$canvas;const missingReview=rootStore.review.missingReviews.find(r=>r.id===id);if(missingReview){rootStore.review.setSelectedMissingReview(missingReview);}(_this$props$canvas=this.props.canvas)===null||_this$props$canvas===void 0?void 0:_this$props$canvas.fitPoint(data.position);return;}const instance=this.props.getInstance(id);if(groupName){var _this$props$canvas2;if(shapeIds&&shapeIds.length){setSelectedShape(shapeIds[0],{instanceId:id,category:instance===null||instance===void 0?void 0:instance.category,groupName});}else{selectGroup(id,groupName);}(_this$props$canvas2=this.props.canvas)===null||_this$props$canvas2===void 0?void 0:_this$props$canvas2.fitSelected(id);}};this.warningMoreHandleAction=(key,warning)=>{if(key===ReviewResult.REJECT)return;const{frames,id,groupName,shapeIds}=warning;const currentReview={instanceId:id,groupName:groupName,frameIndex:frames[0],shapeIds:shapeIds,result:ReviewResult.REJECT};if(key==='delete'){rootStore.review.deleteReviewByInstance(currentReview);}else{rootStore.review.setReview({result:key},currentReview);}};}getCategoryByWarning(warning){const{id,groupName,shapeIds,frames}=warning;const instance=this.props.getInstance(id);const ontologyItem=rootStore.ontology.getOntologyInfo(instance===null||instance===void 0?void 0:instance.category);const groupItem=ontologyItem&&ontologyItem.children&&ontologyItem.children.find(group=>group.name===groupName);return ontologyItem&&instance?\"\".concat(formatMessage('VALIDATION_FRAME',{values:{frameIndex:frames[0]+1}}),\"\\n      \").concat(ontologyItem.display_name||ontologyItem.class_name||'',\" \").concat(instance.number,\"\\n      \").concat(groupItem?\"- \".concat(groupItem.display_name||groupItem.name):'',\"\\n      \").concat(shapeIds&&shapeIds.length&&typeof shapeIds[0]==='number'?\"[\".concat(shapeIds.join(','),\"]\"):''):'';}renderWarningTitle(warning){var _rootStore$ontology$g;const{id}=warning;const category=this.getCategoryByWarning(warning);if(!category){return formatMessage('VALIDATION_NO_INSTANCE');}const instance=this.props.getInstance(id);return/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(\"div\",{className:\"cat-color-dot\",style:{backgroundColor:(_rootStore$ontology$g=rootStore.ontology.getOntologyInfo(instance.category))===null||_rootStore$ontology$g===void 0?void 0:_rootStore$ontology$g.display_color}}),category);}render(){const ValidationTypeTitle={[ValidationType.QUALITY]:formatMessage('VALIDATION_TYPE_QUALITY')};return/*#__PURE__*/React.createElement(CommonValidator,{isEnabled:rootStore.review.isEnabled,validationTypes:ValidationTypeTitle,warnings:this.props.warnings,errors:rootStore.review.errors,containerWidth:\"286px\",titleFormatter:count=>formatMessage('VALIDATION_TITLE',{values:{count}}),checkingMsgFormatter:()=>formatMessage('VALIDATION_CHECKING'),renderWarningTitle:warning=>this.renderWarningTitle(warning),showWarningAction:warning=>!!this.getCategoryByWarning(warning),onWarningAction:warning=>this.handleAction(warning),onMoreHandleAction:this.warningMoreHandleAction,formatMessage:formatMessage});}})||_class;export default Validator;","map":{"version":3,"names":["React","observer","CommonValidator","formatMessage","rootStore","ValidationType","ReviewResult","Validator","_class","Component","constructor","arguments","handleAction","warning","setFrame","setSelectedShape","selectGroup","props","id","groupName","shapeIds","data","frames","position","_this$props$canvas","missingReview","review","missingReviews","find","r","setSelectedMissingReview","canvas","fitPoint","instance","getInstance","_this$props$canvas2","length","instanceId","category","fitSelected","warningMoreHandleAction","key","REJECT","currentReview","frameIndex","result","deleteReviewByInstance","setReview","getCategoryByWarning","ontologyItem","ontology","getOntologyInfo","groupItem","children","group","name","concat","values","display_name","class_name","number","join","renderWarningTitle","_rootStore$ontology$g","createElement","Fragment","className","style","backgroundColor","display_color","render","ValidationTypeTitle","QUALITY","isEnabled","validationTypes","warnings","errors","containerWidth","titleFormatter","count","checkingMsgFormatter","showWarningAction","onWarningAction","onMoreHandleAction"],"sources":["/Users/qzheng/Documents/webroot/annotation_tools/src/components/keypoint/components/Validator.tsx"],"sourcesContent":["import React from 'react';\nimport { observer } from 'mobx-react';\nimport CommonValidator, { IWarning } from '../../common/tabs-menu/Validator';\nimport formatMessage from '../locales';\nimport JobProxy from '../../../libs/JobProxy';\nimport rootStore from '../store/RootStore';\nimport { InstanceAct, ValidationType, Group, ReviewResult, Review } from '../types';\nimport './Validator.scss';\nimport Canvas from './Canvas';\n\ninterface ValidatorProps {\n  canvas: Canvas | null;\n  containerWidth?: number | string;\n  containerHeight?: number | string;\n  instances: {[instanceId: string]: InstanceAct};\n  jobProxy: JobProxy;\n  warnings: IWarning[];\n  setFrame: (frame: number) => void;\n  setSelectedShape: (id: number | string, groupData?: Group) => void;\n  selectGroup: (id: string, groupName: string) => void;\n  getInstance: (instanceID: string) => InstanceAct;\n  saveResult: () => Promise<string>;\n}\n\n@observer\nclass Validator extends React.Component<ValidatorProps> {\n  getCategoryByWarning(warning: IWarning) {\n    const { id, groupName, shapeIds, frames } = warning;\n    const instance = this.props.getInstance(id);\n    const ontologyItem = rootStore.ontology.getOntologyInfo(instance?.category);\n    const groupItem = ontologyItem && ontologyItem.children && ontologyItem.children.find((group) => group.name === groupName);\n    return ontologyItem && instance ?\n      `${formatMessage('VALIDATION_FRAME', {\n        values: { frameIndex: frames[0] + 1 }\n      })}\n      ${ontologyItem.display_name || ontologyItem.class_name || ''} ${instance.number}\n      ${groupItem ? `- ${groupItem.display_name || groupItem.name}` : ''}\n      ${shapeIds && shapeIds.length && (typeof shapeIds[0] === 'number') ? `[${shapeIds.join(',')}]` : ''}` :\n      '';\n  }\n\n  handleAction = (warning: IWarning) => {\n    const { setFrame, setSelectedShape, selectGroup } = this.props;\n    const { id, groupName, shapeIds, data, frames } = warning;\n    setFrame(frames[0]);\n    if (data?.position) {\n      const missingReview = rootStore.review.missingReviews.find((r) => r.id === id);\n      if (missingReview) {\n        rootStore.review.setSelectedMissingReview(missingReview);\n      }\n      this.props.canvas?.fitPoint(data.position);\n      return;\n    }\n    const instance = this.props.getInstance(id);\n    if (groupName) {\n      if (shapeIds && shapeIds.length) {\n        setSelectedShape(shapeIds[0], {\n          instanceId: id,\n          category: instance?.category,\n          groupName\n        });\n      } else {\n        selectGroup(id, groupName);\n      }\n      this.props.canvas?.fitSelected(id);\n    }\n  };\n\n  renderWarningTitle(warning: IWarning) {\n    const { id } = warning;\n    const category = this.getCategoryByWarning(warning);\n    if (!category) {\n      return formatMessage('VALIDATION_NO_INSTANCE');\n    }\n    const instance = this.props.getInstance(id);\n    return (\n      <>\n        <div\n          className=\"cat-color-dot\"\n          style={{ backgroundColor: rootStore.ontology.getOntologyInfo(instance.category)?.display_color }}\n        />\n        {category}\n      </>\n    );\n  }\n\n  warningMoreHandleAction = (key: string, warning: IWarning) => {\n    if (key === ReviewResult.REJECT) return;\n    const { frames, id, groupName, shapeIds } = warning;\n    const currentReview: Review = {\n      instanceId: id,\n      groupName: groupName as string,\n      frameIndex: frames[0],\n      shapeIds: shapeIds!,\n      result: ReviewResult.REJECT\n    };\n    if (key === 'delete') {\n      rootStore.review.deleteReviewByInstance(currentReview);\n    } else {\n      rootStore.review.setReview(\n        { result: key as ReviewResult },\n        currentReview\n      );\n    }\n  };\n\n  render() {\n    const ValidationTypeTitle = {\n      [ValidationType.QUALITY]: formatMessage('VALIDATION_TYPE_QUALITY'),\n    };\n    return (\n      <CommonValidator\n        isEnabled={rootStore.review.isEnabled}\n        validationTypes={ValidationTypeTitle}\n        warnings={this.props.warnings}\n        errors={rootStore.review.errors}\n        containerWidth=\"286px\"\n        titleFormatter={(count) => formatMessage('VALIDATION_TITLE', { values: { count } })}\n        checkingMsgFormatter={() => formatMessage('VALIDATION_CHECKING')}\n        renderWarningTitle={(warning) => this.renderWarningTitle(warning as IWarning)}\n        showWarningAction={(warning) => !!this.getCategoryByWarning(warning)}\n        onWarningAction={(warning) => this.handleAction(warning as IWarning)}\n        onMoreHandleAction={this.warningMoreHandleAction}\n        formatMessage={formatMessage}\n      />\n    );\n  }\n}\n\nexport default Validator;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}