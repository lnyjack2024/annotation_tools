{"ast":null,"code":"import React,{useEffect,useState}from'react';import{observer}from'mobx-react';import{Button,Form,message}from'antd';import{ImageTextField}from'@appen-china/easy-form';import Modal from'../../../common/modal/Modal';import ImagePreview from'../../../common/modal/ImagePreview';import formatMessage from'../../locales';import rootStore from'../../store/RootStore';import'./index.scss';const QualityControl=_ref=>{let{readonly,jobProxy}=_ref;const[form]=Form.useForm();const[previewImg,setPreviewImg]=useState('');const{selectedMissingReview,selectedMissingReviewModalVisible}=rootStore.review;useEffect(()=>{form.resetFields();},[selectedMissingReview]);const handleValues=async()=>{if(rootStore.review.isEnabled&&!rootStore.review.drawMode){const results=await form.validateFields();if(!results.errorFields){rootStore.review.updateMissingReview({...selectedMissingReview,...results});message.success(formatMessage('QC_SET_REJECT'));}}rootStore.review.closeMissingReviewModal();};/**\n  * save file\n  * @param file\n  */const saveFile=file=>jobProxy.saveFile(file);if(!selectedMissingReview){return null;}return/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(Modal,{visible:selectedMissingReviewModalVisible,draggable:true,closable:false,dragId:\"keypoint-qa-form\",maskClosable:true,title:formatMessage('QC_MODAL_TITLE'),onClose:handleValues},/*#__PURE__*/React.createElement(\"div\",{className:\"qa-form\"},/*#__PURE__*/React.createElement(\"p\",null,\"\".concat(formatMessage('VALIDATION_FRAME',{values:{frameIndex:selectedMissingReview.frameIndex+1}}),\"Missing\").concat(selectedMissingReview.number,\"-Dot\")),!readonly?/*#__PURE__*/React.createElement(Form,{form:form,size:\"small\",layout:\"vertical\",initialValues:{comment:selectedMissingReview.comment}},/*#__PURE__*/React.createElement(Form.Item,{name:\"comment\"},/*#__PURE__*/React.createElement(ImageTextField,{uploader:saveFile})),/*#__PURE__*/React.createElement(Button,{onClick:()=>{rootStore.review.deleteMissingReview(selectedMissingReview);}},formatMessage('QC_DELETE')),/*#__PURE__*/React.createElement(Button,{style:{marginLeft:'10px'},onClick:handleValues},formatMessage('QC_SAVE'))):/*#__PURE__*/React.createElement(\"div\",{style:{marginTop:16}},/*#__PURE__*/React.createElement(\"div\",null,formatMessage('QC_COMMENT_LABEL')),/*#__PURE__*/React.createElement(\"div\",{style:{color:'rgba(255, 255, 255, 0.6)'},className:\"img-container\",onClick:e=>{if(e.target.tagName==='IMG'){setPreviewImg(e.target.src);}}// eslint-disable-next-line react/no-danger\n,dangerouslySetInnerHTML:{__html:selectedMissingReview.comment||''}})))),previewImg&&/*#__PURE__*/React.createElement(ImagePreview,{src:previewImg,maskClosable:true,onClose:()=>setPreviewImg('')}));};export default observer(QualityControl);","map":{"version":3,"names":["React","useEffect","useState","observer","Button","Form","message","ImageTextField","Modal","ImagePreview","formatMessage","rootStore","QualityControl","_ref","readonly","jobProxy","form","useForm","previewImg","setPreviewImg","selectedMissingReview","selectedMissingReviewModalVisible","review","resetFields","handleValues","isEnabled","drawMode","results","validateFields","errorFields","updateMissingReview","success","closeMissingReviewModal","saveFile","file","createElement","Fragment","visible","draggable","closable","dragId","maskClosable","title","onClose","className","concat","values","frameIndex","number","size","layout","initialValues","comment","Item","name","uploader","onClick","deleteMissingReview","style","marginLeft","marginTop","color","e","target","tagName","src","dangerouslySetInnerHTML","__html"],"sources":["/Users/qzheng/Documents/webroot/annotation_tools/src/components/keypoint/components/QualityControl/Missing.tsx"],"sourcesContent":["import React, { useEffect, useState } from 'react';\nimport { observer } from 'mobx-react';\nimport { Button, Form, message } from 'antd';\nimport { ImageTextField } from '@appen-china/easy-form';\nimport Modal from '../../../common/modal/Modal';\nimport ImagePreview from '../../../common/modal/ImagePreview';\nimport formatMessage from '../../locales';\nimport rootStore from '../../store/RootStore';\nimport JobProxy from '../../../../libs/JobProxy';\nimport './index.scss';\n\ninterface QualityControlProps {\n  readonly: boolean;\n  jobProxy: JobProxy;\n}\n\nconst QualityControl = ({\n  readonly,\n  jobProxy,\n}: QualityControlProps) => {\n  const [form] = Form.useForm();\n  const [previewImg, setPreviewImg] = useState<string>('');\n  const { selectedMissingReview, selectedMissingReviewModalVisible } = rootStore.review;\n\n  useEffect(() => {\n    form.resetFields();\n  }, [selectedMissingReview]);\n\n  const handleValues = async () => {\n    if (rootStore.review.isEnabled && !rootStore.review.drawMode) {\n      const results = await form.validateFields();\n      if (!results.errorFields) {\n        rootStore.review.updateMissingReview({\n          ...selectedMissingReview,\n          ...results,\n        });\n        message.success(formatMessage('QC_SET_REJECT'));\n      }\n    }\n    rootStore.review.closeMissingReviewModal();\n  };\n\n  /**\n  * save file\n  * @param file\n  */\n  const saveFile = (file: File) => jobProxy.saveFile(file);\n\n  if (!selectedMissingReview) {\n    return null;\n  }\n\n  return (\n    <>\n      <Modal\n        visible={selectedMissingReviewModalVisible}\n        draggable\n        closable={false}\n        dragId=\"keypoint-qa-form\"\n        maskClosable\n        title={formatMessage('QC_MODAL_TITLE')}\n        onClose={handleValues}\n      >\n        <div className=\"qa-form\">\n          <p>{`${formatMessage('VALIDATION_FRAME', { values: { frameIndex: selectedMissingReview.frameIndex + 1 } })}Missing${selectedMissingReview.number}-Dot`}</p>\n          {!readonly ? (\n            <Form\n              form={form}\n              size=\"small\"\n              layout=\"vertical\"\n              initialValues={{\n                comment: selectedMissingReview.comment\n              }}\n            >\n              <Form.Item name=\"comment\">\n                <ImageTextField uploader={saveFile} />\n              </Form.Item>\n              <Button\n                onClick={() => {\n                  rootStore.review.deleteMissingReview(selectedMissingReview);\n                }}\n              >\n                {formatMessage('QC_DELETE')}\n              </Button>\n              <Button\n                style={{ marginLeft: '10px' }}\n                onClick={handleValues}\n              >\n                {formatMessage('QC_SAVE')}\n              </Button>\n            </Form>\n          ) : (\n            <div style={{ marginTop: 16 }}>\n              <div>{formatMessage('QC_COMMENT_LABEL')}</div>\n              <div\n                style={{ color: 'rgba(255, 255, 255, 0.6)' }}\n                className=\"img-container\"\n                onClick={(e) => {\n                  if ((e.target as HTMLElement).tagName === 'IMG') {\n                    setPreviewImg((e.target as HTMLImageElement).src);\n                  }\n                }}\n                // eslint-disable-next-line react/no-danger\n                dangerouslySetInnerHTML={{ __html: selectedMissingReview.comment || '' }}\n              />\n            </div>\n          )}\n        </div>\n\n      </Modal>\n      {previewImg && <ImagePreview src={previewImg} maskClosable onClose={() => setPreviewImg('')} />}\n    </>\n  );\n};\n\nexport default observer(QualityControl);\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}