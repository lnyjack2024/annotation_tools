{"ast":null,"code":"var _jsxFileName = \"/Users/qzheng/Documents/webroot/annotation_tools/src/components/advertisement-annotation/index.jsx\";\nimport React, { forwardRef, useEffect, useImperativeHandle, useRef, useState } from 'react';\nimport screenfull from 'screenfull';\nimport { Base64 } from 'js-base64';\nimport { notification } from 'antd';\nimport AnnotationForm, { FPS } from './AnnotationForm';\nimport AnnotationCanvas, { getDeltaTime } from './AnnotationCanvas';\nimport AnnotationResults from './AnnotationResults';\nimport { randomColor, simpleClone } from './util';\nimport Fullscreen from '../common/icons/Fullscreen';\nimport Save from '../common/icons/Save';\nimport { isPreview } from '../../utils/tool-mode';\nnotification.config({\n  top: 60,\n  getContainer: () => document.getElementById('root')\n});\nconst useStateCb = function (init) {\n  const cbRef = useRef();\n  const [value, setValue] = useState(init);\n  useEffect(() => {\n    if (cbRef.current) cbRef.current(value);\n  }, [value]);\n  function setValueCb(val, cb) {\n    cbRef.current = cb;\n    setValue(val);\n  }\n  return {\n    value,\n    setValueCb\n  };\n};\nconst AdvertisementAnnotationApp = forwardRef((props, ref) => {\n  const [duration, setDuration] = useState();\n  const [currentIndex, setCurrentIndex] = useState();\n  const {\n    value: results,\n    setValueCb: setResults\n  } = useStateCb([]);\n  const {\n    value: advertisementName,\n    setValueCb: setAdvertisementName\n  } = useStateCb([]);\n  const [currentMode, setCurrentMode] = useState('edit');\n  const [currentTime, setCurrentTime] = useState(10);\n  const [playBackRate, setPlayBackRate] = useState(1);\n  const [advertisementType, setAdvertisementType] = useState([]);\n  const canvasRef = useRef();\n  const advertisementNameMap = useRef(new Map());\n  let clk = null;\n  const toolName = 'advertisement-annotation';\n  useImperativeHandle(ref, () => ({\n    onSubmit\n  }));\n  const playVideo = function (record) {\n    const {\n      current\n    } = canvasRef;\n    if (current && current.video) {\n      current.video.play();\n      if (!record) return;\n      if (record.start != null) current.video.currentTime = record.start;else current.video.currentTime = 0;\n      if (clk) clearInterval(clk);\n      clk = setInterval(() => {\n        if ((record.start || 0) > currentTime || (record.end || duration) <= currentTime) {\n          current.video.pause();\n          clearInterval(clk);\n        }\n      }, 1000 / FPS);\n    }\n  };\n  useEffect(() => {\n    const event = e => handleKeyDown(e);\n    document.addEventListener('keydown', event);\n    return () => {\n      document.removeEventListener('keydown', event);\n    };\n  }, [currentTime]);\n  useEffect(() => {\n    props.jobProxy.loadResult().then(async res => {\n      const results = (res === null || res === void 0 ? void 0 : res.results) || [];\n      const labelConfigString = Base64.decode(props.label_config);\n      const labelConfig = JSON.parse(labelConfigString);\n      // TODO: label config validation\n      advertisementNameMap.current = new Map();\n      setResults(results);\n      setAdvertisementName(labelConfig.advertisementName);\n      setAdvertisementType(labelConfig.advertisementType);\n      labelConfig.advertisementName.forEach(item => {\n        advertisementNameMap.current.set(item.value, item.color);\n      });\n    }).catch(e => {\n      console.log(e);\n    });\n    setInterval(() => {\n      const {\n        current\n      } = canvasRef;\n      if (!(current === null || current === void 0 ? void 0 : current.video)) return;\n      const timeNow = parseFloat(current.video.currentTime.toFixed(3));\n      setCurrentTime(timeNow);\n      if (duration == null) setDuration(current.video.duration);\n    }, 1000 / FPS);\n  }, []);\n  const onSave = async () => {\n    if (isPreview(props.jobProxy.toolMode)) {\n      return;\n    }\n    validateResults(results);\n    await props.jobProxy.saveResult({\n      results\n    });\n    notification.success({\n      message: '保存成功'\n    });\n  };\n  const onSubmit = function () {\n    validateResults(results, true);\n    return props.jobProxy.saveResult({\n      results\n      // advertisementName,\n      // advertisementType,\n    }, true);\n  };\n  const validateResults = (results, isSubmit = false) => {\n    const isTypeValid = type => Array.isArray(type) && type.length > 0;\n    const isPositionValid = position => Array.isArray(position) && position.length > 0;\n    const isTimeValid = time => time !== null && time >= 0;\n    const errorIds = {};\n    results.forEach(result => {\n      const errors = [];\n      if (!result.name) {\n        errors.push('识别结果');\n      }\n      if (!isTimeValid(result.start)) {\n        errors.push('开始时间');\n      }\n      if (!isTimeValid(result.end)) {\n        errors.push('结束时间');\n      }\n      if (!isTypeValid(result.type)) {\n        errors.push('广告形式');\n      }\n      if (!isPositionValid(result.position)) {\n        errors.push('标记框位置');\n      }\n      if (!result.snapshot) {\n        errors.push('缺少截图，请手动点击生成');\n      }\n      if (errors.length > 0) {\n        errorIds[result.key] = errors;\n      }\n    });\n    if (Object.keys(errorIds).length > 0) {\n      const errMsg = Object.keys(errorIds).map(k => `ID: ${k} 缺: ${errorIds[k].join(', ')}`).join('; ');\n      if (isSubmit) {\n        notification.error({\n          message: '属性不全',\n          description: errMsg\n        });\n        throw new Error(`请补全属性值再提交 ID: ${Object.keys(errorIds)}`);\n      } else {\n        notification.warn({\n          message: '属性不全',\n          description: errMsg\n        });\n      }\n    }\n  };\n  const setCurrentPlayBackRate = function (rate) {\n    const {\n      current\n    } = canvasRef;\n    if (current && current.video) {\n      current.video.playbackRate = rate;\n      setPlayBackRate(rate);\n    }\n  };\n  function pauseVideo() {\n    const {\n      current\n    } = canvasRef;\n    if (current && current.video && !current.video.paused) current.video.pause();\n  }\n  function seekVideo(targetTime = 0) {\n    const {\n      current\n    } = canvasRef;\n    if (current && current.video && targetTime >= 0 && targetTime <= duration) {\n      current.video.currentTime = targetTime;\n    }\n  }\n  function getResult(index) {\n    return results.find(r => r.key === index);\n  }\n  const handleKeyDown = e => {\n    const {\n      current\n    } = canvasRef;\n    const {\n      ctrlKey\n    } = e;\n    // except return key\n    if (window.disableAdvertisementHotKeys && e.keyCode !== 13) {\n      return;\n    }\n    switch (e.keyCode) {\n      case 32:\n        e.preventDefault();\n        e.stopPropagation();\n        if (currentMode !== 'edit') break;\n        if (current.video.paused) playVideo();else pauseVideo();\n        break;\n      case 70:\n        e.preventDefault();\n        if (e.target.tagName.toUpperCase() === 'INPUT') break;\n        if (!ctrlKey) break;\n        // eslint-disable-next-line no-case-declarations\n        fullScreen();\n        break;\n      case 37:\n        // left arrow\n        if (e.target.tagName.toUpperCase() === 'INPUT') break;\n        if (current && current.video) current.video.currentTime = currentTime - 1;\n        break;\n      case 39:\n        // right arrow\n        if (e.target.tagName.toUpperCase() === 'INPUT') break;\n        if (current && current.video) current.video.currentTime = currentTime + 1;\n        break;\n      case 73:\n        if (e.target.tagName.toUpperCase() === 'INPUT') break;\n        e.preventDefault();\n        if (currentMode === 'edit') {\n          if (currentIndex == null) return;\n          const item = getResult(currentIndex);\n          if (item.start != null && item.start > currentTime + getDeltaTime(playBackRate)) break;\n          if (item.end != null && item.end < currentTime - getDeltaTime(playBackRate)) break;\n          pauseVideo();\n          enableSVG(currentIndex);\n        } else {\n          disableSVG();\n        }\n        break;\n      case 13:\n        // enter\n        if (e.target.tagName.toUpperCase() === 'INPUT') {\n          e.preventDefault();\n          e.target.blur();\n        }\n        break;\n      default:\n        break;\n    }\n    return false;\n  };\n  const addAdvertisementName = function (name) {\n    const advertisementNameCopy = simpleClone(advertisementName);\n    return new Promise(resolve => {\n      const color = randomColor();\n      advertisementNameCopy.unshift({\n        value: name,\n        label: name,\n        color\n      });\n      advertisementNameMap.current.set(name, color);\n      setAdvertisementName(advertisementNameCopy, () => {\n        resolve('updateAdvertisementName');\n      });\n    }).then(() => {\n      // onSubmit();\n    });\n  };\n  const handleResultsChange = function (newResult) {\n    return new Promise(resolve => {\n      setResults(newResult, () => {\n        resolve('updateResult');\n      });\n    }).then(() => {\n      // onSubmit();\n    });\n  };\n  const enableSVG = function (index) {\n    setCurrentIndex(index);\n    setCurrentMode('paint');\n  };\n  const disableSVG = function () {\n    setCurrentMode('edit');\n  };\n\n  // const setSelectedIndex = (function (index) {\n  //   if (index >= 0 && index < results.length) setCurrentIndex(index);\n  //   else setCurrentIndex(null);\n  // });\n\n  const fullScreen = () => {\n    const elem = document.getElementById('root');\n    if (screenfull && !screenfull.isFullscreen) screenfull.request(elem);else if (screenfull && screenfull.isFullscreen) screenfull.toggle();\n  };\n  const focusItemInRightSide = key => {\n    const cardContainer = document.getElementsByClassName('annotation-form-container');\n    const cards = document.getElementsByClassName(`annotation-form-card-${key}`);\n    if (cardContainer.length > 0 && cards.length > 0) {\n      const {\n        top: cTop,\n        bottom: cBottom\n      } = cardContainer[0].getBoundingClientRect();\n      const {\n        top: eTop,\n        bottom: eBottom\n      } = cards[0].getBoundingClientRect();\n      if (eTop < cTop || eTop > cBottom) {\n        cardContainer[0].scrollBy({\n          top: eTop - cTop\n        });\n      }\n    }\n  };\n  return /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"advertisement-annotation-app-topbar\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 305,\n      columnNumber: 7\n    }\n  }, \"Appen Ads Annotation Tool\", /*#__PURE__*/React.createElement(\"div\", {\n    className: \"advertisement-annotation-app-topbar-btn\",\n    onClick: onSave,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 307,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(Save, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 308,\n      columnNumber: 11\n    }\n  })), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"advertisement-annotation-app-topbar-btn\",\n    onClick: fullScreen,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 310,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(Fullscreen, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 311,\n      columnNumber: 11\n    }\n  }))), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"advertisement-annotation-app-container\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 315,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"paint-mode-mask\",\n    style: {\n      visibility: currentMode === 'edit' ? 'hidden' : 'visible'\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 316,\n      columnNumber: 9\n    }\n  }), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"vertical-wrapper\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 317,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(AnnotationCanvas, {\n    ref: canvasRef,\n    currentTime: currentTime,\n    currentIndex: currentIndex,\n    currentMode: currentMode,\n    results: results,\n    video: props.video,\n    advertisementName: advertisementName,\n    currentPlayBackRate: playBackRate,\n    setCurrentIndex: setCurrentIndex,\n    toolMode: props.jobProxy.toolMode,\n    toolMode: props.jobProxy.toolMode,\n    jobId: props.jobProxy.jobId,\n    taskId: props.jobProxy.taskId,\n    recordId: props.jobProxy.recordId,\n    advertisementNameMap: advertisementNameMap.current,\n    handleResultsChange: handleResultsChange,\n    focusItemInRightSide: focusItemInRightSide,\n    saveContent: props.saveContent,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 318,\n      columnNumber: 11\n    }\n  }), /*#__PURE__*/React.createElement(AnnotationResults, {\n    results: results,\n    issueTypes: props.issue_types,\n    playVideo: playVideo,\n    advertisementName: advertisementName,\n    advertisementType: advertisementType,\n    advertisementNameMap: advertisementNameMap.current,\n    setCurrentIndex: setCurrentIndex,\n    currentIndex: currentIndex,\n    toolMode: props.jobProxy.toolMode,\n    canvas: canvasRef.current,\n    handleResultsChange: handleResultsChange,\n    focusItemInRightSide: focusItemInRightSide,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 338,\n      columnNumber: 11\n    }\n  })), /*#__PURE__*/React.createElement(AnnotationForm, {\n    canvas: canvasRef.current,\n    duration: duration,\n    currentTime: currentTime,\n    currentMode: currentMode,\n    currentIndex: currentIndex,\n    toolMode: props.jobProxy.toolMode,\n    advertisementName: advertisementName,\n    advertisementType: advertisementType,\n    advertisementNameMap: advertisementNameMap.current,\n    currentPlayBackRate: playBackRate,\n    results: results,\n    handleResultsChange: handleResultsChange,\n    setCurrentPlayBackRate: setCurrentPlayBackRate,\n    enableSVG: enableSVG,\n    disableSVG: disableSVG,\n    setCurrentIndex: setCurrentIndex,\n    addAdvertisementName: addAdvertisementName,\n    onSubmit: onSubmit,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 353,\n      columnNumber: 9\n    }\n  })));\n});\nexport default AdvertisementAnnotationApp;","map":{"version":3,"names":["React","forwardRef","useEffect","useImperativeHandle","useRef","useState","screenfull","Base64","notification","AnnotationForm","FPS","AnnotationCanvas","getDeltaTime","AnnotationResults","randomColor","simpleClone","Fullscreen","Save","isPreview","config","top","getContainer","document","getElementById","useStateCb","init","cbRef","value","setValue","current","setValueCb","val","cb","AdvertisementAnnotationApp","props","ref","duration","setDuration","currentIndex","setCurrentIndex","results","setResults","advertisementName","setAdvertisementName","currentMode","setCurrentMode","currentTime","setCurrentTime","playBackRate","setPlayBackRate","advertisementType","setAdvertisementType","canvasRef","advertisementNameMap","Map","clk","toolName","onSubmit","playVideo","record","video","play","start","clearInterval","setInterval","end","pause","event","e","handleKeyDown","addEventListener","removeEventListener","jobProxy","loadResult","then","res","labelConfigString","decode","label_config","labelConfig","JSON","parse","forEach","item","set","color","catch","console","log","timeNow","parseFloat","toFixed","onSave","toolMode","validateResults","saveResult","success","message","isSubmit","isTypeValid","type","Array","isArray","length","isPositionValid","position","isTimeValid","time","errorIds","result","errors","name","push","snapshot","key","Object","keys","errMsg","map","k","join","error","description","Error","warn","setCurrentPlayBackRate","rate","playbackRate","pauseVideo","paused","seekVideo","targetTime","getResult","index","find","r","ctrlKey","window","disableAdvertisementHotKeys","keyCode","preventDefault","stopPropagation","target","tagName","toUpperCase","fullScreen","enableSVG","disableSVG","blur","addAdvertisementName","advertisementNameCopy","Promise","resolve","unshift","label","handleResultsChange","newResult","elem","isFullscreen","request","toggle","focusItemInRightSide","cardContainer","getElementsByClassName","cards","cTop","bottom","cBottom","getBoundingClientRect","eTop","eBottom","scrollBy","createElement","Fragment","className","__self","__source","fileName","_jsxFileName","lineNumber","columnNumber","onClick","style","visibility","currentPlayBackRate","jobId","taskId","recordId","saveContent","issueTypes","issue_types","canvas"],"sources":["/Users/qzheng/Documents/webroot/annotation_tools/src/components/advertisement-annotation/index.jsx"],"sourcesContent":["import React, { forwardRef, useEffect, useImperativeHandle, useRef, useState } from 'react';\nimport screenfull from 'screenfull';\nimport { Base64 } from 'js-base64';\nimport { notification } from 'antd';\nimport AnnotationForm, { FPS } from './AnnotationForm';\nimport AnnotationCanvas, { getDeltaTime } from './AnnotationCanvas';\nimport AnnotationResults from './AnnotationResults';\nimport { randomColor, simpleClone } from './util';\nimport Fullscreen from '../common/icons/Fullscreen';\nimport Save from '../common/icons/Save';\nimport { isPreview } from '../../utils/tool-mode';\n\nnotification.config({ top: 60, getContainer: () => document.getElementById('root') });\n\nconst useStateCb = function (init) {\n  const cbRef = useRef();\n  const [value, setValue] = useState(init);\n\n  useEffect(() => {\n    if (cbRef.current) cbRef.current(value);\n  }, [value]);\n\n  function setValueCb(val, cb) {\n    cbRef.current = cb;\n    setValue(val);\n  }\n\n  return { value, setValueCb };\n};\n\nconst AdvertisementAnnotationApp = forwardRef((props, ref) => {\n  const [duration, setDuration] = useState();\n  const [currentIndex, setCurrentIndex] = useState();\n  const { value: results, setValueCb: setResults } = useStateCb([]);\n  const { value: advertisementName, setValueCb: setAdvertisementName } = useStateCb([]);\n  const [currentMode, setCurrentMode] = useState('edit');\n  const [currentTime, setCurrentTime] = useState(10);\n  const [playBackRate, setPlayBackRate] = useState(1);\n  const [advertisementType, setAdvertisementType] = useState([]);\n  const canvasRef = useRef();\n  const advertisementNameMap = useRef(new Map());\n  let clk = null;\n  const toolName = 'advertisement-annotation';\n\n  useImperativeHandle(ref, () => ({\n    onSubmit,\n  }));\n\n  const playVideo = (function (record) {\n    const { current } = canvasRef;\n    if (current && current.video) {\n      current.video.play();\n      if (!record) return;\n      if (record.start != null) current.video.currentTime = record.start;\n      else current.video.currentTime = 0;\n      if (clk) clearInterval(clk);\n      clk = setInterval(() => {\n        if ((record.start || 0) > currentTime || (record.end || duration) <= currentTime) {\n          current.video.pause();\n          clearInterval(clk);\n        }\n      }, 1000 / FPS);\n    }\n  });\n\n  useEffect(() => {\n    const event = (e) => handleKeyDown(e);\n    document.addEventListener('keydown', event);\n    return () => {\n      document.removeEventListener('keydown', event);\n    };\n  }, [currentTime]);\n\n  useEffect(() => {\n    props.jobProxy.loadResult().then(async (res) => {\n      const results = res?.results || [];\n      const labelConfigString = Base64.decode(props.label_config);\n      const labelConfig = JSON.parse(labelConfigString);\n      // TODO: label config validation\n      advertisementNameMap.current = new Map();\n      setResults(results);\n      setAdvertisementName(labelConfig.advertisementName);\n      setAdvertisementType(labelConfig.advertisementType);\n      labelConfig.advertisementName.forEach((item) => {\n        advertisementNameMap.current.set(item.value, item.color);\n      });\n    }).catch((e) => {\n      console.log(e);\n    });\n\n    setInterval(() => {\n      const { current } = canvasRef;\n      if (!current?.video) return;\n      const timeNow = parseFloat(current.video.currentTime.toFixed(3));\n      setCurrentTime(timeNow);\n      if (duration == null) setDuration(current.video.duration);\n    }, 1000 / FPS);\n  }, []);\n\n  const onSave = async () => {\n    if (isPreview(props.jobProxy.toolMode)) {\n      return;\n    }\n\n    validateResults(results);\n\n    await props.jobProxy.saveResult({\n      results,\n    });\n    notification.success({ message: '保存成功' });\n  };\n\n  const onSubmit = (function () {\n    validateResults(results, true);\n\n    return props.jobProxy.saveResult({\n      results,\n      // advertisementName,\n      // advertisementType,\n    }, true);\n  });\n\n  const validateResults = (results, isSubmit = false) => {\n    const isTypeValid = (type) => Array.isArray(type) && type.length > 0;\n\n    const isPositionValid = (position) => Array.isArray(position) && position.length > 0;\n\n    const isTimeValid = (time) => time !== null && time >= 0;\n\n    const errorIds = {};\n    results.forEach((result) => {\n      const errors = [];\n      if (!result.name) {\n        errors.push('识别结果');\n      }\n      if (!isTimeValid(result.start)) {\n        errors.push('开始时间');\n      }\n      if (!isTimeValid(result.end)) {\n        errors.push('结束时间');\n      }\n      if (!isTypeValid(result.type)) {\n        errors.push('广告形式');\n      }\n      if (!isPositionValid(result.position)) {\n        errors.push('标记框位置');\n      }\n      if (!result.snapshot) {\n        errors.push('缺少截图，请手动点击生成');\n      }\n      if (errors.length > 0) {\n        errorIds[result.key] = errors;\n      }\n    });\n    if (Object.keys(errorIds).length > 0) {\n      const errMsg = Object.keys(errorIds).map((k) => `ID: ${k} 缺: ${errorIds[k].join(', ')}`).join('; ');\n      if (isSubmit) {\n        notification.error({ message: '属性不全', description: errMsg });\n        throw new Error(`请补全属性值再提交 ID: ${Object.keys(errorIds)}`);\n      } else {\n        notification.warn({ message: '属性不全', description: errMsg });\n      }\n    }\n  };\n\n  const setCurrentPlayBackRate = (function (rate) {\n    const { current } = canvasRef;\n    if (current && current.video) {\n      current.video.playbackRate = rate;\n      setPlayBackRate(rate);\n    }\n  });\n\n  function pauseVideo() {\n    const { current } = canvasRef;\n    if (current && current.video && !current.video.paused) current.video.pause();\n  }\n\n  function seekVideo(targetTime = 0) {\n    const { current } = canvasRef;\n    if (current && current.video &&\n        targetTime >= 0 && targetTime <= duration) {\n      current.video.currentTime = targetTime;\n    }\n  }\n\n  function getResult(index) {\n    return results.find((r) => r.key === index);\n  }\n\n  const handleKeyDown = (e) => {\n    const { current } = canvasRef;\n    const { ctrlKey } = e;\n    // except return key\n    if (window.disableAdvertisementHotKeys && e.keyCode !== 13) {\n      return;\n    }\n    switch (e.keyCode) {\n      case 32:\n        e.preventDefault();\n        e.stopPropagation();\n        if (currentMode !== 'edit') break;\n        if (current.video.paused) playVideo();\n        else pauseVideo();\n        break;\n      case 70:\n        e.preventDefault();\n        if (e.target.tagName.toUpperCase() === 'INPUT') break;\n        if (!ctrlKey) break;\n        // eslint-disable-next-line no-case-declarations\n        fullScreen();\n        break;\n      case 37: // left arrow\n        if (e.target.tagName.toUpperCase() === 'INPUT') break;\n        if (current && current.video) current.video.currentTime = currentTime - 1;\n        break;\n      case 39: // right arrow\n        if (e.target.tagName.toUpperCase() === 'INPUT') break;\n        if (current && current.video) current.video.currentTime = currentTime + 1;\n        break;\n      case 73:\n        if (e.target.tagName.toUpperCase() === 'INPUT') break;\n        e.preventDefault();\n        if (currentMode === 'edit') {\n          if (currentIndex == null) return;\n          const item = getResult(currentIndex);\n          if (item.start != null && item.start > currentTime + getDeltaTime(playBackRate)) break;\n          if (item.end != null && item.end < currentTime - getDeltaTime(playBackRate)) break;\n          pauseVideo();\n          enableSVG(currentIndex);\n        } else {\n          disableSVG();\n        }\n        break;\n      case 13: // enter\n        if (e.target.tagName.toUpperCase() === 'INPUT') {\n          e.preventDefault();\n          e.target.blur();\n        }\n        break;\n      default:\n        break;\n    }\n    return false;\n  };\n\n  const addAdvertisementName = (function (name) {\n    const advertisementNameCopy = simpleClone(advertisementName);\n    return new Promise((resolve) => {\n      const color = randomColor();\n      advertisementNameCopy.unshift({ value: name, label: name, color });\n      advertisementNameMap.current.set(name, color);\n      setAdvertisementName(advertisementNameCopy, () => {\n        resolve('updateAdvertisementName');\n      });\n    }).then(() => {\n      // onSubmit();\n    });\n  });\n\n  const handleResultsChange = (function (newResult) {\n    return new Promise((resolve) => {\n      setResults(newResult, () => {\n        resolve('updateResult');\n      });\n    }).then(() => {\n      // onSubmit();\n    });\n  });\n\n  const enableSVG = (function (index) {\n    setCurrentIndex(index);\n    setCurrentMode('paint');\n  });\n\n  const disableSVG = (function () {\n    setCurrentMode('edit');\n  });\n\n  // const setSelectedIndex = (function (index) {\n  //   if (index >= 0 && index < results.length) setCurrentIndex(index);\n  //   else setCurrentIndex(null);\n  // });\n\n  const fullScreen = () => {\n    const elem = document.getElementById('root');\n    if (screenfull && !screenfull.isFullscreen) screenfull.request(elem);\n    else if (screenfull && screenfull.isFullscreen) screenfull.toggle();\n  };\n\n  const focusItemInRightSide = (key) => {\n    const cardContainer = document.getElementsByClassName('annotation-form-container');\n    const cards = document.getElementsByClassName(`annotation-form-card-${key}`);\n    if (cardContainer.length > 0 && cards.length > 0) {\n      const { top: cTop, bottom: cBottom } = cardContainer[0].getBoundingClientRect();\n      const { top: eTop, bottom: eBottom } = cards[0].getBoundingClientRect();\n      if (eTop < cTop || eTop > cBottom) {\n        cardContainer[0].scrollBy({ top: eTop - cTop });\n      }\n    }\n  };\n\n  return (\n    <>\n      <div className=\"advertisement-annotation-app-topbar\">\n        Appen Ads Annotation Tool\n        <div className=\"advertisement-annotation-app-topbar-btn\" onClick={onSave}>\n          <Save />\n        </div>\n        <div className=\"advertisement-annotation-app-topbar-btn\" onClick={fullScreen}>\n          <Fullscreen />\n        </div>\n        {/* <Fullscreen style={{ float: 'right', marginTop: '10px' }}/> */}\n      </div>\n      <div className=\"advertisement-annotation-app-container\">\n        <div className=\"paint-mode-mask\" style={{ visibility: currentMode === 'edit' ? 'hidden' : 'visible' }} />\n        <div className=\"vertical-wrapper\">\n          <AnnotationCanvas\n            ref={canvasRef}\n            currentTime={currentTime}\n            currentIndex={currentIndex}\n            currentMode={currentMode}\n            results={results}\n            video={props.video}\n            advertisementName={advertisementName}\n            currentPlayBackRate={playBackRate}\n            setCurrentIndex={setCurrentIndex}\n            toolMode={props.jobProxy.toolMode}\n            toolMode={props.jobProxy.toolMode}\n            jobId={props.jobProxy.jobId}\n            taskId={props.jobProxy.taskId}\n            recordId={props.jobProxy.recordId}\n            advertisementNameMap={advertisementNameMap.current}\n            handleResultsChange={handleResultsChange}\n            focusItemInRightSide={focusItemInRightSide}\n            saveContent={props.saveContent}\n          />\n          <AnnotationResults\n            results={results}\n            issueTypes={props.issue_types}\n            playVideo={playVideo}\n            advertisementName={advertisementName}\n            advertisementType={advertisementType}\n            advertisementNameMap={advertisementNameMap.current}\n            setCurrentIndex={setCurrentIndex}\n            currentIndex={currentIndex}\n            toolMode={props.jobProxy.toolMode}\n            canvas={canvasRef.current}\n            handleResultsChange={handleResultsChange}\n            focusItemInRightSide={focusItemInRightSide}\n          />\n        </div>\n        <AnnotationForm\n          canvas={canvasRef.current}\n          duration={duration}\n          currentTime={currentTime}\n          currentMode={currentMode}\n          currentIndex={currentIndex}\n          toolMode={props.jobProxy.toolMode}\n          advertisementName={advertisementName}\n          advertisementType={advertisementType}\n          advertisementNameMap={advertisementNameMap.current}\n          currentPlayBackRate={playBackRate}\n          results={results}\n          handleResultsChange={handleResultsChange}\n          setCurrentPlayBackRate={setCurrentPlayBackRate}\n          enableSVG={enableSVG}\n          disableSVG={disableSVG}\n          setCurrentIndex={setCurrentIndex}\n          addAdvertisementName={addAdvertisementName}\n          onSubmit={onSubmit}\n        />\n      </div>\n    </>\n  );\n});\n\nexport default AdvertisementAnnotationApp;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}