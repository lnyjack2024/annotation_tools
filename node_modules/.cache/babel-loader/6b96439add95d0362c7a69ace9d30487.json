{"ast":null,"code":"var _jsxFileName = \"/Users/qzheng/Documents/webroot/annotation_tools/src/components/video-tracking2/components/attributes/PointAttributesModal.tsx\";\nimport React from 'react';\nimport { observer } from 'mobx-react';\nimport { toJS } from 'mobx';\nimport { Button, ConfigProvider } from 'antd';\nimport EasyForm from '@appen-china/easy-form';\nimport Modal from '../../../common/modal/Modal';\nimport store from '../../store/RootStore';\nimport i18n from '../../locales';\nimport { setInitialValues } from '../../utils';\nimport './AttributesModal.scss';\nclass PointAttributesModal extends React.Component {\n  constructor(...args) {\n    super(...args);\n    /**\n     * form container\n     */\n    this.ref = React.createRef();\n    /**\n     * when instance values submit\n     * @param values\n     */\n    this.onFrameValuesSubmit = values => {\n      const {\n        selectedShapes,\n        selectedPointIndex\n      } = store.shape;\n      const selectedShape = selectedShapes[0];\n      store.shape.setPointUserData(selectedShape, selectedPointIndex, values);\n      store.config.setPointAttributesModalVisible(false);\n    };\n    /**\n     * submit button click\n     */\n    this.submit = () => {\n      var _this$ref$current;\n      const {\n        selectedShapes\n      } = store.shape;\n      const selectedShape = selectedShapes[0];\n      const {\n        instanceItem\n      } = store.shape.shapes[selectedShape.uid];\n      const frameData = instanceItem.cameras[store.frame.currentCamera].frames[store.frame.currentFrame];\n      if (!frameData.attrChangeAllowed) {\n        return;\n      }\n      const buttons = (_this$ref$current = this.ref.current) === null || _this$ref$current === void 0 ? void 0 : _this$ref$current.querySelectorAll('button.easyform-btn.form-btn-submit');\n      buttons === null || buttons === void 0 ? void 0 : buttons.forEach(btn => {\n        btn.click();\n      });\n    };\n  }\n  render() {\n    var _toJS$points$selected;\n    const {\n      pointAttributesModalVisible\n    } = store.config;\n    const {\n      selectedShapes,\n      selectedPointIndex,\n      config\n    } = store.shape;\n    if (!pointAttributesModalVisible || selectedShapes.length !== 1 || selectedPointIndex < 0) {\n      // no selected point\n      return null;\n    }\n    const selectedShape = selectedShapes[0];\n    const {\n      instanceItem\n    } = store.shape.shapes[selectedShape.uid];\n    const frameData = instanceItem.cameras[store.frame.currentCamera].frames[store.frame.currentFrame];\n    const {\n      pointLabelConfig\n    } = instanceItem.categoryItemRef;\n    if (!frameData || !pointLabelConfig) {\n      return null;\n    }\n    const pointUserData = ((_toJS$points$selected = toJS(frameData.shape).points[selectedPointIndex]) === null || _toJS$points$selected === void 0 ? void 0 : _toJS$points$selected.userData) || {};\n    const pointFields = setInitialValues(pointLabelConfig.fields, pointUserData);\n    if (!frameData.attrChangeAllowed) {\n      pointFields.forEach(field => {\n        field.readonly = true;\n      });\n    }\n    return /*#__PURE__*/React.createElement(Modal, {\n      visible: true,\n      draggable: true,\n      resizable: true,\n      closable: false,\n      defaultSize: {\n        w: 720,\n        h: 720\n      },\n      dragId: \"video-tracking-attributes\",\n      className: \"attributes-form\",\n      title: `${instanceItem.label} - ${i18n.translate('POINT_INDEX_LABEL', {\n        values: {\n          index: selectedPointIndex + config.vertexStart\n        }\n      })}`,\n      onClose: () => store.config.setPointAttributesModalVisible(false),\n      onMaskClick: this.submit,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 72,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      ref: this.ref,\n      className: \"attributes-form-content\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 84,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(EasyForm, {\n      theme: \"dark\",\n      fields: pointFields,\n      conditions: pointLabelConfig.conditions,\n      effects: pointLabelConfig.effects,\n      rules: pointLabelConfig.rules,\n      onSubmit: this.onFrameValuesSubmit,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 85,\n        columnNumber: 11\n      }\n    })), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"attributes-form-footer\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 94,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(ConfigProvider, {\n      prefixCls: \"easyform\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 95,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(Button, {\n      type: \"primary\",\n      onClick: this.submit,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 96,\n        columnNumber: 13\n      }\n    }, i18n.translate('COMMON_SUBMIT')))));\n  }\n}\nexport default observer(PointAttributesModal);","map":{"version":3,"names":["React","observer","toJS","Button","ConfigProvider","EasyForm","Modal","store","i18n","setInitialValues","PointAttributesModal","Component","constructor","args","ref","createRef","onFrameValuesSubmit","values","selectedShapes","selectedPointIndex","shape","selectedShape","setPointUserData","config","setPointAttributesModalVisible","submit","_this$ref$current","instanceItem","shapes","uid","frameData","cameras","frame","currentCamera","frames","currentFrame","attrChangeAllowed","buttons","current","querySelectorAll","forEach","btn","click","render","_toJS$points$selected","pointAttributesModalVisible","length","pointLabelConfig","categoryItemRef","pointUserData","points","userData","pointFields","fields","field","readonly","createElement","visible","draggable","resizable","closable","defaultSize","w","h","dragId","className","title","label","translate","index","vertexStart","onClose","onMaskClick","__self","__source","fileName","_jsxFileName","lineNumber","columnNumber","theme","conditions","effects","rules","onSubmit","prefixCls","type","onClick"],"sources":["/Users/qzheng/Documents/webroot/annotation_tools/src/components/video-tracking2/components/attributes/PointAttributesModal.tsx"],"sourcesContent":["import React from 'react';\nimport { observer } from 'mobx-react';\nimport { toJS } from 'mobx';\nimport { Button, ConfigProvider } from 'antd';\nimport EasyForm from '@appen-china/easy-form';\nimport Modal from '../../../common/modal/Modal';\nimport store from '../../store/RootStore';\nimport i18n from '../../locales';\nimport { setInitialValues } from '../../utils';\nimport { PolygonData } from '../../../common/shapes/Polygon';\nimport { LineData } from '../../../common/shapes/Line';\nimport './AttributesModal.scss';\n\nclass PointAttributesModal extends React.Component {\n  /**\n   * form container\n   */\n  ref = React.createRef<HTMLDivElement>();\n\n  /**\n   * when instance values submit\n   * @param values\n   */\n  onFrameValuesSubmit = (values: any) => {\n    const { selectedShapes, selectedPointIndex } = store.shape;\n    const selectedShape = selectedShapes[0];\n    store.shape.setPointUserData(selectedShape, selectedPointIndex, values);\n    store.config.setPointAttributesModalVisible(false);\n  };\n\n  /**\n   * submit button click\n   */\n  submit = () => {\n    const { selectedShapes } = store.shape;\n    const selectedShape = selectedShapes[0];\n    const { instanceItem } = store.shape.shapes[selectedShape.uid];\n    const frameData = instanceItem.cameras[store.frame.currentCamera].frames[store.frame.currentFrame];\n    if (!frameData.attrChangeAllowed) {\n      return;\n    }\n    const buttons = this.ref.current?.querySelectorAll('button.easyform-btn.form-btn-submit');\n    buttons?.forEach((btn) => {\n      (btn as HTMLButtonElement).click();\n    });\n  };\n\n  render() {\n    const { pointAttributesModalVisible } = store.config;\n    const { selectedShapes, selectedPointIndex, config } = store.shape;\n    if (!pointAttributesModalVisible || selectedShapes.length !== 1 || selectedPointIndex < 0) {\n      // no selected point\n      return null;\n    }\n\n    const selectedShape = selectedShapes[0];\n    const { instanceItem } = store.shape.shapes[selectedShape.uid];\n    const frameData = instanceItem.cameras[store.frame.currentCamera].frames[store.frame.currentFrame];\n    const { pointLabelConfig } = instanceItem.categoryItemRef;\n    if (!frameData || !pointLabelConfig) {\n      return null;\n    }\n\n    const pointUserData = toJS(frameData.shape as PolygonData | LineData).points[selectedPointIndex]?.userData || {};\n    const pointFields = setInitialValues(pointLabelConfig.fields, pointUserData);\n    if (!frameData.attrChangeAllowed) {\n      pointFields.forEach((field) => {\n        field.readonly = true;\n      });\n    }\n    return (\n      <Modal\n        visible\n        draggable\n        resizable\n        closable={false}\n        defaultSize={{ w: 720, h: 720 }}\n        dragId=\"video-tracking-attributes\"\n        className=\"attributes-form\"\n        title={`${instanceItem.label} - ${i18n.translate('POINT_INDEX_LABEL', { values: { index: selectedPointIndex + config.vertexStart } })}`}\n        onClose={() => store.config.setPointAttributesModalVisible(false)}\n        onMaskClick={this.submit}\n      >\n        <div ref={this.ref} className=\"attributes-form-content\">\n          <EasyForm\n            theme=\"dark\"\n            fields={pointFields}\n            conditions={pointLabelConfig.conditions}\n            effects={pointLabelConfig.effects}\n            rules={pointLabelConfig.rules}\n            onSubmit={this.onFrameValuesSubmit}\n          />\n        </div>\n        <div className=\"attributes-form-footer\">\n          <ConfigProvider prefixCls=\"easyform\">\n            <Button type=\"primary\" onClick={this.submit}>\n              {i18n.translate('COMMON_SUBMIT')}\n            </Button>\n          </ConfigProvider>\n        </div>\n      </Modal>\n    );\n  }\n}\n\nexport default observer(PointAttributesModal);\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}