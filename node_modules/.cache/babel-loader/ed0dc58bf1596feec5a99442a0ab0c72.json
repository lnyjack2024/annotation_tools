{"ast":null,"code":"import{EventEmitter}from'eventemitter3';import{Texture,Sprite}from'pixi.js';import Cursor from'../../Cursor';export let EventAction=/*#__PURE__*/function(EventAction){EventAction[\"SELECTED\"]=\"selected\";EventAction[\"POINTER_OVER\"]=\"pointer-over\";EventAction[\"POINTER_OUT\"]=\"pointer-out\";return EventAction;}({});/**\n * anchor\n * @class\n */export default class Anchor extends EventEmitter{/**\n   * get selected\n   * @getter\n   */get selected(){return this._selected;}/**\n   * set selected\n   * @setter\n   */set selected(selected){if(this.destroyed){return;}const shouldUpdate=this._selected!==selected;this._selected=selected;const index=this.container.getChildIndex(this.img);const count=this.container.children.length;if(index!==count-1){this.container.addChildAt(this.img,count-1);// move to front\n}if(shouldUpdate&&this.selectedTexture&&this.texture){this.img.texture=selected?this.selectedTexture:this.texture;}}/**\n   * get visible\n   * @getter\n   */get visible(){return this.img.visible;}/**\n   * set visible\n   * @setter\n   */set visible(visible){this.img.visible=visible;}/**\n   * get interactive\n   * @getter\n   */get interactive(){return this.img.interactive;}/**\n   * set interactive\n   * @setter\n   */set interactive(interactive){this.img.interactive=interactive;}constructor(_ref){let{container,scale,interactive=true,x,y,img,selectedImg}=_ref;super();/**\n   * container\n   */this.container=void 0;/**\n   * anchor x\n   */this.x=void 0;/**\n   * anchor y\n   */this.y=void 0;/**\n   * anchor image\n   */this.img=new Sprite();/**\n   * anchor default style\n   */this.texture=void 0;/**\n   * anchor selected style\n   */this.selectedTexture=void 0;/**\n   * custom data\n   * @member {any}\n   */this.data=void 0;/**\n   * is anchor destroyed\n   */this.destroyed=false;/**\n   * view scale\n   */this._viewScale=1;/**\n   * is selected\n   */this._selected=false;/**\n   * process pointer over\n   */this._processPointerOver=()=>{this.img.cursor=Cursor.POINTER;this.emit(EventAction.POINTER_OVER,this);};/**\n   * process pointer out\n   */this._processPointerOut=()=>{this.img.cursor=Cursor.DEFAULT;this.emit(EventAction.POINTER_OUT,this);};/**\n   * process pointer down\n   * @param event\n   */this._processPointerDown=event=>{if(event.data.button===2){return;}event.stopPropagation();this.selected=true;this.emit(EventAction.SELECTED,this);};this.container=container;if(scale!==undefined){this._viewScale=scale;}this.interactive=interactive;this.x=x;this.y=y;this.img.zIndex=10000;this.container.addChild(this.img);// add listeners\nthis.img.on('pointerover',this._processPointerOver);this.img.on('pointerout',this._processPointerOut);this.img.on('pointerdown',this._processPointerDown);this.setImage(img,selectedImg);}/**\n   * set anchor texture\n   * @param texture\n   */setTexture(texture){if(texture){this.img.texture=texture;// update position\nthis.setPosition(this.x,this.y);// update scale\nthis.setScale(this._viewScale);}}/**\n   * set anchor position\n   * @param x\n   * @param y\n   */setPosition(x,y){this.x=x;this.y=y;const{width,height}=this.img;this.img.position.set(x-width/2,y-height);// target to the center botoom anchor\n}/**\n   * set anchor scale\n   * @param viewScale\n   */setScale(viewScale){this._viewScale=viewScale;this.img.scale.set(1/this._viewScale);this.setPosition(this.x,this.y);}/**\n   * set image\n   * @param img\n   * @param selectedImg\n   */setImage(img,selectedImg){Promise.all([Texture.fromURL(img),Texture.fromURL(selectedImg)]).then(resources=>{if(!this.destroyed){this.texture=resources[0];this.selectedTexture=resources[1];this.setTexture(this.selected?this.selectedTexture:this.texture);}});}/**\n   * destroy\n   */destroy(){Object.values(EventAction).forEach(action=>{this.off(action);});this.container.removeChild(this.img);this.img.destroy();// remove data\nif(this.data){this.data=undefined;}this.destroyed=true;}}","map":{"version":3,"names":["EventEmitter","Texture","Sprite","Cursor","EventAction","Anchor","selected","_selected","destroyed","shouldUpdate","index","container","getChildIndex","img","count","children","length","addChildAt","selectedTexture","texture","visible","interactive","constructor","_ref","scale","x","y","selectedImg","data","_viewScale","_processPointerOver","cursor","POINTER","emit","POINTER_OVER","_processPointerOut","DEFAULT","POINTER_OUT","_processPointerDown","event","button","stopPropagation","SELECTED","undefined","zIndex","addChild","on","setImage","setTexture","setPosition","setScale","width","height","position","set","viewScale","Promise","all","fromURL","then","resources","destroy","Object","values","forEach","action","off","removeChild"],"sources":["/Users/qzheng/Documents/webroot/annotation_tools/src/components/common/shapes/anchors/Anchor.ts"],"sourcesContent":["import { EventEmitter } from 'eventemitter3';\nimport { Container, Texture, Sprite, InteractionEvent } from 'pixi.js';\nimport Cursor from '../../Cursor';\n\nexport enum EventAction {\n  SELECTED = 'selected',\n  POINTER_OVER = 'pointer-over',\n  POINTER_OUT = 'pointer-out',\n}\n\nexport interface AnchorOptions {\n  container: Container;\n  scale?: number;\n  interactive?: boolean;\n  x: number;\n  y: number;\n  img: string;\n  selectedImg: string;\n}\n\n/**\n * anchor\n * @class\n */\nexport default class Anchor extends EventEmitter {\n  /**\n   * container\n   */\n  container: Container;\n\n  /**\n   * anchor x\n   */\n  x: number;\n\n  /**\n   * anchor y\n   */\n  y: number;\n\n  /**\n   * anchor image\n   */\n  img = new Sprite();\n\n  /**\n   * anchor default style\n   */\n  texture?: Texture;\n\n  /**\n   * anchor selected style\n   */\n  selectedTexture?: Texture;\n\n  /**\n   * custom data\n   * @member {any}\n   */\n  data: any;\n\n  /**\n   * is anchor destroyed\n   */\n  destroyed = false;\n\n  /**\n   * view scale\n   */\n  private _viewScale = 1;\n\n  /**\n   * is selected\n   */\n  private _selected = false;\n\n  /**\n   * get selected\n   * @getter\n   */\n  get selected() {\n    return this._selected;\n  }\n\n  /**\n   * set selected\n   * @setter\n   */\n  set selected(selected: boolean) {\n    if (this.destroyed) {\n      return;\n    }\n    const shouldUpdate = this._selected !== selected;\n    this._selected = selected;\n    const index = this.container.getChildIndex(this.img);\n    const count = this.container.children.length;\n    if (index !== count - 1) {\n      this.container.addChildAt(this.img, count - 1); // move to front\n    }\n    if (shouldUpdate && this.selectedTexture && this.texture) {\n      this.img.texture = selected ? this.selectedTexture : this.texture;\n    }\n  }\n\n  /**\n   * get visible\n   * @getter\n   */\n  get visible() {\n    return this.img.visible;\n  }\n\n  /**\n   * set visible\n   * @setter\n   */\n  set visible(visible: boolean) {\n    this.img.visible = visible;\n  }\n\n  /**\n   * get interactive\n   * @getter\n   */\n  get interactive() {\n    return this.img.interactive;\n  }\n\n  /**\n   * set interactive\n   * @setter\n   */\n  set interactive(interactive: boolean) {\n    this.img.interactive = interactive;\n  }\n\n  constructor({ container, scale, interactive = true, x, y, img, selectedImg }: AnchorOptions) {\n    super();\n\n    this.container = container;\n    if (scale !== undefined) {\n      this._viewScale = scale;\n    }\n    this.interactive = interactive;\n\n    this.x = x;\n    this.y = y;\n    this.img.zIndex = 10000;\n    this.container.addChild(this.img);\n\n    // add listeners\n    this.img.on('pointerover', this._processPointerOver);\n    this.img.on('pointerout', this._processPointerOut);\n    this.img.on('pointerdown', this._processPointerDown);\n\n    this.setImage(img, selectedImg);\n  }\n\n  /**\n   * set anchor texture\n   * @param texture\n   */\n  setTexture(texture?: Texture) {\n    if (texture) {\n      this.img.texture = texture;\n      // update position\n      this.setPosition(this.x, this.y);\n      // update scale\n      this.setScale(this._viewScale);\n    }\n  }\n\n  /**\n   * set anchor position\n   * @param x\n   * @param y\n   */\n  setPosition(x: number, y: number) {\n    this.x = x;\n    this.y = y;\n    const { width, height } = this.img;\n    this.img.position.set(x - width / 2, y - height); // target to the center botoom anchor\n  }\n\n  /**\n   * set anchor scale\n   * @param viewScale\n   */\n  setScale(viewScale: number) {\n    this._viewScale = viewScale;\n    this.img.scale.set(1 / this._viewScale);\n    this.setPosition(this.x, this.y);\n  }\n\n  /**\n   * set image\n   * @param img\n   * @param selectedImg\n   */\n  setImage(img: string, selectedImg: string) {\n    Promise.all([\n      Texture.fromURL(img),\n      Texture.fromURL(selectedImg),\n    ]).then((resources) => {\n      if (!this.destroyed) {\n        this.texture = resources[0];\n        this.selectedTexture = resources[1];\n        this.setTexture(this.selected ? this.selectedTexture : this.texture);\n      }\n    });\n  }\n\n  /**\n   * destroy\n   */\n  destroy() {\n    Object.values(EventAction).forEach((action) => {\n      this.off(action);\n    });\n    this.container.removeChild(this.img);\n    this.img.destroy();\n    // remove data\n    if (this.data) {\n      this.data = undefined;\n    }\n    this.destroyed = true;\n  }\n\n  /**\n   * process pointer over\n   */\n  private _processPointerOver = () => {\n    this.img.cursor = Cursor.POINTER;\n    this.emit(EventAction.POINTER_OVER, this);\n  };\n\n  /**\n   * process pointer out\n   */\n  private _processPointerOut = () => {\n    this.img.cursor = Cursor.DEFAULT;\n    this.emit(EventAction.POINTER_OUT, this);\n  };\n\n  /**\n   * process pointer down\n   * @param event\n   */\n  private _processPointerDown = (event: InteractionEvent) => {\n    if (event.data.button === 2) {\n      return;\n    }\n\n    event.stopPropagation();\n    this.selected = true;\n    this.emit(EventAction.SELECTED, this);\n  };\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}