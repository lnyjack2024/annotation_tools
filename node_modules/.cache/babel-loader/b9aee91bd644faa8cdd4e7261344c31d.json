{"ast":null,"code":"var _jsxFileName = \"/Users/qzheng/Documents/webroot/annotation_tools/src/components/multi-channel/components/Channels/index.tsx\";\nimport React from 'react';\nimport { makeObservable, toJS } from 'mobx';\nimport { observer } from 'mobx-react';\nimport Controls from './Controls';\nimport WaveformObserve from './Waveform';\nimport XScroll from '../ScrollControl/XScroll';\nimport store from '../../store/RootStore';\nimport { requestAnimationFrame, cancelAnimationFrame } from '../../utils';\nimport './index.scss';\nclass Channels extends React.Component {\n  constructor(props) {\n    super(props);\n    /**\n     * application dom container\n     */\n    this.channelsContainer = React.createRef();\n    /**\n     * waveform reference\n     */\n    this.waveformRef = React.createRef();\n    /**\n     * scroll\n     */\n    this.scroll = void 0;\n    this.stop = void 0;\n    this.update = () => {\n      this.cancelUpdate();\n      this.stop = requestAnimationFrame(this.updatePlugins);\n    };\n    this.cancelUpdate = () => {\n      if (this.stop) {\n        cancelAnimationFrame(this.stop);\n        this.updatePlugins();\n        this.stop = null;\n      }\n    };\n    this.updatePlugins = () => {\n      var _this$scroll, _ref, _this$waveformRef$cur, _this$waveformRef$cur2, _ref2, _this$waveformRef$cur3, _this$waveformRef$cur4;\n      (_this$scroll = this.scroll) === null || _this$scroll === void 0 ? void 0 : _this$scroll.updateTimeline();\n      (_ref = (_this$waveformRef$cur = this.waveformRef.current) === null || _this$waveformRef$cur === void 0 ? void 0 : (_this$waveformRef$cur2 = _this$waveformRef$cur.wave) === null || _this$waveformRef$cur2 === void 0 ? void 0 : _this$waveformRef$cur2.plugins.timeline) === null || _ref === void 0 ? void 0 : _ref.render();\n      (_ref2 = (_this$waveformRef$cur3 = this.waveformRef.current) === null || _this$waveformRef$cur3 === void 0 ? void 0 : (_this$waveformRef$cur4 = _this$waveformRef$cur3.wave) === null || _this$waveformRef$cur4 === void 0 ? void 0 : _this$waveformRef$cur4.plugins.region) === null || _ref2 === void 0 ? void 0 : _ref2.renderCanvas();\n      if (this.stop) {\n        requestAnimationFrame(this.updatePlugins);\n      }\n    };\n    this.onChangSelectedInstance = (start, end) => {\n      var _this$scroll2;\n      (_this$scroll2 = this.scroll) === null || _this$scroll2 === void 0 ? void 0 : _this$scroll2.updateRegion(start, end);\n    };\n    this.onScroll = ({\n      start,\n      end\n    }) => {\n      var _this$scroll3, _this$waveformRef$cur5;\n      (_this$scroll3 = this.scroll) === null || _this$scroll3 === void 0 ? void 0 : _this$scroll3.setScroll({\n        start,\n        end\n      });\n      (_this$waveformRef$cur5 = this.waveformRef.current) === null || _this$waveformRef$cur5 === void 0 ? void 0 : _this$waveformRef$cur5.handleScroll({\n        start,\n        end\n      });\n    };\n    this.onZoom = ({\n      start,\n      end\n    }) => {\n      var _this$scroll4;\n      (_this$scroll4 = this.scroll) === null || _this$scroll4 === void 0 ? void 0 : _this$scroll4.setScroll({\n        start,\n        end\n      });\n    };\n    makeObservable(this, {});\n  }\n  componentDidMount() {\n    var _this$waveformRef$cur6, _this$waveformRef$cur7, _this$waveformRef$cur9, _this$waveformRef$cur0, _this$waveformRef$cur10, _this$waveformRef$cur11;\n    this.initScroll();\n    (_this$waveformRef$cur6 = this.waveformRef.current) === null || _this$waveformRef$cur6 === void 0 ? void 0 : (_this$waveformRef$cur7 = _this$waveformRef$cur6.wave) === null || _this$waveformRef$cur7 === void 0 ? void 0 : _this$waveformRef$cur7.on('pause', () => {\n      var _this$waveformRef$cur8;\n      this.cancelUpdate();\n      (_this$waveformRef$cur8 = this.waveformRef.current) === null || _this$waveformRef$cur8 === void 0 ? void 0 : _this$waveformRef$cur8.handlePausePlay(false);\n    });\n    (_this$waveformRef$cur9 = this.waveformRef.current) === null || _this$waveformRef$cur9 === void 0 ? void 0 : (_this$waveformRef$cur0 = _this$waveformRef$cur9.wave) === null || _this$waveformRef$cur0 === void 0 ? void 0 : _this$waveformRef$cur0.on('play', () => {\n      var _this$waveformRef$cur1;\n      this.update();\n      (_this$waveformRef$cur1 = this.waveformRef.current) === null || _this$waveformRef$cur1 === void 0 ? void 0 : _this$waveformRef$cur1.handlePausePlay(true);\n    });\n    (_this$waveformRef$cur10 = this.waveformRef.current) === null || _this$waveformRef$cur10 === void 0 ? void 0 : (_this$waveformRef$cur11 = _this$waveformRef$cur10.wave) === null || _this$waveformRef$cur11 === void 0 ? void 0 : _this$waveformRef$cur11.on('change-time', time => {\n      var _this$scroll5;\n      store.waveform.setCurrentTime(time);\n      (_this$scroll5 = this.scroll) === null || _this$scroll5 === void 0 ? void 0 : _this$scroll5.updateTimeline();\n    });\n  }\n  initScroll() {\n    if (this.channelsContainer.current) {\n      this.scroll = new XScroll({\n        container: this.channelsContainer.current,\n        height: 20,\n        trackStyle: {\n          margin: '4px 0',\n          color: '#22262D'\n        },\n        displayRange: store.waveform.displayRange,\n        onScroll: this.onScroll\n      });\n    }\n  }\n  render() {\n    return /*#__PURE__*/React.createElement(\"div\", {\n      className: \"channel-pannel\",\n      ref: this.channelsContainer,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 105,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"channel-main\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 106,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(Controls, {\n      channelsOptions: toJS(store.waveform.channelsOptions),\n      channelOffset: toJS(store.waveform.channelOffset),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 107,\n        columnNumber: 11\n      }\n    }), /*#__PURE__*/React.createElement(WaveformObserve, {\n      ref: this.waveformRef,\n      onZoom: this.onZoom,\n      onChangSelectedInstance: this.onChangSelectedInstance,\n      selectedInstance: store.instance.selectedInstance,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 111,\n        columnNumber: 11\n      }\n    })));\n  }\n}\n;\nexport default observer(Channels);","map":{"version":3,"names":["React","makeObservable","toJS","observer","Controls","WaveformObserve","XScroll","store","requestAnimationFrame","cancelAnimationFrame","Channels","Component","constructor","props","channelsContainer","createRef","waveformRef","scroll","stop","update","cancelUpdate","updatePlugins","_this$scroll","_ref","_this$waveformRef$cur","_this$waveformRef$cur2","_ref2","_this$waveformRef$cur3","_this$waveformRef$cur4","updateTimeline","current","wave","plugins","timeline","render","region","renderCanvas","onChangSelectedInstance","start","end","_this$scroll2","updateRegion","onScroll","_this$scroll3","_this$waveformRef$cur5","setScroll","handleScroll","onZoom","_this$scroll4","componentDidMount","_this$waveformRef$cur6","_this$waveformRef$cur7","_this$waveformRef$cur9","_this$waveformRef$cur0","_this$waveformRef$cur10","_this$waveformRef$cur11","initScroll","on","_this$waveformRef$cur8","handlePausePlay","_this$waveformRef$cur1","time","_this$scroll5","waveform","setCurrentTime","container","height","trackStyle","margin","color","displayRange","createElement","className","ref","__self","__source","fileName","_jsxFileName","lineNumber","columnNumber","channelsOptions","channelOffset","selectedInstance","instance"],"sources":["/Users/qzheng/Documents/webroot/annotation_tools/src/components/multi-channel/components/Channels/index.tsx"],"sourcesContent":["import React from 'react';\nimport { makeObservable, toJS } from 'mobx';\nimport { observer } from 'mobx-react';\nimport Controls from './Controls';\nimport WaveformObserve, { Waveform } from './Waveform';\nimport TimelinePlugin from '../Wave/Timeline';\nimport RegionPlugin from '../Wave/Region';\nimport XScroll from '../ScrollControl/XScroll';\nimport store from '../../store/RootStore';\nimport { requestAnimationFrame, cancelAnimationFrame } from '../../utils';\nimport './index.scss';\n\nclass Channels extends React.Component {\n  /**\n   * application dom container\n   */\n  channelsContainer: React.RefObject<HTMLDivElement> = React.createRef();\n\n  /**\n   * waveform reference\n   */\n  waveformRef = React.createRef<Waveform>();\n\n  /**\n   * scroll\n   */\n  scroll?: XScroll;\n\n  stop: any;\n\n  constructor(props: any) {\n    super(props);\n    makeObservable(this, {});\n  }\n\n  componentDidMount() {\n    this.initScroll();\n\n    this.waveformRef.current?.wave?.on('pause', () => {\n      this.cancelUpdate();\n      this.waveformRef.current?.handlePausePlay(false);\n    });\n    this.waveformRef.current?.wave?.on('play', () => {\n      this.update();\n      this.waveformRef.current?.handlePausePlay(true);\n    });\n    this.waveformRef.current?.wave?.on('change-time', (time: number) => {\n      store.waveform.setCurrentTime(time);\n      this.scroll?.updateTimeline();\n    });\n  }\n\n  initScroll() {\n    if (this.channelsContainer.current) {\n      this.scroll = new XScroll({\n        container: this.channelsContainer.current,\n        height: 20,\n        trackStyle: {\n          margin: '4px 0',\n          color: '#22262D',\n        },\n        displayRange: store.waveform.displayRange,\n        onScroll: this.onScroll\n      });\n    }\n  }\n\n  update = () => {\n    this.cancelUpdate();\n    this.stop = requestAnimationFrame(this.updatePlugins);\n  };\n\n  cancelUpdate = () => {\n    if (this.stop) {\n      cancelAnimationFrame(this.stop);\n      this.updatePlugins();\n      this.stop = null;\n    }\n  };\n\n  updatePlugins = () => {\n    this.scroll?.updateTimeline();\n    (this.waveformRef.current?.wave?.plugins.timeline as TimelinePlugin)?.render();\n    (this.waveformRef.current?.wave?.plugins.region as RegionPlugin)?.renderCanvas();\n    if (this.stop) {\n      requestAnimationFrame(this.updatePlugins);\n    }\n  };\n\n  onChangSelectedInstance = (start?: number, end?: number) => {\n    this.scroll?.updateRegion(start, end);\n  };\n\n  onScroll = ({ start, end }: { start: number; end: number }) => {\n    this.scroll?.setScroll({ start, end });\n    this.waveformRef.current?.handleScroll({ start, end });\n  };\n\n  onZoom = ({ start, end }: { start: number; end: number }) => {\n    this.scroll?.setScroll({ start, end });\n  };\n\n  render() {\n    return (\n      <div className=\"channel-pannel\" ref={this.channelsContainer}>\n        <div className=\"channel-main\">\n          <Controls\n            channelsOptions={toJS(store.waveform.channelsOptions)}\n            channelOffset={toJS(store.waveform.channelOffset)}\n          />\n          <WaveformObserve\n            ref={this.waveformRef}\n            onZoom={this.onZoom}\n            onChangSelectedInstance={this.onChangSelectedInstance}\n            selectedInstance={store.instance.selectedInstance}\n          />\n        </div>\n      </div>\n    );\n  }\n};\n\nexport default observer(Channels);\n"],"mappings":";AAAA,OAAOA,KAAK,MAAM,OAAO;AACzB,SAASC,cAAc,EAAEC,IAAI,QAAQ,MAAM;AAC3C,SAASC,QAAQ,QAAQ,YAAY;AACrC,OAAOC,QAAQ,MAAM,YAAY;AACjC,OAAOC,eAAe,MAAoB,YAAY;AAGtD,OAAOC,OAAO,MAAM,0BAA0B;AAC9C,OAAOC,KAAK,MAAM,uBAAuB;AACzC,SAASC,qBAAqB,EAAEC,oBAAoB,QAAQ,aAAa;AACzE,OAAO,cAAc;AAErB,MAAMC,QAAQ,SAASV,KAAK,CAACW,SAAS,CAAC;EAkBrCC,WAAWA,CAACC,KAAU,EAAE;IACtB,KAAK,CAACA,KAAK,CAAC;IAlBd;AACF;AACA;IAFE,KAGAC,iBAAiB,GAAoCd,KAAK,CAACe,SAAS,CAAC,CAAC;IAEtE;AACF;AACA;IAFE,KAGAC,WAAW,GAAGhB,KAAK,CAACe,SAAS,CAAW,CAAC;IAEzC;AACF;AACA;IAFE,KAGAE,MAAM;IAAA,KAENC,IAAI;IAAA,KAuCJC,MAAM,GAAG,MAAM;MACb,IAAI,CAACC,YAAY,CAAC,CAAC;MACnB,IAAI,CAACF,IAAI,GAAGV,qBAAqB,CAAC,IAAI,CAACa,aAAa,CAAC;IACvD,CAAC;IAAA,KAEDD,YAAY,GAAG,MAAM;MACnB,IAAI,IAAI,CAACF,IAAI,EAAE;QACbT,oBAAoB,CAAC,IAAI,CAACS,IAAI,CAAC;QAC/B,IAAI,CAACG,aAAa,CAAC,CAAC;QACpB,IAAI,CAACH,IAAI,GAAG,IAAI;MAClB;IACF,CAAC;IAAA,KAEDG,aAAa,GAAG,MAAM;MAAA,IAAAC,YAAA,EAAAC,IAAA,EAAAC,qBAAA,EAAAC,sBAAA,EAAAC,KAAA,EAAAC,sBAAA,EAAAC,sBAAA;MACpB,CAAAN,YAAA,OAAI,CAACL,MAAM,cAAAK,YAAA,uBAAXA,YAAA,CAAaO,cAAc,CAAC,CAAC;MAC7B,CAAAN,IAAA,IAAAC,qBAAA,GAAC,IAAI,CAACR,WAAW,CAACc,OAAO,cAAAN,qBAAA,wBAAAC,sBAAA,GAAxBD,qBAAA,CAA0BO,IAAI,cAAAN,sBAAA,uBAA9BA,sBAAA,CAAgCO,OAAO,CAACC,QAAQ,cAAAV,IAAA,uBAAjDA,IAAA,CAAsEW,MAAM,CAAC,CAAC;MAC9E,CAAAR,KAAA,IAAAC,sBAAA,GAAC,IAAI,CAACX,WAAW,CAACc,OAAO,cAAAH,sBAAA,wBAAAC,sBAAA,GAAxBD,sBAAA,CAA0BI,IAAI,cAAAH,sBAAA,uBAA9BA,sBAAA,CAAgCI,OAAO,CAACG,MAAM,cAAAT,KAAA,uBAA/CA,KAAA,CAAkEU,YAAY,CAAC,CAAC;MAChF,IAAI,IAAI,CAAClB,IAAI,EAAE;QACbV,qBAAqB,CAAC,IAAI,CAACa,aAAa,CAAC;MAC3C;IACF,CAAC;IAAA,KAEDgB,uBAAuB,GAAG,CAACC,KAAc,EAAEC,GAAY,KAAK;MAAA,IAAAC,aAAA;MAC1D,CAAAA,aAAA,OAAI,CAACvB,MAAM,cAAAuB,aAAA,uBAAXA,aAAA,CAAaC,YAAY,CAACH,KAAK,EAAEC,GAAG,CAAC;IACvC,CAAC;IAAA,KAEDG,QAAQ,GAAG,CAAC;MAAEJ,KAAK;MAAEC;IAAoC,CAAC,KAAK;MAAA,IAAAI,aAAA,EAAAC,sBAAA;MAC7D,CAAAD,aAAA,OAAI,CAAC1B,MAAM,cAAA0B,aAAA,uBAAXA,aAAA,CAAaE,SAAS,CAAC;QAAEP,KAAK;QAAEC;MAAI,CAAC,CAAC;MACtC,CAAAK,sBAAA,OAAI,CAAC5B,WAAW,CAACc,OAAO,cAAAc,sBAAA,uBAAxBA,sBAAA,CAA0BE,YAAY,CAAC;QAAER,KAAK;QAAEC;MAAI,CAAC,CAAC;IACxD,CAAC;IAAA,KAEDQ,MAAM,GAAG,CAAC;MAAET,KAAK;MAAEC;IAAoC,CAAC,KAAK;MAAA,IAAAS,aAAA;MAC3D,CAAAA,aAAA,OAAI,CAAC/B,MAAM,cAAA+B,aAAA,uBAAXA,aAAA,CAAaH,SAAS,CAAC;QAAEP,KAAK;QAAEC;MAAI,CAAC,CAAC;IACxC,CAAC;IApECtC,cAAc,CAAC,IAAI,EAAE,CAAC,CAAC,CAAC;EAC1B;EAEAgD,iBAAiBA,CAAA,EAAG;IAAA,IAAAC,sBAAA,EAAAC,sBAAA,EAAAC,sBAAA,EAAAC,sBAAA,EAAAC,uBAAA,EAAAC,uBAAA;IAClB,IAAI,CAACC,UAAU,CAAC,CAAC;IAEjB,CAAAN,sBAAA,OAAI,CAAClC,WAAW,CAACc,OAAO,cAAAoB,sBAAA,wBAAAC,sBAAA,GAAxBD,sBAAA,CAA0BnB,IAAI,cAAAoB,sBAAA,uBAA9BA,sBAAA,CAAgCM,EAAE,CAAC,OAAO,EAAE,MAAM;MAAA,IAAAC,sBAAA;MAChD,IAAI,CAACtC,YAAY,CAAC,CAAC;MACnB,CAAAsC,sBAAA,OAAI,CAAC1C,WAAW,CAACc,OAAO,cAAA4B,sBAAA,uBAAxBA,sBAAA,CAA0BC,eAAe,CAAC,KAAK,CAAC;IAClD,CAAC,CAAC;IACF,CAAAP,sBAAA,OAAI,CAACpC,WAAW,CAACc,OAAO,cAAAsB,sBAAA,wBAAAC,sBAAA,GAAxBD,sBAAA,CAA0BrB,IAAI,cAAAsB,sBAAA,uBAA9BA,sBAAA,CAAgCI,EAAE,CAAC,MAAM,EAAE,MAAM;MAAA,IAAAG,sBAAA;MAC/C,IAAI,CAACzC,MAAM,CAAC,CAAC;MACb,CAAAyC,sBAAA,OAAI,CAAC5C,WAAW,CAACc,OAAO,cAAA8B,sBAAA,uBAAxBA,sBAAA,CAA0BD,eAAe,CAAC,IAAI,CAAC;IACjD,CAAC,CAAC;IACF,CAAAL,uBAAA,OAAI,CAACtC,WAAW,CAACc,OAAO,cAAAwB,uBAAA,wBAAAC,uBAAA,GAAxBD,uBAAA,CAA0BvB,IAAI,cAAAwB,uBAAA,uBAA9BA,uBAAA,CAAgCE,EAAE,CAAC,aAAa,EAAGI,IAAY,IAAK;MAAA,IAAAC,aAAA;MAClEvD,KAAK,CAACwD,QAAQ,CAACC,cAAc,CAACH,IAAI,CAAC;MACnC,CAAAC,aAAA,OAAI,CAAC7C,MAAM,cAAA6C,aAAA,uBAAXA,aAAA,CAAajC,cAAc,CAAC,CAAC;IAC/B,CAAC,CAAC;EACJ;EAEA2B,UAAUA,CAAA,EAAG;IACX,IAAI,IAAI,CAAC1C,iBAAiB,CAACgB,OAAO,EAAE;MAClC,IAAI,CAACb,MAAM,GAAG,IAAIX,OAAO,CAAC;QACxB2D,SAAS,EAAE,IAAI,CAACnD,iBAAiB,CAACgB,OAAO;QACzCoC,MAAM,EAAE,EAAE;QACVC,UAAU,EAAE;UACVC,MAAM,EAAE,OAAO;UACfC,KAAK,EAAE;QACT,CAAC;QACDC,YAAY,EAAE/D,KAAK,CAACwD,QAAQ,CAACO,YAAY;QACzC5B,QAAQ,EAAE,IAAI,CAACA;MACjB,CAAC,CAAC;IACJ;EACF;EAqCAR,MAAMA,CAAA,EAAG;IACP,oBACElC,KAAA,CAAAuE,aAAA;MAAKC,SAAS,EAAC,gBAAgB;MAACC,GAAG,EAAE,IAAI,CAAC3D,iBAAkB;MAAA4D,MAAA;MAAAC,QAAA;QAAAC,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA;IAAA,gBAC1D/E,KAAA,CAAAuE,aAAA;MAAKC,SAAS,EAAC,cAAc;MAAAE,MAAA;MAAAC,QAAA;QAAAC,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA;IAAA,gBAC3B/E,KAAA,CAAAuE,aAAA,CAACnE,QAAQ;MACP4E,eAAe,EAAE9E,IAAI,CAACK,KAAK,CAACwD,QAAQ,CAACiB,eAAe,CAAE;MACtDC,aAAa,EAAE/E,IAAI,CAACK,KAAK,CAACwD,QAAQ,CAACkB,aAAa,CAAE;MAAAP,MAAA;MAAAC,QAAA;QAAAC,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA;IAAA,CACnD,CAAC,eACF/E,KAAA,CAAAuE,aAAA,CAAClE,eAAe;MACdoE,GAAG,EAAE,IAAI,CAACzD,WAAY;MACtB+B,MAAM,EAAE,IAAI,CAACA,MAAO;MACpBV,uBAAuB,EAAE,IAAI,CAACA,uBAAwB;MACtD6C,gBAAgB,EAAE3E,KAAK,CAAC4E,QAAQ,CAACD,gBAAiB;MAAAR,MAAA;MAAAC,QAAA;QAAAC,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA;IAAA,CACnD,CACE,CACF,CAAC;EAEV;AACF;AAAC;AAED,eAAe5E,QAAQ,CAACO,QAAQ,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module"}