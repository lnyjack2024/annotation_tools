{"ast":null,"code":"import { v4 as uuidv4 } from 'uuid';\nimport { Point, Graphics } from 'pixi.js';\nexport default class TierContainer {\n  /**\n   * set x\n   * @setter\n   */\n  set selected(sel) {\n    this._selected = sel;\n    this._drawShapeFill();\n  }\n  constructor(options) {\n    this.id = void 0;\n    this.color = 0xE6ECF0;\n    this.selectedColor = 0xffffff;\n    /**\n     * container index\n     */\n    this.index = 0;\n    this.width = void 0;\n    this.height = void 0;\n    this.container = void 0;\n    /**\n     * PIXI instance\n     * @member {Graphics}\n     */\n    this.instance = new Graphics();\n    this.rect = new Graphics();\n    /**\n     * tier category\n     */\n    this.category = void 0;\n    /**\n     * is selected\n     */\n    this._selected = false;\n    /**\n     * ctrl key hold on\n     */\n    this._ctrlKey = false;\n    /**\n    * PIXI application\n    * @member {PIXI.Application}\n    */\n    this.app = void 0;\n    /**\n     * container border\n     */\n    this.border = new Graphics();\n    /**\n     * border color\n     */\n    this.borderColor = 0xC9CBCC;\n    /**\n     * handle select\n     */\n    this.onSelected = void 0;\n    /**\n     * process pointerdown\n     * @param event\n     * @param frontTargets\n     */\n    this.processPointerDown = (event, frontTargets = []) => {\n      if (event.data.button === 2 && this._ctrlKey) {\n        return;\n      }\n      this.onSelected(this.category, this);\n    };\n    /**\n     * process key down\n     * @param e\n     */\n    this.processGlobalKeyDown = e => {\n      if (e.ctrlKey) {\n        this._ctrlKey = true;\n      }\n    };\n    /**\n     * process key up\n     */\n    this.processGlobalKeyUp = () => {\n      this._ctrlKey = false;\n    };\n    const {\n      container,\n      index,\n      width,\n      height,\n      category,\n      app,\n      selected,\n      id,\n      onSelected\n    } = options;\n    this.id = id || uuidv4();\n    this.app = app;\n    this._selected = selected;\n    this.category = category;\n    this.onSelected = onSelected;\n    this.container = container;\n    this.index = index;\n    this.width = width;\n    this.height = height;\n    this.instance.interactive = true;\n    document.addEventListener('keydown', this.processGlobalKeyDown);\n    document.addEventListener('keyup', this.processGlobalKeyUp);\n    this.instance.on('pointerdown', this.processPointerDown);\n    this.container.addChild(this.instance);\n    this.normalize();\n  }\n  normalize() {\n    this._drawShapeFill();\n    this._drawShapeLine();\n  }\n\n  /**\n   * draw container fill\n   */\n  _drawShapeFill() {\n    if (this._selected) {\n      this.instance.addChild(this.rect);\n      this.rect.beginFill(this.selectedColor);\n      this.rect.drawRect(0.5, this.index * this.height, this.width - 1, this.height - 1);\n      this.rect.endFill();\n      this.rect.zIndex = 1;\n    } else {\n      this.instance.removeChild(this.rect);\n    }\n  }\n\n  /**\n   * draw container border\n   */\n  _drawShapeLine() {\n    const borderWidth = 1 * window.devicePixelRatio;\n    const y = this.index * this.height;\n    this.instance.beginFill(this.color);\n    this.instance.drawRect(0.5, this.index * this.height, this.width, this.height);\n    this.instance.endFill();\n    this.instance.lineStyle(borderWidth, this.borderColor);\n    this.instance.moveTo(0, y + 0.5);\n    this.instance.lineTo(0, y + this.height - 0.5);\n    this.instance.lineTo(this.width, y + this.height - 0.5);\n    this.instance.lineTo(this.width, y + 0.5);\n    if (this.index === 0) {\n      this.instance.lineTo(0, y + 0.5);\n    }\n  }\n  /**\n   * map screen position to stage position as a PIXI point\n   * @protected\n   * @param x screen position x\n   * @param y screen position y\n   */\n  _mapScreenToStagePosition(x, y) {\n    const point = new Point();\n    this.app.renderer.plugins.interaction.mapPositionToPoint(point, x, y);\n    return point;\n  }\n}","map":{"version":3,"names":["v4","uuidv4","Point","Graphics","TierContainer","selected","sel","_selected","_drawShapeFill","constructor","options","id","color","selectedColor","index","width","height","container","instance","rect","category","_ctrlKey","app","border","borderColor","onSelected","processPointerDown","event","frontTargets","data","button","processGlobalKeyDown","e","ctrlKey","processGlobalKeyUp","interactive","document","addEventListener","on","addChild","normalize","_drawShapeLine","beginFill","drawRect","endFill","zIndex","removeChild","borderWidth","window","devicePixelRatio","y","lineStyle","moveTo","lineTo","_mapScreenToStagePosition","x","point","renderer","plugins","interaction","mapPositionToPoint"],"sources":["/Users/qzheng/Documents/webroot/annotation_tools/src/components/phonetic-transcription/common/shapes/TierContainer.ts"],"sourcesContent":["import { v4 as uuidv4 } from 'uuid';\nimport { Application, Point, Graphics, InteractionEvent, Container } from 'pixi.js';\n\nexport interface TierContainerOptions {\n  id?: string;\n  container: Container;\n  index: number;\n  height: number;\n  width: number;\n  category: string;\n  app: Application;\n  selected: boolean;\n  onSelected: (category: string, ctx: TierContainer) => void;\n}\n\nexport default class TierContainer {\n  id: string;\n\n  color = 0xE6ECF0;\n\n  selectedColor = 0xffffff;\n\n  /**\n   * container index\n   */\n  index = 0;\n\n  width: number;\n\n  height: number;\n\n  container: Container;\n\n  /**\n   * PIXI instance\n   * @member {Graphics}\n   */\n  instance = new Graphics();\n\n  rect = new Graphics();\n\n  /**\n   * tier category\n   */\n  category: string;\n\n  /**\n   * is selected\n   */\n  _selected = false;\n\n  /**\n   * ctrl key hold on\n   */\n  _ctrlKey = false;\n\n  /**\n  * PIXI application\n  * @member {PIXI.Application}\n  */\n  app: Application;\n\n  /**\n   * container border\n   */\n  border = new Graphics();\n\n  /**\n   * border color\n   */\n  borderColor = 0xC9CBCC;\n\n  /**\n   * handle select\n   */\n  onSelected: (className: string, ctx: TierContainer) => void;\n\n  /**\n   * set x\n   * @setter\n   */\n  set selected(sel: boolean) {\n    this._selected = sel;\n    this._drawShapeFill();\n  }\n\n  constructor(options: TierContainerOptions) {\n    const { container, index, width, height, category, app, selected, id, onSelected } = options;\n    this.id = id || uuidv4();\n    this.app = app;\n    this._selected = selected;\n    this.category = category;\n    this.onSelected = onSelected;\n    this.container = container;\n    this.index = index;\n    this.width = width;\n    this.height = height;\n    this.instance.interactive = true;\n    document.addEventListener('keydown', this.processGlobalKeyDown);\n    document.addEventListener('keyup', this.processGlobalKeyUp);\n    this.instance.on('pointerdown', this.processPointerDown);\n    this.container.addChild(this.instance);\n    this.normalize();\n  }\n\n  normalize() {\n    this._drawShapeFill();\n    this._drawShapeLine();\n  }\n\n  /**\n   * draw container fill\n   */\n  private _drawShapeFill() {\n    if (this._selected) {\n      this.instance.addChild(this.rect);\n      this.rect.beginFill(this.selectedColor);\n      this.rect.drawRect(0.5, this.index * this.height, this.width - 1, this.height - 1);\n      this.rect.endFill();\n      this.rect.zIndex = 1;\n    } else {\n      this.instance.removeChild(this.rect);\n    }\n  }\n\n  /**\n   * draw container border\n   */\n  private _drawShapeLine() {\n    const borderWidth = 1 * window.devicePixelRatio;\n    const y = this.index * this.height;\n    this.instance.beginFill(this.color);\n    this.instance.drawRect(0.5, this.index * this.height, this.width, this.height);\n    this.instance.endFill();\n    this.instance.lineStyle(borderWidth, this.borderColor);\n    this.instance.moveTo(0, y + 0.5);\n    this.instance.lineTo(0, y + this.height - 0.5);\n    this.instance.lineTo(this.width, y + this.height - 0.5);\n    this.instance.lineTo(this.width, y + 0.5);\n    if (this.index === 0) {\n      this.instance.lineTo(0, y + 0.5);\n    }\n  }\n\n  /**\n   * process pointerdown\n   * @param event\n   * @param frontTargets\n   */\n  processPointerDown = (event: InteractionEvent, frontTargets: Graphics[] = []) => {\n    if (event.data.button === 2 && this._ctrlKey) {\n      return;\n    }\n    this.onSelected(this.category, this);\n  };\n\n  /**\n   * process key down\n   * @param e\n   */\n  processGlobalKeyDown = (e: KeyboardEvent) => {\n    if (e.ctrlKey) {\n      this._ctrlKey = true;\n    }\n  };\n\n  /**\n   * process key up\n   */\n  processGlobalKeyUp = () => {\n    this._ctrlKey = false;\n  };\n\n  /**\n   * map screen position to stage position as a PIXI point\n   * @protected\n   * @param x screen position x\n   * @param y screen position y\n   */\n  protected _mapScreenToStagePosition(x: number, y: number) {\n    const point = new Point();\n    this.app.renderer.plugins.interaction.mapPositionToPoint(point, x, y);\n    return point;\n  }\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}