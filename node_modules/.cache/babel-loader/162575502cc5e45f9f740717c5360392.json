{"ast":null,"code":"import{makeAutoObservable,toJS}from'mobx';import{v4 as uuidv4}from'uuid';import{cloneDeep}from'lodash';import InstanceItem from'./InstanceItem';/**\n * Instance\n * @class\n */export default class Instance{/**\n   * instance category class name\n   * @getter\n   */get category(){return this.categoryRef.className;}/**\n   * instance label\n   * @getter\n   */get label(){return\"\".concat(this.categoryRef.displayName).concat(this.number);}/**\n   * instance frame status (merged status)\n   * @getter\n   */get frameStatus(){// simple merge\nreturn Object.values(this.items).map(i=>i.frameStatus).reduce((acc,curr)=>({...acc,...curr}),{});}/**\n   * instance existed camera names\n   * @getter\n   */get existedCameras(){const cameras=new Set(Object.values(this.items).flatMap(i=>i.existedCameras));return Array.from(cameras);}/**\n   * is instance empty in all camera & frames\n   * @getter\n   */get isEmpty(){return Object.values(this.items).every(item=>item.isEmpty);}/**\n   * is instance only contains one item\n   * @getter\n   */get isSingle(){const{children}=this.categoryRef;return children.length===1&&children[0].count===1;}constructor(_ref){let{id,categoryRef,number,attributes:_attributes,dynamicAttributes:_dynamicAttributes,items=[],getNextShapeOrder}=_ref;/**\n   * instance uuid\n   * @member\n   */this.id=void 0;/**\n   * category instance reference\n   * @member\n   */this.categoryRef=void 0;/**\n   * instance number\n   * @member\n   */this.number=void 0;/**\n   * instance attributes\n   * @member\n   */this.attributes=void 0;/**\n * instance dynamic attributes\n * @member\n */this.dynamicAttributes=void 0;/**\n   * instance items\n   * @member\n   */this.items={};/**\n   * is instance selected\n   * @member\n   */this.selected=false;/**\n   * is instance collapsed\n   * @member\n   */this.collapsed=false;/**\n   * get next shape order\n   * @member\n   */this.getNextShapeOrder=void 0;/**\n * set dynamic attributes\n * @param attrs\n */this.setDynamicAttributes=attrs=>{if(Array.isArray(attrs)){const dynamicAttributes={};attrs.forEach(cameraItem=>{const{camera,frames}=cameraItem||{};if(camera){dynamicAttributes[camera]={};if(Array.isArray(frames)){frames.forEach(frameItem=>{const{frameIndex,attributes}=frameItem;dynamicAttributes[camera][frameIndex]={frameIndex,attributes};});}}});this.dynamicAttributes=dynamicAttributes;};};makeAutoObservable(this,{id:false,categoryRef:false,isEmpty:false,isSingle:false,getNextShapeOrder:false},{autoBind:true});this.getNextShapeOrder=getNextShapeOrder;this.id=id||uuidv4();this.categoryRef=categoryRef;this.number=number;this.attributes=cloneDeep(_attributes);this.setDynamicAttributes(_dynamicAttributes);items.forEach(item=>this.createItemFromData(item));}/**\n   * create instance item from structured instance item data\n   * @param instanceItem\n   */createItemFromData(instanceItem){const{children}=this.categoryRef;const categoryItem=children.find(c=>c.name===instanceItem.name);if(categoryItem){const item=new InstanceItem({id:instanceItem.id,instance:this,categoryItemRef:categoryItem,number:instanceItem.number,cameras:instanceItem.cameras});this.items[item.id]=item;}}/**\n   * get instance items by instance item name\n   * @param instanceItemName\n   */getItemsByName(instanceItemName){return toJS(Object.values(this.items).filter(i=>i.name===instanceItemName));}/**\n   * get instance item by name & number\n   * @param instanceItemName\n   * @param instanceItemNumber\n   */getItem(instanceItemName,instanceItemNumber){const items=Object.values(this.items);return items.find(i=>i.name===instanceItemName&&i.number===instanceItemNumber);}/**\n   * set selected\n   * @param selected\n   */setSelected(selected){this.selected=selected;}/**\n   * set collasped\n   * @param collapsed\n   */setCollapsed(collapsed){this.collapsed=collapsed;}/**\n   * set attributes\n   * @param attributes\n   */setAttributes(attributes){this.attributes=cloneDeep(attributes);}/**\n   * set dynamic attributes\n   * @param camera\n   * @param updatedDynamicAttributes\n   */setDynamicAttributesByCamera(camera,updatedDynamicAttributes){for(let i=0;i<updatedDynamicAttributes.length;i+=1){const{frameIndex,attributes}=updatedDynamicAttributes[i];if(attributes){if(!this.dynamicAttributes){this.dynamicAttributes={};}if(!this.dynamicAttributes[camera]){this.dynamicAttributes[camera]={};}if(!this.dynamicAttributes[camera][frameIndex]){this.dynamicAttributes[camera][frameIndex]={frameIndex};};this.dynamicAttributes[camera][frameIndex].attributes=cloneDeep(attributes);}}}instanceDynamicAttrNeedDelete(camera,instanceItemId){const instanceItemHasCameraData=Object.values(this.items).filter(item=>{var _item$cameras;return((_item$cameras=item.cameras)===null||_item$cameras===void 0?void 0:_item$cameras[camera])&&item.id!==instanceItemId;});if(instanceItemHasCameraData&&instanceItemHasCameraData.length>0){return false;}return true;}/**\n   * delete dynamic attributes by camera 、frames、instanceItemId\n   * @param camera\n   * @param frames\n   * @param instanceItemId\n   */deleteDynamicAttributesByCamera(camera,frames,instanceItemId){var _this$dynamicAttribut;if((_this$dynamicAttribut=this.dynamicAttributes)===null||_this$dynamicAttribut===void 0?void 0:_this$dynamicAttribut[camera]){frames.forEach(frameIndex=>{var _this$items$instanceI,_this$items$instanceI2,_this$items$instanceI3,_this$items$instanceI4;const needDelete=this.instanceDynamicAttrNeedDelete(camera,instanceItemId);if(needDelete&&!((_this$items$instanceI=this.items[instanceItemId])===null||_this$items$instanceI===void 0?void 0:(_this$items$instanceI2=_this$items$instanceI.cameras)===null||_this$items$instanceI2===void 0?void 0:(_this$items$instanceI3=_this$items$instanceI2[camera])===null||_this$items$instanceI3===void 0?void 0:(_this$items$instanceI4=_this$items$instanceI3.frames)===null||_this$items$instanceI4===void 0?void 0:_this$items$instanceI4[frameIndex])){delete this.dynamicAttributes[camera][frameIndex];if(Object.keys(this.dynamicAttributes[camera]).length===0){delete this.dynamicAttributes[camera];}if(Object.keys(this.dynamicAttributes).length===0){this.dynamicAttributes=undefined;}}});}}/**\n   * remove item\n   * @param instanceItemId\n   */removeItem(instanceItemId){delete this.items[instanceItemId];}/**\n   * destroy\n   */destroy(){// remove references\nthis.items={};}dynamicAttributesJSON(){if(!this.dynamicAttributes){return undefined;}const cameras=Object.keys(this.dynamicAttributes);return cameras.map(camera=>{const frames=Object.values(this.dynamicAttributes[camera]).map(_ref2=>{let{frameIndex,attributes}=_ref2;return{frameIndex,attributes:cloneDeep(toJS(attributes))};});return{camera,frames};});}/**\n   * return structured data\n   */toJSON(){return{...this.getBasicInfo(),children:Object.values(this.items).filter(item=>!item.isEmpty).map(item=>item.toJSON())};}/**\n   * return basic info data\n   */getBasicInfo(){return{id:this.id,category:this.category,categoryName:this.categoryRef.displayName,categoryColor:this.categoryRef.displayColor,number:this.number,attributes:cloneDeep(toJS(this.attributes)),dynamicAttributes:this.dynamicAttributesJSON()};}}","map":{"version":3,"names":["makeAutoObservable","toJS","v4","uuidv4","cloneDeep","InstanceItem","Instance","category","categoryRef","className","label","concat","displayName","number","frameStatus","Object","values","items","map","i","reduce","acc","curr","existedCameras","cameras","Set","flatMap","Array","from","isEmpty","every","item","isSingle","children","length","count","constructor","_ref","id","attributes","dynamicAttributes","getNextShapeOrder","selected","collapsed","setDynamicAttributes","attrs","isArray","forEach","cameraItem","camera","frames","frameItem","frameIndex","autoBind","createItemFromData","instanceItem","categoryItem","find","c","name","instance","categoryItemRef","getItemsByName","instanceItemName","filter","getItem","instanceItemNumber","setSelected","setCollapsed","setAttributes","setDynamicAttributesByCamera","updatedDynamicAttributes","instanceDynamicAttrNeedDelete","instanceItemId","instanceItemHasCameraData","_item$cameras","deleteDynamicAttributesByCamera","_this$dynamicAttribut","_this$items$instanceI","_this$items$instanceI2","_this$items$instanceI3","_this$items$instanceI4","needDelete","keys","undefined","removeItem","destroy","dynamicAttributesJSON","_ref2","toJSON","getBasicInfo","categoryName","categoryColor","displayColor"],"sources":["/Users/qzheng/Documents/webroot/annotation_tools/src/components/video-tracking2/model/Instance.ts"],"sourcesContent":["import { makeAutoObservable, toJS } from 'mobx';\nimport { v4 as uuidv4 } from 'uuid';\nimport { cloneDeep } from 'lodash';\nimport InstanceItem from './InstanceItem';\nimport { InstanceItem as IInstanceItem, Instance as IInstance, Category, DynamicAttributes, InstanceDynamicAttributes } from '../types';\n\ninterface InstanceOptions {\n  id?: string;\n  categoryRef: Category;\n  number: number;\n  attributes?: any;\n  dynamicAttributes?: InstanceDynamicAttributes[];\n  items?: IInstanceItem[];\n  getNextShapeOrder?: (frameIndex: number, camera: string) => number;\n}\n\n/**\n * Instance\n * @class\n */\nexport default class Instance {\n  /**\n   * instance uuid\n   * @member\n   */\n  id: string;\n\n  /**\n   * category instance reference\n   * @member\n   */\n  categoryRef: Category;\n\n  /**\n   * instance number\n   * @member\n   */\n  number: number;\n\n  /**\n   * instance attributes\n   * @member\n   */\n  attributes?: any;\n\n  /**\n * instance dynamic attributes\n * @member\n */\n  dynamicAttributes?: {\n    [camera: string]: {\n      [frameIndex: number]: DynamicAttributes;\n    }\n  };\n\n\n  /**\n   * instance items\n   * @member\n   */\n  items: { [itemId: string]: InstanceItem } = {};\n\n  /**\n   * is instance selected\n   * @member\n   */\n  selected = false;\n\n  /**\n   * is instance collapsed\n   * @member\n   */\n  collapsed = false;\n\n  /**\n   * get next shape order\n   * @member\n   */\n  getNextShapeOrder?: (frameIndex: number, camera: string) => number;\n\n  /**\n   * instance category class name\n   * @getter\n   */\n  get category() {\n    return this.categoryRef.className;\n  }\n\n  /**\n   * instance label\n   * @getter\n   */\n  get label() {\n    return `${this.categoryRef.displayName}${this.number}`;\n  }\n\n  /**\n   * instance frame status (merged status)\n   * @getter\n   */\n  get frameStatus() {\n    // simple merge\n    return Object.values(this.items)\n      .map((i) => i.frameStatus)\n      .reduce((acc, curr) => ({ ...acc, ...curr }), {});\n  }\n\n  /**\n   * instance existed camera names\n   * @getter\n   */\n  get existedCameras() {\n    const cameras = new Set(Object.values(this.items).flatMap((i) => i.existedCameras));\n    return Array.from(cameras);\n  }\n\n  /**\n   * is instance empty in all camera & frames\n   * @getter\n   */\n  get isEmpty() {\n    return Object.values(this.items).every((item) => item.isEmpty);\n  }\n\n  /**\n   * is instance only contains one item\n   * @getter\n   */\n  get isSingle() {\n    const { children } = this.categoryRef;\n    return children.length === 1 && children[0].count === 1;\n  }\n\n  constructor({ id, categoryRef, number, attributes, dynamicAttributes, items = [], getNextShapeOrder }: InstanceOptions) {\n    makeAutoObservable(this, {\n      id: false,\n      categoryRef: false,\n      isEmpty: false,\n      isSingle: false,\n      getNextShapeOrder: false,\n    }, {\n      autoBind: true,\n    });\n\n    this.getNextShapeOrder = getNextShapeOrder;\n    this.id = id || uuidv4();\n    this.categoryRef = categoryRef;\n    this.number = number;\n    this.attributes = cloneDeep(attributes);\n    this.setDynamicAttributes(dynamicAttributes);\n    items.forEach((item) => this.createItemFromData(item));\n  }\n\n  /**\n   * create instance item from structured instance item data\n   * @param instanceItem\n   */\n  createItemFromData(instanceItem: IInstanceItem) {\n    const { children } = this.categoryRef;\n    const categoryItem = children.find((c) => c.name === instanceItem.name);\n    if (categoryItem) {\n      const item = new InstanceItem({\n        id: instanceItem.id,\n        instance: this,\n        categoryItemRef: categoryItem,\n        number: instanceItem.number,\n        cameras: instanceItem.cameras,\n      });\n      this.items[item.id] = item;\n    }\n  }\n\n  /**\n   * get instance items by instance item name\n   * @param instanceItemName\n   */\n  getItemsByName(instanceItemName: string) {\n    return toJS(Object.values(this.items).filter((i) => i.name === instanceItemName));\n  }\n\n  /**\n   * get instance item by name & number\n   * @param instanceItemName\n   * @param instanceItemNumber\n   */\n  getItem(instanceItemName: string, instanceItemNumber: number) {\n    const items = Object.values(this.items);\n    return items.find((i) => i.name === instanceItemName && i.number === instanceItemNumber);\n  }\n\n  /**\n   * set selected\n   * @param selected\n   */\n  setSelected(selected: boolean) {\n    this.selected = selected;\n  }\n\n  /**\n   * set collasped\n   * @param collapsed\n   */\n  setCollapsed(collapsed: boolean) {\n    this.collapsed = collapsed;\n  }\n\n  /**\n   * set attributes\n   * @param attributes\n   */\n  setAttributes(attributes: any) {\n    this.attributes = cloneDeep(attributes);\n  }\n\n  /**\n * set dynamic attributes\n * @param attrs\n */\n  setDynamicAttributes = (attrs: any) => {\n    if (Array.isArray(attrs)) {\n      const dynamicAttributes: {\n        [camera: string]: {\n          [frameIndex: number]: DynamicAttributes;\n        }\n      } = {};\n      attrs.forEach((cameraItem) => {\n        const { camera, frames } = cameraItem || {};\n        if (camera) {\n          dynamicAttributes[camera] = {};\n          if (Array.isArray(frames)) {\n            frames.forEach((frameItem) => {\n              const { frameIndex, attributes } = frameItem;\n              dynamicAttributes[camera][frameIndex] = {\n                frameIndex,\n                attributes,\n              };\n            });\n          }\n        }\n      });\n      this.dynamicAttributes = dynamicAttributes;\n    };\n  };\n\n  /**\n   * set dynamic attributes\n   * @param camera\n   * @param updatedDynamicAttributes\n   */\n  setDynamicAttributesByCamera(camera: string, updatedDynamicAttributes: DynamicAttributes[]) {\n    for (let i = 0; i < updatedDynamicAttributes.length; i += 1) {\n      const { frameIndex, attributes } = updatedDynamicAttributes[i];\n      if (attributes) {\n        if (!this.dynamicAttributes) {\n          this.dynamicAttributes = {};\n        }\n        if (!this.dynamicAttributes[camera]) {\n          this.dynamicAttributes[camera] = {};\n        }\n        if (!this.dynamicAttributes[camera][frameIndex]) {\n          this.dynamicAttributes[camera][frameIndex] = { frameIndex };\n        };\n        this.dynamicAttributes[camera][frameIndex].attributes = cloneDeep(attributes);\n      }\n    }\n  }\n\n  instanceDynamicAttrNeedDelete(camera: string, instanceItemId: string) {\n    const instanceItemHasCameraData = Object.values(this.items).filter((item) => item.cameras?.[camera] && item.id !== instanceItemId);\n    if (instanceItemHasCameraData && instanceItemHasCameraData.length > 0) {\n      return false;\n    }\n    return true;\n  }\n\n  /**\n   * delete dynamic attributes by camera 、frames、instanceItemId\n   * @param camera\n   * @param frames\n   * @param instanceItemId\n   */\n  deleteDynamicAttributesByCamera(camera: string, frames: number[], instanceItemId: string) {\n    if (this.dynamicAttributes?.[camera]) {\n      frames.forEach((frameIndex) => {\n        const needDelete = this.instanceDynamicAttrNeedDelete(camera, instanceItemId);\n        if (needDelete && !this.items[instanceItemId]?.cameras?.[camera]?.frames?.[frameIndex]) {\n          delete this.dynamicAttributes![camera][frameIndex];\n          if (Object.keys(this.dynamicAttributes![camera]).length === 0) {\n            delete this.dynamicAttributes![camera];\n          }\n          if (Object.keys(this.dynamicAttributes!).length === 0) {\n            this.dynamicAttributes = undefined;\n          }\n        }\n      });\n    }\n  }\n\n  /**\n   * remove item\n   * @param instanceItemId\n   */\n  removeItem(instanceItemId: string) {\n    delete this.items[instanceItemId];\n  }\n\n  /**\n   * destroy\n   */\n  destroy() {\n    // remove references\n    this.items = {};\n  }\n\n  dynamicAttributesJSON(): InstanceDynamicAttributes[] | undefined {\n    if (!this.dynamicAttributes) {\n      return undefined;\n    }\n    const cameras = Object.keys(this.dynamicAttributes);\n    return cameras.map((camera) => {\n      const frames = Object.values(this.dynamicAttributes![camera]).map(({ frameIndex, attributes }) => ({\n        frameIndex,\n        attributes: cloneDeep(toJS(attributes)),\n      }));\n      return {\n        camera,\n        frames,\n      };\n    });\n  }\n\n  /**\n   * return structured data\n   */\n  toJSON(): IInstance {\n    return {\n      ...this.getBasicInfo(),\n      children: Object.values(this.items)\n        .filter((item) => !item.isEmpty)\n        .map((item) => item.toJSON()),\n    };\n  }\n\n  /**\n   * return basic info data\n   */\n  getBasicInfo() {\n    return {\n      id: this.id,\n      category: this.category,\n      categoryName: this.categoryRef.displayName,\n      categoryColor: this.categoryRef.displayColor,\n      number: this.number,\n      attributes: cloneDeep(toJS(this.attributes)),\n      dynamicAttributes: this.dynamicAttributesJSON(),\n    };\n  }\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}