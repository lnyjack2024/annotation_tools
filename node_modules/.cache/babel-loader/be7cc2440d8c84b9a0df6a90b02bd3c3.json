{"ast":null,"code":"var _jsxFileName = \"/Users/qzheng/Documents/webroot/annotation_tools/src/components/audio-temp2/index.js\";\nimport React from 'react';\nimport WaveSurfer from 'wavesurfer.js';\nimport TimelinePlugin from 'wavesurfer.js/dist/plugin/wavesurfer.timeline.min.js';\nimport RegionsPlugin from 'wavesurfer.js/dist/plugin/wavesurfer.regions.min.js';\nimport hexToRgba from 'hex-to-rgba';\nimport { IoMdPlay, IoMdRewind, IoMdFastforward, IoMdPause } from 'react-icons/io';\nimport { InputNumber, Select, Input } from 'antd';\nimport { store } from '../../utils';\nimport './audio.css';\nconst toolName = 'audio-temp2';\nconst defaultColor = '#5ceee4';\nconst defaultAlpha = 0.45;\nconst {\n  Option\n} = Select;\nexport default class AudioAnnotationApp extends React.Component {\n  constructor(...args) {\n    super(...args);\n    this.state = {\n      isPlaying: false,\n      isEditing: false,\n      summary: '',\n      category: '',\n      start: '',\n      end: '',\n      note: '',\n      unitId: '',\n      numType: 'NUM',\n      numHan: '',\n      numGeneral: '',\n      focus: false\n    };\n    this.wavesurfer = null;\n    this.workingRegion = null;\n    this.ontologyColors = new Map([...(this.props.ontology && Array.isArray(this.props.ontology) && this.props.ontology.map(i => [i.class_name, i.display_color]))]);\n    this.playPause = e => {\n      e.preventDefault();\n      this.setState({\n        isPlaying: !this.state.isPlaying\n      });\n      this.wavesurfer.playPause();\n    };\n    this.skipBackward = e => {\n      e.preventDefault();\n      this.wavesurfer.skipBackward();\n    };\n    this.skipForward = e => {\n      e.preventDefault();\n      this.wavesurfer.skipForward();\n    };\n    this.showSummary = region => {\n      this.setState({\n        summary: region.data.note\n      });\n    };\n    this.hideSummary = () => {\n      this.setState({\n        summary: ''\n      });\n    };\n    this.onRegionClick = (region, e) => {\n      e.stopPropagation();\n      // Play on click, loop on shift click\n      e.shiftKey ? region.playLoop() : region.play();\n      this.onRegionEdit(region);\n    };\n    this.onRegionEdit = region => {\n      this.workingRegion = region;\n      this.setState({\n        isEditing: true,\n        category: (region.data || {}).category || '',\n        start: this.roundTime(region.start),\n        //Math.round(region.start * 10) / 10,\n        end: this.roundTime(region.end),\n        // Math.round(region.end * 10) / 10,\n        note: (region.data || {}).note || ''\n      });\n\n      // save to region\n      this.workingRegion.update({\n        data: {\n          note: this.state.note,\n          category: this.state.category\n        }\n      });\n      this.saveRegions();\n    };\n    this.onRegionUpdate = region => {\n      this.saveRegions();\n      if (this.workingRegion) {\n        this.setState({\n          start: this.roundTime(region.start),\n          //Math.round(region.start * 10) / 10,\n          end: this.roundTime(region.end) // Math.round(region.end * 10) / 10,\n        });\n      }\n    };\n    this.handleCategorySelect = (category, e) => {\n      e.preventDefault();\n      this.setState({\n        category: category.class_name\n      });\n\n      // save to region\n      this.workingRegion.update({\n        color: hexToRgba(category.display_color, defaultAlpha),\n        data: {\n          note: this.state.note,\n          category: category.class_name\n        }\n      });\n      this.saveRegions();\n    };\n    this.handleRegionDelete = e => {\n      e.preventDefault();\n      this.workingRegion.remove();\n      this.workingRegion = null;\n      this.saveRegions();\n      this.setState({\n        isEditing: false\n      });\n    };\n    this.handleRegionSave = e => {\n      e.preventDefault();\n      const {\n        category,\n        start,\n        end,\n        note\n      } = this.state;\n      this.workingRegion.update({\n        start,\n        end,\n        data: {\n          category,\n          note\n        }\n      });\n      this.workingRegion = null;\n      this.saveRegions();\n      this.setState({\n        isEditing: false\n      });\n    };\n    this.setSpeed = n => {\n      const rate = this.speedFormula(n);\n      this.wavesurfer.setPlaybackRate(rate);\n    };\n  }\n  componentDidMount() {\n    this.wavesurfer = WaveSurfer.create({\n      container: '#wave',\n      pixelRatio: 1,\n      scrollParent: true,\n      normalize: true,\n      minimap: true,\n      backend: 'MediaElement',\n      backgroundColor: '#504D66',\n      waveColor: '#27253c',\n      progressColor: '#F7963D',\n      cursorColor: '#F7963D',\n      plugins: [RegionsPlugin.create(), TimelinePlugin.create({\n        container: '#wave-timeline',\n        primaryColor: '#EDEDEF',\n        secondaryColor: '#DCDBE0',\n        primaryFontColor: '#EDEDEF',\n        secondaryFontColor: '#DCDBE0'\n      })]\n    });\n    this.wavesurfer.load(this.props.audio);\n    this.wavesurfer.on('ready', () => {\n      this.wavesurfer.enableDragSelection({\n        color: hexToRgba(defaultColor, defaultAlpha)\n      });\n      const {\n        mode,\n        unit_id\n      } = this.props;\n      const unitId = unit_id;\n      this.setState({\n        unitId: unitId\n      });\n      const {\n        jobId,\n        taskId\n      } = this.resolveUnitId(unitId);\n      const isCacheValid = this.isCacheValid(mode, jobId, taskId);\n      if (!isCacheValid) {\n        store.clear(toolName);\n      }\n      store.setStorage(toolName, 'baseInfo', {\n        mode,\n        jobId,\n        taskId\n      });\n      const storedRegions = store.getStorage(toolName, unitId);\n      if (storedRegions) {\n        this.loadRegions(storedRegions);\n      } else {\n        const annotation = this.props.review_from;\n        if (annotation && annotation.length > 0) {\n          this.loadRegions(annotation);\n          this.saveRegions();\n        }\n      }\n    });\n\n    // bind actions\n    this.wavesurfer.on('play', () => {\n      this.setState({\n        isPlaying: true\n      });\n    });\n    this.wavesurfer.on('pause', () => {\n      this.setState({\n        isPlaying: false\n      });\n    });\n    this.wavesurfer.on('region-in', this.showSummary);\n    this.wavesurfer.on('region-out', this.hideSummary);\n    this.wavesurfer.on('region-click', this.onRegionClick);\n    this.wavesurfer.on('region-update-end', this.onRegionEdit);\n    this.wavesurfer.on('region-updated', this.onRegionUpdate);\n    document.addEventListener('keydown', e => {\n      const {\n        keyCode\n      } = e;\n      switch (keyCode) {\n        case 32:\n          e.preventDefault();\n          this.wavesurfer.playPause();\n          break;\n        case 37:\n          // left arrow\n          !this.state.focus && this.skipBackward(e);\n          break;\n        case 39:\n          // right arrow\n          !this.state.focus && this.skipForward(e);\n          break;\n        default:\n      }\n    });\n  }\n  resolveUnitId(unitId) {\n    const units = unitId.split(\"_\");\n    let jobId, taskId, recordId;\n    if (units && units.length >= 3) {\n      jobId = units[0];\n      taskId = units[1];\n      recordId = units[2];\n    }\n    return {\n      jobId,\n      taskId,\n      recordId\n    };\n  }\n  exportResult() {\n    // return store.getStorage(toolName, 'regions');\n    return Object.keys(this.wavesurfer.regions.list).map(id => {\n      const {\n        start,\n        end,\n        data\n      } = this.wavesurfer.regions.list[id];\n      return {\n        start: this.roundTime(start),\n        end: this.roundTime(end),\n        data\n      };\n    });\n  }\n  isCacheValid(mode, jobId, taskId) {\n    try {\n      const baseInfo = store.getStorage(toolName, 'baseInfo');\n      if (baseInfo && jobId === baseInfo.jobId && taskId === baseInfo.taskId && mode === baseInfo.mode) {\n        return true;\n      }\n    } catch (e) {\n      // failed to parse baseInfo\n    }\n    return false;\n  }\n  loadRegions(regions) {\n    regions.forEach(region => {\n      const regionColor = this.ontologyColors.get(region.data.category) || defaultColor;\n      region.color = hexToRgba(regionColor, defaultAlpha);\n      this.wavesurfer.addRegion(region);\n    });\n  }\n  saveRegions() {\n    const regions = Object.keys(this.wavesurfer.regions.list).map(id => {\n      const {\n        start,\n        end,\n        data\n      } = this.wavesurfer.regions.list[id];\n      return {\n        start: this.roundTime(start),\n        end: this.roundTime(end),\n        data\n      };\n    });\n    store.setStorage(toolName, this.state.unitId, regions);\n  }\n  roundTime(time) {\n    return Math.round(time * 1000) / 1000;\n  }\n  speedFormula(n) {\n    const num = parseInt(n);\n    if (isNaN(num)) return 1.0;\n    let rate = (1 + 0.1 * num).toFixed(1);\n    if (rate > 2) return 2.0;\n    if (rate < 0.1) return 0.1;\n    return rate;\n  }\n  setCaret(textObj) {\n    if (textObj.createTextRange) {\n      textObj.caretPos = document.selection.createRange().duplicate();\n    }\n  }\n  insertAtCaret(textFieldValue) {\n    let textObj = document.getElementById(`${toolName}-input-note`);\n    let rangeStart = textObj.selectionStart;\n    let rangeEnd = textObj.selectionEnd;\n    let tempStr1 = textObj.value.substring(0, rangeStart);\n    let tempStr2 = textObj.value.substring(rangeEnd);\n    textObj.value = tempStr1 + '' + textFieldValue + '' + tempStr2;\n    this.setState({\n      note: tempStr1 + '' + textFieldValue + '' + tempStr2\n    });\n    let newStart = rangeStart + textFieldValue.length;\n    textObj.setSelectionRange(newStart, newStart);\n    textObj.focus();\n    // this.setCaret(textObj);\n  }\n  insertNumber() {\n    let type = this.state.numType;\n    let han = this.state.numHan;\n    let general = this.state.numGeneral;\n    this.insertAtCaret(`[${type}#${han}#${general}]`);\n  }\n  inputKeyDown(e) {\n    let key = e.keyCode;\n    let text = e.target.value;\n    let selectionStart = e.target.selectionStart;\n    let selectionEnd = e.target.selectionEnd;\n    let {\n      start,\n      end\n    } = this.getMatchStartEnd(text, selectionStart, selectionEnd);\n    // console.log(start, end, selectionStart, selectionEnd);\n    if (key === 8) {\n      e.preventDefault();\n      if (start !== selectionStart || end !== selectionEnd) {\n        let pre = text.substring(0, start);\n        let post = text.substring(end);\n        e.target.value = `${pre}${post}`;\n        this.setState({\n          note: `${pre}${post}`\n        });\n      } else {\n        let pre = text.substring(0, start > 0 && start === end ? start - 1 : start);\n        let post = text.substring(end);\n        e.target.value = `${pre}${post}`;\n        this.setState({\n          note: `${pre}${post}`\n        });\n      }\n      if (start > 0 && start === end) {\n        e.target.setSelectionRange(start - 1, start - 1);\n      } else {\n        e.target.setSelectionRange(start, start);\n      }\n      // e.target.focus();\n    } else if (key === 37) {\n      if (start !== selectionStart) {\n        e.target.setSelectionRange(start + 1, start + 1);\n      }\n    } else if (key === 39) {\n      if (end !== selectionEnd) {\n        e.target.setSelectionRange(end - 1, end - 1);\n      }\n    } else if (start < selectionStart && end > selectionEnd) {\n      e.preventDefault();\n      return;\n    }\n  }\n  getMatchStartEnd(text, selectionStart, selectionEnd) {\n    const matches = /\\[(\\w|\\d|#|\\p{L})+\\]/gu;\n    let start = selectionStart;\n    let end = selectionEnd;\n    for (let match; (match = matches.exec(text)) !== null;) {\n      if (match.index < selectionStart && matches.lastIndex >= selectionEnd) {\n        start = match.index;\n        end = matches.lastIndex;\n      }\n    }\n\n    // matches && matches.find(match => {\n    //   const matchIndex = text.indexOf(match);\n    //   if (position > matchIndex && position <= matchIndex + match.length) {\n    //     start = matchIndex;\n    //     end = matchIndex + match.length;\n    //   }\n    // });\n\n    return {\n      start,\n      end\n    };\n  }\n  render() {\n    const {\n      isPlaying,\n      isEditing,\n      summary,\n      category,\n      start,\n      end,\n      note\n    } = this.state;\n    return /*#__PURE__*/React.createElement(\"div\", {\n      className: `${toolName}-container`,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 386,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      id: \"wave\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 387,\n        columnNumber: 9\n      }\n    }), /*#__PURE__*/React.createElement(\"div\", {\n      id: \"wave-timeline\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 388,\n        columnNumber: 9\n      }\n    }), /*#__PURE__*/React.createElement(\"div\", {\n      className: `${toolName}-btn-group`,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 390,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(\"button\", {\n      className: `${toolName}-audio-btn`,\n      onClick: this.skipBackward,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 391,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(IoMdRewind, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 392,\n        columnNumber: 13\n      }\n    })), /*#__PURE__*/React.createElement(\"button\", {\n      className: `${toolName}-audio-btn`,\n      onClick: this.playPause,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 394,\n        columnNumber: 11\n      }\n    }, isPlaying ? /*#__PURE__*/React.createElement(IoMdPause, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 395,\n        columnNumber: 26\n      }\n    }) : /*#__PURE__*/React.createElement(IoMdPlay, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 395,\n        columnNumber: 42\n      }\n    })), /*#__PURE__*/React.createElement(\"button\", {\n      className: `${toolName}-audio-btn`,\n      onClick: this.skipForward,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 397,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(IoMdFastforward, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 398,\n        columnNumber: 13\n      }\n    })), /*#__PURE__*/React.createElement(\"span\", {\n      className: `${toolName}-speed-control`,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 400,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(\"span\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 401,\n        columnNumber: 13\n      }\n    }, \"\\u64AD\\u653E\\u901F\\u7387: \"), /*#__PURE__*/React.createElement(InputNumber, {\n      id: `${toolName}-speed-btn`,\n      defaultValue: 0,\n      min: -9,\n      max: 10,\n      step: 1,\n      type: \"number\",\n      size: \"small\",\n      formatter: value => this.speedFormula(value),\n      onChange: this.setSpeed,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 402,\n        columnNumber: 13\n      }\n    }))), /*#__PURE__*/React.createElement(\"div\", {\n      className: `${toolName}-summary`,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 416,\n        columnNumber: 9\n      }\n    }, summary), isEditing && /*#__PURE__*/React.createElement(\"form\", {\n      className: `${toolName}-form`,\n      onSubmit: this.handleRegionSave,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 419,\n        columnNumber: 11\n      }\n    }, this.props.ontology && this.props.ontology.length > 0 && /*#__PURE__*/React.createElement(\"div\", {\n      className: `${toolName}-form-group`,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 422,\n        columnNumber: 15\n      }\n    }, /*#__PURE__*/React.createElement(\"label\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 423,\n        columnNumber: 17\n      }\n    }, \"\\u9009\\u62E9\\u89D2\\u8272\"), this.props.ontology.map(i => /*#__PURE__*/React.createElement(\"div\", {\n      key: i.key,\n      className: `${toolName}-ontology-btn ${i.class_name === category ? 'label-selected' : 'label-unselected'}`,\n      style: {\n        background: i.display_color\n      },\n      onClick: e => this.handleCategorySelect(i, e),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 425,\n        columnNumber: 21\n      }\n    }, i.class_name))), /*#__PURE__*/React.createElement(\"div\", {\n      className: `${toolName}-form-group`,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 437,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(\"label\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 438,\n        columnNumber: 15\n      }\n    }, \"\\u5F00\\u59CB\\u65F6\\u95F4\"), /*#__PURE__*/React.createElement(\"input\", {\n      type: \"text\",\n      value: start,\n      onChange: e => this.setState({\n        start: e.target.value\n      }),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 439,\n        columnNumber: 15\n      }\n    })), /*#__PURE__*/React.createElement(\"div\", {\n      className: `${toolName}-form-group`,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 442,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(\"label\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 443,\n        columnNumber: 15\n      }\n    }, \"\\u7ED3\\u675F\\u65F6\\u95F4\"), /*#__PURE__*/React.createElement(\"input\", {\n      type: \"text\",\n      value: end,\n      onChange: e => this.setState({\n        end: e.target.value\n      }),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 444,\n        columnNumber: 15\n      }\n    })), /*#__PURE__*/React.createElement(\"div\", {\n      className: `${toolName}-form-group`,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 447,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(\"label\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 448,\n        columnNumber: 15\n      }\n    }, \"\\u8F93\\u5165\\u6587\\u672C\"), /*#__PURE__*/React.createElement(\"input\", {\n      type: \"text\",\n      value: note,\n      id: `${toolName}-input-note`,\n      onSelect: this.setCaret(this),\n      onClick: this.setCaret(this),\n      onKeyUp: this.setCaret(this),\n      onChange: e => this.setState({\n        note: e.target.value\n      }),\n      onKeyDown: e => this.inputKeyDown(e),\n      onFocus: e => this.setState({\n        focus: true\n      }),\n      onBlur: e => this.setState({\n        focus: false\n      }),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 449,\n        columnNumber: 15\n      }\n    })), /*#__PURE__*/React.createElement(\"div\", {\n      className: `${toolName}-form-group`,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 463,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(\"label\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 464,\n        columnNumber: 15\n      }\n    }, \"\\u63D2\\u5165\\u6807\\u7B7E\"), /*#__PURE__*/React.createElement(\"div\", {\n      className: `${toolName}-ontology-btn`,\n      style: {\n        background: '#F6F4FC'\n      },\n      onClick: e => this.insertAtCaret('[noise]'),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 465,\n        columnNumber: 15\n      }\n    }, \"\\u566A\\u97F3\"), /*#__PURE__*/React.createElement(\"div\", {\n      className: `${toolName}-ontology-btn`,\n      style: {\n        background: '#F6F4FC'\n      },\n      onClick: e => this.insertAtCaret('[cough]'),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 471,\n        columnNumber: 15\n      }\n    }, \"\\u6E05\\u55D3\\u5B50\"), /*#__PURE__*/React.createElement(\"div\", {\n      className: `${toolName}-ontology-btn`,\n      style: {\n        background: '#F6F4FC'\n      },\n      onClick: e => this.insertAtCaret('[throat]'),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 477,\n        columnNumber: 15\n      }\n    }, \"\\u54B3\\u55FD\"), /*#__PURE__*/React.createElement(\"div\", {\n      className: `${toolName}-ontology-btn`,\n      style: {\n        background: '#F6F4FC'\n      },\n      onClick: e => this.insertAtCaret('[laugh]'),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 483,\n        columnNumber: 15\n      }\n    }, \"\\u7B11\\u58F0\")), /*#__PURE__*/React.createElement(\"div\", {\n      className: `${toolName}-form-group`,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 491,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(\"label\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 492,\n        columnNumber: 15\n      }\n    }, \"\\u63D2\\u5165\\u6570\\u5B57\"), /*#__PURE__*/React.createElement(Select, {\n      id: `${toolName}-num-select`,\n      labelInValue: true,\n      defaultValue: {\n        key: this.state.numType\n      },\n      style: {\n        width: 80\n      },\n      onChange: value => {\n        this.setState({\n          numType: value.key\n        });\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 493,\n        columnNumber: 15\n      }\n    }, /*#__PURE__*/React.createElement(Option, {\n      value: \"NUM\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 500,\n        columnNumber: 17\n      }\n    }, \"\\u6570\\u5B57\"), /*#__PURE__*/React.createElement(Option, {\n      value: \"TEL\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 501,\n        columnNumber: 17\n      }\n    }, \"\\u7535\\u8BDD\"), /*#__PURE__*/React.createElement(Option, {\n      value: \"TIME\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 502,\n        columnNumber: 17\n      }\n    }, \"\\u65F6\\u95F4\")), /*#__PURE__*/React.createElement(\"span\", {\n      style: {\n        margin: '0 5px'\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 504,\n        columnNumber: 15\n      }\n    }, \"\\u6C49\\u5B57\\u53D1\\u97F3\"), /*#__PURE__*/React.createElement(Input, {\n      id: `${toolName}-num-han`,\n      style: {\n        width: 120\n      },\n      onChange: e => this.setState({\n        numHan: e.target.value\n      }),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 505,\n        columnNumber: 15\n      }\n    }), /*#__PURE__*/React.createElement(\"span\", {\n      style: {\n        margin: '0 5px'\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 509,\n        columnNumber: 15\n      }\n    }, \"\\u65E5\\u5E38\\u5199\\u6CD5\"), /*#__PURE__*/React.createElement(Input, {\n      id: `${toolName}-num-general`,\n      style: {\n        width: 120\n      },\n      onChange: e => this.setState({\n        numGeneral: e.target.value\n      }),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 510,\n        columnNumber: 15\n      }\n    }), /*#__PURE__*/React.createElement(\"div\", {\n      className: `${toolName}-ontology-btn`,\n      style: {\n        background: '#F6F4FC',\n        margin: '0 5px'\n      },\n      onClick: e => this.insertNumber(),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 514,\n        columnNumber: 15\n      }\n    }, \"\\u786E\\u5B9A\")), /*#__PURE__*/React.createElement(\"button\", {\n      className: `${toolName}-action-btn`,\n      type: \"submit\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 523,\n        columnNumber: 13\n      }\n    }, \"\\u4FDD\\u5B58\"), /*#__PURE__*/React.createElement(\"button\", {\n      className: `${toolName}-action-btn danger`,\n      onClick: this.handleRegionDelete,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 526,\n        columnNumber: 13\n      }\n    }, \"\\u5220\\u9664\")));\n  }\n}","map":{"version":3,"names":["React","WaveSurfer","TimelinePlugin","RegionsPlugin","hexToRgba","IoMdPlay","IoMdRewind","IoMdFastforward","IoMdPause","InputNumber","Select","Input","store","toolName","defaultColor","defaultAlpha","Option","AudioAnnotationApp","Component","constructor","args","state","isPlaying","isEditing","summary","category","start","end","note","unitId","numType","numHan","numGeneral","focus","wavesurfer","workingRegion","ontologyColors","Map","props","ontology","Array","isArray","map","i","class_name","display_color","playPause","e","preventDefault","setState","skipBackward","skipForward","showSummary","region","data","hideSummary","onRegionClick","stopPropagation","shiftKey","playLoop","play","onRegionEdit","roundTime","update","saveRegions","onRegionUpdate","handleCategorySelect","color","handleRegionDelete","remove","handleRegionSave","setSpeed","n","rate","speedFormula","setPlaybackRate","componentDidMount","create","container","pixelRatio","scrollParent","normalize","minimap","backend","backgroundColor","waveColor","progressColor","cursorColor","plugins","primaryColor","secondaryColor","primaryFontColor","secondaryFontColor","load","audio","on","enableDragSelection","mode","unit_id","jobId","taskId","resolveUnitId","isCacheValid","clear","setStorage","storedRegions","getStorage","loadRegions","annotation","review_from","length","document","addEventListener","keyCode","units","split","recordId","exportResult","Object","keys","regions","list","id","baseInfo","forEach","regionColor","get","addRegion","time","Math","round","num","parseInt","isNaN","toFixed","setCaret","textObj","createTextRange","caretPos","selection","createRange","duplicate","insertAtCaret","textFieldValue","getElementById","rangeStart","selectionStart","rangeEnd","selectionEnd","tempStr1","value","substring","tempStr2","newStart","setSelectionRange","insertNumber","type","han","general","inputKeyDown","key","text","target","getMatchStartEnd","pre","post","matches","match","exec","index","lastIndex","render","createElement","className","__self","__source","fileName","_jsxFileName","lineNumber","columnNumber","onClick","defaultValue","min","max","step","size","formatter","onChange","onSubmit","style","background","onSelect","onKeyUp","onKeyDown","onFocus","onBlur","labelInValue","width","margin"],"sources":["/Users/qzheng/Documents/webroot/annotation_tools/src/components/audio-temp2/index.js"],"sourcesContent":["import React from 'react';\nimport WaveSurfer from 'wavesurfer.js';\nimport TimelinePlugin from 'wavesurfer.js/dist/plugin/wavesurfer.timeline.min.js';\nimport RegionsPlugin from 'wavesurfer.js/dist/plugin/wavesurfer.regions.min.js';\nimport hexToRgba from 'hex-to-rgba';\nimport { IoMdPlay, IoMdRewind, IoMdFastforward, IoMdPause } from 'react-icons/io';\nimport { InputNumber, Select, Input } from 'antd';\n\nimport { store } from '../../utils';\nimport './audio.css';\n\nconst toolName = 'audio-temp2';\nconst defaultColor = '#5ceee4';\nconst defaultAlpha = 0.45;\nconst { Option } = Select;\nexport default class AudioAnnotationApp extends React.Component {\n  state = {\n    isPlaying: false,\n    isEditing: false,\n    summary: '',\n    category: '',\n    start: '',\n    end: '',\n    note: '',\n    unitId: '',\n    numType: 'NUM',\n    numHan: '',\n    numGeneral: '',\n    focus: false,\n  };\n\n  wavesurfer = null;\n  workingRegion = null;\n  ontologyColors = new Map([\n    ...this.props.ontology && Array.isArray(this.props.ontology) &&\n    this.props.ontology.map(i => ([i.class_name, i.display_color])),\n  ]);\n\n  componentDidMount() {\n    this.wavesurfer = WaveSurfer.create({\n      container: '#wave',\n      pixelRatio: 1,\n      scrollParent: true,\n      normalize: true,\n      minimap: true,\n      backend: 'MediaElement',\n      backgroundColor: '#504D66',\n      waveColor: '#27253c',\n      progressColor: '#F7963D',\n      cursorColor: '#F7963D',\n      plugins: [\n        RegionsPlugin.create(),\n        TimelinePlugin.create({\n          container: '#wave-timeline',\n          primaryColor: '#EDEDEF',\n          secondaryColor: '#DCDBE0',\n          primaryFontColor: '#EDEDEF',\n          secondaryFontColor: '#DCDBE0',\n        })\n      ]\n    });\n    this.wavesurfer.load(this.props.audio);\n\n    this.wavesurfer.on('ready', () => {\n      this.wavesurfer.enableDragSelection({\n        color: hexToRgba(defaultColor, defaultAlpha)\n      });\n\n      const { mode, unit_id } = this.props;\n      const unitId = unit_id;\n      this.setState({ unitId: unitId });\n      const { jobId, taskId } = this.resolveUnitId(unitId);\n\n      const isCacheValid = this.isCacheValid(mode, jobId, taskId);\n      if (!isCacheValid) {\n        store.clear(toolName);\n      }\n      store.setStorage(toolName, 'baseInfo', { mode, jobId, taskId });\n\n      const storedRegions = store.getStorage(toolName, unitId);\n      if (storedRegions) {\n        this.loadRegions(storedRegions);\n      } else {\n        const annotation = this.props.review_from;\n        if (annotation && annotation.length > 0) {\n          this.loadRegions(annotation);\n          this.saveRegions();\n        }\n      }\n    });\n\n    // bind actions\n    this.wavesurfer.on('play', () => {\n      this.setState({ isPlaying: true });\n    });\n    this.wavesurfer.on('pause', () => {\n      this.setState({ isPlaying: false });\n    });\n    this.wavesurfer.on('region-in', this.showSummary);\n    this.wavesurfer.on('region-out', this.hideSummary);\n    this.wavesurfer.on('region-click', this.onRegionClick);\n    this.wavesurfer.on('region-update-end', this.onRegionEdit);\n    this.wavesurfer.on('region-updated', this.onRegionUpdate);\n\n    document.addEventListener('keydown', (e) => {\n      const { keyCode } = e;\n      switch (keyCode) {\n        case 32:\n          e.preventDefault();\n          this.wavesurfer.playPause();\n          break;\n        case 37: // left arrow\n          !this.state.focus && this.skipBackward(e);\n          break;\n        case 39: // right arrow\n          !this.state.focus && this.skipForward(e);\n          break\n        default:\n      }\n    });\n  }\n\n  resolveUnitId(unitId) {\n    const units = unitId.split(\"_\");\n    let jobId, taskId, recordId;\n    if (units && units.length >= 3) {\n      jobId = units[0];\n      taskId = units[1];\n      recordId = units[2];\n    }\n    return {\n      jobId,\n      taskId,\n      recordId,\n    }\n  }\n\n  exportResult() {\n    // return store.getStorage(toolName, 'regions');\n    return Object.keys(this.wavesurfer.regions.list).map((id) => {\n      const { start, end, data } = this.wavesurfer.regions.list[id];\n      return { start: this.roundTime(start), end: this.roundTime(end), data };\n    });\n  }\n\n  isCacheValid(mode, jobId, taskId) {\n    try {\n      const baseInfo = store.getStorage(toolName, 'baseInfo');\n      if (baseInfo && jobId === baseInfo.jobId && taskId === baseInfo.taskId && mode === baseInfo.mode) {\n        return true;\n      }\n    } catch (e) {\n      // failed to parse baseInfo\n    }\n    return false;\n  }\n\n  loadRegions(regions) {\n    regions.forEach((region) => {\n      const regionColor = this.ontologyColors.get(region.data.category) || defaultColor;\n      region.color = hexToRgba(regionColor, defaultAlpha);\n      this.wavesurfer.addRegion(region);\n    });\n  }\n\n  saveRegions() {\n    const regions = Object.keys(this.wavesurfer.regions.list).map((id) => {\n      const { start, end, data } = this.wavesurfer.regions.list[id];\n      return { start: this.roundTime(start), end: this.roundTime(end), data };\n    });\n    store.setStorage(toolName, this.state.unitId, regions);\n  }\n\n  roundTime(time) {\n    return Math.round(time * 1000) / 1000;\n  }\n\n  playPause = (e) => {\n    e.preventDefault();\n    this.setState({ isPlaying: !this.state.isPlaying });\n    this.wavesurfer.playPause();\n  }\n\n  skipBackward = (e) => {\n    e.preventDefault();\n    this.wavesurfer.skipBackward();\n  }\n\n  skipForward = (e) => {\n    e.preventDefault();\n    this.wavesurfer.skipForward();\n  }\n\n  showSummary = (region) => {\n    this.setState({ summary: region.data.note });\n  }\n\n  hideSummary = () => {\n    this.setState({ summary: '' });\n  }\n\n  onRegionClick = (region, e) => {\n    e.stopPropagation();\n    // Play on click, loop on shift click\n    e.shiftKey ? region.playLoop() : region.play();\n\n    this.onRegionEdit(region);\n  }\n\n  onRegionEdit = (region) => {\n    this.workingRegion = region;\n    this.setState({\n      isEditing: true,\n      category: (region.data || {}).category || '',\n      start: this.roundTime(region.start), //Math.round(region.start * 10) / 10,\n      end: this.roundTime(region.end), // Math.round(region.end * 10) / 10,\n      note: (region.data || {}).note || '',\n    });\n\n    // save to region\n    this.workingRegion.update({\n      data: {\n        note: this.state.note,\n        category: this.state.category,\n      }\n    });\n    this.saveRegions();\n  }\n\n  onRegionUpdate = (region) => {\n    this.saveRegions();\n\n    if (this.workingRegion) {\n      this.setState({\n        start: this.roundTime(region.start), //Math.round(region.start * 10) / 10,\n        end: this.roundTime(region.end), // Math.round(region.end * 10) / 10,\n      });\n    }\n  }\n\n  handleCategorySelect = (category, e) => {\n    e.preventDefault();\n    this.setState({ category: category.class_name });\n\n    // save to region\n    this.workingRegion.update({\n      color: hexToRgba(category.display_color, defaultAlpha),\n      data: {\n        note: this.state.note,\n        category: category.class_name,\n      }\n    });\n    this.saveRegions();\n  }\n\n  handleRegionDelete = (e) => {\n    e.preventDefault();\n    this.workingRegion.remove();\n    this.workingRegion = null;\n    this.saveRegions();\n    this.setState({ isEditing: false });\n  }\n\n  handleRegionSave = (e) => {\n    e.preventDefault();\n    const { category, start, end, note } = this.state;\n    this.workingRegion.update({\n      start,\n      end,\n      data: { category, note },\n    });\n    this.workingRegion = null;\n    this.saveRegions();\n    this.setState({ isEditing: false });\n  }\n\n  setSpeed = (n) => {\n    const rate = this.speedFormula(n);\n    this.wavesurfer.setPlaybackRate(rate);\n  }\n\n  speedFormula(n) {\n    const num = parseInt(n);\n    if (isNaN(num)) return 1.0;\n    let rate = (1 + 0.1 * num).toFixed(1);\n    if (rate > 2) return 2.0;\n    if (rate < 0.1) return 0.1;\n    return rate;\n  }\n\n  setCaret(textObj) {\n    if (textObj.createTextRange) {\n      textObj.caretPos = document.selection.createRange().duplicate();\n    }\n  }\n\n  insertAtCaret(textFieldValue) {\n    let textObj = document.getElementById(`${toolName}-input-note`);\n    let rangeStart = textObj.selectionStart;\n    let rangeEnd = textObj.selectionEnd;\n    let tempStr1 = textObj.value.substring(0, rangeStart);\n    let tempStr2 = textObj.value.substring(rangeEnd);\n    textObj.value = tempStr1 + '' + textFieldValue + '' + tempStr2;\n    this.setState({note: tempStr1 + '' + textFieldValue + '' + tempStr2});\n    let newStart = rangeStart + textFieldValue.length;\n    textObj.setSelectionRange(newStart, newStart);\n    textObj.focus();\n    // this.setCaret(textObj);\n  }\n\n  insertNumber() {\n    let type = this.state.numType;\n    let han = this.state.numHan;\n    let general = this.state.numGeneral;\n    this.insertAtCaret(`[${type}#${han}#${general}]`);\n  }\n\n  inputKeyDown(e) {\n    let key = e.keyCode;\n    let text = e.target.value;\n    let selectionStart = e.target.selectionStart;\n    let selectionEnd = e.target.selectionEnd;\n    let {start, end} = this.getMatchStartEnd(text, selectionStart, selectionEnd);\n    // console.log(start, end, selectionStart, selectionEnd);\n    if (key === 8)  {\n      e.preventDefault();\n      if (start !== selectionStart || end !== selectionEnd) {\n        let pre = text.substring(0, start);\n        let post = text.substring(end);\n        e.target.value = `${pre}${post}`;\n        this.setState({note: `${pre}${post}`});\n      } else {\n        let pre = text.substring(0, start > 0 && start === end ? start - 1 : start);\n        let post = text.substring(end);\n        e.target.value = `${pre}${post}`;\n        this.setState({note: `${pre}${post}`});\n      }\n      if (start > 0 && start === end) {\n        e.target.setSelectionRange(start - 1, start - 1);\n      } else {\n        e.target.setSelectionRange(start, start);\n      }\n      // e.target.focus();\n    } else if (key === 37) {\n      if (start !== selectionStart) {\n        e.target.setSelectionRange(start + 1, start + 1);\n      }\n    } else if (key === 39) {\n      if (end !== selectionEnd) {\n        e.target.setSelectionRange(end -1 , end - 1);\n      }\n    } else if (start < selectionStart && end > selectionEnd) {\n      e.preventDefault();\n      return;\n    }\n  }\n\n  getMatchStartEnd(text, selectionStart, selectionEnd) {\n    const matches = /\\[(\\w|\\d|#|\\p{L})+\\]/gu;\n\n    let start = selectionStart;\n    let end = selectionEnd;\n\n    for (let match; (match = matches.exec(text)) !== null;) {\n      if (match.index < selectionStart && matches.lastIndex >= selectionEnd) {\n        start = match.index;\n        end = matches.lastIndex;\n      }\n    }\n\n    // matches && matches.find(match => {\n    //   const matchIndex = text.indexOf(match);\n    //   if (position > matchIndex && position <= matchIndex + match.length) {\n    //     start = matchIndex;\n    //     end = matchIndex + match.length;\n    //   }\n    // });\n\n    return {start, end};\n  }\n\n  render() {\n    const { isPlaying, isEditing, summary, category, start, end, note } = this.state;\n\n    return (\n      <div className={`${toolName}-container`}>\n        <div id=\"wave\" />\n        <div id=\"wave-timeline\" />\n\n        <div className={`${toolName}-btn-group`}>\n          <button className={`${toolName}-audio-btn`} onClick={this.skipBackward}>\n            <IoMdRewind />\n          </button>\n          <button className={`${toolName}-audio-btn`} onClick={this.playPause}>\n            {isPlaying ? <IoMdPause /> : <IoMdPlay />}\n          </button>\n          <button className={`${toolName}-audio-btn`} onClick={this.skipForward}>\n            <IoMdFastforward />\n          </button>\n          <span className={`${toolName}-speed-control`}>\n            <span>播放速率: </span>\n            <InputNumber\n              id={`${toolName}-speed-btn`}\n              defaultValue={0}\n              min={-9}\n              max={10}\n              step={1}\n              type={\"number\"}\n              size={\"small\"}\n              formatter={value => this.speedFormula(value)}\n              onChange={this.setSpeed}\n            />\n          </span>\n        </div>\n\n        <div className={`${toolName}-summary`}>{summary}</div>\n\n        {isEditing && (\n          <form className={`${toolName}-form`} onSubmit={this.handleRegionSave}>\n            {\n              this.props.ontology && this.props.ontology.length > 0 &&\n              <div className={`${toolName}-form-group`}>\n                <label>选择角色</label>\n                {this.props.ontology.map(i => (\n                    <div\n                        key={i.key}\n                        className={`${toolName}-ontology-btn ${i.class_name === category ? 'label-selected' : 'label-unselected'}`}\n                        style={{ background: i.display_color }}\n                        onClick={(e) => this.handleCategorySelect(i, e)}\n                    >\n                      {i.class_name}\n                    </div>\n                ))}\n              </div>\n            }\n\n            <div className={`${toolName}-form-group`}>\n              <label>开始时间</label>\n              <input type={\"text\"} value={start} onChange={e => this.setState({ start: e.target.value })} />\n            </div>\n\n            <div className={`${toolName}-form-group`}>\n              <label>结束时间</label>\n              <input type={\"text\"} value={end} onChange={e => this.setState({ end: e.target.value })} />\n            </div>\n\n            <div className={`${toolName}-form-group`}>\n              <label>输入文本</label>\n              <input type={\"text\"} value={note}\n                     id={`${toolName}-input-note`}\n                     onSelect={this.setCaret(this)}\n                     onClick={this.setCaret(this)}\n                     onKeyUp={this.setCaret(this)}\n                     onChange={e => this.setState({ note: e.target.value })}\n                     onKeyDown={e => this.inputKeyDown(e)}\n                     onFocus={e => this.setState({focus: true})}\n                     onBlur={e => this.setState({focus: false})}\n              />\n              {/*<textarea rows=\"3\" value={note} onChange={e => this.setState({ note: e.target.value })} />*/}\n            </div>\n\n\n            <div className={`${toolName}-form-group`}>\n              <label>插入标签</label>\n              <div className={`${toolName}-ontology-btn`}\n                  style={{ background: '#F6F4FC' }}\n                  onClick={(e) => this.insertAtCaret('[noise]')}\n              >\n                噪音\n              </div>\n              <div className={`${toolName}-ontology-btn`}\n                   style={{ background: '#F6F4FC' }}\n                   onClick={(e) => this.insertAtCaret('[cough]')}\n              >\n                清嗓子\n              </div>\n              <div className={`${toolName}-ontology-btn`}\n                   style={{ background: '#F6F4FC' }}\n                   onClick={(e) => this.insertAtCaret('[throat]')}\n              >\n                咳嗽\n              </div>\n              <div className={`${toolName}-ontology-btn`}\n                   style={{ background: '#F6F4FC' }}\n                   onClick={(e) => this.insertAtCaret('[laugh]')}\n              >\n                笑声\n              </div>\n            </div>\n\n            <div className={`${toolName}-form-group`}>\n              <label>插入数字</label>\n              <Select\n                  id={`${toolName}-num-select`}\n                  labelInValue\n                  defaultValue={{ key: this.state.numType }}\n                  style={{ width: 80 }}\n                  onChange={(value) => {this.setState({numType: value.key})}}\n              >\n                <Option value=\"NUM\">数字</Option>\n                <Option value=\"TEL\">电话</Option>\n                <Option value=\"TIME\">时间</Option>\n              </Select>\n              <span style={{margin: '0 5px' }}>汉字发音</span>\n              <Input id={`${toolName}-num-han`}\n                     style={{ width: 120 }}\n                     onChange={e => this.setState({numHan: e.target.value})}\n              />\n              <span style={{margin: '0 5px' }}>日常写法</span>\n              <Input id={`${toolName}-num-general`}\n                     style={{ width: 120 }}\n                     onChange={ e => this.setState({numGeneral: e.target.value})}\n              />\n              <div className={`${toolName}-ontology-btn`}\n                   style={{ background: '#F6F4FC',  margin: '0 5px' }}\n                   onClick={(e) => this.insertNumber()}\n              >\n                确定\n              </div>\n            </div>\n\n\n            <button className={`${toolName}-action-btn`} type=\"submit\">\n              保存\n            </button>\n            <button className={`${toolName}-action-btn danger`} onClick={this.handleRegionDelete}>\n              删除\n            </button>\n          </form>\n        )}\n      </div>\n    );\n  }\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}