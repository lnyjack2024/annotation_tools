{"ast":null,"code":"import React,{forwardRef,useEffect,useImperativeHandle,useRef,useState}from'react';import screenfull from'screenfull';import{Base64}from'js-base64';import{notification}from'antd';import AnnotationForm,{FPS}from'./AnnotationForm';import AnnotationCanvas,{getDeltaTime}from'./AnnotationCanvas';import AnnotationResults from'./AnnotationResults';import AutoSaver from'../common/AutoSaver';import{randomColor,simpleClone}from'./util';import Fullscreen from'../common/icons/Fullscreen';import Save from'../common/icons/Save';import{isPreview,isReviewEditable,isAnnotationReadonly}from'../../utils/tool-mode';import{setLocale}from'./locale';notification.config({top:60,getContainer:()=>document.getElementById('root')});const useStateCb=function(init){const cbRef=useRef();const[value,setValue]=useState(init);useEffect(()=>{if(cbRef.current)cbRef.current(value);},[value]);function setValueCb(val,cb){cbRef.current=cb;setValue(val);}return{value,setValueCb};};const AdvertisementAnnotationApp=forwardRef((props,ref)=>{const[duration,setDuration]=useState();const[currentIndex,setCurrentIndex]=useState();const{value:results,setValueCb:setResults}=useStateCb([]);const{value:advertisementName,setValueCb:setAdvertisementName}=useStateCb([]);const[currentMode,setCurrentMode]=useState('edit');const[currentTime,setCurrentTime]=useState(10);const[playBackRate,setPlayBackRate]=useState(1);const[advertisementType,setAdvertisementType]=useState([]);const canvasRef=useRef();const advertisementNameMap=useRef(new Map());const saverRef=useRef();let clk=null;const toolName='advertisement-annotation';useImperativeHandle(ref,()=>({onSubmit,submitReviews,getReviews:submitReviews}));const playVideo=function(record){const{current}=canvasRef;if(current&&current.video){current.video.play();if(!record)return;if(record.start!=null)current.video.currentTime=record.start;else current.video.currentTime=0;if(clk)clearInterval(clk);clk=setInterval(()=>{if((record.start||0)>currentTime||(record.end||duration)<=currentTime){current.video.pause();clearInterval(clk);}},1000/FPS);}};useEffect(()=>{const event=e=>handleKeyDown(e);document.addEventListener('keydown',event);return()=>{document.removeEventListener('keydown',event);};},[currentTime]);useEffect(()=>{setLocale(props.locale);initData();},[]);const initData=async()=>{try{const res=await props.jobProxy.loadResult();const newResults=(res===null||res===void 0?void 0:res.results)||[];const labelConfigString=Base64.decode(props.label_config);const labelConfig=JSON.parse(labelConfigString);const reviewRes=await props.jobProxy.loadReviews();const reviews=(reviewRes===null||reviewRes===void 0?void 0:reviewRes.reviews)||[];reviews.forEach(_ref=>{let{key,qaState,qaReason,qaComment}=_ref;const index=newResults.findIndex(i=>i.key===key);if(index>=0){newResults[index]={...newResults[index],qaState,qaReason,qaComment};}});setResults(newResults);// TODO: label config validation\nadvertisementNameMap.current=new Map();setAdvertisementName(labelConfig.advertisementName);setAdvertisementType(labelConfig.advertisementType);labelConfig.advertisementName.forEach(item=>{advertisementNameMap.current.set(item.value,item.color);});}catch(e){console.log(e);};setInterval(()=>{const{current}=canvasRef;if(!(current===null||current===void 0?void 0:current.video))return;const timeNow=parseFloat(current.video.currentTime.toFixed(3));setCurrentTime(timeNow);if(duration==null)setDuration(current.video.duration);},1000/FPS);};const onSubmit=function(){var _saverRef$current;let isSubmit=arguments.length>0&&arguments[0]!==undefined?arguments[0]:true;validateResults(results,isSubmit);(_saverRef$current=saverRef.current)===null||_saverRef$current===void 0?void 0:_saverRef$current.disableLeaveCheck();return props.jobProxy.saveResult({results// advertisementName,\n// advertisementType,\n},isSubmit);};const handleSave=async()=>{if(isPreview(props.jobProxy.toolMode)){return;}try{if(!isAnnotationReadonly(props.jobProxy.toolMode)){await onSubmit(false);}if(isReviewEditable(props.jobProxy.toolMode)){await submitReviews(false);}notification.success({message:'保存成功'});}catch(e){notification.error({message:'保存失败'});}};const submitReviews=function(){var _saverRef$current2;let isSubmit=arguments.length>0&&arguments[0]!==undefined?arguments[0]:true;const reviews=results.map(r=>({key:r.key,qaState:r.qaState,qaReason:r.qaReason,qaComment:r.qaComment}));validateReviews(reviews,isSubmit);(_saverRef$current2=saverRef.current)===null||_saverRef$current2===void 0?void 0:_saverRef$current2.disableLeaveCheck();return props.jobProxy.saveReviews({reviews},true);};const validateReviews=(reviews,isSubmit)=>{const errorIds={};reviews.forEach(review=>{const errors=[];if(review.qaState==='rejected'&&review.qaReason===null){errors.push('驳回原因');}if(errors.length>0){errorIds[review.key]=errors;}});if(Object.keys(errorIds).length>0){const errMsg=Object.keys(errorIds).map(k=>\"ID: \".concat(k,\" \\u7F3A: \").concat(errorIds[k].join(', '))).join('; ');if(isSubmit){notification.error({message:'质检未完善',description:errMsg});throw new Error(\"\\u8BF7\\u8865\\u5168\\u8D28\\u68C0\\u4FE1\\u606F\\u518D\\u63D0\\u4EA4 ID: \".concat(Object.keys(errorIds)));}else{notification.warn({message:'质检未完善',description:errMsg});}}};const validateResults=function(res){let isSubmit=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;const isTypeValid=type=>Array.isArray(type)&&type.length>0;const isPositionValid=position=>Array.isArray(position)&&position.length>0;const isTimeValid=time=>time!==null&&time>=0;const errorIds={};res.forEach(result=>{const errors=[];if(!result.name){errors.push('识别结果');}if(!isTimeValid(result.start)){errors.push('开始时间');}if(!isTimeValid(result.end)){errors.push('结束时间');}if(!isTypeValid(result.type)){errors.push('广告形式');}if(!isPositionValid(result.position)){errors.push('标记框位置');}if(!result.snapshot){errors.push('缺少截图，请手动点击生成');}if(errors.length>0){errorIds[result.key]=errors;}});if(Object.keys(errorIds).length>0){const errMsg=Object.keys(errorIds).map(k=>\"ID: \".concat(k,\" \\u7F3A: \").concat(errorIds[k].join(', '))).join('; ');if(isSubmit){notification.error({message:'属性不全',description:errMsg});throw new Error(\"\\u8BF7\\u8865\\u5168\\u5C5E\\u6027\\u503C\\u518D\\u63D0\\u4EA4 ID: \".concat(Object.keys(errorIds)));}else{notification.warn({message:'属性不全',description:errMsg});}}};const setCurrentPlayBackRate=function(rate){const{current}=canvasRef;if(current&&current.video){current.video.playbackRate=rate;setPlayBackRate(rate);}};function pauseVideo(){const{current}=canvasRef;if(current&&current.video&&!current.video.paused)current.video.pause();}function seekVideo(){let targetTime=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;const{current}=canvasRef;if(current&&current.video&&targetTime>=0&&targetTime<=duration){current.video.currentTime=targetTime;}}function getResult(index){return results.find(r=>r.key===index);}const handleKeyDown=e=>{const{current}=canvasRef;const{ctrlKey}=e;// except return key\nif(window.disableAdvertisementHotKeys&&e.keyCode!==13){return;}switch(e.keyCode){case 32:e.preventDefault();e.stopPropagation();if(currentMode!=='edit')break;if(current.video.paused)playVideo();else pauseVideo();break;case 70:e.preventDefault();if(e.target.tagName.toUpperCase()==='INPUT')break;if(!ctrlKey)break;// eslint-disable-next-line no-case-declarations\nfullScreen();break;case 37:// left arrow\nif(e.target.tagName.toUpperCase()==='INPUT')break;if(current&&current.video)current.video.currentTime=currentTime-1;break;case 39:// right arrow\nif(e.target.tagName.toUpperCase()==='INPUT')break;if(current&&current.video)current.video.currentTime=currentTime+1;break;case 73:if(e.target.tagName.toUpperCase()==='INPUT')break;e.preventDefault();if(currentMode==='edit'){if(currentIndex==null)return;const item=getResult(currentIndex);if(item.start!=null&&item.start>currentTime+getDeltaTime(playBackRate))break;if(item.end!=null&&item.end<currentTime-getDeltaTime(playBackRate))break;pauseVideo();enableSVG(currentIndex);}else{disableSVG();}break;case 13:// enter\nif(e.target.tagName.toUpperCase()==='INPUT'){e.preventDefault();e.target.blur();}break;default:break;}return false;};const addAdvertisementName=function(name){const advertisementNameCopy=simpleClone(advertisementName);return new Promise(resolve=>{const color=randomColor();advertisementNameCopy.unshift({value:name,label:name,color});advertisementNameMap.current.set(name,color);setAdvertisementName(advertisementNameCopy,()=>{resolve('updateAdvertisementName');});}).then(()=>{// onSubmit();\n});};const handleResultsChange=function(newResult){return new Promise(resolve=>{setResults(newResult,()=>{resolve('updateResult');});}).then(()=>{// onSubmit();\n});};const enableSVG=function(index){setCurrentIndex(index);setCurrentMode('paint');};const disableSVG=function(){setCurrentMode('edit');};// const setSelectedIndex = (function (index) {\n//   if (index >= 0 && index < results.length) setCurrentIndex(index);\n//   else setCurrentIndex(null);\n// });\nconst fullScreen=()=>{const elem=document.getElementById('root');if(screenfull&&!screenfull.isFullscreen)screenfull.request(elem);else if(screenfull&&screenfull.isFullscreen)screenfull.toggle();};const focusItemInRightSide=key=>{const cardContainer=document.getElementsByClassName('annotation-form-container');const cards=document.getElementsByClassName(\"annotation-form-card-\".concat(key));if(cardContainer.length>0&&cards.length>0){const{top:cTop,bottom:cBottom}=cardContainer[0].getBoundingClientRect();const{top:eTop,bottom:eBottom}=cards[0].getBoundingClientRect();if(eTop<cTop||eTop>cBottom){cardContainer[0].scrollBy({top:eTop-cTop});}}};return/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(AutoSaver,{ref:saverRef,leaveCheck:true,data:results,save:handleSave}),/*#__PURE__*/React.createElement(\"div\",{className:\"advertisement-annotation-app-topbar\"},/*#__PURE__*/React.createElement(\"div\",{className:\"advertisement-annotation-app-topbar-btn\",onClick:handleSave},/*#__PURE__*/React.createElement(Save,null)),/*#__PURE__*/React.createElement(\"div\",{className:\"advertisement-annotation-app-topbar-btn\",onClick:fullScreen},/*#__PURE__*/React.createElement(Fullscreen,null))),/*#__PURE__*/React.createElement(\"div\",{className:\"advertisement-annotation-app-container\"},/*#__PURE__*/React.createElement(\"div\",{className:\"paint-mode-mask\",style:{visibility:currentMode==='edit'?'hidden':'visible'}}),/*#__PURE__*/React.createElement(\"div\",{className:\"vertical-wrapper\"},/*#__PURE__*/React.createElement(AnnotationCanvas,{ref:canvasRef,currentTime:currentTime,currentIndex:currentIndex,currentMode:currentMode,results:results,video:props.video,advertisementName:advertisementName,currentPlayBackRate:playBackRate,setCurrentIndex:setCurrentIndex,toolMode:props.jobProxy.toolMode,projectId:props.jobProxy.projectId,flowId:props.jobProxy.flowId,jobId:props.jobProxy.jobId,taskId:props.jobProxy.taskId,recordId:props.jobProxy.recordId,advertisementNameMap:advertisementNameMap.current,handleResultsChange:handleResultsChange,focusItemInRightSide:focusItemInRightSide,saveContent:props.saveContent}),/*#__PURE__*/React.createElement(AnnotationResults,{results:results,issueTypes:props.issue_types,playVideo:playVideo,advertisementName:advertisementName,advertisementType:advertisementType,advertisementNameMap:advertisementNameMap.current,setCurrentIndex:setCurrentIndex,currentIndex:currentIndex,toolMode:props.jobProxy.toolMode,canvas:canvasRef.current,handleResultsChange:handleResultsChange,focusItemInRightSide:focusItemInRightSide})),/*#__PURE__*/React.createElement(AnnotationForm,{canvas:canvasRef.current,duration:duration,currentTime:currentTime,currentMode:currentMode,currentIndex:currentIndex,toolMode:props.jobProxy.toolMode,advertisementName:advertisementName,advertisementType:advertisementType,advertisementNameMap:advertisementNameMap.current,currentPlayBackRate:playBackRate,results:results,handleResultsChange:handleResultsChange,setCurrentPlayBackRate:setCurrentPlayBackRate,enableSVG:enableSVG,disableSVG:disableSVG,setCurrentIndex:setCurrentIndex,addAdvertisementName:addAdvertisementName,onSubmit:onSubmit})));});export default AdvertisementAnnotationApp;","map":{"version":3,"names":["React","forwardRef","useEffect","useImperativeHandle","useRef","useState","screenfull","Base64","notification","AnnotationForm","FPS","AnnotationCanvas","getDeltaTime","AnnotationResults","AutoSaver","randomColor","simpleClone","Fullscreen","Save","isPreview","isReviewEditable","isAnnotationReadonly","setLocale","config","top","getContainer","document","getElementById","useStateCb","init","cbRef","value","setValue","current","setValueCb","val","cb","AdvertisementAnnotationApp","props","ref","duration","setDuration","currentIndex","setCurrentIndex","results","setResults","advertisementName","setAdvertisementName","currentMode","setCurrentMode","currentTime","setCurrentTime","playBackRate","setPlayBackRate","advertisementType","setAdvertisementType","canvasRef","advertisementNameMap","Map","saverRef","clk","toolName","onSubmit","submitReviews","getReviews","playVideo","record","video","play","start","clearInterval","setInterval","end","pause","event","e","handleKeyDown","addEventListener","removeEventListener","locale","initData","res","jobProxy","loadResult","newResults","labelConfigString","decode","label_config","labelConfig","JSON","parse","reviewRes","loadReviews","reviews","forEach","_ref","key","qaState","qaReason","qaComment","index","findIndex","i","item","set","color","console","log","timeNow","parseFloat","toFixed","_saverRef$current","isSubmit","arguments","length","undefined","validateResults","disableLeaveCheck","saveResult","handleSave","toolMode","success","message","error","_saverRef$current2","map","r","validateReviews","saveReviews","errorIds","review","errors","push","Object","keys","errMsg","k","concat","join","description","Error","warn","isTypeValid","type","Array","isArray","isPositionValid","position","isTimeValid","time","result","name","snapshot","setCurrentPlayBackRate","rate","playbackRate","pauseVideo","paused","seekVideo","targetTime","getResult","find","ctrlKey","window","disableAdvertisementHotKeys","keyCode","preventDefault","stopPropagation","target","tagName","toUpperCase","fullScreen","enableSVG","disableSVG","blur","addAdvertisementName","advertisementNameCopy","Promise","resolve","unshift","label","then","handleResultsChange","newResult","elem","isFullscreen","request","toggle","focusItemInRightSide","cardContainer","getElementsByClassName","cards","cTop","bottom","cBottom","getBoundingClientRect","eTop","eBottom","scrollBy","createElement","Fragment","leaveCheck","data","save","className","onClick","style","visibility","currentPlayBackRate","projectId","flowId","jobId","taskId","recordId","saveContent","issueTypes","issue_types","canvas"],"sources":["/Users/qzheng/Documents/webroot/annotation_tools/src/components/advertisement-annotation/index.jsx"],"sourcesContent":["import React, { forwardRef, useEffect, useImperativeHandle, useRef, useState } from 'react';\nimport screenfull from 'screenfull';\nimport { Base64 } from 'js-base64';\nimport { notification } from 'antd';\nimport AnnotationForm, { FPS } from './AnnotationForm';\nimport AnnotationCanvas, { getDeltaTime } from './AnnotationCanvas';\nimport AnnotationResults from './AnnotationResults';\nimport AutoSaver from '../common/AutoSaver';\nimport { randomColor, simpleClone } from './util';\nimport Fullscreen from '../common/icons/Fullscreen';\nimport Save from '../common/icons/Save';\nimport { isPreview, isReviewEditable, isAnnotationReadonly } from '../../utils/tool-mode';\nimport { setLocale } from './locale';\n\nnotification.config({ top: 60, getContainer: () => document.getElementById('root') });\n\nconst useStateCb = function (init) {\n  const cbRef = useRef();\n  const [value, setValue] = useState(init);\n\n  useEffect(() => {\n    if (cbRef.current) cbRef.current(value);\n  }, [value]);\n\n  function setValueCb(val, cb) {\n    cbRef.current = cb;\n    setValue(val);\n  }\n\n  return { value, setValueCb };\n};\n\nconst AdvertisementAnnotationApp = forwardRef((props, ref) => {\n  const [duration, setDuration] = useState();\n  const [currentIndex, setCurrentIndex] = useState();\n  const { value: results, setValueCb: setResults } = useStateCb([]);\n  const { value: advertisementName, setValueCb: setAdvertisementName } = useStateCb([]);\n  const [currentMode, setCurrentMode] = useState('edit');\n  const [currentTime, setCurrentTime] = useState(10);\n  const [playBackRate, setPlayBackRate] = useState(1);\n  const [advertisementType, setAdvertisementType] = useState([]);\n  const canvasRef = useRef();\n  const advertisementNameMap = useRef(new Map());\n  const saverRef = useRef();\n\n  let clk = null;\n  const toolName = 'advertisement-annotation';\n\n  useImperativeHandle(ref, () => ({\n    onSubmit,\n    submitReviews,\n    getReviews: submitReviews,\n  }));\n\n  const playVideo = (function (record) {\n    const { current } = canvasRef;\n    if (current && current.video) {\n      current.video.play();\n      if (!record) return;\n      if (record.start != null) current.video.currentTime = record.start;\n      else current.video.currentTime = 0;\n      if (clk) clearInterval(clk);\n      clk = setInterval(() => {\n        if ((record.start || 0) > currentTime || (record.end || duration) <= currentTime) {\n          current.video.pause();\n          clearInterval(clk);\n        }\n      }, 1000 / FPS);\n    }\n  });\n\n  useEffect(() => {\n    const event = (e) => handleKeyDown(e);\n    document.addEventListener('keydown', event);\n    return () => {\n      document.removeEventListener('keydown', event);\n    };\n  }, [currentTime]);\n\n  useEffect(() => {\n    setLocale(props.locale);\n    initData();\n  }, []);\n\n  const initData = async () => {\n    try {\n      const res = await props.jobProxy.loadResult();\n      const newResults = res?.results || [];\n      const labelConfigString = Base64.decode(props.label_config);\n      const labelConfig = JSON.parse(labelConfigString);\n      const reviewRes = await props.jobProxy.loadReviews();\n      const reviews = reviewRes?.reviews || [];\n      reviews.forEach(({ key, qaState, qaReason, qaComment }) => {\n        const index = newResults.findIndex((i) => i.key === key);\n        if (index >= 0) {\n          newResults[index] = {\n            ...newResults[index],\n            qaState,\n            qaReason,\n            qaComment,\n          };\n        }\n      });\n      setResults(newResults);\n\n      // TODO: label config validation\n      advertisementNameMap.current = new Map();\n      setAdvertisementName(labelConfig.advertisementName);\n      setAdvertisementType(labelConfig.advertisementType);\n      labelConfig.advertisementName.forEach((item) => {\n        advertisementNameMap.current.set(item.value, item.color);\n      });\n    } catch (e) {\n      console.log(e);\n    };\n\n    setInterval(() => {\n      const { current } = canvasRef;\n      if (!current?.video) return;\n      const timeNow = parseFloat(current.video.currentTime.toFixed(3));\n      setCurrentTime(timeNow);\n      if (duration == null) setDuration(current.video.duration);\n    }, 1000 / FPS);\n  };\n\n  const onSubmit = (isSubmit = true) => {\n    validateResults(results, isSubmit);\n    saverRef.current?.disableLeaveCheck();\n    return props.jobProxy.saveResult({\n      results,\n      // advertisementName,\n      // advertisementType,\n    }, isSubmit);\n  };\n\n  const handleSave = async () => {\n    if (isPreview(props.jobProxy.toolMode)) {\n      return;\n    }\n\n    try {\n      if (!isAnnotationReadonly(props.jobProxy.toolMode)) {\n        await onSubmit(false);\n      }\n      if (isReviewEditable(props.jobProxy.toolMode)) {\n        await submitReviews(false);\n      }\n      notification.success({ message: '保存成功' });\n    } catch (e) {\n      notification.error({ message: '保存失败' });\n    }\n  };\n\n  const submitReviews = (isSubmit = true) => {\n    const reviews = results.map((r) => ({\n      key: r.key,\n      qaState: r.qaState,\n      qaReason: r.qaReason,\n      qaComment: r.qaComment,\n    }));\n    validateReviews(reviews, isSubmit);\n    saverRef.current?.disableLeaveCheck();\n    return props.jobProxy.saveReviews({ reviews }, true);\n  };\n\n  const validateReviews = (reviews, isSubmit) => {\n    const errorIds = {};\n    reviews.forEach((review) => {\n      const errors = [];\n      if (review.qaState === 'rejected' && review.qaReason === null) {\n        errors.push('驳回原因');\n      }\n      if (errors.length > 0) {\n        errorIds[review.key] = errors;\n      }\n    });\n    if (Object.keys(errorIds).length > 0) {\n      const errMsg = Object.keys(errorIds).map((k) => `ID: ${k} 缺: ${errorIds[k].join(', ')}`).join('; ');\n      if (isSubmit) {\n        notification.error({ message: '质检未完善', description: errMsg });\n        throw new Error(`请补全质检信息再提交 ID: ${Object.keys(errorIds)}`);\n      } else {\n        notification.warn({ message: '质检未完善', description: errMsg });\n      }\n    }\n  };\n\n  const validateResults = (res, isSubmit = false) => {\n    const isTypeValid = (type) => Array.isArray(type) && type.length > 0;\n\n    const isPositionValid = (position) => Array.isArray(position) && position.length > 0;\n\n    const isTimeValid = (time) => time !== null && time >= 0;\n\n    const errorIds = {};\n    res.forEach((result) => {\n      const errors = [];\n      if (!result.name) {\n        errors.push('识别结果');\n      }\n      if (!isTimeValid(result.start)) {\n        errors.push('开始时间');\n      }\n      if (!isTimeValid(result.end)) {\n        errors.push('结束时间');\n      }\n      if (!isTypeValid(result.type)) {\n        errors.push('广告形式');\n      }\n      if (!isPositionValid(result.position)) {\n        errors.push('标记框位置');\n      }\n      if (!result.snapshot) {\n        errors.push('缺少截图，请手动点击生成');\n      }\n      if (errors.length > 0) {\n        errorIds[result.key] = errors;\n      }\n    });\n    if (Object.keys(errorIds).length > 0) {\n      const errMsg = Object.keys(errorIds).map((k) => `ID: ${k} 缺: ${errorIds[k].join(', ')}`).join('; ');\n      if (isSubmit) {\n        notification.error({ message: '属性不全', description: errMsg });\n        throw new Error(`请补全属性值再提交 ID: ${Object.keys(errorIds)}`);\n      } else {\n        notification.warn({ message: '属性不全', description: errMsg });\n      }\n    }\n  };\n\n  const setCurrentPlayBackRate = (function (rate) {\n    const { current } = canvasRef;\n    if (current && current.video) {\n      current.video.playbackRate = rate;\n      setPlayBackRate(rate);\n    }\n  });\n\n  function pauseVideo() {\n    const { current } = canvasRef;\n    if (current && current.video && !current.video.paused) current.video.pause();\n  }\n\n  function seekVideo(targetTime = 0) {\n    const { current } = canvasRef;\n    if (current && current.video &&\n        targetTime >= 0 && targetTime <= duration) {\n      current.video.currentTime = targetTime;\n    }\n  }\n\n  function getResult(index) {\n    return results.find((r) => r.key === index);\n  }\n\n  const handleKeyDown = (e) => {\n    const { current } = canvasRef;\n    const { ctrlKey } = e;\n    // except return key\n    if (window.disableAdvertisementHotKeys && e.keyCode !== 13) {\n      return;\n    }\n    switch (e.keyCode) {\n      case 32:\n        e.preventDefault();\n        e.stopPropagation();\n        if (currentMode !== 'edit') break;\n        if (current.video.paused) playVideo();\n        else pauseVideo();\n        break;\n      case 70:\n        e.preventDefault();\n        if (e.target.tagName.toUpperCase() === 'INPUT') break;\n        if (!ctrlKey) break;\n        // eslint-disable-next-line no-case-declarations\n        fullScreen();\n        break;\n      case 37: // left arrow\n        if (e.target.tagName.toUpperCase() === 'INPUT') break;\n        if (current && current.video) current.video.currentTime = currentTime - 1;\n        break;\n      case 39: // right arrow\n        if (e.target.tagName.toUpperCase() === 'INPUT') break;\n        if (current && current.video) current.video.currentTime = currentTime + 1;\n        break;\n      case 73:\n        if (e.target.tagName.toUpperCase() === 'INPUT') break;\n        e.preventDefault();\n        if (currentMode === 'edit') {\n          if (currentIndex == null) return;\n          const item = getResult(currentIndex);\n          if (item.start != null && item.start > currentTime + getDeltaTime(playBackRate)) break;\n          if (item.end != null && item.end < currentTime - getDeltaTime(playBackRate)) break;\n          pauseVideo();\n          enableSVG(currentIndex);\n        } else {\n          disableSVG();\n        }\n        break;\n      case 13: // enter\n        if (e.target.tagName.toUpperCase() === 'INPUT') {\n          e.preventDefault();\n          e.target.blur();\n        }\n        break;\n      default:\n        break;\n    }\n    return false;\n  };\n\n  const addAdvertisementName = (function (name) {\n    const advertisementNameCopy = simpleClone(advertisementName);\n    return new Promise((resolve) => {\n      const color = randomColor();\n      advertisementNameCopy.unshift({ value: name, label: name, color });\n      advertisementNameMap.current.set(name, color);\n      setAdvertisementName(advertisementNameCopy, () => {\n        resolve('updateAdvertisementName');\n      });\n    }).then(() => {\n      // onSubmit();\n    });\n  });\n\n  const handleResultsChange = (function (newResult) {\n    return new Promise((resolve) => {\n      setResults(newResult, () => {\n        resolve('updateResult');\n      });\n    }).then(() => {\n      // onSubmit();\n    });\n  });\n\n  const enableSVG = (function (index) {\n    setCurrentIndex(index);\n    setCurrentMode('paint');\n  });\n\n  const disableSVG = (function () {\n    setCurrentMode('edit');\n  });\n\n  // const setSelectedIndex = (function (index) {\n  //   if (index >= 0 && index < results.length) setCurrentIndex(index);\n  //   else setCurrentIndex(null);\n  // });\n\n  const fullScreen = () => {\n    const elem = document.getElementById('root');\n    if (screenfull && !screenfull.isFullscreen) screenfull.request(elem);\n    else if (screenfull && screenfull.isFullscreen) screenfull.toggle();\n  };\n\n  const focusItemInRightSide = (key) => {\n    const cardContainer = document.getElementsByClassName('annotation-form-container');\n    const cards = document.getElementsByClassName(`annotation-form-card-${key}`);\n    if (cardContainer.length > 0 && cards.length > 0) {\n      const { top: cTop, bottom: cBottom } = cardContainer[0].getBoundingClientRect();\n      const { top: eTop, bottom: eBottom } = cards[0].getBoundingClientRect();\n      if (eTop < cTop || eTop > cBottom) {\n        cardContainer[0].scrollBy({ top: eTop - cTop });\n      }\n    }\n  };\n\n  return (\n    <>\n      <AutoSaver\n        ref={saverRef}\n        leaveCheck\n        data={results}\n        save={handleSave}\n      />\n      <div className=\"advertisement-annotation-app-topbar\">\n        <div className=\"advertisement-annotation-app-topbar-btn\" onClick={handleSave}>\n          <Save />\n        </div>\n        <div className=\"advertisement-annotation-app-topbar-btn\" onClick={fullScreen}>\n          <Fullscreen />\n        </div>\n        {/* <Fullscreen style={{ float: 'right', marginTop: '10px' }}/> */}\n      </div>\n      <div className=\"advertisement-annotation-app-container\">\n        <div className=\"paint-mode-mask\" style={{ visibility: currentMode === 'edit' ? 'hidden' : 'visible' }} />\n        <div className=\"vertical-wrapper\">\n          <AnnotationCanvas\n            ref={canvasRef}\n            currentTime={currentTime}\n            currentIndex={currentIndex}\n            currentMode={currentMode}\n            results={results}\n            video={props.video}\n            advertisementName={advertisementName}\n            currentPlayBackRate={playBackRate}\n            setCurrentIndex={setCurrentIndex}\n            toolMode={props.jobProxy.toolMode}\n            projectId={props.jobProxy.projectId}\n            flowId={props.jobProxy.flowId}\n            jobId={props.jobProxy.jobId}\n            taskId={props.jobProxy.taskId}\n            recordId={props.jobProxy.recordId}\n            advertisementNameMap={advertisementNameMap.current}\n            handleResultsChange={handleResultsChange}\n            focusItemInRightSide={focusItemInRightSide}\n            saveContent={props.saveContent}\n          />\n          <AnnotationResults\n            results={results}\n            issueTypes={props.issue_types}\n            playVideo={playVideo}\n            advertisementName={advertisementName}\n            advertisementType={advertisementType}\n            advertisementNameMap={advertisementNameMap.current}\n            setCurrentIndex={setCurrentIndex}\n            currentIndex={currentIndex}\n            toolMode={props.jobProxy.toolMode}\n            canvas={canvasRef.current}\n            handleResultsChange={handleResultsChange}\n            focusItemInRightSide={focusItemInRightSide}\n          />\n        </div>\n        <AnnotationForm\n          canvas={canvasRef.current}\n          duration={duration}\n          currentTime={currentTime}\n          currentMode={currentMode}\n          currentIndex={currentIndex}\n          toolMode={props.jobProxy.toolMode}\n          advertisementName={advertisementName}\n          advertisementType={advertisementType}\n          advertisementNameMap={advertisementNameMap.current}\n          currentPlayBackRate={playBackRate}\n          results={results}\n          handleResultsChange={handleResultsChange}\n          setCurrentPlayBackRate={setCurrentPlayBackRate}\n          enableSVG={enableSVG}\n          disableSVG={disableSVG}\n          setCurrentIndex={setCurrentIndex}\n          addAdvertisementName={addAdvertisementName}\n          onSubmit={onSubmit}\n        />\n      </div>\n    </>\n  );\n});\n\nexport default AdvertisementAnnotationApp;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}