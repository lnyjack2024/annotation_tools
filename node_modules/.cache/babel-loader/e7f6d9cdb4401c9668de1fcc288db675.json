{"ast":null,"code":"/* eslint-disable no-nested-ternary */ /* eslint-disable react/no-access-state-in-setstate */ /* eslint-disable no-undef */ /* eslint-disable no-underscore-dangle */import React,{createContext}from'react';import{Editor,EditorState,convertFromRaw,getDefaultKeyBinding}from'draft-js';import{notification,message}from'antd';import{uniq}from'lodash';import{substr,strlen}from'fbjs/lib/UnicodeUtils';import{v4 as uuidv4}from'uuid';import localMessage,{setLocale}from'./locale';import{LabelTag,InsertionTag,ConnectionTag}from'./components/tag';import{isAnnotationReadonly,isRework,isReviewEditable,isPreview}from'../../utils/tool-mode';import Sidebar from'./components/sidebar';import{genTagMap,renderTagMap}from'./utils/tagMapUtil';import ReviewForm from'./components/reviewForm';import UndoRedo from'./components/UndoRedo';import ReviewMode from'./components/ReviewMode';import Save from'./components/Save';import{isAppenCloud}from'../../utils';import AppenLogo from'../common/AppenLogo';import store from'./store/RootStore';import'./TextAnnotationApp.scss';import'draft-js/dist/Draft.css';import{FIND_BLOCK,FIND_BLOCK_SELECTED,FOCUS_COLOR,DEFAULT_COLOR,FONT_COLOR,BASE_COLOR,HISTORY_SIZE,FONT_SIZE,TAG_HEIGHT,LINE_HEIGHT,EDITOR_PADDING,COMPOSITION,SELECTION,ACTION,KEY_COMMAND,RECALL_TYPE,HOVER_COLOR,FONT_SPACE,FOCUS_TYPE,HOVER_ALPHA,ACTIVE_ALPHA,DEFAULT_ALPHA}from'./store/constant';import{isArabic,convertArrayToColor,convertColorToArray,getSliceHead,setSelection,closeSelection,getTextByInsertion,getTargetWrapperDataSet,getConfigByKeys}from'./utils/helper';import{isLabel,isInsertion,isConnection,isQATag}from'./store/tag_mode';import{ReviewItemResult,TAG,ReviewMode as ReviewModeType}from'./types';import TagInfoMap from'./utils/TagInfoMap';export const TextToolContext=createContext();export default class TextAnnotationApp extends React.Component{constructor(props){var _this;super(props);_this=this;this.addHistory=(type,data)=>{let targetList;if(this.undoLock){// Add history to redo list\ntargetList=this.redoList;}else if(this.redoLock){// Add history back to undo list\ntargetList=this.undoList;// Clear redo list\n}else{// Add history to redo list\ntargetList=this.undoList;this.redoList=[];}let{length}=targetList;if(length>HISTORY_SIZE){targetList.shift();length-=1;}if(type===ACTION.EDIT_SINGLE_ADD&&length>=1){const prev=targetList[length-1];if((prev.type===ACTION.EDIT_DEFAULT||prev.type===ACTION.EDIT_SINGLE_ADD)&&prev.data.prevSlice===''&&prev.data.end===data.prevStart){targetList.pop();targetList.push({type:ACTION.EDIT_DEFAULT,data:{prevSlice:'',slice:prev.data.slice+data.slice,prevStart:prev.data.prevStart,prevEnd:prev.data.prevEnd,start:data.start,end:data.end}});}else targetList.push({type,data});}else if(type===ACTION.EDIT_SINGLE_DEL&&length>=1){const prev=targetList[length-1];if((prev.type===ACTION.EDIT_DEFAULT||prev.type===ACTION.EDIT_SINGLE_DEL)&&prev.data.slice===''&&data.prevEnd===prev.data.start){targetList.pop();targetList.push({type:ACTION.EDIT_DEFAULT,data:{slice:'',prevSlice:data.prevSlice+prev.data.prevSlice,prevStart:data.end,prevEnd:prev.data.prevEnd,start:data.start,end:data.end}});}else targetList.push({type,data});}else targetList.push({type,data});};this.executeHistory=recallType=>{// Execute history\nlet targetList;if(recallType===RECALL_TYPE.UNDO){// Get from undo list\nthis.undoLock=true;targetList=this.undoList;}else if(recallType===RECALL_TYPE.REDO){// Get from redo list\nthis.redoLock=true;targetList=this.redoList;}if(targetList.length===0){this.undoLock=false;this.redoLock=false;return;}const item=targetList.pop();const{data}=item;let nextEditorState=this.state.editorState;switch(item.type){case ACTION.EDIT_SINGLE_ADD:case ACTION.EDIT_SINGLE_DEL:case ACTION.EDIT_DEFAULT:case ACTION.EDIT_REPLACE:{const newData={prevSlice:data.slice,slice:data.prevSlice,start:data.prevEnd,end:data.prevEnd,prevStart:data.prevStart,prevEnd:data.end,...(item.type===ACTION.EDIT_REPLACE&&{tags:data.prevTags,prevTags:data.tags})};// nextEditorState = this.onContentChange(nextEditorState, newData);\nnextEditorState=setSelection(this.onContentChange(nextEditorState,newData,item.type),newData.start,newData.end);break;}case ACTION.ADD_INSERTION:{const{type,id}=data.insertion;nextEditorState=this.deleteTag(type,id);break;}case ACTION.ADD_LABEL:{const{type,id}=data.label;nextEditorState=this.deleteTag(type,id);break;}case ACTION.ADD_MISSING_REVIEW:{const{preReview,id}=data;if(preReview){const{editorState}=this.addReview(nextEditorState,id,{...preReview});nextEditorState=editorState;}else{const{editorState}=this.deleteQATag(id);nextEditorState=editorState;}break;}case ACTION.ADD_CONNECTION:{const{type,id}=data;nextEditorState=this.deleteTag(type,id);break;}case ACTION.DEL_LABEL:{const{relatedConnections,label}=data;nextEditorState=this.addLabel(nextEditorState,label,relatedConnections);break;}case ACTION.DEL_MISSING_REVIEW:{const{label,review}=data;const{editorState}=this.addQALabel(nextEditorState,label,{...review});nextEditorState=editorState;break;}case ACTION.DEL_INSERTION:{const{relatedConnections,insertion}=data;nextEditorState=this.addInsertion(nextEditorState,insertion,relatedConnections);break;}case ACTION.DEL_CONNECTION:{const{connection}=data;nextEditorState=this.addConnection(nextEditorState,connection);break;}case ACTION.EDIT_REPLACE_ALL:{const{text:currentText,prevText,prevResults,results}=data;store.ontology.text=prevText;store.ontology.setResults(prevResults);this.raw=this.renderTextArea(prevText);nextEditorState=EditorState.set(nextEditorState,{currentContent:convertFromRaw(this.raw)});this.addHistory(ACTION.EDIT_REPLACE_ALL,{text:prevText,prevText:currentText,prevResults:results,results:prevResults});break;}case ACTION.ADD_REVIEW:{const{preReview,id}=data;if(preReview){const{editorState}=this.addReview(nextEditorState,id,{...preReview});nextEditorState=editorState;}else{const{editorState}=this.deleteReview(id);nextEditorState=editorState;}break;}case ACTION.DELETE_REVIEW:{const{review,id}=data;const{editorState}=this.addReview(nextEditorState,id,{...review});nextEditorState=editorState;break;}case ACTION.ADD_REVIEWS:{nextEditorState=this.deleteReviewItems(data);break;}case ACTION.DELETE_REVIEWS:{nextEditorState=this.addReviewItems(nextEditorState,data);break;}default:break;}this.renderAndSave(nextEditorState);this.undoLock=false;this.redoLock=false;};this.renderAndSave=function(_editorState){let shouldRenderTags=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;let shouldResetCurrentState=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;let shouldSaveURL=arguments.length>3&&arguments[3]!==undefined?arguments[3]:false;const editorState=_editorState||_this.state.editorState;const{hasFocus}=editorState.getSelection();const top=_this.editorWrapper.scrollTop;// window.ew = this.editorWrapper;\nreturn new Promise(resolve=>{if(shouldResetCurrentState){_this.resetCurrentFrom();}_this.setState({editorState});if(shouldSaveURL){_this.exportResult();}resolve();}).then(()=>{if(shouldRenderTags){const{nextEditorState,tagMap}=_this.measureTags(editorState);return new Promise(resolve=>{_this.setState({editorState:nextEditorState},()=>{store.ontology.updateOntologiesStatusMap();});resolve(tagMap);});}}).then(tagMap=>{if(shouldRenderTags){_this.renderTags(tagMap);return new Promise(resolve=>{_this.setState({editorWidth:_this.editorWrapper.offsetWidth-EDITOR_PADDING*2,editorHeight:_this.editorWrapper.scrollHeight-EDITOR_PADDING*2,tagMap});resolve();});}}).then(()=>{if(hasFocus){// move back to current selection after composition end\nif(_this.compositionTop>=0){_this.editor.focus({y:_this.compositionTop});_this.compositionTop=-1;}else _this.editor.focus({y:top});}return new Promise(resolve=>resolve());});};this.updateEditorAndRender=options=>{let{editorState}=this.state;// update rawDraftContentState, using new results\nthis.raw=this.renderTextArea();// update editorState, using new rawDraftContentState\neditorState=EditorState.set(editorState,{currentContent:convertFromRaw(this.raw)});if(options&&typeof options[Symbol.iterator]==='function'){return this.renderAndSave(editorState,...options);}return this.renderAndSave(editorState);};this.onChange=editorState=>{// ignore composition operation\nif(this.compositionFlag===COMPOSITION.ENABLED)return;// get operation type ( handled operation not included )\nconst prevEditorState=this.state.editorState;const prevText=store.ontology.text;const text=editorState.getCurrentContent().getPlainText();let prevStart=prevEditorState.getSelection().getStartOffset();const prevEnd=prevEditorState.getSelection().getEndOffset();const start=editorState.getSelection().getStartOffset();const end=editorState.getSelection().getEndOffset();const{hasFocus}=editorState.getSelection();const{hasFocus:prevFocus}=prevEditorState.getSelection();if(hasFocus!==prevFocus){// when focus change update new editor state and return without doing anything\nconst nextEditorState=EditorState.set(editorState,{currentContent:convertFromRaw(this.raw)});this.renderAndSave(nextEditorState,null,false);return;}if(this.inputFlag||this.pasteFlag||this.compositionFlag===COMPOSITION.PENDING||prevText!==text){/* text changed:\n       * 1. deleted by delete key\n       * 2. deleted by drag + delete key\n       * 3. deleted by drag + cut operation\n       * 4. insert/replace by (drag) + simply typing\n       * 5. insert/replace by (drag) + composition typing\n       * 6. insert/replace by (drag) + paste operation\n       * 7. redo && undo\n       */if(prevStart===prevEnd&&start===prevStart-1)prevStart-=1;const prevSlice=prevText.slice(prevStart,prevEnd);const slice=text.slice(prevStart,end);const data={prevSlice,slice,prevStart,prevEnd,start,end};const nextEditorState=this.onContentChange(editorState,data);// reset flag\nthis.inputFlag=false;this.pasteFlag=false;this.compositionFlag=COMPOSITION.DISABLED;this.renderAndSave(nextEditorState);}else{/* selection changed\n       * 1. simply select\n       * 2. click select: add insertion\n       * 3. drag select: add label\n       */const data={start,end};const{nextEditorState,type}=this.onSelectionChange(editorState,data);const shouldRender=type!==SELECTION.MOVE;this.renderAndSave(nextEditorState,shouldRender,shouldRender);}};this.renderTags=tagMap=>{const spanMap=this.getAnchorElementsByHeads();const newTagMap=renderTagMap(tagMap,spanMap);return newTagMap;};this.onSave=async()=>{if(isPreview(this.toolMode))return;try{if(!isAnnotationReadonly(this.toolMode)){await this.exportResult();}if(isReviewEditable(this.toolMode)){await this.submitReviews(false);}message.success(localMessage('saveSuccess'));}catch(e){message.warning(localMessage('saveFail'));}};this.onSubmit=async params=>{const invalid=params&&params.validityFlag==='false';if(store.config.submitCheck&&(!invalid||!store.config.skipCheckForInvalidData)){// validate before submit\nawait store.validation.defaultSync();if(store.validation.blocked){throw new Error(localMessage('SUBMIT_CHECK_FAIL'));}}return this.exportResult(true);};this.exportResult=function(){let isSubmit=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;if(isAnnotationReadonly(_this.toolMode))return;return store.saveResult(isSubmit);};this.measureTags=editorState=>{const{raw}=this;const{text}=store.ontology;const{labels,insertions}=store.ontology.getResults();const spanMap=this.getAnchorElementsByHeads();const offsetTops=uniq(labels.map(label=>{var _spanMap$get;return(_spanMap$get=spanMap.get(label.start))===null||_spanMap$get===void 0?void 0:_spanMap$get.offsetTop;}).concat(insertions.map(insertion=>{var _spanMap$get2;return(_spanMap$get2=spanMap.get(insertion.at))===null||_spanMap$get2===void 0?void 0:_spanMap$get2.offsetTop;})));const occupyMap=new Map();offsetTops.forEach(offsetTop=>{occupyMap.set(offsetTop,[]);});// get label offsets\nconst tagMap=genTagMap(store.ontology.getResults(),store.ontology.ontologyConfigMap,spanMap,occupyMap,text);const ranges=raw.blocks[0].inlineStyleRanges;const style={...this.state.style};ranges.filter(item=>item.style.slice(0,6)==='ANCHOR').forEach(item=>{const span=this.getAnchorElementByHead(item.offset);if(span){const occupyList=occupyMap.get(span.offsetTop);const lineHeight=occupyList.map(it=>it.top>0?it.top-FONT_SIZE+TAG_HEIGHT:-it.top).sort((a,b)=>a-b).pop()*2+LINE_HEIGHT;style[\"LINEHEIGHT_\".concat(lineHeight)]={lineHeight:\"\".concat(lineHeight,\"px\")};ranges.push({offset:item.offset,length:item.length,style:\"LINEHEIGHT_\".concat(lineHeight)});}});const nextEditorState=EditorState.set(editorState,{currentContent:convertFromRaw(this.raw)});this.setState({style});return{nextEditorState,tagMap};};this.onSelectionChange=(editorState,data)=>{const{start,end}=data;const{currentBrush}=this.state;if(!this.mouseFlag){return{nextEditorState:editorState,type:SELECTION.MOVE};}if(start===end&&isInsertion(currentBrush===null||currentBrush===void 0?void 0:currentBrush.type)){const fbAt=strlen(store.ontology.text.slice(0,start));const nextEditorState=this.addInsertion(editorState,{at:fbAt,value:currentBrush.text,keys:currentBrush.keys,type:TAG.INSERTION});return{nextEditorState,type:SELECTION.CLICK};}if(start!==end&&isLabel(currentBrush===null||currentBrush===void 0?void 0:currentBrush.type)){const fbStart=strlen(store.ontology.text.slice(0,start));const fbEnd=strlen(store.ontology.text.slice(0,end));if(isQATag(currentBrush===null||currentBrush===void 0?void 0:currentBrush.type)){const{editorState:nextEditorState}=this.addQALabel(editorState,{start:fbStart,end:fbEnd,value:currentBrush.text,keys:currentBrush.keys,type:currentBrush.type},{result:ReviewItemResult.MISSING},true,true);return{nextEditorState,type:SELECTION.DRAG};}const nextEditorState=this.addLabel(editorState,{start:fbStart,end:fbEnd,value:currentBrush.text,keys:currentBrush.keys,type:currentBrush.type});return{nextEditorState,type:SELECTION.DRAG};}return{nextEditorState:editorState,type:SELECTION.MOVE};};this.deleteTag=(type,id)=>{const{state:{editorState}}=this;if(isQATag(type)&&store.config.reviewMode!==ReviewModeType.REVIEW){return editorState;}if(!isQATag(type)&&store.config.reviewMode===ReviewModeType.REVIEW){return;}if(isAnnotationReadonly(this.toolMode)){return editorState;}const operation=store.ontology.deleteTag(type,id);switch(true){case isLabel(type):this.addHistory(ACTION.DEL_LABEL,operation);break;case isConnection(type):this.addHistory(ACTION.DEL_CONNECTION,operation);break;case isInsertion(type):this.addHistory(ACTION.DEL_INSERTION,operation);break;default:break;}this.raw=this.renderTextArea();return EditorState.set(editorState,{currentContent:convertFromRaw(this.raw)});};this.addInsertion=function(editorState,_ref){let{at,value,id,keys,type}=_ref;let relatedConnections=arguments.length>2&&arguments[2]!==undefined?arguments[2]:[];const{state:{currentBrush},toolMode}=_this;const{text}=store.ontology;if(isAnnotationReadonly(_this.toolMode)||store.config.reviewMode===ReviewModeType.REVIEW)return editorState;if(at===strlen(text))return editorState;// prevent insert to the end of content\n// eslint-disable-next-line no-restricted-syntax\nfor(const item of store.ontology.results.insertions){if(item.at===at&&item.value===currentBrush.text)return editorState;}if(!id)id=uuidv4();const arabic=isArabic(substr(text,at));if(arabic&&at)at-=1;const newItem={type,at,value,id,text:getTextByInsertion(store.ontology.text,{at,value}),isReview:isReviewEditable(toolMode),keys};_this.addHistory(ACTION.ADD_INSERTION,{insertion:newItem,relatedConnections});store.ontology.addResultItem(newItem,relatedConnections);_this.raw=_this.renderTextArea();editorState=EditorState.set(editorState,{currentContent:convertFromRaw(_this.raw)});editorState=closeSelection(editorState);return editorState;};this.addConnection=(editorState,_ref2)=>{let{fromId,fromType,toId,toType,value,id,keys,type}=_ref2;const{state:{currentBrush},toolMode}=this;if(isAnnotationReadonly(toolMode)||store.config.reviewMode===ReviewModeType.REVIEW)return editorState;if(fromId===toId)return editorState;if(isQATag(fromType)||isQATag(toType))return editorState;// can't add connection for qa tool\nif(store.ontology.results.connections.some(item=>item.fromId===fromId&&item.toId===toId&&item.value===currentBrush.text))return editorState;if(!id)id=uuidv4();const newItem={type,fromId,fromType,toId,toType,value,id,isReview:isReviewEditable(toolMode),keys};this.addHistory(ACTION.ADD_CONNECTION,newItem);store.ontology.addResultItem(newItem);this.raw=this.renderTextArea();editorState=EditorState.set(editorState,{currentContent:convertFromRaw(this.raw)});return editorState;};this.addLabel=function(editorState,_ref3){let{start,end,value,id,keys,type}=_ref3;let relatedConnections=arguments.length>2&&arguments[2]!==undefined?arguments[2]:[];const{toolMode}=_this;const{ontology,config}=store;const{text}=store.ontology;if(config.reviewMode===ReviewModeType.REVIEW&&!isQATag(type))return editorState;if(isAnnotationReadonly(_this.toolMode)&&!isQATag(type))return editorState;if(isQATag(type)&&(!isReviewEditable(_this.toolMode)||config.reviewMode===ReviewModeType.LABELING))return editorState;// qa mode can only use qa tool, work mode can only use normal tool\n// slice should not begin with \\n\nif(substr(text,start,1)==='\\n')return editorState;if(ontology.results.labels.some(item=>item.start===start&&item.end===end&&item.value===value))return editorState;// generate new label\nif(!id)id=uuidv4();const newItem={type,start,end,value,id,text:substr(text,start,end-start),isReview:isReviewEditable(toolMode),keys};_this.addHistory(ACTION.ADD_LABEL,{label:newItem,relatedConnections});ontology.addResultItem(newItem,relatedConnections);// update rawDraftContentState, using new results\n_this.raw=_this.renderTextArea();// update editorState, using new rawDraftContentState\neditorState=EditorState.set(editorState,{currentContent:convertFromRaw(_this.raw)});editorState=closeSelection(editorState);return editorState;};this.addQALabel=function(editorState,_ref4,reviewInfo){let{start,end,value,id,keys,type}=_ref4;let needUnRedo=arguments.length>3&&arguments[3]!==undefined?arguments[3]:true;let needOpenReview=arguments.length>4&&arguments[4]!==undefined?arguments[4]:false;const{toolMode}=_this;const{ontology,config,review}=store;const{text}=ontology;if(config.reviewMode===ReviewModeType.REVIEW&&!isQATag(type))return{editorState,operation:null};if(isAnnotationReadonly(_this.toolMode)&&!isQATag(type))return{editorState,operation:null};if(isQATag(type)&&(!isReviewEditable(_this.toolMode)||config.reviewMode===ReviewModeType.LABELING))return{editorState,operation:null};// qa mode can only use qa tool, work mode can only use normal tool\n// slice should not begin with \\n\nif(substr(text,start,1)==='\\n')return{editorState,operation:null};if(review.reviews.missing.some(item=>item.start===start&&item.end===end&&item.value===value))return{editorState,operation:null};// generate new label\nif(!id)id=uuidv4();const newItem={type,start,end,value,id,text:substr(text,start,end-start),isReview:isReviewEditable(toolMode),keys};if(needOpenReview){_this.setState({tagOpenReview:{...newItem}});}const operation=review.addMissingReview(newItem,id,{...reviewInfo});if(needUnRedo){_this.addHistory(ACTION.ADD_MISSING_REVIEW,operation);}// update rawDraftContentState, using new results\n_this.raw=_this.renderTextArea();// update editorState, using new rawDraftContentState\neditorState=EditorState.set(editorState,{currentContent:convertFromRaw(_this.raw)});editorState=closeSelection(editorState);return{editorState,operation};};this.deleteQATag=function(id){let needUnRedo=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;const{state:{editorState}}=_this;if(store.config.reviewMode!==ReviewModeType.REVIEW){return{editorState,operation:null};}if(isAnnotationReadonly(_this.toolMode)){return{editorState,operation:null};}const operation=store.review.deleteMissingReview(id);if(needUnRedo){_this.addHistory(ACTION.DEL_MISSING_REVIEW,operation);}_this.raw=_this.renderTextArea();return{editorState:EditorState.set(editorState,{currentContent:convertFromRaw(_this.raw)}),operation};};this.deleteReview=function(reviewId){let needUnRedo=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;const{state:{editorState}}=_this;if(!(isReviewEditable(_this.toolMode)&&store.config.reviewMode===ReviewModeType.REVIEW)){return{editorState,operation:null};}const operation=store.review.deleteReview(reviewId);if(needUnRedo){_this.addHistory(ACTION.DELETE_REVIEW,operation);}_this.raw=_this.renderTextArea();return{editorState:EditorState.set(editorState,{currentContent:convertFromRaw(_this.raw)}),operation};};this.addReview=function(editorState,reviewId,review){let needUnRedo=arguments.length>3&&arguments[3]!==undefined?arguments[3]:true;const{state:{editorState:currEditorState}}=_this;if(!(isReviewEditable(_this.toolMode)&&store.config.reviewMode===ReviewModeType.REVIEW)){return{editorState:currEditorState,operation:null};}const operation=store.review.setReview(reviewId,{...review});if(needUnRedo){_this.addHistory(ACTION.ADD_REVIEW,operation);}_this.raw=_this.renderTextArea();return{editorState:EditorState.set(editorState,{currentContent:convertFromRaw(_this.raw)}),operation};};this.deleteReviewItemById=reviewId=>{if(reviewId){let nextEditorState=this.state.editorState;const reviewItem=store.ontology.getItemById(reviewId);if(reviewItem&&isQATag(reviewItem.type)){const{editorState}=this.deleteQATag(reviewItem.id);nextEditorState=editorState;}else{const{editorState}=this.deleteReview(reviewId);nextEditorState=editorState;}this.renderAndSave(nextEditorState);}};this.deleteReviewItemsById=reviewIds=>{const operations=[];reviewIds===null||reviewIds===void 0?void 0:reviewIds.forEach(reviewId=>{if(reviewId){const reviewItem=store.ontology.getItemById(reviewId);if(reviewItem&&isQATag(reviewItem.type)){const{operation}=this.deleteQATag(reviewItem.id,false);if(operation){operations.push(operation);}}else{const{operation}=this.deleteReview(reviewId,false);if(operation){operations.push(operation);}}}});this.addHistory(ACTION.DELETE_REVIEWS,operations);const{state:{editorState}}=this;this.raw=this.renderTextArea();return EditorState.set(editorState,{currentContent:convertFromRaw(this.raw)});};this.deleteReviewItems=reviewItems=>{const operations=[];const{state:{editorState}}=this;if(!(isReviewEditable(this.toolMode)&&store.config.reviewMode===ReviewModeType.REVIEW)){return editorState;}reviewItems===null||reviewItems===void 0?void 0:reviewItems.forEach(reviewItem=>{const{review,id}=reviewItem;if(review.result===ReviewItemResult.MISSING){const{operation}=this.deleteQATag(id,false);if(operation){operations.push(operation);}}else{const{operation}=this.deleteReview(id,false);if(operation){operations.push(operation);}}});this.addHistory(ACTION.DELETE_REVIEWS,operations);this.raw=this.renderTextArea();return EditorState.set(editorState,{currentContent:convertFromRaw(this.raw)});};this.addReviewItems=(editorState,reviewItems)=>{const operations=[];if(!(isReviewEditable(this.toolMode)&&store.config.reviewMode===ReviewModeType.REVIEW)){return editorState;}reviewItems===null||reviewItems===void 0?void 0:reviewItems.forEach(reviewItem=>{const{review,id}=reviewItem;if(review.result===ReviewItemResult.MISSING){const{operation}=this.addQALabel(editorState,reviewItem.label,{...review},false,false);if(operation){operations.push(operation);}}else{const{operation}=this.addReview(editorState,id,{...review},false);if(operation){operations.push(operation);}}});this.addHistory(ACTION.ADD_REVIEWS,operations);this.raw=this.renderTextArea();return EditorState.set(editorState,{currentContent:convertFromRaw(this.raw)});};this.deleteReviewHandle=reviewItem=>{if(reviewItem){let nextEditorState=this.state.editorState;if(isQATag(reviewItem.type)){const{editorState}=this.deleteQATag(reviewItem.id);nextEditorState=editorState;}else{const{editorState}=this.deleteReview(reviewItem.id);nextEditorState=editorState;}this.renderAndSave(nextEditorState);}};this.onDeleteReview=()=>{const{tagOpenReview}=this.state;this.deleteReviewHandle(tagOpenReview);};// create new RawDraftContentState and update customeStyleMap\n// update: raw, style, sliceMap\nthis.renderTextArea=_text=>{const{ontology}=store;const{ontologyConfigMap}=ontology;const{currentClick,currentHover,foundTags,foundTagSelectedIndex,needJumpFound}=this.state;const style={...this.state.style};const text=_text||store.ontology.text;const{labels,insertions}=ontology.getResults();// render missing labels as normal labels\n// slice text to segments\nconst slices=uniq(labels.map(label=>label.start).concat(labels.map(label=>label.end)).concat(insertions.map(insertion=>insertion.at)).concat(foundTags.map(t=>t.start)).concat(foundTags.map(t=>t.end)).concat([0,text.length]).sort((a,b)=>a-b));const labelHeads=uniq(labels.map(label=>label.start));const insertionHeads=uniq(insertions.map(insertion=>insertion.at));const foundTagHeads=uniq(foundTags.map(tag=>tag.start));// .concat(insertions.map((insertion) => insertion.at)));\nconst raw={blocks:[{text,key:'span-wrapper',type:'unstyled',depth:0,inlineStyleRanges:[{offset:0,length:text.length,style:'DEFAULT_STYLE'}],children:[],entityRanges:[],data:{}}],entityMap:{}};let sliceCount=0;// 对重叠的tag进行背景色叠加\nconst ranges=raw.blocks[0].inlineStyleRanges;this.sliceMap=new Map();slices.forEach((anchor,index,array)=>{// set slice\nif(!index)return;const{prev,next}={prev:array[index-1],next:anchor};const match=labels.filter(label=>label.start<=prev&&label.end>prev);let currentRGB=[0,0,0];let currentAlpha=0;let nextAlpha=DEFAULT_ALPHA;let isCoverbyQa=false;let keepRGB=null;match.some(label=>{const labelItem=getConfigByKeys(ontologyConfigMap,label.keys);const tempRGB=convertColorToArray(labelItem.color);if(!keepRGB)isCoverbyQa=isQATag(label.type);// render clicked tag in priority\nif(currentClick.id===label.id||currentClick.fromId===label.id||currentClick.toId===label.id){keepRGB=tempRGB.map((value,i)=>value*ACTIVE_ALPHA);isCoverbyQa=isQATag(label.type);return true;}if(!keepRGB&&currentHover.id===label.id||currentHover.fromId===label.id||currentHover.toId===label.id){keepRGB=tempRGB.map(v=>v*HOVER_ALPHA);}if(!keepRGB){currentRGB=currentRGB.map((value,i)=>value+tempRGB[i]*nextAlpha);currentAlpha+=nextAlpha;nextAlpha=DEFAULT_ALPHA*(1-currentAlpha)*(1-currentAlpha);}return false;});// background of found tag\nfoundTags.filter(tag=>tag.start<=prev&&tag.end>prev).some(tag=>{const tagIndex=foundTags.findIndex(f=>f.start===tag.start);if(tagIndex!==undefined){keepRGB=foundTagSelectedIndex===tagIndex&&!needJumpFound?[255,230,0]:[255,169,64,0.20];return true;}return false;});const baseRGB=convertColorToArray(BASE_COLOR);currentRGB=keepRGB||currentRGB.map((value,i)=>Math.min(255,value+baseRGB[i]*(1-currentAlpha)));const currentColor=convertArrayToColor(currentRGB);if(!style[\"BACKGROUND_\".concat(currentColor)])style[\"BACKGROUND_\".concat(currentColor)]={backgroundColor:currentColor};if(isCoverbyQa)ranges.push({offset:prev,length:next-prev,style:'MISSING_STYLE'});ranges.push({offset:prev,length:next-prev,style:\"BACKGROUND_\".concat(currentColor)});ranges.push({offset:prev,length:next-prev,style:\"SLICE_\".concat(prev,\"_\").concat(next)});// set slice head if for label/insertion slice\nif(labelHeads.indexOf(prev)>=0||insertionHeads.indexOf(prev)>=0){const slice=substr(text,prev,next-prev);const head=getSliceHead(slice);ranges.push({offset:prev,length:strlen(head),style:\"ANCHOR_\".concat(prev)});}if(foundTagHeads.indexOf(prev)>=0){const tagIndex=foundTags.findIndex(f=>f.start===prev);if(tagIndex!==undefined){const tag=foundTags[tagIndex];ranges.push({offset:prev,length:tag.end-tag.start,style:foundTagSelectedIndex===tagIndex&&!needJumpFound?'FIND_BLOCK_SELECTED':'FIND_BLOCK'});}}if(labelHeads.indexOf(prev)>=0||insertionHeads.indexOf(prev)>=0||foundTagHeads.indexOf(prev)>=0){const slice=substr(text,prev,next-prev);const head=getSliceHead(slice);// set sliceMap\nthis.sliceMap.set(prev,sliceCount);if(head!==slice)sliceCount+=1;}sliceCount+=1;});// update new style\nthis.setState({style});return raw;};this.onMouseMove=e=>{const box=this.svg.getBoundingClientRect();this.setState({currentMouse:{left:e.clientX-box.x,top:e.clientY-box.y}});};this.moveFocusToTag=tag=>{let currentClick={...this.state.currentClick};const{tagMap}=this.state;if(tag==null)return;currentClick={id:tag.id,fromId:tag.fromId,toId:tag.toId,fromType:tag.fromType,toType:tag.toType};const{top}=tagMap.getItem(tag.id,tag.type);const{clientHeight,scrollTop}=this.editorWrapper;if(top<scrollTop||top>clientHeight+scrollTop){this.editor.focus({y:top});}this.setState({currentClick},()=>{this.updateEditorAndRender();});};this.onKeyDown=e=>{if(window.disableTextHotKeys){return;}const{currentClick,editorState}=this.state;const{keyCode,ctrlKey,altKey}=e;const config=[];store.ontology.ontologyConfigMap.forEach(value=>{config.push(value);});if(ctrlKey){switch(true){case keyCode>=48&&keyCode<=57:{// 0 - 9\ne.preventDefault();const index=e.keyCode-49;if(index===-1){this.setCurrentBrush(null);}if(config[index]){this.setCurrentBrush(config[index]);}break;}case keyCode===90:e.preventDefault();this.executeHistory(RECALL_TYPE.UNDO);break;// Z\ncase keyCode===89:e.preventDefault();this.executeHistory(RECALL_TYPE.REDO);break;// Y\ncase keyCode===83:e.preventDefault();this.onSave();break;// S\ncase keyCode===82:{// R\ne.preventDefault();const nTag=store.ontology.moveToTagByStep(currentClick.id,1,true);this.moveFocusToTag(nTag);break;}case keyCode===81:{// Q\ne.preventDefault();if(currentClick.id==null)break;let nxtTag;if(altKey){nxtTag=store.ontology.stepToTag(currentClick.id,-1);}else{nxtTag=store.ontology.moveToTagByStep(currentClick.id,-1);}this.moveFocusToTag(nxtTag);break;}case keyCode===69:{// E\ne.preventDefault();if(currentClick.id==null)break;let nextTag;if(altKey){nextTag=store.ontology.stepToTag(currentClick.id,1);}else{nextTag=store.ontology.moveToTagByStep(currentClick.id,1);}this.moveFocusToTag(nextTag);break;}default:break;}}else if((currentClick===null||currentClick===void 0?void 0:currentClick.id)!==null&&isReviewEditable(this.toolMode)&&!isQATag(currentClick.type)&&store.config.reviewMode===ReviewModeType.REVIEW){switch(keyCode){case 49:// 1\ne.preventDefault();e.stopPropagation();this.addReview(editorState,currentClick.id,{result:'pass'});break;// 2\ncase 50:{e.preventDefault();e.stopPropagation();let tagReviewInfo=store.review.getReview(currentClick.id);if(!tagReviewInfo||tagReviewInfo.result!==ReviewItemResult.REJECT){tagReviewInfo={result:'reject',id:currentClick.id,type:[]};}const item=store.ontology.getItem(currentClick.type,currentClick.id);this.setState({tagOpenReview:item,tagReviewInfo});this.editor.blur();break;}default:break;}}};// update text\nthis.onContentChange=(editorState,data,type)=>{const{currentBrush,editorState:preState,findPanelVisible,inputEnable}=this.state;if(isAnnotationReadonly(this.toolMode)||store.config.reviewMode===ReviewModeType.REVIEW||(currentBrush||findPanelVisible||!inputEnable)&&type===undefined||this.props.read_only){return preState;}const{slice,prevSlice,tags,prevTags}=data;let{prevStart,prevEnd}=data;if(prevSlice.length===1&&slice.length===0)this.addHistory(ACTION.EDIT_SINGLE_DEL,data);else if(prevSlice.length===0&&slice.length===1)this.addHistory(ACTION.EDIT_SINGLE_ADD,data);else if(type===ACTION.EDIT_REPLACE)this.addHistory(ACTION.EDIT_REPLACE,data);else this.addHistory(ACTION.EDIT_DEFAULT,data);prevStart=strlen(store.ontology.text.slice(0,data.prevStart));prevEnd=strlen(store.ontology.text.slice(0,data.prevEnd));store.ontology.text=store.ontology.text.slice(0,data.prevStart)+data.slice+store.ontology.text.slice(data.prevEnd);// update labels and insertions\nconst offset=slice.length-prevSlice.length;if(type===ACTION.EDIT_REPLACE&&prevTags){const{insertions=[],labels=[],connections=[]}=prevTags;[...insertions,...labels,...connections].forEach(t=>{store.ontology.deleteTag(t.type,t.id);});}store.ontology.tagMove(prevStart,prevEnd,offset);if(type===ACTION.EDIT_REPLACE&&tags){const{insertions=[],labels=[],connections=[]}=tags;[...insertions,...labels,...connections].forEach(t=>{store.ontology.addResultItem(t);});}// update rawDraftContentState, using new text and results\nthis.raw=this.renderTextArea();// update editorState, using new rawDraftContentState\neditorState=EditorState.set(editorState,{currentContent:convertFromRaw(this.raw)});return editorState;};this.resetCurrentFocus=function(){let attribute=arguments.length>0&&arguments[0]!==undefined?arguments[0]:'currentClick';let shouldUpdate=arguments.length>1?arguments[1]:undefined;return new Promise(resolve=>{_this.setState({[\"\".concat(attribute)]:{id:null,from:null,to:null}},()=>resolve('state updated'));}).then(()=>{if(shouldUpdate){return _this.updateEditorAndRender();}});};this.resetCurrentFrom=()=>{this.setState({currentFrom:{type:null,id:null,offset:null}});};// to status for tag: connection mode and other mode\nthis.onTagClick=(e,type,id)=>{const{currentFrom,currentBrush,editorState,tagMap}=this.state;const offset=tagMap.getItem(id,type);this.editor.blur();if(!isConnection(currentBrush===null||currentBrush===void 0?void 0:currentBrush.type))return;// connecting mode only applys to label and insertion\nif(isLabel(type)||isInsertion(type)){// if there is no starting point, setup the starting point\nif(!currentFrom.type){this.setState({currentFrom:{type,id,offset}});}else{const nextEditorState=this.addConnection(editorState,{fromId:currentFrom.id,fromType:currentFrom.type,toId:id,toType:type,type:TAG.CONNECTION,value:currentBrush.text,keys:currentBrush.keys});this.renderAndSave(nextEditorState,true,true);}}};this.onTagDoubleClick=e=>{// only work in qa mode\nif(!store.reviewable&&!store.isRework){return;}const{id,type}=getTargetWrapperDataSet(e);const item=store.ontology.getItem(type,id);const tagReviewInfo=store.review.getReview(id);this.setState({tagOpenReview:item,tagReviewInfo});this.editor.blur();};// mouseEvent includes: mouse enter, mouse leave, mouse click, mouse context menu\nthis.TagMouseEvent=(e,type,id,focusType,active)=>{const{currentClick:{id:currId}}=this.state;const tag=store.ontology.getItem(type,id);if(!tag){return;}let attribute='';if(focusType===FOCUS_TYPE.HOVER){if(currId===tag.id&&active)return;attribute='currentHover';}else if(focusType===FOCUS_TYPE.CLICK){attribute='currentClick';this.editor.blur();}// active status: mouse enter | mouse click\nif(active){if(focusType===FOCUS_TYPE.CLICK){this.onTagClick(e,type,id);}// ranges.push({ offset: label.start, length: label.end - label.start, style: `${focusType}_STYLE_${color}` });\nthis.setState({[\"\".concat(attribute)]:{id:tag.id,fromId:tag===null||tag===void 0?void 0:tag.fromId,toId:tag===null||tag===void 0?void 0:tag.toId,fromType:tag===null||tag===void 0?void 0:tag.fromType,toType:tag===null||tag===void 0?void 0:tag.toType,type:tag===null||tag===void 0?void 0:tag.type}},()=>{this.updateEditorAndRender();});}else{// unactive status: mouse leave | mouse context menu\nconst tagType=type;this.resetCurrentFocus(attribute,true).then(()=>{if(focusType===FOCUS_TYPE.CLICK){this.onContextMenu(e,tag.id,tagType);}});}};this.onContextMenu=(e,id,type)=>{let nextEditorState;switch(type){case TAG.LABEL:case TAG.CONNECTION:case TAG.INSERTION:nextEditorState=this.deleteTag(type,id);break;case TAG.LABEL_QA:{const{editorState}=this.deleteQATag(id);nextEditorState=editorState;break;}default:return;}this.renderAndSave(nextEditorState);};this.setCurrentBrush=function(item){let input=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;_this.setState({currentBrush:item,inputEnable:input});};this.setFormVisible=()=>{this.setState({tagOpenReview:null,tagReviewInfo:null});};this.genKeyCommand=e=>{if(e.metaKey||e.altKey)return KEY_COMMAND.INVALID_KEY;switch(e.keyCode){case 90:// prevent default undo\ne.preventDefault();if(e.ctrlKey)return KEY_COMMAND.HANDLE_UNDO;return getDefaultKeyBinding(e);case 89:// prevent default redo\ne.preventDefault();if(e.ctrlKey)return KEY_COMMAND.HANDLE_REDO;return getDefaultKeyBinding(e);case 13:e.preventDefault();return KEY_COMMAND.HANDLE_RETURN;default:return getDefaultKeyBinding(e);}};this.handleKeyCommand=command=>{const{editorState}=this.state;switch(command){case KEY_COMMAND.INVALID_KEY:return'handled';case KEY_COMMAND.HANDLE_RETURN:{const start=editorState.getSelection().getStartOffset();const end=editorState.getSelection().getEndOffset();const nextEditorState=setSelection(this.onContentChange(editorState,{slice:'\\n',prevSlice:store.ontology.text.slice(start,end),prevStart:start,prevEnd:end,start:start+1,end:start+1}),start+1,start+1);this.renderAndSave(nextEditorState);return'handled';}case KEY_COMMAND.HANDLE_UNDO:return'handled';case KEY_COMMAND.HANDLE_REDO:return'handled';default:return'not-handled';}};// Get one anchor by slice head\nthis.getAnchorElementByHead=at=>{const{sliceMap}=this;const wrapper=this.editorWrapper.querySelector('.public-DraftStyleDefault-block');const id=\"span-wrapper-0-\".concat(sliceMap.get(at));const span=wrapper.querySelector(\"[data-offset-key='\".concat(id,\"']\"));return span;};// Get all anchors at one time\nthis.getAnchorElementsByHeads=()=>{const{sliceMap}=this;const wrapper=this.editorWrapper.querySelector('.public-DraftStyleDefault-block');const spanMap=new Map();sliceMap.forEach((value,key)=>{const id=\"span-wrapper-0-\".concat(sliceMap.get(key));const span=wrapper.querySelector(\"[data-offset-key='\".concat(id,\"']\"));spanMap.set(key,span);});return spanMap;};this.onMouseDown=e=>{if(e.which===1){this.mouseFlag=true;}const onMouseUp=()=>{this.mouseFlag=false;window.removeEventListener('mouseup',onMouseUp);};window.addEventListener('mouseup',onMouseUp);};this.onCompositionEnd=()=>{this.compositionFlag=COMPOSITION.PENDING;};this.onCompositionStart=()=>{this.compositionFlag=COMPOSITION.ENABLED;this.compositionTop=this.editorWrapper.scrollTop;};this.handleBeforeInput=()=>{this.inputFlag=true;return'not-handled';};this.handlePastedText=()=>{this.pasteFlag=true;return'not-handled';};setLocale(props.locale);this.raw={blocks:[],entityMap:{}};this.sliceMap=new Map();this.state={foundTags:[],needJumpFound:false,foundTagSelectedIndex:0,style:{FIND_BLOCK,FIND_BLOCK_SELECTED},tagOpenReview:null,tagReviewInfo:null,editorState:EditorState.createEmpty(),currentBrush:null,editorHeight:null,editorWidth:null,tagMap:new TagInfoMap(),currentClick:{id:null,fromId:null,toId:null,fromType:null,toType:null},currentHover:{id:'',fromId:null,toId:null,fromType:null,toType:null},currentFrom:{type:null,id:null,offset:null},currentMouse:{left:0,top:0},inputEnable:false};this.compositionTop=-1;this.compositionFlag=COMPOSITION.DISABLED;this.inputFlag=false;this.mouseFlag=false;this.pasteFlag=false;this.undoLock=false;this.redoLock=false;this.redoList=[];this.undoList=[];// user setting\nthis.fontColor=FONT_COLOR;this.toolMode=this.props.jobProxy.toolMode||this.props.mode;store.jobProxy=this.props.jobProxy;}submitReviews(){let isSubmit=arguments.length>0&&arguments[0]!==undefined?arguments[0]:true;return store.saveReviews(isSubmit);}getReviews(){return this.submitReviews();}getStatistics(){return store.getAuditStatistics();}async componentDidMount(){this.toolMode=this.props.jobProxy.toolMode;let{content}=this.props;let results;// insert qa tool's label\ntry{const resultRes=await this.props.jobProxy.loadResult();if((resultRes===null||resultRes===void 0?void 0:resultRes.results)&&(resultRes===null||resultRes===void 0?void 0:resultRes.content)){content=resultRes.content;results=resultRes.results;}else if((resultRes===null||resultRes===void 0?void 0:resultRes.labels)&&(resultRes===null||resultRes===void 0?void 0:resultRes.connections)&&(resultRes===null||resultRes===void 0?void 0:resultRes.insertions)){results=resultRes;}}catch(e){notification.error({message:localMessage('ANNOTATION_DATA_LOAD_ERROR'),duration:null});return;}// init store\ntry{await store.init({...this.props,content:content||''});}catch(e){notification.error({message:e.message,duration:null});return;}// initialize results\nstore.ontology.parseResults(results);const reviewRes=await this.props.jobProxy.loadReviews();if(reviewRes){store.review.parseReview(reviewRes);}// initialize raw\nthis.raw=this.renderTextArea();this.editorWrapper.addEventListener('compositionstart',this.onCompositionStart);this.editorWrapper.addEventListener('compositionend',this.onCompositionEnd);this.editorWrapper.addEventListener('mousedown',this.onMouseDown);this.editorWrapper.addEventListener('dragstart',e=>e.preventDefault());this.editorWrapper.addEventListener('contextmenu',e=>{e.preventDefault();this.resetCurrentFrom();this.resetCurrentFocus('currentClick',true);});this.editorWrapper.addEventListener('mousemove',this.onMouseMove);window.addEventListener('keydown',this.onKeyDown);window.addEventListener('resize',()=>this.renderAndSave(null,true,false,false));// initialize customStyleMap\nthis.setState({style:{...this.state.style,DEFAULT_STYLE:{color:this.fontColor,fontSize:\"\".concat(FONT_SIZE,\"px\"),lineHeight:\"\".concat(LINE_HEIGHT,\"px\"),letterSpacing:\"\".concat(FONT_SPACE,\"px\")},MISSING_STYLE:{color:'#000000'}}});this.renderAndSave(EditorState.createWithContent(convertFromRaw(this.raw)),true,true,false);// use url file backup to replace content, results, and reviews information\n// use local storage backup to replace text, results, and reviews information\n// save every 5 minutes\nsetInterval(()=>{this.onSave();},1000*60*5);if(this.props.renderComplete){this.props.renderComplete();}}render(){var _currentFrom$offset,_currentFrom$offset2;const{editorState,style,currentBrush,editorWidth,editorHeight,currentClick,currentHover,currentMouse,currentFrom,tagMap,tagOpenReview,tagReviewInfo,inputEnable}=this.state;const{config}=store;return/*#__PURE__*/React.createElement(\"div\",{className:\"app-wrapper\"},/*#__PURE__*/React.createElement(\"div\",{className:\"topbar-wrapper\",onClick:()=>{this.editorOnFocus=false;}},/*#__PURE__*/React.createElement(\"div\",{className:\"topbar-left-wrapper\"},isAppenCloud()&&/*#__PURE__*/React.createElement(\"div\",{className:\"logo\"},/*#__PURE__*/React.createElement(AppenLogo,null)),/*#__PURE__*/React.createElement(ReviewMode,null),/*#__PURE__*/React.createElement(\"div\",{className:\"divider\"}),/*#__PURE__*/React.createElement(UndoRedo,{undoHandle:()=>this.executeHistory(RECALL_TYPE.UNDO),redoHandle:()=>this.executeHistory(RECALL_TYPE.REDO),undoList:this.undoList,redoList:this.redoList}),/*#__PURE__*/React.createElement(\"div\",{className:\"divider\"}),/*#__PURE__*/React.createElement(Save,{onSave:this.onSave})),/*#__PURE__*/React.createElement(\"div\",{className:\"topbar-right-wrapper\"})),/*#__PURE__*/React.createElement(TextToolContext.Provider,{value:{moveFocusToTag:this.moveFocusToTag,deleteReviewItemById:this.deleteReviewItemById,deleteReviewItemsById:this.deleteReviewItemsById}},/*#__PURE__*/React.createElement(Sidebar,{showReview:isRework(this.toolMode)||isReviewEditable(this.toolMode),onClick:()=>{this.editorOnFocus=false;},currentBrush:currentBrush,inputEnable:inputEnable,setCurrentBrush:this.setCurrentBrush,items:tagMap,contentReadyOnly:this.props.read_only})),/*#__PURE__*/React.createElement(\"div\",{className:\"right-wrapper\"},/*#__PURE__*/React.createElement(\"div\",{className:\"editor-wrapper\",ref:r=>{this.editorWrapper=r;}},/*#__PURE__*/React.createElement(\"div\",{className:\"svg-wrapper\"},/*#__PURE__*/React.createElement(\"svg\",{ref:r=>{this.svg=r;},style:{height:\"\".concat(editorHeight,\"px\"),width:\"\".concat(editorWidth,\"px\")}},Object.entries(tagMap.connections).map(_ref5=>{let[id,connect]=_ref5;return/*#__PURE__*/React.createElement(\"g\",{key:id},/*#__PURE__*/React.createElement(\"path\",{d:connect.path,stroke:currentHover.id===id?HOVER_COLOR:currentClick.id===id?FOCUS_COLOR:DEFAULT_COLOR,fill:\"#00000000\"}));}),currentFrom.type?/*#__PURE__*/React.createElement(\"path\",{d:\"M \".concat((_currentFrom$offset=currentFrom.offset)===null||_currentFrom$offset===void 0?void 0:_currentFrom$offset.left,\" \").concat((_currentFrom$offset2=currentFrom.offset)===null||_currentFrom$offset2===void 0?void 0:_currentFrom$offset2.top,\" L \").concat(currentMouse.left,\" \").concat(currentMouse.top),stroke:FOCUS_COLOR,fill:\"#00000000\"}):null)),/*#__PURE__*/React.createElement(\"div\",{className:\"tags-wrapper\"},/*#__PURE__*/React.createElement(\"div\",{className:\"tags-panel\",style:{height:\"\".concat(editorHeight,\"px\"),width:\"\".concat(editorWidth,\"px\")},onDoubleClick:this.onTagDoubleClick},Object.entries(tagMap.labels).map(_ref6=>{var _store$review$getRevi;let[id,label]=_ref6;return/*#__PURE__*/React.createElement(LabelTag,{key:id,reviewResult:(_store$review$getRevi=store.review.getReview(id))===null||_store$review$getRevi===void 0?void 0:_store$review$getRevi.result,label:label,isHover:currentHover.id===id||currentHover.fromId===id||currentHover.toId===id,isClick:currentClick.id===id||currentClick.fromId===id||currentClick.toId===id,labelMouseEvent:this.TagMouseEvent});}),Object.entries(tagMap.insertions).map(_ref7=>{var _store$review$getRevi2;let[id,insertion]=_ref7;return/*#__PURE__*/React.createElement(InsertionTag,{key:id,reviewResult:(_store$review$getRevi2=store.review.getReview(id))===null||_store$review$getRevi2===void 0?void 0:_store$review$getRevi2.result,insertion:insertion,isHover:currentHover.id===id||currentHover.fromId===id||currentHover.toId===id,isClick:currentClick.id===id||currentClick.fromId===id||currentClick.toId===id,insertionMouseEvent:this.TagMouseEvent});}),Object.entries(tagMap.connections).map(_ref8=>{var _store$review$getRevi3;let[id,connection]=_ref8;return/*#__PURE__*/React.createElement(ConnectionTag,{key:id,reviewResult:(_store$review$getRevi3=store.review.getReview(id))===null||_store$review$getRevi3===void 0?void 0:_store$review$getRevi3.result,connection:connection,isHover:currentHover.id===id,isClick:currentClick.id===id,connectionMouseEvent:this.TagMouseEvent});}))),/*#__PURE__*/React.createElement(\"div\",{onClick:()=>{this.editor.focus();this.resetCurrentFocus('currentClick',true);}},/*#__PURE__*/React.createElement(Editor,{ref:r=>{this.editor=r;},editorState:editorState,customStyleMap:style,onChange:this.onChange,handlePastedText:this.handlePastedText,handleBeforeInput:this.handleBeforeInput,handleKeyCommand:this.handleKeyCommand,keyBindingFn:this.genKeyCommand})))),/*#__PURE__*/React.createElement(ReviewForm,{toolMode:this.toolMode,tagReviewInfo:tagReviewInfo,tagOpenReview:tagOpenReview,issueTypes:this.props.issue_types,setFormVisible:this.setFormVisible,onConfirm:review=>{this.addReview(editorState,tagOpenReview===null||tagOpenReview===void 0?void 0:tagOpenReview.id,review);store.ontology.updateOntologiesStatusMap();},onDelete:this.onDeleteReview}));}}","map":{"version":3,"names":["React","createContext","Editor","EditorState","convertFromRaw","getDefaultKeyBinding","notification","message","uniq","substr","strlen","v4","uuidv4","localMessage","setLocale","LabelTag","InsertionTag","ConnectionTag","isAnnotationReadonly","isRework","isReviewEditable","isPreview","Sidebar","genTagMap","renderTagMap","ReviewForm","UndoRedo","ReviewMode","Save","isAppenCloud","AppenLogo","store","FIND_BLOCK","FIND_BLOCK_SELECTED","FOCUS_COLOR","DEFAULT_COLOR","FONT_COLOR","BASE_COLOR","HISTORY_SIZE","FONT_SIZE","TAG_HEIGHT","LINE_HEIGHT","EDITOR_PADDING","COMPOSITION","SELECTION","ACTION","KEY_COMMAND","RECALL_TYPE","HOVER_COLOR","FONT_SPACE","FOCUS_TYPE","HOVER_ALPHA","ACTIVE_ALPHA","DEFAULT_ALPHA","isArabic","convertArrayToColor","convertColorToArray","getSliceHead","setSelection","closeSelection","getTextByInsertion","getTargetWrapperDataSet","getConfigByKeys","isLabel","isInsertion","isConnection","isQATag","ReviewItemResult","TAG","ReviewModeType","TagInfoMap","TextToolContext","TextAnnotationApp","Component","constructor","props","_this","this","addHistory","type","data","targetList","undoLock","redoList","redoLock","undoList","length","shift","EDIT_SINGLE_ADD","prev","EDIT_DEFAULT","prevSlice","end","prevStart","pop","push","slice","prevEnd","start","EDIT_SINGLE_DEL","executeHistory","recallType","UNDO","REDO","item","nextEditorState","state","editorState","EDIT_REPLACE","newData","tags","prevTags","onContentChange","ADD_INSERTION","id","insertion","deleteTag","ADD_LABEL","label","ADD_MISSING_REVIEW","preReview","addReview","deleteQATag","ADD_CONNECTION","DEL_LABEL","relatedConnections","addLabel","DEL_MISSING_REVIEW","review","addQALabel","DEL_INSERTION","addInsertion","DEL_CONNECTION","connection","addConnection","EDIT_REPLACE_ALL","text","currentText","prevText","prevResults","results","ontology","setResults","raw","renderTextArea","set","currentContent","ADD_REVIEW","deleteReview","DELETE_REVIEW","ADD_REVIEWS","deleteReviewItems","DELETE_REVIEWS","addReviewItems","renderAndSave","_editorState","shouldRenderTags","arguments","undefined","shouldResetCurrentState","shouldSaveURL","hasFocus","getSelection","top","editorWrapper","scrollTop","Promise","resolve","resetCurrentFrom","setState","exportResult","then","tagMap","measureTags","updateOntologiesStatusMap","renderTags","editorWidth","offsetWidth","editorHeight","scrollHeight","compositionTop","editor","focus","y","updateEditorAndRender","options","Symbol","iterator","onChange","compositionFlag","ENABLED","prevEditorState","getCurrentContent","getPlainText","getStartOffset","getEndOffset","prevFocus","inputFlag","pasteFlag","PENDING","DISABLED","onSelectionChange","shouldRender","MOVE","spanMap","getAnchorElementsByHeads","newTagMap","onSave","toolMode","submitReviews","success","e","warning","onSubmit","params","invalid","validityFlag","config","submitCheck","skipCheckForInvalidData","validation","defaultSync","blocked","Error","isSubmit","saveResult","labels","insertions","getResults","offsetTops","map","_spanMap$get","get","offsetTop","concat","_spanMap$get2","at","occupyMap","Map","forEach","ontologyConfigMap","ranges","blocks","inlineStyleRanges","style","filter","span","getAnchorElementByHead","offset","occupyList","lineHeight","it","sort","a","b","currentBrush","mouseFlag","fbAt","value","keys","INSERTION","CLICK","fbStart","fbEnd","result","MISSING","DRAG","reviewMode","REVIEW","operation","_ref","arabic","newItem","isReview","addResultItem","_ref2","fromId","fromType","toId","toType","connections","some","_ref3","LABELING","_ref4","reviewInfo","needUnRedo","needOpenReview","reviews","missing","tagOpenReview","addMissingReview","deleteMissingReview","reviewId","currEditorState","setReview","deleteReviewItemById","reviewItem","getItemById","deleteReviewItemsById","reviewIds","operations","reviewItems","deleteReviewHandle","onDeleteReview","_text","currentClick","currentHover","foundTags","foundTagSelectedIndex","needJumpFound","slices","t","labelHeads","insertionHeads","foundTagHeads","tag","key","depth","children","entityRanges","entityMap","sliceCount","sliceMap","anchor","index","array","next","match","currentRGB","currentAlpha","nextAlpha","isCoverbyQa","keepRGB","labelItem","tempRGB","color","i","v","tagIndex","findIndex","f","baseRGB","Math","min","currentColor","backgroundColor","indexOf","head","onMouseMove","box","svg","getBoundingClientRect","currentMouse","left","clientX","x","clientY","moveFocusToTag","getItem","clientHeight","onKeyDown","window","disableTextHotKeys","keyCode","ctrlKey","altKey","preventDefault","setCurrentBrush","nTag","moveToTagByStep","nxtTag","stepToTag","nextTag","stopPropagation","tagReviewInfo","getReview","REJECT","blur","preState","findPanelVisible","inputEnable","read_only","tagMove","resetCurrentFocus","attribute","shouldUpdate","from","to","currentFrom","onTagClick","CONNECTION","onTagDoubleClick","reviewable","TagMouseEvent","focusType","active","currId","HOVER","tagType","onContextMenu","LABEL","LABEL_QA","input","setFormVisible","genKeyCommand","metaKey","INVALID_KEY","HANDLE_UNDO","HANDLE_REDO","HANDLE_RETURN","handleKeyCommand","command","wrapper","querySelector","onMouseDown","which","onMouseUp","removeEventListener","addEventListener","onCompositionEnd","onCompositionStart","handleBeforeInput","handlePastedText","locale","createEmpty","fontColor","jobProxy","mode","saveReviews","getReviews","getStatistics","getAuditStatistics","componentDidMount","content","resultRes","loadResult","error","duration","init","parseResults","reviewRes","loadReviews","parseReview","DEFAULT_STYLE","fontSize","letterSpacing","MISSING_STYLE","createWithContent","setInterval","renderComplete","render","_currentFrom$offset","_currentFrom$offset2","createElement","className","onClick","editorOnFocus","undoHandle","redoHandle","Provider","showReview","items","contentReadyOnly","ref","r","height","width","Object","entries","_ref5","connect","d","path","stroke","fill","onDoubleClick","_ref6","_store$review$getRevi","reviewResult","isHover","isClick","labelMouseEvent","_ref7","_store$review$getRevi2","insertionMouseEvent","_ref8","_store$review$getRevi3","connectionMouseEvent","customStyleMap","keyBindingFn","issueTypes","issue_types","onConfirm","onDelete"],"sources":["/Users/qzheng/Documents/webroot/annotation_tools/src/components/editable-text/TextAnnotationApp.jsx"],"sourcesContent":["/* eslint-disable no-nested-ternary */\n/* eslint-disable react/no-access-state-in-setstate */\n/* eslint-disable no-undef */\n/* eslint-disable no-underscore-dangle */\nimport React, { createContext } from 'react';\nimport { Editor, EditorState, convertFromRaw, getDefaultKeyBinding } from 'draft-js';\nimport { notification, message } from 'antd';\nimport { uniq } from 'lodash';\nimport { substr, strlen } from 'fbjs/lib/UnicodeUtils';\nimport { v4 as uuidv4 } from 'uuid';\nimport localMessage, { setLocale } from './locale';\nimport { LabelTag, InsertionTag, ConnectionTag } from './components/tag';\nimport { isAnnotationReadonly, isRework, isReviewEditable, isPreview } from '../../utils/tool-mode';\nimport Sidebar from './components/sidebar';\nimport { genTagMap, renderTagMap } from './utils/tagMapUtil';\n\nimport ReviewForm from './components/reviewForm';\nimport UndoRedo from './components/UndoRedo';\nimport ReviewMode from './components/ReviewMode';\nimport Save from './components/Save';\nimport { isAppenCloud } from '../../utils';\nimport AppenLogo from '../common/AppenLogo';\nimport store from './store/RootStore';\nimport './TextAnnotationApp.scss';\nimport 'draft-js/dist/Draft.css';\nimport {\n  FIND_BLOCK,\n  FIND_BLOCK_SELECTED,\n  FOCUS_COLOR, DEFAULT_COLOR,\n  FONT_COLOR, BASE_COLOR, HISTORY_SIZE,\n  FONT_SIZE, TAG_HEIGHT,\n  LINE_HEIGHT, EDITOR_PADDING,\n  COMPOSITION, SELECTION, ACTION, KEY_COMMAND,\n  RECALL_TYPE,\n  HOVER_COLOR,\n  FONT_SPACE, FOCUS_TYPE,\n  HOVER_ALPHA,\n  ACTIVE_ALPHA,\n  DEFAULT_ALPHA,\n} from './store/constant';\nimport {\n  isArabic,\n  convertArrayToColor,\n  convertColorToArray,\n  getSliceHead,\n  setSelection,\n  closeSelection,\n  getTextByInsertion,\n  getTargetWrapperDataSet,\n  getConfigByKeys,\n} from './utils/helper';\nimport {\n  isLabel,\n  isInsertion,\n  isConnection,\n  isQATag,\n} from './store/tag_mode';\nimport { ReviewItemResult, TAG, ReviewMode as ReviewModeType } from './types';\nimport TagInfoMap from './utils/TagInfoMap';\n\nexport const TextToolContext = createContext();\nexport default class TextAnnotationApp extends React.Component {\n  constructor(props) {\n    super(props);\n    setLocale(props.locale);\n    this.raw = { blocks: [], entityMap: {} };\n    this.sliceMap = new Map();\n    this.state = {\n      foundTags: [],\n      needJumpFound: false,\n      foundTagSelectedIndex: 0,\n      style: {\n        FIND_BLOCK,\n        FIND_BLOCK_SELECTED,\n      },\n      tagOpenReview: null,\n      tagReviewInfo: null,\n      editorState: EditorState.createEmpty(),\n      currentBrush: null,\n      editorHeight: null,\n      editorWidth: null,\n      tagMap: new TagInfoMap(),\n      currentClick: {\n        id: null,\n        fromId: null,\n        toId: null,\n        fromType: null,\n        toType: null,\n      },\n      currentHover: {\n        id: '',\n        fromId: null,\n        toId: null,\n        fromType: null,\n        toType: null,\n      },\n      currentFrom: {\n        type: null,\n        id: null,\n        offset: null,\n      },\n      currentMouse: {\n        left: 0,\n        top: 0,\n      },\n      inputEnable: false,\n    };\n\n    this.compositionTop = -1;\n    this.compositionFlag = COMPOSITION.DISABLED;\n    this.inputFlag = false;\n    this.mouseFlag = false;\n    this.pasteFlag = false;\n    this.undoLock = false;\n    this.redoLock = false;\n    this.redoList = [];\n    this.undoList = [];\n\n    // user setting\n    this.fontColor = FONT_COLOR;\n    this.toolMode = this.props.jobProxy.toolMode || this.props.mode;\n    store.jobProxy = this.props.jobProxy;\n  };\n\n  addHistory = (type, data) => {\n    let targetList;\n    if (this.undoLock) {\n      // Add history to redo list\n      targetList = this.redoList;\n    } else if (this.redoLock) {\n      // Add history back to undo list\n      targetList = this.undoList;\n      // Clear redo list\n    } else {\n      // Add history to redo list\n      targetList = this.undoList;\n      this.redoList = [];\n    }\n    let { length } = targetList;\n    if (length > HISTORY_SIZE) {\n      targetList.shift();\n      length -= 1;\n    }\n    if (type === ACTION.EDIT_SINGLE_ADD && length >= 1) {\n      const prev = targetList[length - 1];\n      if ((prev.type === ACTION.EDIT_DEFAULT || prev.type === ACTION.EDIT_SINGLE_ADD) && (prev.data.prevSlice === '' && prev.data.end === data.prevStart)) {\n        targetList.pop();\n        targetList.push({\n          type: ACTION.EDIT_DEFAULT,\n          data: {\n            prevSlice: '',\n            slice: prev.data.slice + data.slice,\n            prevStart: prev.data.prevStart,\n            prevEnd: prev.data.prevEnd,\n            start: data.start,\n            end: data.end,\n          }\n        });\n      } else targetList.push({ type, data });\n    } else if (type === ACTION.EDIT_SINGLE_DEL && length >= 1) {\n      const prev = targetList[length - 1];\n      if ((prev.type === ACTION.EDIT_DEFAULT || prev.type === ACTION.EDIT_SINGLE_DEL) && (prev.data.slice === '' && data.prevEnd === prev.data.start)) {\n        targetList.pop();\n        targetList.push({\n          type: ACTION.EDIT_DEFAULT,\n          data: {\n            slice: '',\n            prevSlice: data.prevSlice + prev.data.prevSlice,\n            prevStart: data.end,\n            prevEnd: prev.data.prevEnd,\n            start: data.start,\n            end: data.end,\n          }\n        });\n      } else targetList.push({ type, data });\n    } else targetList.push({ type, data });\n  };\n\n  executeHistory = (recallType) => {\n    // Execute history\n    let targetList;\n    if (recallType === RECALL_TYPE.UNDO) {\n      // Get from undo list\n      this.undoLock = true;\n      targetList = this.undoList;\n    } else if (recallType === RECALL_TYPE.REDO) {\n      // Get from redo list\n      this.redoLock = true;\n      targetList = this.redoList;\n    }\n    if (targetList.length === 0) {\n      this.undoLock = false;\n      this.redoLock = false;\n      return;\n    }\n    const item = targetList.pop();\n    const { data } = item;\n    let nextEditorState = this.state.editorState;\n    switch (item.type) {\n      case ACTION.EDIT_SINGLE_ADD:\n      case ACTION.EDIT_SINGLE_DEL:\n      case ACTION.EDIT_DEFAULT:\n      case ACTION.EDIT_REPLACE:\n      {\n        const newData = {\n          prevSlice: data.slice,\n          slice: data.prevSlice,\n          start: data.prevEnd,\n          end: data.prevEnd,\n          prevStart: data.prevStart,\n          prevEnd: data.end,\n          ...item.type === ACTION.EDIT_REPLACE && {\n            tags: data.prevTags,\n            prevTags: data.tags,\n          }\n        };\n        // nextEditorState = this.onContentChange(nextEditorState, newData);\n        nextEditorState = setSelection(this.onContentChange(nextEditorState, newData, item.type), newData.start, newData.end);\n        break;\n      }\n      case ACTION.ADD_INSERTION:\n      {\n        const { type, id } = data.insertion;\n        nextEditorState = this.deleteTag(type, id);\n        break;\n      }\n      case ACTION.ADD_LABEL:\n      {\n        const { type, id } = data.label;\n        nextEditorState = this.deleteTag(type, id);\n        break;\n      }\n      case ACTION.ADD_MISSING_REVIEW:\n      {\n        const { preReview, id } = data;\n        if (preReview) {\n          const { editorState } = this.addReview(nextEditorState, id, { ...preReview });\n          nextEditorState = editorState;\n        } else {\n          const { editorState } = this.deleteQATag(id);\n          nextEditorState = editorState;\n        }\n        break;\n      }\n      case ACTION.ADD_CONNECTION:\n      {\n        const { type, id } = data;\n        nextEditorState = this.deleteTag(type, id);\n        break;\n      }\n      case ACTION.DEL_LABEL:\n      {\n        const { relatedConnections, label } = data;\n        nextEditorState = this.addLabel(nextEditorState, label, relatedConnections);\n        break;\n      }\n      case ACTION.DEL_MISSING_REVIEW:\n      {\n        const { label, review } = data;\n        const { editorState } = this.addQALabel(nextEditorState, label, { ...review });\n        nextEditorState = editorState;\n\n        break;\n      }\n      case ACTION.DEL_INSERTION:\n      {\n        const { relatedConnections, insertion } = data;\n\n        nextEditorState = this.addInsertion(nextEditorState, insertion, relatedConnections);\n        break;\n      }\n      case ACTION.DEL_CONNECTION:\n      {\n        const { connection } = data;\n        nextEditorState = this.addConnection(nextEditorState, connection);\n        break;\n      }\n      case ACTION.EDIT_REPLACE_ALL:\n      {\n        const { text: currentText, prevText, prevResults, results } = data;\n        store.ontology.text = prevText;\n        store.ontology.setResults(prevResults);\n        this.raw = this.renderTextArea(prevText);\n        nextEditorState = EditorState.set(nextEditorState, { currentContent: convertFromRaw(this.raw) });\n        this.addHistory(ACTION.EDIT_REPLACE_ALL, {\n          text: prevText,\n          prevText: currentText,\n          prevResults: results,\n          results: prevResults,\n        });\n        break;\n      }\n      case ACTION.ADD_REVIEW: {\n        const { preReview, id } = data;\n        if (preReview) {\n          const { editorState } = this.addReview(nextEditorState, id, { ...preReview });\n          nextEditorState = editorState;\n        } else {\n          const { editorState } = this.deleteReview(id);\n          nextEditorState = editorState;\n        }\n        break;\n      }\n      case ACTION.DELETE_REVIEW: {\n        const { review, id } = data;\n        const { editorState } = this.addReview(nextEditorState, id, { ...review });\n        nextEditorState = editorState;\n        break;\n      }\n      case ACTION.ADD_REVIEWS: {\n        nextEditorState = this.deleteReviewItems(data);\n        break;\n      }\n      case ACTION.DELETE_REVIEWS: {\n        nextEditorState = this.addReviewItems(nextEditorState, data);\n        break;\n      }\n      default:\n        break;\n    }\n\n    this.renderAndSave(nextEditorState);\n    this.undoLock = false;\n    this.redoLock = false;\n  };\n\n  renderAndSave = (\n    _editorState,\n    shouldRenderTags = true,\n    shouldResetCurrentState = false,\n    shouldSaveURL = false,\n  ) => {\n    const editorState = _editorState || this.state.editorState;\n    const { hasFocus } = editorState.getSelection();\n    const top = this.editorWrapper.scrollTop;\n    // window.ew = this.editorWrapper;\n    return new Promise((resolve) => {\n      if (shouldResetCurrentState) {\n        this.resetCurrentFrom();\n      }\n      this.setState({ editorState });\n      if (shouldSaveURL) {\n        this.exportResult();\n      }\n      resolve();\n    }).then(() => {\n      if (shouldRenderTags) {\n        const { nextEditorState, tagMap } = this.measureTags(editorState);\n        return new Promise((resolve) => {\n          this.setState({ editorState: nextEditorState }, () => {\n            store.ontology.updateOntologiesStatusMap();\n          });\n          resolve(tagMap);\n        });\n      }\n    }).then((tagMap) => {\n      if (shouldRenderTags) {\n        this.renderTags(tagMap);\n        return new Promise((resolve) => {\n          this.setState({\n            editorWidth: this.editorWrapper.offsetWidth - EDITOR_PADDING * 2,\n            editorHeight: this.editorWrapper.scrollHeight - EDITOR_PADDING * 2,\n            tagMap,\n          });\n          resolve();\n        });\n      }\n    }).then(() => {\n      if (hasFocus) {\n        // move back to current selection after composition end\n        if (this.compositionTop >= 0) {\n          this.editor.focus({ y: this.compositionTop });\n          this.compositionTop = -1;\n        } else this.editor.focus({ y: top });\n      }\n      return new Promise((resolve) => resolve());\n    });\n  };\n\n  updateEditorAndRender = (options) => {\n    let { editorState } = this.state;\n    // update rawDraftContentState, using new results\n    this.raw = this.renderTextArea();\n    // update editorState, using new rawDraftContentState\n    editorState = EditorState.set(editorState, { currentContent: convertFromRaw(this.raw) });\n    if (options && typeof options[Symbol.iterator] === 'function') {\n      return this.renderAndSave(editorState, ...options);\n    }\n\n    return this.renderAndSave(editorState);\n  };\n\n  onChange = (editorState) => {\n    // ignore composition operation\n    if (this.compositionFlag === COMPOSITION.ENABLED) return;\n    // get operation type ( handled operation not included )\n    const prevEditorState = this.state.editorState;\n    const prevText = store.ontology.text;\n    const text = editorState.getCurrentContent().getPlainText();\n    let prevStart = prevEditorState.getSelection().getStartOffset();\n    const prevEnd = prevEditorState.getSelection().getEndOffset();\n    const start = editorState.getSelection().getStartOffset();\n    const end = editorState.getSelection().getEndOffset();\n    const { hasFocus } = editorState.getSelection();\n    const { hasFocus: prevFocus } = prevEditorState.getSelection();\n\n    if (hasFocus !== prevFocus) { // when focus change update new editor state and return without doing anything\n      const nextEditorState = EditorState.set(editorState, { currentContent: convertFromRaw(this.raw) });\n      this.renderAndSave(nextEditorState, null, false);\n      return;\n    }\n\n    if (this.inputFlag || this.pasteFlag || this.compositionFlag === COMPOSITION.PENDING || prevText !== text) {\n      /* text changed:\n       * 1. deleted by delete key\n       * 2. deleted by drag + delete key\n       * 3. deleted by drag + cut operation\n       * 4. insert/replace by (drag) + simply typing\n       * 5. insert/replace by (drag) + composition typing\n       * 6. insert/replace by (drag) + paste operation\n       * 7. redo && undo\n       */\n      if (prevStart === prevEnd && start === prevStart - 1) prevStart -= 1;\n      const prevSlice = prevText.slice(prevStart, prevEnd);\n      const slice = text.slice(prevStart, end);\n      const data = { prevSlice, slice, prevStart, prevEnd, start, end };\n      const nextEditorState = this.onContentChange(editorState, data);\n      // reset flag\n      this.inputFlag = false;\n      this.pasteFlag = false;\n      this.compositionFlag = COMPOSITION.DISABLED;\n      this.renderAndSave(nextEditorState);\n    } else {\n      /* selection changed\n       * 1. simply select\n       * 2. click select: add insertion\n       * 3. drag select: add label\n       */\n      const data = { start, end };\n      const { nextEditorState, type } = this.onSelectionChange(editorState, data);\n      const shouldRender = type !== SELECTION.MOVE;\n      this.renderAndSave(nextEditorState, shouldRender, shouldRender);\n    }\n  };\n\n  renderTags = (tagMap) => {\n    const spanMap = this.getAnchorElementsByHeads();\n    const newTagMap = renderTagMap(tagMap, spanMap);\n    return newTagMap;\n  };\n\n  onSave = async () => {\n    if (isPreview(this.toolMode)) return;\n    try {\n      if (!isAnnotationReadonly(this.toolMode)) {\n        await this.exportResult();\n      }\n      if (isReviewEditable(this.toolMode)) {\n        await this.submitReviews(false);\n      }\n      message.success(localMessage('saveSuccess'));\n    } catch (e) {\n      message.warning(localMessage('saveFail'));\n    }\n  };\n\n  onSubmit = async (params) => {\n    const invalid = params && params.validityFlag === 'false';\n    if (store.config.submitCheck && (\n      !invalid || !store.config.skipCheckForInvalidData\n    )) {\n      // validate before submit\n      await store.validation.defaultSync();\n      if (store.validation.blocked) {\n        throw new Error(localMessage('SUBMIT_CHECK_FAIL'));\n      }\n    }\n    return this.exportResult(true);\n  };\n\n  exportResult = (isSubmit = false) => {\n    if (isAnnotationReadonly(this.toolMode)) return;\n    return store.saveResult(isSubmit);\n  };\n\n  submitReviews(isSubmit = true) {\n    return store.saveReviews(isSubmit);\n  }\n\n  getReviews() {\n    return this.submitReviews();\n  }\n\n  getStatistics() {\n    return store.getAuditStatistics();\n  }\n\n  measureTags = (editorState) => {\n    const { raw } = this;\n    const { text } = store.ontology;\n    const { labels, insertions } = store.ontology.getResults();\n\n    const spanMap = this.getAnchorElementsByHeads();\n    const offsetTops = uniq((labels.map((label) => spanMap.get(label.start)?.offsetTop))\n      .concat(insertions.map((insertion) => spanMap.get(insertion.at)?.offsetTop)));\n    const occupyMap = new Map();\n    offsetTops.forEach((offsetTop) => { occupyMap.set(offsetTop, []); });\n\n    // get label offsets\n    const tagMap = genTagMap(store.ontology.getResults(), store.ontology.ontologyConfigMap, spanMap, occupyMap, text);\n    const ranges = raw.blocks[0].inlineStyleRanges;\n    const style = { ...this.state.style };\n    ranges.filter((item) => item.style.slice(0, 6) === 'ANCHOR').forEach((item) => {\n      const span = this.getAnchorElementByHead(item.offset);\n      if (span) {\n        const occupyList = occupyMap.get(span.offsetTop);\n        const lineHeight = occupyList.map((it) => (it.top > 0 ? it.top - FONT_SIZE + TAG_HEIGHT : -it.top))\n          .sort((a, b) => (a - b)).pop() * 2 + LINE_HEIGHT;\n        style[`LINEHEIGHT_${lineHeight}`] = { lineHeight: `${lineHeight}px` };\n        ranges.push({ offset: item.offset, length: item.length, style: `LINEHEIGHT_${lineHeight}` });\n      }\n    });\n    const nextEditorState = EditorState.set(editorState, { currentContent: convertFromRaw(this.raw) });\n    this.setState({ style });\n    return { nextEditorState, tagMap };\n  };\n\n  onSelectionChange = (editorState, data) => {\n    const { start, end } = data;\n    const { currentBrush } = this.state;\n    if (!this.mouseFlag) {\n      return { nextEditorState: editorState, type: SELECTION.MOVE };\n    } if (start === end && isInsertion(currentBrush?.type)) {\n      const fbAt = strlen(store.ontology.text.slice(0, start));\n      const nextEditorState = this.addInsertion(editorState, { at: fbAt, value: currentBrush.text, keys: currentBrush.keys, type: TAG.INSERTION });\n      return { nextEditorState, type: SELECTION.CLICK };\n    } if (start !== end && isLabel(currentBrush?.type)) {\n      const fbStart = strlen(store.ontology.text.slice(0, start));\n      const fbEnd = strlen(store.ontology.text.slice(0, end));\n      if (isQATag(currentBrush?.type)) {\n        const { editorState: nextEditorState } = this.addQALabel(editorState, { start: fbStart, end: fbEnd, value: currentBrush.text, keys: currentBrush.keys, type: currentBrush.type }, { result: ReviewItemResult.MISSING }, true, true);\n        return { nextEditorState, type: SELECTION.DRAG };\n      }\n      const nextEditorState = this.addLabel(editorState, { start: fbStart, end: fbEnd, value: currentBrush.text, keys: currentBrush.keys, type: currentBrush.type });\n      return { nextEditorState, type: SELECTION.DRAG };\n    }\n    return { nextEditorState: editorState, type: SELECTION.MOVE };\n  };\n\n  deleteTag = (type, id) => {\n    const { state: { editorState } } = this;\n    if (isQATag(type) && store.config.reviewMode !== ReviewModeType.REVIEW) {\n      return editorState;\n    }\n    if (!isQATag(type) && store.config.reviewMode === ReviewModeType.REVIEW) {\n      return;\n    }\n    if (isAnnotationReadonly(this.toolMode)) {\n      return editorState;\n    }\n\n    const operation = store.ontology.deleteTag(type, id);\n    switch (true) {\n      case (isLabel(type)): this.addHistory(ACTION.DEL_LABEL, operation); break;\n      case (isConnection(type)): this.addHistory(ACTION.DEL_CONNECTION, operation); break;\n      case (isInsertion(type)): this.addHistory(ACTION.DEL_INSERTION, operation); break;\n      default: break;\n    }\n    this.raw = this.renderTextArea();\n    return EditorState.set(editorState, { currentContent: convertFromRaw(this.raw) });\n  };\n\n  addInsertion = (editorState, { at, value, id, keys, type }, relatedConnections = []) => {\n    const { state: { currentBrush }, toolMode } = this;\n    const { text } = store.ontology;\n    if (isAnnotationReadonly(this.toolMode) || store.config.reviewMode === ReviewModeType.REVIEW) return editorState;\n    if (at === strlen(text)) return editorState; // prevent insert to the end of content\n    // eslint-disable-next-line no-restricted-syntax\n    for (const item of store.ontology.results.insertions) {\n      if (item.at === at && item.value === currentBrush.text) return editorState;\n    }\n    if (!id) id = uuidv4();\n    const arabic = isArabic(substr(text, at));\n    if (arabic && at) at -= 1;\n    const newItem = {\n      type,\n      at,\n      value,\n      id,\n      text: getTextByInsertion(store.ontology.text, { at, value }),\n      isReview: isReviewEditable(toolMode),\n      keys,\n    };\n\n    this.addHistory(ACTION.ADD_INSERTION, {\n      insertion: newItem,\n      relatedConnections,\n    });\n\n    store.ontology.addResultItem(newItem, relatedConnections);\n\n    this.raw = this.renderTextArea();\n    editorState = EditorState.set(editorState, { currentContent: convertFromRaw(this.raw) });\n    editorState = closeSelection(editorState);\n    return editorState;\n  };\n\n  addConnection = (editorState, { fromId, fromType, toId, toType, value, id, keys, type }) => {\n    const { state: { currentBrush }, toolMode } = this;\n    if (isAnnotationReadonly(toolMode) || store.config.reviewMode === ReviewModeType.REVIEW) return editorState;\n    if (fromId === toId) return editorState;\n    if (isQATag(fromType) || isQATag(toType)) return editorState; // can't add connection for qa tool\n\n    if (store.ontology.results.connections.some((item) => item.fromId === fromId && item.toId === toId && item.value === currentBrush.text)) return editorState;\n\n    if (!id) id = uuidv4();\n    const newItem = {\n      type,\n      fromId,\n      fromType,\n      toId,\n      toType,\n      value,\n      id,\n      isReview: isReviewEditable(toolMode),\n      keys,\n    };\n    this.addHistory(ACTION.ADD_CONNECTION, newItem);\n    store.ontology.addResultItem(newItem);\n\n    this.raw = this.renderTextArea();\n    editorState = EditorState.set(editorState, { currentContent: convertFromRaw(this.raw) });\n    return editorState;\n  };\n\n  addLabel = (editorState, { start, end, value, id, keys, type }, relatedConnections = []) => {\n    const { toolMode } = this;\n    const { ontology, config } = store;\n    const { text } = store.ontology;\n\n    if (config.reviewMode === ReviewModeType.REVIEW && (!isQATag(type))) return editorState;\n    if (isAnnotationReadonly(this.toolMode) && (!isQATag(type))) return editorState;\n    if (isQATag(type) && (!isReviewEditable(this.toolMode) || config.reviewMode === ReviewModeType.LABELING)) return editorState; // qa mode can only use qa tool, work mode can only use normal tool\n\n    // slice should not begin with \\n\n    if (substr(text, start, 1) === '\\n') return editorState;\n\n    if (ontology.results.labels.some((item) => item.start === start && item.end === end && item.value === value)) return editorState;\n\n    // generate new label\n    if (!id) id = uuidv4();\n    const newItem = {\n      type,\n      start,\n      end,\n      value,\n      id,\n      text: substr(text, start, end - start),\n      isReview: isReviewEditable(toolMode),\n      keys\n    };\n\n    this.addHistory(ACTION.ADD_LABEL, {\n      label: newItem,\n      relatedConnections,\n    });\n\n    ontology.addResultItem(newItem, relatedConnections);\n    // update rawDraftContentState, using new results\n    this.raw = this.renderTextArea();\n    // update editorState, using new rawDraftContentState\n    editorState = EditorState.set(editorState, { currentContent: convertFromRaw(this.raw) });\n    editorState = closeSelection(editorState);\n    return editorState;\n  };\n\n  addQALabel = (editorState, { start, end, value, id, keys, type }, reviewInfo, needUnRedo = true, needOpenReview = false) => {\n    const { toolMode } = this;\n    const { ontology, config, review } = store;\n    const { text } = ontology;\n    if (config.reviewMode === ReviewModeType.REVIEW && (!isQATag(type))) return { editorState, operation: null };\n    if (isAnnotationReadonly(this.toolMode) && (!isQATag(type))) return { editorState, operation: null };\n    if (isQATag(type) && (!isReviewEditable(this.toolMode) || config.reviewMode === ReviewModeType.LABELING)) return { editorState, operation: null }; // qa mode can only use qa tool, work mode can only use normal tool\n\n    // slice should not begin with \\n\n    if (substr(text, start, 1) === '\\n') return { editorState, operation: null };\n\n    if (review.reviews.missing.some((item) => item.start === start && item.end === end && item.value === value)) return { editorState, operation: null };\n\n    // generate new label\n    if (!id) id = uuidv4();\n    const newItem = {\n      type,\n      start,\n      end,\n      value,\n      id,\n      text: substr(text, start, end - start),\n      isReview: isReviewEditable(toolMode),\n      keys\n    };\n    if (needOpenReview) {\n      this.setState({ tagOpenReview: { ...newItem } });\n    }\n\n    const operation = review.addMissingReview(newItem, id, { ...reviewInfo });\n    if (needUnRedo) {\n      this.addHistory(ACTION.ADD_MISSING_REVIEW, operation);\n    }\n\n    // update rawDraftContentState, using new results\n    this.raw = this.renderTextArea();\n    // update editorState, using new rawDraftContentState\n    editorState = EditorState.set(editorState, { currentContent: convertFromRaw(this.raw) });\n    editorState = closeSelection(editorState);\n    return { editorState, operation };\n  };\n\n  deleteQATag = (id, needUnRedo = true) => {\n    const { state: { editorState } } = this;\n\n    if (store.config.reviewMode !== ReviewModeType.REVIEW) {\n      return { editorState, operation: null };\n    }\n    if (isAnnotationReadonly(this.toolMode)) {\n      return { editorState, operation: null };\n    }\n    const operation = store.review.deleteMissingReview(id);\n    if (needUnRedo) {\n      this.addHistory(ACTION.DEL_MISSING_REVIEW, operation);\n    }\n    this.raw = this.renderTextArea();\n    return { editorState: EditorState.set(editorState, { currentContent: convertFromRaw(this.raw) }), operation };\n  };\n\n  deleteReview = (reviewId, needUnRedo = true) => {\n    const { state: { editorState } } = this;\n    if (!(isReviewEditable(this.toolMode) && store.config.reviewMode === ReviewModeType.REVIEW)) {\n      return { editorState, operation: null };\n    }\n    const operation = store.review.deleteReview(reviewId);\n    if (needUnRedo) {\n      this.addHistory(ACTION.DELETE_REVIEW, operation);\n    }\n    this.raw = this.renderTextArea();\n    return { editorState: EditorState.set(editorState, { currentContent: convertFromRaw(this.raw) }), operation };\n  };\n\n  addReview = (editorState, reviewId, review, needUnRedo = true) => {\n    const { state: { editorState: currEditorState } } = this;\n    if (!(isReviewEditable(this.toolMode) && store.config.reviewMode === ReviewModeType.REVIEW)) {\n      return { editorState: currEditorState, operation: null };\n    }\n    const operation = store.review.setReview(reviewId, {\n      ...review\n    });\n    if (needUnRedo) {\n      this.addHistory(ACTION.ADD_REVIEW, operation);\n    }\n    this.raw = this.renderTextArea();\n    return { editorState: EditorState.set(editorState, { currentContent: convertFromRaw(this.raw) }), operation };\n  };\n\n  deleteReviewItemById = (reviewId) => {\n    if (reviewId) {\n      let nextEditorState = this.state.editorState;\n      const reviewItem = store.ontology.getItemById(reviewId);\n      if (reviewItem && isQATag(reviewItem.type)) {\n        const { editorState } = this.deleteQATag(reviewItem.id);\n        nextEditorState = editorState;\n      } else {\n        const { editorState } = this.deleteReview(reviewId);\n        nextEditorState = editorState;\n      }\n      this.renderAndSave(nextEditorState);\n    }\n  };\n\n  deleteReviewItemsById = (reviewIds) => {\n    const operations = [];\n    reviewIds?.forEach((reviewId) => {\n      if (reviewId) {\n        const reviewItem = store.ontology.getItemById(reviewId);\n        if (reviewItem && isQATag(reviewItem.type)) {\n          const { operation } = this.deleteQATag(reviewItem.id, false);\n          if (operation) {\n            operations.push(operation);\n          }\n        } else {\n          const { operation } = this.deleteReview(reviewId, false);\n          if (operation) {\n            operations.push(operation);\n          }\n        }\n      }\n    });\n    this.addHistory(ACTION.DELETE_REVIEWS, operations);\n    const { state: { editorState } } = this;\n    this.raw = this.renderTextArea();\n    return EditorState.set(editorState, { currentContent: convertFromRaw(this.raw) });\n  };\n\n  deleteReviewItems = (reviewItems) => {\n    const operations = [];\n    const { state: { editorState } } = this;\n    if (!(isReviewEditable(this.toolMode) && store.config.reviewMode === ReviewModeType.REVIEW)) {\n      return editorState;\n    }\n    reviewItems?.forEach((reviewItem) => {\n      const { review, id } = reviewItem;\n      if (review.result === ReviewItemResult.MISSING) {\n        const { operation } = this.deleteQATag(id, false);\n        if (operation) {\n          operations.push(operation);\n        }\n      } else {\n        const { operation } = this.deleteReview(id, false);\n        if (operation) {\n          operations.push(operation);\n        }\n      }\n    });\n    this.addHistory(ACTION.DELETE_REVIEWS, operations);\n    this.raw = this.renderTextArea();\n    return EditorState.set(editorState, { currentContent: convertFromRaw(this.raw) });\n  };\n\n  addReviewItems = (editorState, reviewItems) => {\n    const operations = [];\n    if (!(isReviewEditable(this.toolMode) && store.config.reviewMode === ReviewModeType.REVIEW)) {\n      return editorState;\n    }\n    reviewItems?.forEach((reviewItem) => {\n      const { review, id } = reviewItem;\n      if (review.result === ReviewItemResult.MISSING) {\n        const { operation } = this.addQALabel(editorState, reviewItem.label, { ...review }, false, false);\n        if (operation) {\n          operations.push(operation);\n        }\n      } else {\n        const { operation } = this.addReview(editorState, id, { ...review }, false);\n        if (operation) {\n          operations.push(operation);\n        }\n      }\n    });\n    this.addHistory(ACTION.ADD_REVIEWS, operations);\n    this.raw = this.renderTextArea();\n    return EditorState.set(editorState, { currentContent: convertFromRaw(this.raw) });\n  };\n\n  deleteReviewHandle = (reviewItem) => {\n    if (reviewItem) {\n      let nextEditorState = this.state.editorState;\n      if (isQATag(reviewItem.type)) {\n        const { editorState } = this.deleteQATag(reviewItem.id);\n        nextEditorState = editorState;\n      } else {\n        const { editorState } = this.deleteReview(reviewItem.id);\n        nextEditorState = editorState;\n      }\n      this.renderAndSave(nextEditorState);\n    }\n  };\n\n  onDeleteReview = () => {\n    const { tagOpenReview } = this.state;\n    this.deleteReviewHandle(tagOpenReview);\n  };\n\n  // create new RawDraftContentState and update customeStyleMap\n  // update: raw, style, sliceMap\n  renderTextArea = (_text) => {\n    const { ontology } = store;\n    const { ontologyConfigMap } = ontology;\n    const {\n      currentClick, currentHover,\n      foundTags, foundTagSelectedIndex, needJumpFound,\n    } = this.state;\n    const style = { ...this.state.style };\n    const text = _text || store.ontology.text;\n    const { labels, insertions } = ontology.getResults();\n    // render missing labels as normal labels\n\n    // slice text to segments\n    const slices = uniq(\n      (labels.map((label) => label.start))\n        .concat(labels.map((label) => label.end))\n        .concat(insertions.map((insertion) => insertion.at))\n        .concat(foundTags.map((t) => t.start))\n        .concat(foundTags.map((t) => t.end))\n        .concat([0, text.length])\n        .sort((a, b) => a - b)\n    );\n    const labelHeads = uniq((labels.map((label) => label.start)));\n    const insertionHeads = uniq((insertions.map((insertion) => insertion.at)));\n    const foundTagHeads = uniq((foundTags.map((tag) => tag.start)));\n\n    // .concat(insertions.map((insertion) => insertion.at)));\n    const raw = {\n      blocks: [{\n        text,\n        key: 'span-wrapper',\n        type: 'unstyled',\n        depth: 0,\n        inlineStyleRanges: [\n          { offset: 0, length: text.length, style: 'DEFAULT_STYLE' }],\n        children: [],\n        entityRanges: [],\n        data: {},\n      }],\n      entityMap: {}\n    };\n    let sliceCount = 0;\n    // 对重叠的tag进行背景色叠加\n    const ranges = raw.blocks[0].inlineStyleRanges;\n    this.sliceMap = new Map();\n    slices.forEach((anchor, index, array) => {\n      // set slice\n      if (!index) return;\n      const { prev, next } = { prev: array[index - 1], next: anchor };\n      const match = labels.filter((label) => (label.start <= prev && label.end > prev));\n      let currentRGB = [0, 0, 0];\n      let currentAlpha = 0;\n      let nextAlpha = DEFAULT_ALPHA;\n      let isCoverbyQa = false;\n      let keepRGB = null;\n      match.some((label) => {\n        const labelItem = getConfigByKeys(ontologyConfigMap, label.keys);\n        const tempRGB = convertColorToArray(labelItem.color);\n        if (!keepRGB) isCoverbyQa = isQATag(label.type);\n        // render clicked tag in priority\n        if (currentClick.id === label.id || currentClick.fromId === label.id || currentClick.toId === label.id) {\n          keepRGB = tempRGB.map((value, i) => value * ACTIVE_ALPHA);\n          isCoverbyQa = isQATag(label.type);\n          return true;\n        }\n\n        if ((!keepRGB && currentHover.id === label.id) || currentHover.fromId === label.id || currentHover.toId === label.id) {\n          keepRGB = tempRGB.map((v) => v * HOVER_ALPHA);\n        }\n\n        if (!keepRGB) {\n          currentRGB = currentRGB.map((value, i) => value + tempRGB[i] * nextAlpha);\n          currentAlpha += nextAlpha;\n          nextAlpha = DEFAULT_ALPHA * (1 - currentAlpha) * (1 - currentAlpha);\n        }\n        return false;\n      });\n      // background of found tag\n      foundTags\n        .filter((tag) => (tag.start <= prev && tag.end > prev))\n        .some((tag) => {\n          const tagIndex = foundTags.findIndex((f) => f.start === tag.start);\n          if (tagIndex !== undefined) {\n            keepRGB = foundTagSelectedIndex === tagIndex && !needJumpFound ? [255, 230, 0] : [255, 169, 64, 0.20];\n            return true;\n          }\n          return false;\n        });\n      const baseRGB = convertColorToArray(BASE_COLOR);\n      currentRGB = keepRGB || currentRGB.map((value, i) => Math.min(255, value + baseRGB[i] * (1 - currentAlpha)));\n      const currentColor = convertArrayToColor(currentRGB);\n\n      if (!style[`BACKGROUND_${currentColor}`]) style[`BACKGROUND_${currentColor}`] = { backgroundColor: currentColor };\n\n      if (isCoverbyQa) ranges.push({ offset: prev, length: next - prev, style: 'MISSING_STYLE' });\n      ranges.push({ offset: prev, length: next - prev, style: `BACKGROUND_${currentColor}` });\n      ranges.push({ offset: prev, length: next - prev, style: `SLICE_${prev}_${next}` });\n      // set slice head if for label/insertion slice\n      if (labelHeads.indexOf(prev) >= 0 || insertionHeads.indexOf(prev) >= 0) {\n        const slice = substr(text, prev, next - prev);\n        const head = getSliceHead(slice);\n        ranges.push({ offset: prev, length: strlen(head), style: `ANCHOR_${prev}` });\n      }\n      if (foundTagHeads.indexOf(prev) >= 0) {\n        const tagIndex = foundTags.findIndex((f) => f.start === prev);\n        if (tagIndex !== undefined) {\n          const tag = foundTags[tagIndex];\n          ranges.push({\n            offset: prev,\n            length: tag.end - tag.start,\n            style: foundTagSelectedIndex === tagIndex && !needJumpFound ? 'FIND_BLOCK_SELECTED' : 'FIND_BLOCK',\n          });\n        }\n      }\n\n      if (labelHeads.indexOf(prev) >= 0 || insertionHeads.indexOf(prev) >= 0 || foundTagHeads.indexOf(prev) >= 0) {\n        const slice = substr(text, prev, next - prev);\n        const head = getSliceHead(slice);\n        // set sliceMap\n        this.sliceMap.set(prev, sliceCount);\n        if (head !== slice) sliceCount += 1;\n      }\n      sliceCount += 1;\n    });\n    // update new style\n    this.setState({ style });\n    return raw;\n  };\n\n  async componentDidMount() {\n    this.toolMode = this.props.jobProxy.toolMode;\n    let { content } = this.props;\n    let results;\n\n    // insert qa tool's label\n    try {\n      const resultRes = await this.props.jobProxy.loadResult();\n      if (resultRes?.results && resultRes?.content) {\n        content = resultRes.content;\n        results = resultRes.results;\n      } else if (resultRes?.labels && resultRes?.connections && resultRes?.insertions) {\n        results = resultRes;\n      }\n    } catch (e) {\n      notification.error({ message: localMessage('ANNOTATION_DATA_LOAD_ERROR'), duration: null });\n      return;\n    }\n\n    // init store\n    try {\n      await store.init({ ...this.props, content: content || '' });\n    } catch (e) {\n      notification.error({ message: e.message, duration: null });\n      return;\n    }\n\n    // initialize results\n    store.ontology.parseResults(results);\n\n    const reviewRes = await this.props.jobProxy.loadReviews();\n    if (reviewRes) {\n      store.review.parseReview(reviewRes);\n    }\n\n    // initialize raw\n    this.raw = this.renderTextArea();\n\n    this.editorWrapper.addEventListener('compositionstart', this.onCompositionStart);\n    this.editorWrapper.addEventListener('compositionend', this.onCompositionEnd);\n\n    this.editorWrapper.addEventListener('mousedown', this.onMouseDown);\n    this.editorWrapper.addEventListener('dragstart', (e) => e.preventDefault());\n    this.editorWrapper.addEventListener('contextmenu', (e) => {\n      e.preventDefault();\n      this.resetCurrentFrom();\n      this.resetCurrentFocus('currentClick', true);\n    });\n    this.editorWrapper.addEventListener('mousemove', this.onMouseMove);\n\n    window.addEventListener('keydown', this.onKeyDown);\n    window.addEventListener('resize', () => this.renderAndSave(null, true, false, false));\n\n    // initialize customStyleMap\n    this.setState({\n      style: {\n        ...this.state.style,\n        DEFAULT_STYLE: {\n          color: this.fontColor,\n          fontSize: `${FONT_SIZE}px`,\n          lineHeight: `${LINE_HEIGHT}px`,\n          letterSpacing: `${FONT_SPACE}px`,\n        },\n        MISSING_STYLE: {\n          color: '#000000',\n        }\n      },\n    });\n    this.renderAndSave(EditorState.createWithContent(convertFromRaw(this.raw)), true, true, false);\n    // use url file backup to replace content, results, and reviews information\n    // use local storage backup to replace text, results, and reviews information\n    // save every 5 minutes\n    setInterval(() => {\n      this.onSave();\n    }, 1000 * 60 * 5);\n    if (this.props.renderComplete) {\n      this.props.renderComplete();\n    }\n  }\n\n  onMouseMove = (e) => {\n    const box = this.svg.getBoundingClientRect();\n    this.setState({\n      currentMouse: {\n        left: e.clientX - box.x,\n        top: e.clientY - box.y,\n      }\n    });\n  };\n\n  moveFocusToTag = (tag) => {\n    let currentClick = { ...this.state.currentClick };\n    const { tagMap } = this.state;\n    if (tag == null) return;\n    currentClick = {\n      id: tag.id,\n      fromId: tag.fromId,\n      toId: tag.toId,\n      fromType: tag.fromType,\n      toType: tag.toType,\n    };\n    const { top } = tagMap.getItem(tag.id, tag.type);\n    const { clientHeight, scrollTop } = this.editorWrapper;\n    if (top < scrollTop || top > clientHeight + scrollTop) {\n      this.editor.focus({ y: top });\n    }\n\n    this.setState({ currentClick }, () => {\n      this.updateEditorAndRender();\n    });\n  };\n\n  onKeyDown = (e) => {\n    if (window.disableTextHotKeys) {\n      return;\n    }\n    const { currentClick, editorState } = this.state;\n    const { keyCode, ctrlKey, altKey } = e;\n    const config = [];\n    store.ontology.ontologyConfigMap.forEach((value) => { config.push(value); });\n    if (ctrlKey) {\n      switch (true) {\n        case (keyCode >= 48 && keyCode <= 57): {\n          // 0 - 9\n          e.preventDefault();\n          const index = e.keyCode - 49;\n          if (index === -1) {\n            this.setCurrentBrush(null);\n          }\n          if (config[index]) {\n            this.setCurrentBrush(config[index]);\n          }\n          break; }\n        case (keyCode === 90): e.preventDefault(); this.executeHistory(RECALL_TYPE.UNDO); break; // Z\n        case (keyCode === 89): e.preventDefault(); this.executeHistory(RECALL_TYPE.REDO); break; // Y\n        case (keyCode === 83): e.preventDefault(); this.onSave(); break; // S\n        case (keyCode === 82): { // R\n          e.preventDefault();\n          const nTag = store.ontology.moveToTagByStep(currentClick.id, 1, true);\n          this.moveFocusToTag(nTag);\n          break;\n        }\n        case (keyCode === 81): { // Q\n          e.preventDefault();\n          if (currentClick.id == null) break;\n          let nxtTag;\n          if (altKey) {\n            nxtTag = store.ontology.stepToTag(currentClick.id, -1);\n          } else {\n            nxtTag = store.ontology.moveToTagByStep(currentClick.id, -1);\n          }\n          this.moveFocusToTag(nxtTag);\n          break;\n        }\n        case (keyCode === 69): { // E\n          e.preventDefault();\n          if (currentClick.id == null) break;\n          let nextTag;\n          if (altKey) {\n            nextTag = store.ontology.stepToTag(currentClick.id, 1);\n          } else {\n            nextTag = store.ontology.moveToTagByStep(currentClick.id, 1);\n          }\n          this.moveFocusToTag(nextTag);\n          break;\n        }\n        default: break;\n      }\n    } else if (currentClick?.id !== null && isReviewEditable(this.toolMode) && !isQATag(currentClick.type) && store.config.reviewMode === ReviewModeType.REVIEW) {\n      switch (keyCode) {\n        case 49: // 1\n          e.preventDefault();\n          e.stopPropagation();\n          this.addReview(editorState, currentClick.id, {\n            result: 'pass',\n          });\n          break;\n        // 2\n        case 50: {\n          e.preventDefault();\n          e.stopPropagation();\n          let tagReviewInfo = store.review.getReview(currentClick.id);\n          if (!tagReviewInfo || tagReviewInfo.result !== ReviewItemResult.REJECT) {\n            tagReviewInfo = { result: 'reject', id: currentClick.id, type: [] };\n          }\n          const item = store.ontology.getItem(currentClick.type, currentClick.id);\n\n          this.setState({ tagOpenReview: item, tagReviewInfo });\n          this.editor.blur();\n          break;\n        }\n        default: break;\n      }\n    }\n  };\n\n  // update text\n  onContentChange = (editorState, data, type) => {\n    const { currentBrush, editorState: preState, findPanelVisible, inputEnable } = this.state;\n\n    if (\n      (isAnnotationReadonly(this.toolMode) || store.config.reviewMode === ReviewModeType.REVIEW)\n      || ((currentBrush || findPanelVisible || !inputEnable) && type === undefined)\n      || this.props.read_only\n    ) {\n      return preState;\n    }\n    const { slice, prevSlice, tags, prevTags } = data;\n    let { prevStart, prevEnd } = data;\n\n    if (prevSlice.length === 1 && slice.length === 0) this.addHistory(ACTION.EDIT_SINGLE_DEL, data);\n    else if (prevSlice.length === 0 && slice.length === 1) this.addHistory(ACTION.EDIT_SINGLE_ADD, data);\n    else if (type === ACTION.EDIT_REPLACE) this.addHistory(ACTION.EDIT_REPLACE, data);\n    else this.addHistory(ACTION.EDIT_DEFAULT, data);\n\n    prevStart = strlen(store.ontology.text.slice(0, data.prevStart));\n    prevEnd = strlen(store.ontology.text.slice(0, data.prevEnd));\n    store.ontology.text = store.ontology.text.slice(0, data.prevStart) + data.slice + store.ontology.text.slice(data.prevEnd);\n    // update labels and insertions\n    const offset = slice.length - prevSlice.length;\n\n    if (type === ACTION.EDIT_REPLACE && prevTags) {\n      const { insertions = [], labels = [], connections = [] } = prevTags;\n      [...insertions, ...labels, ...connections].forEach((t) => {\n        store.ontology.deleteTag(t.type, t.id);\n      });\n    }\n    store.ontology.tagMove(prevStart, prevEnd, offset);\n    if (type === ACTION.EDIT_REPLACE && tags) {\n      const { insertions = [], labels = [], connections = [] } = tags;\n      [...insertions, ...labels, ...connections].forEach((t) => {\n        store.ontology.addResultItem(t);\n      });\n    }\n\n    // update rawDraftContentState, using new text and results\n    this.raw = this.renderTextArea();\n\n    // update editorState, using new rawDraftContentState\n    editorState = EditorState.set(editorState, { currentContent: convertFromRaw(this.raw) });\n    return editorState;\n  };\n\n  resetCurrentFocus = (attribute = 'currentClick', shouldUpdate) => new Promise((resolve) => {\n    this.setState({\n      [`${attribute}`]: { id: null, from: null, to: null },\n    }, () => resolve('state updated'));\n  }).then(() => {\n    if (shouldUpdate) {\n      return this.updateEditorAndRender();\n    }\n  });\n\n  resetCurrentFrom = () => {\n    this.setState({\n      currentFrom: { type: null, id: null, offset: null },\n    });\n  };\n\n  // to status for tag: connection mode and other mode\n  onTagClick = (e, type, id) => {\n    const { currentFrom, currentBrush, editorState, tagMap } = this.state;\n    const offset = tagMap.getItem(id, type);\n    this.editor.blur();\n    if (!isConnection(currentBrush?.type)) return;\n\n    // connecting mode only applys to label and insertion\n    if (isLabel(type) || isInsertion(type)) {\n      // if there is no starting point, setup the starting point\n      if (!currentFrom.type) {\n        this.setState({\n          currentFrom: {\n            type,\n            id,\n            offset,\n          }\n        });\n      } else {\n        const nextEditorState = this.addConnection(editorState, { fromId: currentFrom.id, fromType: currentFrom.type, toId: id, toType: type, type: TAG.CONNECTION, value: currentBrush.text, keys: currentBrush.keys });\n        this.renderAndSave(nextEditorState, true, true);\n      }\n    }\n  };\n\n  onTagDoubleClick = (e) => {\n    // only work in qa mode\n    if (!store.reviewable && !store.isRework) {\n      return;\n    }\n    const { id, type } = getTargetWrapperDataSet(e);\n    const item = store.ontology.getItem(type, id);\n    const tagReviewInfo = store.review.getReview(id);\n    this.setState({ tagOpenReview: item, tagReviewInfo });\n    this.editor.blur();\n  };\n\n  // mouseEvent includes: mouse enter, mouse leave, mouse click, mouse context menu\n  TagMouseEvent = (e, type, id, focusType, active) => {\n    const { currentClick: { id: currId } } = this.state;\n    const tag = store.ontology.getItem(type, id);\n    if (!tag) {\n      return;\n    }\n\n    let attribute = '';\n    if (focusType === FOCUS_TYPE.HOVER) {\n      if (currId === tag.id && active) return;\n      attribute = 'currentHover';\n    } else if (focusType === FOCUS_TYPE.CLICK) {\n      attribute = 'currentClick';\n      this.editor.blur();\n    }\n\n    // active status: mouse enter | mouse click\n    if (active) {\n      if (focusType === FOCUS_TYPE.CLICK) {\n        this.onTagClick(e, type, id);\n      }\n      // ranges.push({ offset: label.start, length: label.end - label.start, style: `${focusType}_STYLE_${color}` });\n      this.setState({\n        [`${attribute}`]: {\n          id: tag.id,\n          fromId: tag?.fromId,\n          toId: tag?.toId,\n          fromType: tag?.fromType,\n          toType: tag?.toType,\n          type: tag?.type,\n        }\n      }, () => {\n        this.updateEditorAndRender();\n      });\n    } else { // unactive status: mouse leave | mouse context menu\n      const tagType = type;\n      this.resetCurrentFocus(attribute, true).then(() => {\n        if (focusType === FOCUS_TYPE.CLICK) {\n          this.onContextMenu(e, tag.id, tagType);\n        }\n      });\n    }\n  };\n\n  onContextMenu = (e, id, type) => {\n    let nextEditorState;\n    switch (type) {\n      case TAG.LABEL:\n      case TAG.CONNECTION:\n      case TAG.INSERTION:\n        nextEditorState = this.deleteTag(type, id);\n        break;\n      case TAG.LABEL_QA:\n      {\n        const { editorState } = this.deleteQATag(id);\n        nextEditorState = editorState;\n        break;\n      }\n      default: return;\n    }\n    this.renderAndSave(nextEditorState);\n  };\n\n  render() {\n    const {\n      editorState,\n      style,\n      currentBrush,\n      editorWidth,\n      editorHeight,\n      currentClick,\n      currentHover,\n      currentMouse,\n      currentFrom,\n      tagMap,\n      tagOpenReview,\n      tagReviewInfo,\n\n      inputEnable,\n    } = this.state;\n    const { config } = store;\n    return (\n      <div className=\"app-wrapper\">\n        <div className=\"topbar-wrapper\" onClick={() => { this.editorOnFocus = false; }}>\n          <div className=\"topbar-left-wrapper\">\n            {isAppenCloud() && (\n            <div className=\"logo\">\n              <AppenLogo />\n            </div>\n            )}\n            <ReviewMode />\n            <div className=\"divider\" />\n            <UndoRedo\n              undoHandle={() => this.executeHistory(RECALL_TYPE.UNDO)}\n              redoHandle={() => this.executeHistory(RECALL_TYPE.REDO)}\n              undoList={this.undoList}\n              redoList={this.redoList}\n            />\n            <div className=\"divider\" />\n            <Save onSave={this.onSave} />\n          </div>\n          <div className=\"topbar-right-wrapper\">\n            {/* <LabelScan onToggle={this.toggleLabelsDrawer} /> */}\n          </div>\n        </div>\n        <TextToolContext.Provider value={{ moveFocusToTag: this.moveFocusToTag, deleteReviewItemById: this.deleteReviewItemById, deleteReviewItemsById: this.deleteReviewItemsById }}>\n          <Sidebar\n            showReview={isRework(this.toolMode) || isReviewEditable(this.toolMode)}\n            onClick={() => { this.editorOnFocus = false; }}\n            currentBrush={currentBrush}\n            inputEnable={inputEnable}\n            setCurrentBrush={this.setCurrentBrush}\n            items={tagMap}\n            contentReadyOnly={this.props.read_only}\n          />\n        </TextToolContext.Provider>\n        <div className=\"right-wrapper\">\n          <div\n            className=\"editor-wrapper\"\n            ref={(r) => { this.editorWrapper = r; }}\n          >\n            <div className=\"svg-wrapper\">\n              <svg ref={(r) => { this.svg = r; }} style={{ height: `${editorHeight}px`, width: `${editorWidth}px` }}>\n                {Object.entries(tagMap.connections).map(([id, connect]) => (\n                  <g key={id}>\n                    <path\n                      d={connect.path}\n                      stroke={currentHover.id === id ? HOVER_COLOR : currentClick.id === id ? FOCUS_COLOR : DEFAULT_COLOR}\n                      fill=\"#00000000\"\n                    />\n                  </g>\n                ))}\n                {currentFrom.type ?\n                  <path d={`M ${currentFrom.offset?.left} ${currentFrom.offset?.top} L ${currentMouse.left} ${currentMouse.top}`} stroke={FOCUS_COLOR} fill=\"#00000000\" /> :\n                  null}\n              </svg>\n            </div>\n            <div className=\"tags-wrapper\">\n              <div\n                className=\"tags-panel\"\n                style={{ height: `${editorHeight}px`, width: `${editorWidth}px` }}\n                onDoubleClick={this.onTagDoubleClick}\n              >\n                {Object.entries(tagMap.labels).map(([id, label]) => (\n                  <LabelTag\n                    key={id}\n                    reviewResult={store.review.getReview(id)?.result}\n                    label={label}\n                    isHover={\n                      (currentHover.id === id) ||\n                      currentHover.fromId === id ||\n                      currentHover.toId === id\n                    }\n                    isClick={\n                      (currentClick.id === id) ||\n                      currentClick.fromId === id ||\n                      currentClick.toId === id\n                    }\n                    labelMouseEvent={this.TagMouseEvent}\n                  />\n                ))}\n                {Object.entries(tagMap.insertions).map(([id, insertion]) => (\n                  <InsertionTag\n                    key={id}\n                    reviewResult={store.review.getReview(id)?.result}\n                    insertion={insertion}\n                    isHover={\n                      (currentHover.id === id) ||\n                      currentHover.fromId === id ||\n                      currentHover.toId === id\n                    }\n                    isClick={\n                      (currentClick.id === id) ||\n                      currentClick.fromId === id ||\n                      currentClick.toId === id\n                    }\n                    insertionMouseEvent={this.TagMouseEvent}\n                  />\n                ))}\n                {Object.entries(tagMap.connections).map(([id, connection]) => (\n                  <ConnectionTag\n                    key={id}\n                    reviewResult={store.review.getReview(id)?.result}\n                    connection={connection}\n                    isHover={currentHover.id === id}\n                    isClick={currentClick.id === id}\n                    connectionMouseEvent={this.TagMouseEvent}\n                  />\n                ))}\n              </div>\n            </div>\n            <div\n              onClick={() => {\n                this.editor.focus();\n                this.resetCurrentFocus('currentClick', true);\n              }}\n            >\n              <Editor\n                ref={(r) => { this.editor = r; }}\n                editorState={editorState}\n                customStyleMap={style}\n                onChange={this.onChange}\n                handlePastedText={this.handlePastedText}\n                handleBeforeInput={this.handleBeforeInput}\n                handleKeyCommand={this.handleKeyCommand}\n                keyBindingFn={this.genKeyCommand}\n              />\n            </div>\n          </div>\n        </div>\n        <ReviewForm\n          toolMode={this.toolMode}\n          tagReviewInfo={tagReviewInfo}\n          tagOpenReview={tagOpenReview}\n          issueTypes={this.props.issue_types}\n          setFormVisible={this.setFormVisible}\n          onConfirm={(review) => {\n            this.addReview(editorState, tagOpenReview?.id, review);\n            store.ontology.updateOntologiesStatusMap();\n          }}\n          onDelete={this.onDeleteReview}\n        />\n      </div>\n    );\n  };\n\n  setCurrentBrush = (item, input = false) => {\n    this.setState({ currentBrush: item, inputEnable: input });\n  };\n\n  setFormVisible = () => {\n    this.setState({ tagOpenReview: null, tagReviewInfo: null });\n  };\n\n  genKeyCommand = (e) => {\n    if (e.metaKey || e.altKey) return KEY_COMMAND.INVALID_KEY;\n    switch (e.keyCode) {\n      case 90:\n        // prevent default undo\n        e.preventDefault();\n        if (e.ctrlKey) return KEY_COMMAND.HANDLE_UNDO;\n        return getDefaultKeyBinding(e);\n      case 89:\n        // prevent default redo\n        e.preventDefault();\n        if (e.ctrlKey) return KEY_COMMAND.HANDLE_REDO;\n        return getDefaultKeyBinding(e);\n      case 13:\n        e.preventDefault();\n        return KEY_COMMAND.HANDLE_RETURN;\n      default:\n        return getDefaultKeyBinding(e);\n    }\n  };\n\n  handleKeyCommand = (command) => {\n    const { editorState } = this.state;\n    switch (command) {\n      case KEY_COMMAND.INVALID_KEY: return 'handled';\n      case KEY_COMMAND.HANDLE_RETURN:\n      {\n        const start = editorState.getSelection().getStartOffset();\n        const end = editorState.getSelection().getEndOffset();\n        const nextEditorState = setSelection(this.onContentChange(editorState, {\n          slice: '\\n',\n          prevSlice: store.ontology.text.slice(start, end),\n          prevStart: start,\n          prevEnd: end,\n          start: start + 1,\n          end: start + 1,\n        }), start + 1, start + 1);\n        this.renderAndSave(nextEditorState);\n        return 'handled';\n      }\n      case KEY_COMMAND.HANDLE_UNDO: return 'handled';\n      case KEY_COMMAND.HANDLE_REDO: return 'handled';\n      default: return 'not-handled';\n    }\n  };\n\n  // Get one anchor by slice head\n  getAnchorElementByHead = (at) => {\n    const { sliceMap } = this;\n    const wrapper = this.editorWrapper.querySelector('.public-DraftStyleDefault-block');\n    const id = `span-wrapper-0-${sliceMap.get(at)}`;\n    const span = wrapper.querySelector(`[data-offset-key='${id}']`);\n    return span;\n  };\n\n  // Get all anchors at one time\n  getAnchorElementsByHeads = () => {\n    const { sliceMap } = this;\n    const wrapper = this.editorWrapper.querySelector('.public-DraftStyleDefault-block');\n    const spanMap = new Map();\n    sliceMap.forEach((value, key) => {\n      const id = `span-wrapper-0-${sliceMap.get(key)}`;\n      const span = wrapper.querySelector(`[data-offset-key='${id}']`);\n      spanMap.set(key, span);\n    });\n    return spanMap;\n  };\n\n  onMouseDown = (e) => {\n    if (e.which === 1) {\n      this.mouseFlag = true;\n    }\n    const onMouseUp = () => {\n      this.mouseFlag = false;\n      window.removeEventListener('mouseup', onMouseUp);\n    };\n    window.addEventListener('mouseup', onMouseUp);\n  };\n\n  onCompositionEnd = () => {\n    this.compositionFlag = COMPOSITION.PENDING;\n  };\n\n  onCompositionStart = () => {\n    this.compositionFlag = COMPOSITION.ENABLED;\n    this.compositionTop = this.editorWrapper.scrollTop;\n  };\n\n  handleBeforeInput = () => { this.inputFlag = true; return 'not-handled'; };\n\n  handlePastedText = () => { this.pasteFlag = true; return 'not-handled'; };\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}