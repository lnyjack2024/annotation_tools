{"ast":null,"code":"import{EditorState,Modifier}from'draft-js';import{CODE_BLOCK_TYPE}from'../constants';export default function backspaceCommandHandler(editorState,setEditorState){const selection=editorState.getSelection();const start=selection.getStartKey();const end=selection.getEndKey();const startOffset=selection.getStartOffset();const endOffset=selection.getEndOffset();if(start===end&&startOffset===endOffset&&startOffset===0){// anchor is at the beginning of the line\nconst currentContent=editorState.getCurrentContent();const currBlock=currentContent.getBlockForKey(start);if((currBlock===null||currBlock===void 0?void 0:currBlock.getType())===CODE_BLOCK_TYPE){const lastBlock=currentContent.getBlockBefore(currBlock.getKey());if((lastBlock===null||lastBlock===void 0?void 0:lastBlock.getType())===CODE_BLOCK_TYPE){// merge block to last block\nconst lastBlockKey=lastBlock.getKey();const lastBlockLen=lastBlock.getLength();const newContent=Modifier.removeRange(currentContent,selection.merge({anchorKey:lastBlockKey,anchorOffset:lastBlockLen,focusOffset:0}),'backward');setEditorState(EditorState.push(editorState,newContent,'remove-range'));return'handled';}}}return'not-handled';}","map":{"version":3,"names":["EditorState","Modifier","CODE_BLOCK_TYPE","backspaceCommandHandler","editorState","setEditorState","selection","getSelection","start","getStartKey","end","getEndKey","startOffset","getStartOffset","endOffset","getEndOffset","currentContent","getCurrentContent","currBlock","getBlockForKey","getType","lastBlock","getBlockBefore","getKey","lastBlockKey","lastBlockLen","getLength","newContent","removeRange","merge","anchorKey","anchorOffset","focusOffset","push"],"sources":["/Users/qzheng/Documents/webroot/annotation_tools/src/components/common/llm/input/command-handlers/backspace.ts"],"sourcesContent":["import { DraftHandleValue, EditorState, Modifier } from 'draft-js';\nimport { CODE_BLOCK_TYPE } from '../constants';\n\nexport default function backspaceCommandHandler(\n  editorState: EditorState,\n  setEditorState: React.Dispatch<React.SetStateAction<EditorState>>,\n): DraftHandleValue {\n  const selection = editorState.getSelection();\n  const start = selection.getStartKey();\n  const end = selection.getEndKey();\n  const startOffset = selection.getStartOffset();\n  const endOffset = selection.getEndOffset();\n  if (start === end && startOffset === endOffset && startOffset === 0) {\n    // anchor is at the beginning of the line\n    const currentContent = editorState.getCurrentContent();\n    const currBlock = currentContent.getBlockForKey(start);\n    if (currBlock?.getType() === CODE_BLOCK_TYPE) {\n      const lastBlock = currentContent.getBlockBefore(currBlock.getKey());\n      if (lastBlock?.getType() === CODE_BLOCK_TYPE) {\n        // merge block to last block\n        const lastBlockKey = lastBlock.getKey();\n        const lastBlockLen = lastBlock.getLength();\n        const newContent = Modifier.removeRange(currentContent, selection.merge({\n          anchorKey: lastBlockKey,\n          anchorOffset: lastBlockLen,\n          focusOffset: 0,\n        }), 'backward');\n        setEditorState(EditorState.push(editorState, newContent, 'remove-range'));\n        return 'handled';\n      }\n    }\n  }\n  return 'not-handled';\n}\n"],"mappings":"AAAA,OAA2BA,WAAW,CAAEC,QAAQ,KAAQ,UAAU,CAClE,OAASC,eAAe,KAAQ,cAAc,CAE9C,cAAe,SAAS,CAAAC,uBAAuBA,CAC7CC,WAAwB,CACxBC,cAAiE,CAC/C,CAClB,KAAM,CAAAC,SAAS,CAAGF,WAAW,CAACG,YAAY,CAAC,CAAC,CAC5C,KAAM,CAAAC,KAAK,CAAGF,SAAS,CAACG,WAAW,CAAC,CAAC,CACrC,KAAM,CAAAC,GAAG,CAAGJ,SAAS,CAACK,SAAS,CAAC,CAAC,CACjC,KAAM,CAAAC,WAAW,CAAGN,SAAS,CAACO,cAAc,CAAC,CAAC,CAC9C,KAAM,CAAAC,SAAS,CAAGR,SAAS,CAACS,YAAY,CAAC,CAAC,CAC1C,GAAIP,KAAK,GAAKE,GAAG,EAAIE,WAAW,GAAKE,SAAS,EAAIF,WAAW,GAAK,CAAC,CAAE,CACnE;AACA,KAAM,CAAAI,cAAc,CAAGZ,WAAW,CAACa,iBAAiB,CAAC,CAAC,CACtD,KAAM,CAAAC,SAAS,CAAGF,cAAc,CAACG,cAAc,CAACX,KAAK,CAAC,CACtD,GAAI,CAAAU,SAAS,SAATA,SAAS,iBAATA,SAAS,CAAEE,OAAO,CAAC,CAAC,IAAKlB,eAAe,CAAE,CAC5C,KAAM,CAAAmB,SAAS,CAAGL,cAAc,CAACM,cAAc,CAACJ,SAAS,CAACK,MAAM,CAAC,CAAC,CAAC,CACnE,GAAI,CAAAF,SAAS,SAATA,SAAS,iBAATA,SAAS,CAAED,OAAO,CAAC,CAAC,IAAKlB,eAAe,CAAE,CAC5C;AACA,KAAM,CAAAsB,YAAY,CAAGH,SAAS,CAACE,MAAM,CAAC,CAAC,CACvC,KAAM,CAAAE,YAAY,CAAGJ,SAAS,CAACK,SAAS,CAAC,CAAC,CAC1C,KAAM,CAAAC,UAAU,CAAG1B,QAAQ,CAAC2B,WAAW,CAACZ,cAAc,CAAEV,SAAS,CAACuB,KAAK,CAAC,CACtEC,SAAS,CAAEN,YAAY,CACvBO,YAAY,CAAEN,YAAY,CAC1BO,WAAW,CAAE,CACf,CAAC,CAAC,CAAE,UAAU,CAAC,CACf3B,cAAc,CAACL,WAAW,CAACiC,IAAI,CAAC7B,WAAW,CAAEuB,UAAU,CAAE,cAAc,CAAC,CAAC,CACzE,MAAO,SAAS,CAClB,CACF,CACF,CACA,MAAO,aAAa,CACtB","ignoreList":[]},"metadata":{},"sourceType":"module"}