{"ast":null,"code":"import React from'react';import Mousetrap from'mousetrap';import cx from'classnames';import formatMessage from'../../locales';import{Pause,CaretRight,Left,Right,DoubleLeft,DoubleRight}from'../../../common/icons';Mousetrap.addKeycodes({188:'comma',190:'period',191:'slash'});export default class FrameActions extends React.Component{constructor(){super(...arguments);this.state={frame:'1',isPlaying:false};this.playTimer=null;this.togglePlaying=()=>{this.setState(stat=>({isPlaying:!stat.isPlaying}),()=>{if(this.state.isPlaying){this.setFrameByAutoPlay();}else if(this.playTimer){window.clearTimeout(this.playTimer);this.playTimer=null;}});};this.setFrameByAutoPlay=()=>{const{currentFrame,frameCount,setFrame}=this.props;if(currentFrame<frameCount-1){setFrame(currentFrame+1);}else{setFrame(0);this.setState({isPlaying:false});}};this.prev=step=>{if(!this.state.isPlaying){this.props.setFrame(Math.max(this.props.currentFrame-step,0));}};this.next=step=>{if(!this.state.isPlaying){this.props.setFrame(Math.min(this.props.currentFrame+step,this.props.frameCount-1));}};this.input=e=>{const str=e.target.value;if(!str||/^\\d*$/.test(str)){this.setState({frame:str});}};this.goto=()=>{let frame=Number(this.state.frame)-1;if(Number.isNaN(frame)||frame<0||frame>=this.props.frameCount){frame=this.props.currentFrame;}this.props.setFrame(frame);this.setState({frame:\"\".concat(frame+1)});};}componentDidMount(){Mousetrap.bind('comma',()=>this.prev(1));Mousetrap.bind('period',()=>this.next(1));Mousetrap.bind('shift+comma',()=>this.prev(10));Mousetrap.bind('shift+period',()=>this.next(10));Mousetrap.bind('slash',()=>this.togglePlaying());}componentWillUnmount(){Mousetrap.unbind('comma');Mousetrap.unbind('period');Mousetrap.unbind('shift+comma');Mousetrap.unbind('shift+period');Mousetrap.unbind('slash');}componentDidUpdate(prevProps){if(prevProps.currentFrame!==this.props.currentFrame){this.setState({frame:\"\".concat(this.props.currentFrame+1)});}if(prevProps.frameLoading!==this.props.frameLoading&&!this.props.frameLoading){// frame loaded\nif(this.state.isPlaying){// if is auto playing, play next frame\nthis.playTimer=window.setTimeout(()=>{this.setFrameByAutoPlay();},300);}}}render(){return/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(\"div\",{style:{marginRight:24,userSelect:'none'}},formatMessage('FRAME_LABEL'),/*#__PURE__*/React.createElement(\"input\",{className:cx('frame-input',{invalid:!this.props.currentFrameValid}),disabled:this.state.isPlaying,value:this.state.frame,onChange:this.input,onBlur:this.goto,onKeyUp:e=>{if(e.key==='Enter'){this.goto();}}}),\"/ \".concat(this.props.frameCount)),/*#__PURE__*/React.createElement(\"div\",{className:\"frame-action-icon\",onClick:()=>this.prev(10)},/*#__PURE__*/React.createElement(DoubleLeft,null)),/*#__PURE__*/React.createElement(\"div\",{className:\"frame-action-icon\",onClick:()=>this.prev(1)},/*#__PURE__*/React.createElement(Left,null)),/*#__PURE__*/React.createElement(\"div\",{className:\"frame-action-icon\",onClick:this.togglePlaying},this.state.isPlaying?/*#__PURE__*/React.createElement(Pause,null):/*#__PURE__*/React.createElement(CaretRight,null)),/*#__PURE__*/React.createElement(\"div\",{className:\"frame-action-icon\",onClick:()=>this.next(1)},/*#__PURE__*/React.createElement(Right,null)),/*#__PURE__*/React.createElement(\"div\",{className:\"frame-action-icon\",onClick:()=>this.next(10)},/*#__PURE__*/React.createElement(DoubleRight,null)));}}","map":{"version":3,"names":["React","Mousetrap","cx","formatMessage","Pause","CaretRight","Left","Right","DoubleLeft","DoubleRight","addKeycodes","FrameActions","Component","constructor","arguments","state","frame","isPlaying","playTimer","togglePlaying","setState","stat","setFrameByAutoPlay","window","clearTimeout","currentFrame","frameCount","setFrame","props","prev","step","Math","max","next","min","input","e","str","target","value","test","goto","Number","isNaN","concat","componentDidMount","bind","componentWillUnmount","unbind","componentDidUpdate","prevProps","frameLoading","setTimeout","render","createElement","style","marginRight","userSelect","className","invalid","currentFrameValid","disabled","onChange","onBlur","onKeyUp","key","onClick"],"sources":["/Users/qzheng/Documents/webroot/annotation_tools/src/components/keypoint/components/FrameContorl/FrameActions.tsx"],"sourcesContent":["import React from 'react';\nimport Mousetrap from 'mousetrap';\nimport cx from 'classnames';\nimport formatMessage from '../../locales';\nimport { Pause, CaretRight, Left, Right, DoubleLeft, DoubleRight } from '../../../common/icons';\n\nMousetrap.addKeycodes({\n  188: 'comma',\n  190: 'period',\n  191: 'slash',\n});\n\ninterface FrameActionsProps {\n  currentFrameValid: boolean;\n  frameCount: number;\n  frameLoading: boolean;\n  currentFrame: number;\n  setFrame: (frame: number) => void;\n}\n\ninterface FrameActionsState {\n  frame: string;\n  isPlaying: boolean;\n}\n\nexport default class FrameActions extends React.Component<FrameActionsProps, FrameActionsState> {\n  state = {\n    frame: '1',\n    isPlaying: false,\n  };\n\n  playTimer: number | null = null;\n\n  componentDidMount() {\n    Mousetrap.bind('comma', () => this.prev(1));\n    Mousetrap.bind('period', () => this.next(1));\n    Mousetrap.bind('shift+comma', () => this.prev(10));\n    Mousetrap.bind('shift+period', () => this.next(10));\n    Mousetrap.bind('slash', () => this.togglePlaying());\n  }\n\n  componentWillUnmount() {\n    Mousetrap.unbind('comma');\n    Mousetrap.unbind('period');\n    Mousetrap.unbind('shift+comma');\n    Mousetrap.unbind('shift+period');\n    Mousetrap.unbind('slash');\n  }\n\n  componentDidUpdate(prevProps: FrameActionsProps) {\n    if (prevProps.currentFrame !== this.props.currentFrame) {\n      this.setState({ frame: `${this.props.currentFrame + 1}` });\n    }\n\n    if (prevProps.frameLoading !== this.props.frameLoading && !this.props.frameLoading) {\n      // frame loaded\n      if (this.state.isPlaying) {\n        // if is auto playing, play next frame\n        this.playTimer = window.setTimeout(() => {\n          this.setFrameByAutoPlay();\n        }, 300);\n      }\n    }\n  }\n\n  togglePlaying = () => {\n    this.setState((stat) => ({ isPlaying: !stat.isPlaying }), () => {\n      if (this.state.isPlaying) {\n        this.setFrameByAutoPlay();\n      } else if (this.playTimer) {\n        window.clearTimeout(this.playTimer);\n        this.playTimer = null;\n      }\n    });\n  };\n\n  setFrameByAutoPlay = () => {\n    const { currentFrame, frameCount, setFrame } = this.props;\n    if (currentFrame < frameCount - 1) {\n      setFrame(currentFrame + 1);\n    } else {\n      setFrame(0);\n      this.setState({ isPlaying: false });\n    }\n  };\n\n  prev = (step: number) => {\n    if (!this.state.isPlaying) {\n      this.props.setFrame(Math.max(this.props.currentFrame - step, 0));\n    }\n  };\n\n  next = (step: number) => {\n    if (!this.state.isPlaying) {\n      this.props.setFrame(Math.min(this.props.currentFrame + step, this.props.frameCount - 1));\n    }\n  };\n\n  input = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const str = e.target.value;\n    if (!str || /^\\d*$/.test(str)) {\n      this.setState({ frame: str });\n    }\n  };\n\n  goto = () => {\n    let frame = Number(this.state.frame) - 1;\n    if (Number.isNaN(frame) || frame < 0 || frame >= this.props.frameCount) {\n      frame = this.props.currentFrame;\n    }\n    this.props.setFrame(frame);\n    this.setState({ frame: `${frame + 1}` });\n  };\n\n  render() {\n    return (\n      <div>\n        <div style={{ marginRight: 24, userSelect: 'none' }}>\n          {formatMessage('FRAME_LABEL')}\n          <input\n            className={cx('frame-input', { invalid: !this.props.currentFrameValid })}\n            disabled={this.state.isPlaying}\n            value={this.state.frame}\n            onChange={this.input}\n            onBlur={this.goto}\n            onKeyUp={(e) => {\n              if (e.key === 'Enter') {\n                this.goto();\n              }\n            }}\n          />\n          {`/ ${this.props.frameCount}`}\n        </div>\n        <div className=\"frame-action-icon\" onClick={() => this.prev(10)}>\n          <DoubleLeft />\n        </div>\n        <div className=\"frame-action-icon\" onClick={() => this.prev(1)}>\n          <Left />\n        </div>\n        <div className=\"frame-action-icon\" onClick={this.togglePlaying}>\n          {this.state.isPlaying ? <Pause /> : <CaretRight />}\n        </div>\n        <div className=\"frame-action-icon\" onClick={() => this.next(1)}>\n          <Right />\n        </div>\n        <div className=\"frame-action-icon\" onClick={() => this.next(10)}>\n          <DoubleRight />\n        </div>\n      </div>\n    );\n  }\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}