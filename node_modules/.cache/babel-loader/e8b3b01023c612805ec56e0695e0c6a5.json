{"ast":null,"code":"var _jsxFileName = \"/Users/qzheng/Documents/webroot/annotation_tools/src/components/video-tracking2/components/attributes/LabelViewer.tsx\";\nimport React from 'react';\nimport { reaction } from 'mobx';\nimport { observer } from 'mobx-react';\nimport ShapeLabel from './ShapeLabel';\nimport store from '../../store/RootStore';\nimport { AttributesMode } from '../../types';\nimport './LabelViewer.scss';\nclass LabelViewer extends React.Component {\n  constructor(...args) {\n    super(...args);\n    this.container = React.createRef();\n    this.reactionDisposers = [];\n  }\n  componentDidMount() {\n    this.reactionDisposers.push(reaction(() => store.config.viewScales[this.props.camera], () => {\n      this.update();\n    }));\n    this.reactionDisposers.push(reaction(() => store.config.viewPosition, () => {\n      if (this.props.camera === store.frame.currentCamera) {\n        this.update();\n      }\n    }));\n  }\n  componentWillUnmount() {\n    this.reactionDisposers.forEach(disposer => disposer());\n  }\n  update() {\n    if (store.config.activeAttributesMode === AttributesMode.ALWAYS) {\n      this.forceUpdate();\n    }\n  }\n  renderLabelByShape({\n    shape,\n    instanceItem\n  }, useMousePosition = false) {\n    if (!this.container.current) {\n      return null;\n    }\n\n    // no frame data\n    const {\n      camera,\n      mousePosition\n    } = this.props;\n    const {\n      currentFrame,\n      cameraViews\n    } = store.frame;\n    const cameraData = instanceItem.cameras[camera];\n    if (!cameraData || !cameraData.frames || !cameraData.frames[currentFrame]) {\n      return null;\n    }\n    const {\n      width,\n      height,\n      left,\n      top\n    } = this.container.current.getBoundingClientRect();\n    let x;\n    let y;\n    if (useMousePosition) {\n      x = mousePosition.x - left + 10;\n      y = mousePosition.y - top + 10;\n    } else {\n      const p = shape.getGlobalPosition();\n      const cameraView = cameraViews[camera];\n      const lp = cameraView.toLocal(p);\n      x = lp.x;\n      y = lp.y;\n    }\n    if (x < 0 || x > width || y < 0 || y > height) {\n      return null;\n    }\n    return /*#__PURE__*/React.createElement(ShapeLabel, {\n      key: shape.uid,\n      instance: instanceItem.instance,\n      instanceItem: instanceItem,\n      frameData: cameraData.frames[currentFrame],\n      centered: !useMousePosition,\n      x: x,\n      y: y,\n      visible: shape.visible,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 80,\n        columnNumber: 7\n      }\n    });\n  }\n  render() {\n    const {\n      camera\n    } = this.props;\n    const {\n      labelItems,\n      activeAttributesMode\n    } = store.config;\n    const {\n      shapes,\n      hoveredShapeId,\n      getShapesForCamera\n    } = store.shape;\n    const cameraShapes = getShapesForCamera(camera);\n    const hoveredShape = shapes[hoveredShapeId];\n    return labelItems.length > 0 && /*#__PURE__*/React.createElement(\"div\", {\n      ref: this.container,\n      className: \"label-viewer\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 100,\n        columnNumber: 7\n      }\n    }, activeAttributesMode === AttributesMode.ALWAYS && cameraShapes.map(shape => this.renderLabelByShape(shape)), activeAttributesMode === AttributesMode.HOVER && hoveredShape && hoveredShape.camera === camera && this.renderLabelByShape(hoveredShape, true));\n  }\n}\n;\nexport default observer(LabelViewer);","map":{"version":3,"names":["React","reaction","observer","ShapeLabel","store","AttributesMode","LabelViewer","Component","constructor","args","container","createRef","reactionDisposers","componentDidMount","push","config","viewScales","props","camera","update","viewPosition","frame","currentCamera","componentWillUnmount","forEach","disposer","activeAttributesMode","ALWAYS","forceUpdate","renderLabelByShape","shape","instanceItem","useMousePosition","current","mousePosition","currentFrame","cameraViews","cameraData","cameras","frames","width","height","left","top","getBoundingClientRect","x","y","p","getGlobalPosition","cameraView","lp","toLocal","createElement","key","uid","instance","frameData","centered","visible","__self","__source","fileName","_jsxFileName","lineNumber","columnNumber","render","labelItems","shapes","hoveredShapeId","getShapesForCamera","cameraShapes","hoveredShape","length","ref","className","map","HOVER"],"sources":["/Users/qzheng/Documents/webroot/annotation_tools/src/components/video-tracking2/components/attributes/LabelViewer.tsx"],"sourcesContent":["import React from 'react';\nimport { reaction, IReactionDisposer } from 'mobx';\nimport { observer } from 'mobx-react';\nimport ShapeLabel from './ShapeLabel';\nimport { ShapeData } from '../../../common/shapes/types';\nimport Shape from '../../../common/shapes/Shape';\nimport InstanceItem from '../../model/InstanceItem';\nimport store from '../../store/RootStore';\nimport { AttributesMode } from '../../types';\nimport './LabelViewer.scss';\n\ninterface LabelViewerProps {\n  camera: string;\n  mousePosition: { x: number; y: number };\n}\n\nclass LabelViewer extends React.Component<LabelViewerProps> {\n  container = React.createRef<HTMLDivElement>();\n\n  reactionDisposers: IReactionDisposer[] = [];\n\n  componentDidMount() {\n    this.reactionDisposers.push(reaction(\n      () => store.config.viewScales[this.props.camera],\n      () => {\n        this.update();\n      },\n    ));\n    this.reactionDisposers.push(reaction(\n      () => store.config.viewPosition,\n      () => {\n        if (this.props.camera === store.frame.currentCamera) {\n          this.update();\n        }\n      },\n    ));\n  }\n\n  componentWillUnmount() {\n    this.reactionDisposers.forEach((disposer) => disposer());\n  }\n\n  update() {\n    if (store.config.activeAttributesMode === AttributesMode.ALWAYS) {\n      this.forceUpdate();\n    }\n  }\n\n  renderLabelByShape({ shape, instanceItem }: { shape: Shape<ShapeData>; instanceItem: InstanceItem }, useMousePosition = false) {\n    if (!this.container.current) {\n      return null;\n    }\n\n    // no frame data\n    const { camera, mousePosition } = this.props;\n    const { currentFrame, cameraViews } = store.frame;\n    const cameraData = instanceItem.cameras[camera];\n    if (!cameraData || !cameraData.frames || !cameraData.frames[currentFrame]) {\n      return null;\n    }\n\n    const { width, height, left, top } = this.container.current.getBoundingClientRect();\n    let x: number;\n    let y: number;\n    if (useMousePosition) {\n      x = mousePosition.x - left + 10;\n      y = mousePosition.y - top + 10;\n    } else {\n      const p = shape.getGlobalPosition();\n      const cameraView = cameraViews[camera];\n      const lp = cameraView.toLocal(p);\n      x = lp.x;\n      y = lp.y;\n    }\n\n    if (x < 0 || x > width || y < 0 || y > height) {\n      return null;\n    }\n    return (\n      <ShapeLabel\n        key={shape.uid}\n        instance={instanceItem.instance}\n        instanceItem={instanceItem}\n        frameData={cameraData.frames[currentFrame]}\n        centered={!useMousePosition}\n        x={x}\n        y={y}\n        visible={shape.visible}\n      />\n    );\n  }\n\n  render() {\n    const { camera } = this.props;\n    const { labelItems, activeAttributesMode } = store.config;\n    const { shapes, hoveredShapeId, getShapesForCamera } = store.shape;\n    const cameraShapes = getShapesForCamera(camera);\n    const hoveredShape = shapes[hoveredShapeId];\n    return labelItems.length > 0 && (\n      <div ref={this.container} className=\"label-viewer\">\n        {\n          activeAttributesMode === AttributesMode.ALWAYS &&\n          cameraShapes.map((shape) => this.renderLabelByShape(shape))\n        }\n        {\n          activeAttributesMode === AttributesMode.HOVER &&\n          hoveredShape &&\n          hoveredShape.camera === camera &&\n          this.renderLabelByShape(hoveredShape, true)\n        }\n      </div>\n    );\n  }\n};\n\nexport default observer(LabelViewer);\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}