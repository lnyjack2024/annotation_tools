{"ast":null,"code":"var _jsxFileName = \"/Users/qzheng/Documents/webroot/annotation_tools/src/components/long-audio/components/SegmentDetail/LineDetail/LineDetail.jsx\";\nimport React, { useEffect, useState } from 'react';\nimport { connect } from 'react-redux';\nimport './LineDetail.scss';\nimport EasyForm from '@appen-china/easy-form';\nimport LineRoleRadio from '../LineRoleRadio/LineRoleRadio';\nimport LineText from '../LineText/LineText';\nimport { deleteLine, setLineCategory, setLineAttributes, toppingLine, setLineRole } from '../../../redux/action';\nimport { triggerForm } from '../../../constants';\nimport { isAnnotationReadonly } from '../../../../../utils/tool-mode';\nimport DeleteIcon from '../../common/Icons/DeleteIcon';\nconst LineDetail = props => {\n  const {\n    line,\n    lineIndex,\n    lineConfig,\n    currentRoles,\n    toolMode,\n    currentVideo,\n    currentSegment,\n    annotateDisabled\n  } = props;\n  const handleButtonClick = (e, type) => {\n    switch (type) {\n      case 'delete':\n        props.deleteLine({\n          videoIndex: null,\n          segmentIndex: currentSegment,\n          lineIndex,\n          role: line.role\n        });\n        break;\n      case 'topping':\n        props.toppingLine({\n          videoIndex: null,\n          segmentIndex: currentSegment,\n          lineIndex\n        });\n        break;\n      default:\n        break;\n    }\n  };\n  const [lineFormConfig, setLineFormConfig] = useState({});\n  const [hasEfOntology, setHasEfOntology] = useState(false);\n  useEffect(() => {\n    const {\n      fields\n    } = lineConfig;\n    const efOntology = fields.find(f => f.name === 'ef-ontology');\n    setHasEfOntology(!!efOntology);\n  }, [lineConfig]);\n  useEffect(() => {\n    const readonly = isAnnotationReadonly(toolMode) || annotateDisabled;\n    const fields = lineConfig.fields.map(v => ({\n      ...v,\n      readonly: readonly || v.readonly,\n      defaultValue: v.name === 'role' || v.name === 'ef-ontology' ? line.role : line.attributes[v.name],\n      optionType: v.type === 'RADIO' ? 'button' : 'default'\n    }));\n    setLineFormConfig({\n      ...lineConfig,\n      fields,\n      footerVisible: false\n    });\n    changeEfOntology(line.role);\n  }, [currentSegment, annotateDisabled, line.role]);\n  const changeEfOntology = role => {\n    var _line$attributes;\n    if (role !== ((_line$attributes = line.attributes) === null || _line$attributes === void 0 ? void 0 : _line$attributes['ef-ontology']) && hasEfOntology) {\n      const {\n        updatedValues\n      } = triggerForm(lineFormConfig, {\n        ...line.attributes,\n        'ef-ontology': role\n      });\n      props.setLineAttributes({\n        videoIndex: currentVideo,\n        segmentIndex: currentSegment,\n        lineIndex,\n        attributes: updatedValues\n      });\n    }\n  };\n  const changeLineCategory = data => {\n    const attributes = {\n      ...line.attributes,\n      ...data\n    };\n    const {\n      updatedValues\n    } = triggerForm(lineFormConfig, attributes);\n    const {\n      role,\n      ...values\n    } = updatedValues;\n    props.setLineAttributes({\n      videoIndex: currentVideo,\n      segmentIndex: currentSegment,\n      lineIndex,\n      attributes: values\n    });\n    if (role !== undefined) {\n      props.setLineRole({\n        lineIndex,\n        role\n      });\n    }\n  };\n  return /*#__PURE__*/React.createElement(\"div\", {\n    className: `line-detail-container line-attributes-${lineIndex}`,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 96,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(\"button\", {\n    className: \"line-detail-button\",\n    style: {\n      display: lineIndex === 0 ? 'none' : 'block'\n    },\n    onClick: e => handleButtonClick(e, 'delete'),\n    disabled: annotateDisabled,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 97,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(DeleteIcon, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 103,\n      columnNumber: 9\n    }\n  })), /*#__PURE__*/React.createElement(LineRoleRadio, {\n    role: line.role,\n    index: lineIndex,\n    currentRoles: currentRoles,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 112,\n      columnNumber: 7\n    }\n  }), /*#__PURE__*/React.createElement(LineText, {\n    text: line.text,\n    lineIndex: lineIndex,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 117,\n      columnNumber: 7\n    }\n  }), /*#__PURE__*/React.createElement(EasyForm, Object.assign({\n    theme: \"dark\",\n    autoFocus: false\n  }, lineFormConfig && lineFormConfig, {\n    onChange: changeLineCategory,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 121,\n      columnNumber: 7\n    }\n  })));\n};\nconst mapStateToProps = state => ({\n  ontology: state.ontology,\n  segmentConfig: state.segmentConfig,\n  lineConfig: state.lineConfig,\n  currentSegment: state.currentSegment,\n  toolMode: state.toolMode,\n  results: state.results,\n  currentVideo: state.currentVideo,\n  annotateDisabled: state.annotateDisabled\n});\nconst mapDispatchToProps = {\n  deleteLine,\n  toppingLine,\n  setLineCategory,\n  setLineAttributes,\n  setLineRole\n};\nexport default connect(mapStateToProps, mapDispatchToProps)(LineDetail);","map":{"version":3,"names":["React","useEffect","useState","connect","EasyForm","LineRoleRadio","LineText","deleteLine","setLineCategory","setLineAttributes","toppingLine","setLineRole","triggerForm","isAnnotationReadonly","DeleteIcon","LineDetail","props","line","lineIndex","lineConfig","currentRoles","toolMode","currentVideo","currentSegment","annotateDisabled","handleButtonClick","e","type","videoIndex","segmentIndex","role","lineFormConfig","setLineFormConfig","hasEfOntology","setHasEfOntology","fields","efOntology","find","f","name","readonly","map","v","defaultValue","attributes","optionType","footerVisible","changeEfOntology","_line$attributes","updatedValues","changeLineCategory","data","values","undefined","createElement","className","__self","__source","fileName","_jsxFileName","lineNumber","columnNumber","style","display","onClick","disabled","index","text","Object","assign","theme","autoFocus","onChange","mapStateToProps","state","ontology","segmentConfig","results","mapDispatchToProps"],"sources":["/Users/qzheng/Documents/webroot/annotation_tools/src/components/long-audio/components/SegmentDetail/LineDetail/LineDetail.jsx"],"sourcesContent":["import React, { useEffect, useState } from 'react';\nimport { connect } from 'react-redux';\nimport './LineDetail.scss';\nimport EasyForm from '@appen-china/easy-form';\nimport LineRoleRadio from '../LineRoleRadio/LineRoleRadio';\nimport LineText from '../LineText/LineText';\nimport { deleteLine, setLineCategory, setLineAttributes, toppingLine, setLineRole } from '../../../redux/action';\nimport { triggerForm } from '../../../constants';\nimport { isAnnotationReadonly } from '../../../../../utils/tool-mode';\nimport DeleteIcon from '../../common/Icons/DeleteIcon';\n\nconst LineDetail = (props) => {\n  const { line, lineIndex, lineConfig, currentRoles, toolMode, currentVideo, currentSegment, annotateDisabled } = props;\n  const handleButtonClick = (e, type) => {\n    switch (type) {\n      case 'delete':\n        props.deleteLine({\n          videoIndex: null,\n          segmentIndex: currentSegment,\n          lineIndex,\n          role: line.role,\n        });\n        break;\n      case 'topping':\n        props.toppingLine({\n          videoIndex: null,\n          segmentIndex: currentSegment,\n          lineIndex,\n        });\n        break;\n      default:\n        break;\n    }\n  };\n  const [lineFormConfig, setLineFormConfig] = useState({});\n  const [hasEfOntology, setHasEfOntology] = useState(false);\n\n  useEffect(() => {\n    const { fields } = lineConfig;\n    const efOntology = fields.find((f) => f.name === 'ef-ontology');\n    setHasEfOntology(!!efOntology);\n  }, [lineConfig]);\n\n  useEffect(() => {\n    const readonly = isAnnotationReadonly(toolMode) || annotateDisabled;\n    const fields = lineConfig.fields.map((v) => ({\n      ...v,\n      readonly: readonly || v.readonly,\n      defaultValue: (v.name === 'role' || v.name === 'ef-ontology') ? line.role : line.attributes[v.name],\n      optionType: v.type === 'RADIO' ? 'button' : 'default',\n    }));\n    setLineFormConfig({\n      ...lineConfig,\n      fields,\n      footerVisible: false,\n    });\n    changeEfOntology(line.role);\n  }, [currentSegment, annotateDisabled, line.role]);\n\n  const changeEfOntology = (role) => {\n    if (role !== line.attributes?.['ef-ontology'] && hasEfOntology) {\n      const { updatedValues } = triggerForm(lineFormConfig, { ...line.attributes, 'ef-ontology': role });\n      props.setLineAttributes({\n        videoIndex: currentVideo,\n        segmentIndex: currentSegment,\n        lineIndex,\n        attributes: updatedValues\n      });\n    }\n  };\n\n  const changeLineCategory = (data) => {\n    const attributes = {\n      ...line.attributes,\n      ...data,\n    };\n    const { updatedValues } = triggerForm(lineFormConfig, attributes);\n    const { role, ...values } = updatedValues;\n\n    props.setLineAttributes({\n      videoIndex: currentVideo,\n      segmentIndex: currentSegment,\n      lineIndex,\n      attributes: values\n    });\n\n    if (role !== undefined) {\n      props.setLineRole({\n        lineIndex,\n        role,\n      });\n    }\n  };\n\n  return (\n    <div className={`line-detail-container line-attributes-${lineIndex}`}>\n      <button\n        className=\"line-detail-button\"\n        style={{ display: lineIndex === 0 ? 'none' : 'block' }}\n        onClick={(e) => handleButtonClick(e, 'delete')}\n        disabled={annotateDisabled}\n      >\n        <DeleteIcon />\n      </button>\n      {/* <button\n        className=\"line-detail-button\"\n        style={{ display: lineIndex === 0 ? 'none' : 'block' }}\n        onClick={e => handleButtonClick(e, 'topping')}\n      >\n        topping\n      </button> */}\n      <LineRoleRadio\n        role={line.role}\n        index={lineIndex}\n        currentRoles={currentRoles}\n      />\n      <LineText\n        text={line.text}\n        lineIndex={lineIndex}\n      />\n      <EasyForm\n        theme=\"dark\"\n        autoFocus={false}\n        {...lineFormConfig && lineFormConfig}\n        onChange={changeLineCategory}\n      />\n    </div>\n  );\n};\n\nconst mapStateToProps = (state) => ({\n  ontology: state.ontology,\n  segmentConfig: state.segmentConfig,\n  lineConfig: state.lineConfig,\n  currentSegment: state.currentSegment,\n  toolMode: state.toolMode,\n  results: state.results,\n  currentVideo: state.currentVideo,\n  annotateDisabled: state.annotateDisabled,\n});\nconst mapDispatchToProps = {\n  deleteLine,\n  toppingLine,\n  setLineCategory,\n  setLineAttributes,\n  setLineRole,\n};\nexport default connect(mapStateToProps, mapDispatchToProps)(LineDetail);\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}