{"ast":null,"code":"import React from'react';import{Collapse}from'antd';import{ArrowRightOutlined,CaretRightOutlined,ExclamationCircleFilled}from'@ant-design/icons';import{Warning,Up,Sync}from'../icons';import'antd/es/collapse/style/index.css';import'./Validator.scss';const{Panel}=Collapse;class Validator extends React.Component{constructor(){super(...arguments);this.state={checking:false,open:false};this.handleSync=async()=>{this.setState({checking:true});await Promise.all([this.props.onValidate(),new Promise(resolve=>{setTimeout(resolve,300);})]);this.setState({checking:false});};}renderWarning(warning){const{renderWarningTitle,showWarningAction,onWarningAction}=this.props;const{type,id,message}=warning;return/*#__PURE__*/React.createElement(\"div\",{key:\"\".concat(type,\"-\").concat(id),className:\"warning-item\"},/*#__PURE__*/React.createElement(\"div\",{className:\"warning-title\"},/*#__PURE__*/React.createElement(\"div\",{className:\"name\"},renderWarningTitle(warning)),showWarningAction&&showWarningAction(warning)&&/*#__PURE__*/React.createElement(\"div\",{className:\"action\",onClick:()=>{if(onWarningAction){onWarningAction(warning);}}},/*#__PURE__*/React.createElement(ArrowRightOutlined,null))),/*#__PURE__*/React.createElement(\"div\",{className:\"warning-msg\"},message));}renderWarnings(type){const{validationTypes,warnings,errors={}}=this.props;const typeWarnings=warnings.filter(i=>i.type===type);const typeError=errors[type];return(typeWarnings.length>0||typeError)&&/*#__PURE__*/React.createElement(Panel,{key:type,header:validationTypes[type],extra:/*#__PURE__*/React.createElement(\"div\",null,typeError&&/*#__PURE__*/React.createElement(ExclamationCircleFilled,{style:{color:'rgba(220, 70, 36)',marginRight:4}}),/*#__PURE__*/React.createElement(\"span\",{className:\"result-count\"},warnings.length))},typeError&&/*#__PURE__*/React.createElement(\"div\",{className:\"error\"},typeError),typeWarnings.map(warning=>this.renderWarning(warning)));}render(){const{validationTypes,warnings,containerWidth='100%',containerHeight='100%',titleFormatter,checkingMsgFormatter}=this.props;return/*#__PURE__*/React.createElement(\"div\",{className:\"tool-validator\",style:{width:containerWidth,height:this.state.open?containerHeight:32}},/*#__PURE__*/React.createElement(\"div\",{className:\"content\",style:{visibility:this.state.open?'visible':'hidden'}},/*#__PURE__*/React.createElement(Collapse,{ghost:true,expandIcon:p=>/*#__PURE__*/React.createElement(CaretRightOutlined,{style:{...(p.isActive?{top:11,transform:'rotate(90deg)'}:{color:'rgba(255, 255, 255, 0.6)'})}})},Object.keys(validationTypes).map(type=>this.renderWarnings(type)))),/*#__PURE__*/React.createElement(\"div\",{className:\"header\"},/*#__PURE__*/React.createElement(\"div\",{style:{backgroundColor:warnings.length>0?'rgba(220, 70, 36, 0.5)':'transparent'}},/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(Warning,null),/*#__PURE__*/React.createElement(\"span\",{style:{paddingLeft:8}},titleFormatter?titleFormatter(warnings.length):\"\".concat(warnings.length,\" Warning(s)\"))),/*#__PURE__*/React.createElement(\"div\",null,this.state.checking&&/*#__PURE__*/React.createElement(\"div\",{style:{fontSize:12,color:'rgba(255, 255, 255, 0.6)',paddingRight:4}},checkingMsgFormatter?checkingMsgFormatter():'Checking...'),/*#__PURE__*/React.createElement(\"div\",{className:\"icon-button\",onClick:this.handleSync},/*#__PURE__*/React.createElement(Sync,null)),/*#__PURE__*/React.createElement(\"div\",{className:\"icon-button\",style:{transform:this.state.open?'rotate(180deg)':''},onClick:()=>this.setState(stat=>({open:!stat.open}))},/*#__PURE__*/React.createElement(Up,null))))));}}export default Validator;","map":{"version":3,"names":["React","Collapse","ArrowRightOutlined","CaretRightOutlined","ExclamationCircleFilled","Warning","Up","Sync","Panel","Validator","Component","constructor","arguments","state","checking","open","handleSync","setState","Promise","all","props","onValidate","resolve","setTimeout","renderWarning","warning","renderWarningTitle","showWarningAction","onWarningAction","type","id","message","createElement","key","concat","className","onClick","renderWarnings","validationTypes","warnings","errors","typeWarnings","filter","i","typeError","length","header","extra","style","color","marginRight","map","render","containerWidth","containerHeight","titleFormatter","checkingMsgFormatter","width","height","visibility","ghost","expandIcon","p","isActive","top","transform","Object","keys","backgroundColor","paddingLeft","fontSize","paddingRight","stat"],"sources":["/Users/qzheng/Documents/webroot/annotation_tools/src/components/common/validator/Validator.tsx"],"sourcesContent":["import React from 'react';\nimport { Collapse } from 'antd';\nimport { ArrowRightOutlined, CaretRightOutlined, ExclamationCircleFilled } from '@ant-design/icons';\nimport { Warning, Up, Sync } from '../icons';\nimport 'antd/es/collapse/style/index.css';\nimport './Validator.scss';\n\ninterface IWarning {\n  type: string;\n  id: string;\n  message: string;\n  frames: number[];\n  info?: {\n    [key: string]: any;\n  };\n  blockSubmit?: boolean;\n}\n\ninterface ValidatorProps {\n  validationTypes: {\n    [type: string]: string;\n  };\n  warnings: IWarning[];\n  errors?: {\n    [type: string]: string;\n  };\n  containerWidth?: number | string;\n  containerHeight?: number | string;\n  onValidate: () => Promise<unknown>;\n  renderWarningTitle: (warning: IWarning) => React.ReactNode;\n  showWarningAction?: (warning: IWarning) => boolean;\n  onWarningAction?: (warning: IWarning) => void;\n  titleFormatter?: (warningsCount: number) => string;\n  checkingMsgFormatter?: () => string;\n}\n\ninterface ValidatorState {\n  checking: boolean;\n  open: boolean;\n}\n\nconst { Panel } = Collapse;\n\nclass Validator extends React.Component<ValidatorProps, ValidatorState> {\n  state: ValidatorState = {\n    checking: false,\n    open: false,\n  };\n\n  handleSync = async () => {\n    this.setState({ checking: true });\n\n    await Promise.all([\n      this.props.onValidate(),\n      new Promise((resolve) => {\n        setTimeout(resolve, 300);\n      }),\n    ]);\n\n    this.setState({ checking: false });\n  };\n\n  renderWarning(warning: IWarning) {\n    const { renderWarningTitle, showWarningAction, onWarningAction } = this.props;\n    const { type, id, message } = warning;\n    return (\n      <div\n        key={`${type}-${id}`}\n        className=\"warning-item\"\n      >\n        <div className=\"warning-title\">\n          <div className=\"name\">\n            {renderWarningTitle(warning)}\n          </div>\n          {showWarningAction && showWarningAction(warning) && (\n            <div\n              className=\"action\"\n              onClick={() => {\n                if (onWarningAction) {\n                  onWarningAction(warning);\n                }\n              }}\n            >\n              <ArrowRightOutlined />\n            </div>\n          )}\n        </div>\n        <div className=\"warning-msg\">\n          {message}\n        </div>\n      </div>\n    );\n  }\n\n  renderWarnings(type: string) {\n    const { validationTypes, warnings, errors = {} } = this.props;\n    const typeWarnings = warnings.filter((i) => i.type === type);\n    const typeError = errors[type];\n    return (typeWarnings.length > 0 || typeError) && (\n      <Panel\n        key={type}\n        header={validationTypes[type]}\n        extra={(\n          <div>\n            {typeError && (\n              <ExclamationCircleFilled style={{ color: 'rgba(220, 70, 36)', marginRight: 4 }} />\n            )}\n            <span className=\"result-count\">\n              {warnings.length}\n            </span>\n          </div>\n        )}\n      >\n        {typeError && <div className=\"error\">{typeError}</div>}\n        {typeWarnings.map((warning) => this.renderWarning(warning))}\n      </Panel>\n    );\n  }\n\n  render() {\n    const {\n      validationTypes,\n      warnings,\n      containerWidth = '100%',\n      containerHeight = '100%',\n      titleFormatter,\n      checkingMsgFormatter,\n    } = this.props;\n\n    return (\n      <div\n        className=\"tool-validator\"\n        style={{\n          width: containerWidth,\n          height: this.state.open ? containerHeight : 32,\n        }}\n      >\n        <div\n          className=\"content\"\n          style={{\n            visibility: this.state.open ? 'visible' : 'hidden',\n          }}\n        >\n          <Collapse\n            ghost\n            expandIcon={(p) => (\n              <CaretRightOutlined\n                style={{\n                  ...p.isActive ? {\n                    top: 11,\n                    transform: 'rotate(90deg)',\n                  } : {\n                    color: 'rgba(255, 255, 255, 0.6)',\n                  },\n                }}\n              />\n            )}\n          >\n            {Object.keys(validationTypes).map((type) => this.renderWarnings(type))}\n          </Collapse>\n        </div>\n        <div className=\"header\">\n          <div\n            style={{\n              backgroundColor: warnings.length > 0 ? 'rgba(220, 70, 36, 0.5)' : 'transparent'\n            }}\n          >\n            <div>\n              <Warning />\n              <span style={{ paddingLeft: 8 }}>\n                {titleFormatter ? titleFormatter(warnings.length) : `${warnings.length} Warning(s)`}\n              </span>\n            </div>\n            <div>\n              {this.state.checking && (\n                <div style={{ fontSize: 12, color: 'rgba(255, 255, 255, 0.6)', paddingRight: 4 }}>\n                  {checkingMsgFormatter ? checkingMsgFormatter() : 'Checking...'}\n                </div>\n              )}\n              <div className=\"icon-button\" onClick={this.handleSync}>\n                <Sync />\n              </div>\n              <div\n                className=\"icon-button\"\n                style={{\n                  transform: this.state.open ? 'rotate(180deg)' : '',\n                }}\n                onClick={() => this.setState((stat) => ({ open: !stat.open }))}\n              >\n                <Up />\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    );\n  }\n}\n\nexport default Validator;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}