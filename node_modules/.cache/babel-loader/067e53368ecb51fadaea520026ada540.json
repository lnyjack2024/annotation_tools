{"ast":null,"code":"var _jsxFileName = \"/Users/qzheng/Documents/webroot/annotation_tools/src/components/long-audio/components/SegmentDetail/LineDetail/LineDetail.js\";\nimport React, { useEffect, useState } from 'react';\nimport { connect } from 'react-redux';\nimport './LineDetail.scss';\nimport EasyForm from '@appen/easy-form';\nimport LineRoleRadio from '../LineRoleRadio/LineRoleRadio';\nimport LineText from '../LineText/LineText';\nimport { deleteLine, setLineCategory, toppingLine, setLineRole } from '../../../redux/action';\nimport { triggerForm } from '../../../constants';\nimport { isAnnotationReadonly } from '../../../../../utils/tool-mode';\nimport DeleteIcon from '../../common/Icons/DeleteIcon';\nconst LineDetail = props => {\n  const {\n    line,\n    lineIndex,\n    lineConfig,\n    currentRoles,\n    toolMode,\n    currentSegment,\n    annotateDisabled\n  } = props;\n  const handleButtonClick = (e, type) => {\n    switch (type) {\n      case 'delete':\n        props.deleteLine({\n          videoIndex: null,\n          segmentIndex: currentSegment,\n          lineIndex\n        });\n        break;\n      case 'topping':\n        props.toppingLine({\n          videoIndex: null,\n          segmentIndex: currentSegment,\n          lineIndex\n        });\n        break;\n      default:\n        break;\n    }\n  };\n  const [lineFormConfig, setLineFormConfig] = useState({});\n  useEffect(() => {\n    const readonly = isAnnotationReadonly(toolMode) || annotateDisabled;\n    const fields = lineConfig.fields.map(v => ({\n      ...v,\n      readonly: readonly || v.readonly,\n      defaultValue: v.name === 'role' ? line.role : line.attributes[v.name],\n      optionType: v.type === 'RADIO' ? 'button' : 'default'\n    }));\n    setLineFormConfig({\n      ...lineConfig,\n      fields,\n      footerVisible: false\n    });\n  }, [currentSegment, annotateDisabled]);\n  const changeLineCategory = data => {\n    const {\n      conditions\n    } = lineFormConfig;\n    const hasCondition = conditions && Array.isArray(conditions) && conditions.length;\n    const setValue = (key, value) => {\n      const index = lineConfig.fields.findIndex(v => v.name === key);\n      props.setLineCategory({\n        videoIndex: null,\n        segmentIndex: null,\n        lineIndex,\n        key,\n        value,\n        fieldIndex: `${lineIndex}_${index}`\n      });\n    };\n    Object.keys(data).forEach(key => {\n      if (key === 'role') {\n        props.setLineRole({\n          lineIndex,\n          role: data[key]\n        });\n      } else if (hasCondition && conditions.find(con => con.field === key)) {\n        const {\n          updatedValues\n        } = triggerForm(lineFormConfig, {\n          [key]: data[key]\n        });\n        Object.keys(updatedValues).forEach(upKey => {\n          setValue(upKey, updatedValues[upKey]);\n        });\n      } else {\n        setValue(key, data[key]);\n      }\n    });\n  };\n  return /*#__PURE__*/React.createElement(\"div\", {\n    className: \"line-detail-container\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 84,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(\"button\", {\n    className: \"line-detail-button\",\n    style: {\n      display: lineIndex === 0 ? 'none' : 'block'\n    },\n    onClick: e => handleButtonClick(e, 'delete'),\n    disabled: annotateDisabled,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 85,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(DeleteIcon, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 91,\n      columnNumber: 9\n    }\n  })), /*#__PURE__*/React.createElement(LineRoleRadio, {\n    role: line.role,\n    index: lineIndex,\n    currentRoles: currentRoles,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 100,\n      columnNumber: 7\n    }\n  }), /*#__PURE__*/React.createElement(EasyForm, Object.assign({\n    theme: \"dark\",\n    autoFocus: false\n  }, lineFormConfig && lineFormConfig, {\n    onChange: changeLineCategory,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 105,\n      columnNumber: 7\n    }\n  })), /*#__PURE__*/React.createElement(LineText, {\n    text: line.text,\n    lineIndex: lineIndex,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 111,\n      columnNumber: 7\n    }\n  }));\n};\nconst mapStateToProps = state => ({\n  ontology: state.ontology,\n  segmentConfig: state.segmentConfig,\n  lineConfig: state.lineConfig,\n  currentSegment: state.currentSegment,\n  toolMode: state.toolMode,\n  results: state.results,\n  currentVideo: state.currentVideo,\n  annotateDisabled: state.annotateDisabled\n});\nconst mapDispatchToProps = {\n  deleteLine,\n  toppingLine,\n  setLineCategory,\n  setLineRole\n};\nexport default connect(mapStateToProps, mapDispatchToProps)(LineDetail);","map":{"version":3,"names":["React","useEffect","useState","connect","EasyForm","LineRoleRadio","LineText","deleteLine","setLineCategory","toppingLine","setLineRole","triggerForm","isAnnotationReadonly","DeleteIcon","LineDetail","props","line","lineIndex","lineConfig","currentRoles","toolMode","currentSegment","annotateDisabled","handleButtonClick","e","type","videoIndex","segmentIndex","lineFormConfig","setLineFormConfig","readonly","fields","map","v","defaultValue","name","role","attributes","optionType","footerVisible","changeLineCategory","data","conditions","hasCondition","Array","isArray","length","setValue","key","value","index","findIndex","fieldIndex","Object","keys","forEach","find","con","field","updatedValues","upKey","createElement","className","__self","__source","fileName","_jsxFileName","lineNumber","columnNumber","style","display","onClick","disabled","assign","theme","autoFocus","onChange","text","mapStateToProps","state","ontology","segmentConfig","results","currentVideo","mapDispatchToProps"],"sources":["/Users/qzheng/Documents/webroot/annotation_tools/src/components/long-audio/components/SegmentDetail/LineDetail/LineDetail.js"],"sourcesContent":["import React, { useEffect, useState } from 'react';\nimport { connect } from 'react-redux';\nimport './LineDetail.scss';\nimport EasyForm from '@appen/easy-form';\nimport LineRoleRadio from '../LineRoleRadio/LineRoleRadio';\nimport LineText from '../LineText/LineText';\nimport { deleteLine, setLineCategory, toppingLine, setLineRole } from '../../../redux/action';\nimport { triggerForm } from '../../../constants';\nimport { isAnnotationReadonly } from '../../../../../utils/tool-mode';\nimport DeleteIcon from '../../common/Icons/DeleteIcon';\n\nconst LineDetail = (props) => {\n  const { line, lineIndex, lineConfig, currentRoles, toolMode, currentSegment, annotateDisabled } = props;\n  const handleButtonClick = (e, type) => {\n    switch (type) {\n      case 'delete':\n        props.deleteLine({\n          videoIndex: null,\n          segmentIndex: currentSegment,\n          lineIndex,\n        });\n        break;\n      case 'topping':\n        props.toppingLine({\n          videoIndex: null,\n          segmentIndex: currentSegment,\n          lineIndex,\n        });\n        break;\n      default:\n        break;\n    }\n  };\n  const [lineFormConfig, setLineFormConfig] = useState({});\n  useEffect(() => {\n    const readonly = isAnnotationReadonly(toolMode) || annotateDisabled;\n    const fields = lineConfig.fields.map((v) => ({\n      ...v,\n      readonly: readonly || v.readonly,\n      defaultValue: v.name === 'role' ? line.role : line.attributes[v.name],\n      optionType: v.type === 'RADIO' ? 'button' : 'default',\n    }));\n    setLineFormConfig({\n      ...lineConfig,\n      fields,\n      footerVisible: false,\n    });\n  }, [currentSegment, annotateDisabled]);\n\n  const changeLineCategory = (data) => {\n    const { conditions } = lineFormConfig;\n    const hasCondition = conditions && Array.isArray(conditions) && conditions.length;\n\n    const setValue = (key, value) => {\n      const index = lineConfig.fields.findIndex((v) => v.name === key);\n      props.setLineCategory({\n        videoIndex: null,\n        segmentIndex: null,\n        lineIndex,\n        key,\n        value,\n        fieldIndex: `${lineIndex}_${index}`,\n      });\n    };\n\n    Object.keys(data).forEach((key) => {\n      if (key === 'role') {\n        props.setLineRole({\n          lineIndex,\n          role: data[key],\n        });\n      } else if (hasCondition && conditions.find((con) => con.field === key)) {\n        const { updatedValues } = triggerForm(lineFormConfig, { [key]: data[key] });\n        Object.keys(updatedValues).forEach((upKey) => {\n          setValue(upKey, updatedValues[upKey]);\n        });\n      } else {\n        setValue(key, data[key]);\n      }\n    });\n  };\n\n  return (\n    <div className=\"line-detail-container\">\n      <button\n        className=\"line-detail-button\"\n        style={{ display: lineIndex === 0 ? 'none' : 'block' }}\n        onClick={(e) => handleButtonClick(e, 'delete')}\n        disabled={annotateDisabled}\n      >\n        <DeleteIcon />\n      </button>\n      {/* <button\n        className=\"line-detail-button\"\n        style={{ display: lineIndex === 0 ? 'none' : 'block' }}\n        onClick={e => handleButtonClick(e, 'topping')}\n      >\n        topping\n      </button> */}\n      <LineRoleRadio\n        role={line.role}\n        index={lineIndex}\n        currentRoles={currentRoles}\n      />\n      <EasyForm\n        theme=\"dark\"\n        autoFocus={false}\n        {...lineFormConfig && lineFormConfig}\n        onChange={changeLineCategory}\n      />\n      <LineText\n        text={line.text}\n        lineIndex={lineIndex}\n      />\n    </div>\n  );\n};\n\nconst mapStateToProps = (state) => ({\n  ontology: state.ontology,\n  segmentConfig: state.segmentConfig,\n  lineConfig: state.lineConfig,\n  currentSegment: state.currentSegment,\n  toolMode: state.toolMode,\n  results: state.results,\n  currentVideo: state.currentVideo,\n  annotateDisabled: state.annotateDisabled,\n});\nconst mapDispatchToProps = {\n  deleteLine,\n  toppingLine,\n  setLineCategory,\n  setLineRole,\n};\nexport default connect(mapStateToProps, mapDispatchToProps)(LineDetail);\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}