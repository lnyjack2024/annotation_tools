{"ast":null,"code":"import React from'react';import{action,makeObservable,observable}from'mobx';import{observer}from'mobx-react';import cx from'classnames';import InstanceItemAttributes from'./InstanceItemAttributes';import{Up,Pencil}from'../../../common/icons';import store from'../../store/RootStore';import i18n from'../../locales';import{parseFields}from'../../utils';import'./InstanceAttributes.scss';import AttributeValueItem from'./AttributeValueItem';class InstanceAttributes extends React.Component{constructor(props){super(props);/**\n   * fields map for instance & its items\n   */this.fieldsMap={};/**\n   * collapsed\n   */this.collapsed=false;this.toggleCollapsed=()=>{this.collapsed=!this.collapsed;};makeObservable(this,{fieldsMap:observable,collapsed:observable,updateFieldsMap:action,toggleCollapsed:action});this.updateFieldsMap();}componentDidUpdate(prevProps){if(prevProps.instance.id!==this.props.instance.id){this.updateFieldsMap();}}updateFieldsMap(){const{children=[],labelConfigDynamic}=this.props.instance.categoryRef;this.fieldsMap={dynamicInstance:parseFields(labelConfigDynamic)};// get label config for all items\nchildren.forEach(child=>{this.fieldsMap[child.name]=parseFields(child.labelConfig);});}render(){const{instance,instanceItem}=this.props;const{label:labelName}=instance;const dynamicAttributes=store.instance.getCurrentDynamicAttributesByInstance(instance);const attrKeysDynamic=Object.keys(dynamicAttributes||{});const fieldKeysDynamic=Object.keys(this.fieldsMap.dynamicInstance);const legacyKeysDynamic=attrKeysDynamic.filter(key=>!fieldKeysDynamic.includes(key));return/*#__PURE__*/React.createElement(\"div\",{className:cx('collapse-panel instance-attributes-panel',{collapsed:this.collapsed})},/*#__PURE__*/React.createElement(\"div\",{className:\"collapse-panel-title space-between\",onClick:this.toggleCollapsed},/*#__PURE__*/React.createElement(\"span\",null,/*#__PURE__*/React.createElement(\"div\",{className:\"collapse-panel-collapse-icon\"},/*#__PURE__*/React.createElement(Up,null)),i18n.translate('INSTANCE_ATTRIBUTES_INSTANCE',{values:{frame:store.frame.currentFrame+1}})),/*#__PURE__*/React.createElement(\"span\",null,!store.readonly&&store.instance.isAttributesEnabled(instance,instanceItem)&&/*#__PURE__*/React.createElement(\"div\",{className:\"collapse-panel-icon\",onClick:e=>{e.stopPropagation();store.config.setAttributesModalVisible(true);}},/*#__PURE__*/React.createElement(Pencil,null)))),/*#__PURE__*/React.createElement(\"div\",{className:\"collapse-panel-content\"},/*#__PURE__*/React.createElement(\"div\",{className:\"section\"},/*#__PURE__*/React.createElement(\"div\",{className:\"section-title\"},labelName),[...fieldKeysDynamic,...legacyKeysDynamic].map(key=>attrKeysDynamic.includes(key)&&/*#__PURE__*/React.createElement(AttributeValueItem,{key:key,fieldName:key,fieldsMap:this.fieldsMap.dynamicInstance,values:dynamicAttributes}))),instanceItem&&/*#__PURE__*/React.createElement(InstanceItemAttributes,{instanceItem:instanceItem,fieldsMap:this.fieldsMap[instanceItem.name]}),!instanceItem&&Object.values(instance.items).filter(i=>{const cameras=Object.keys(i.cameras).filter(c=>!i.cameras[c].isEmpty);return cameras.includes(store.frame.currentCamera);}).map(item=>/*#__PURE__*/React.createElement(InstanceItemAttributes,{key:item.id,instanceItem:item,fieldsMap:this.fieldsMap[item.name]}))));}}export default observer(InstanceAttributes);","map":{"version":3,"names":["React","action","makeObservable","observable","observer","cx","InstanceItemAttributes","Up","Pencil","store","i18n","parseFields","AttributeValueItem","InstanceAttributes","Component","constructor","props","fieldsMap","collapsed","toggleCollapsed","updateFieldsMap","componentDidUpdate","prevProps","instance","id","children","labelConfigDynamic","categoryRef","dynamicInstance","forEach","child","name","labelConfig","render","instanceItem","label","labelName","dynamicAttributes","getCurrentDynamicAttributesByInstance","attrKeysDynamic","Object","keys","fieldKeysDynamic","legacyKeysDynamic","filter","key","includes","createElement","className","onClick","translate","values","frame","currentFrame","readonly","isAttributesEnabled","e","stopPropagation","config","setAttributesModalVisible","map","fieldName","items","i","cameras","c","isEmpty","currentCamera","item"],"sources":["/Users/qzheng/Documents/webroot/annotation_tools/src/components/video-tracking2/components/attributes/InstanceAttributes.tsx"],"sourcesContent":["import React from 'react';\nimport { action, makeObservable, observable } from 'mobx';\nimport { observer } from 'mobx-react';\nimport cx from 'classnames';\nimport InstanceItemAttributes from './InstanceItemAttributes';\nimport { Up, Pencil } from '../../../common/icons';\nimport store from '../../store/RootStore';\nimport i18n from '../../locales';\nimport { parseFields } from '../../utils';\nimport { FieldConfig } from '../../types';\nimport Instance from '../../model/Instance';\nimport InstanceItem from '../../model/InstanceItem';\nimport './InstanceAttributes.scss';\nimport AttributeValueItem from './AttributeValueItem';\n\ninterface InstanceAttributesProps {\n  instance: Instance;\n  instanceItem?: InstanceItem;\n}\n\nclass InstanceAttributes extends React.Component<InstanceAttributesProps> {\n  /**\n   * fields map for instance & its items\n   */\n  fieldsMap: {\n    [type: string]: { [fieldName: string]: FieldConfig }\n  } = {};\n\n  /**\n   * collapsed\n   */\n  collapsed = false;\n\n  constructor(props: InstanceAttributesProps) {\n    super(props);\n\n    makeObservable(this, {\n      fieldsMap: observable,\n      collapsed: observable,\n      updateFieldsMap: action,\n      toggleCollapsed: action,\n    });\n\n    this.updateFieldsMap();\n  }\n\n  componentDidUpdate(prevProps: InstanceAttributesProps) {\n    if (prevProps.instance.id !== this.props.instance.id) {\n      this.updateFieldsMap();\n    }\n  }\n\n  updateFieldsMap() {\n    const { children = [], labelConfigDynamic } = this.props.instance.categoryRef;\n    this.fieldsMap = {\n      dynamicInstance: parseFields(labelConfigDynamic)\n    };\n    // get label config for all items\n    children.forEach((child) => {\n      this.fieldsMap[child.name] = parseFields(child.labelConfig);\n    });\n  }\n\n  toggleCollapsed = () => {\n    this.collapsed = !this.collapsed;\n  };\n\n  render() {\n    const { instance, instanceItem } = this.props;\n    const { label: labelName } = instance;\n    const dynamicAttributes = store.instance.getCurrentDynamicAttributesByInstance(instance);\n    const attrKeysDynamic = Object.keys(dynamicAttributes || {});\n    const fieldKeysDynamic = Object.keys(this.fieldsMap.dynamicInstance);\n    const legacyKeysDynamic = attrKeysDynamic.filter((key) => !fieldKeysDynamic.includes(key));\n    return (\n      <div\n        className={cx('collapse-panel instance-attributes-panel', {\n          collapsed: this.collapsed,\n        })}\n      >\n        <div\n          className=\"collapse-panel-title space-between\"\n          onClick={this.toggleCollapsed}\n        >\n          <span>\n            <div className=\"collapse-panel-collapse-icon\">\n              <Up />\n            </div>\n            {i18n.translate('INSTANCE_ATTRIBUTES_INSTANCE', {\n              values: { frame: store.frame.currentFrame + 1 },\n            })}\n          </span>\n          <span>\n            {!store.readonly && store.instance.isAttributesEnabled(instance, instanceItem) && (\n              <div\n                className=\"collapse-panel-icon\"\n                onClick={(e) => {\n                  e.stopPropagation();\n                  store.config.setAttributesModalVisible(true);\n                }}\n              >\n                <Pencil />\n              </div>\n            )}\n          </span>\n        </div>\n        <div className=\"collapse-panel-content\">\n          <div\n            className=\"section\"\n          >\n            <div className=\"section-title\">\n              {labelName}\n            </div>\n            {\n              [...fieldKeysDynamic, ...legacyKeysDynamic].map((key) => attrKeysDynamic.includes(key) && (\n              <AttributeValueItem\n                key={key}\n                fieldName={key}\n                fieldsMap={this.fieldsMap.dynamicInstance}\n                values={dynamicAttributes}\n              />\n              ))\n            }\n          </div>\n          {instanceItem && (\n            <InstanceItemAttributes\n              instanceItem={instanceItem}\n              fieldsMap={this.fieldsMap[instanceItem.name]}\n            />\n          )}\n          {!instanceItem &&\n          Object.values(instance.items)\n            .filter((i) => {\n              const cameras = Object.keys(i.cameras).filter((c) => !i.cameras[c].isEmpty);\n              return cameras.includes(store.frame.currentCamera);\n            })\n            .map((item) => (\n              <InstanceItemAttributes\n                key={item.id}\n                instanceItem={item}\n                fieldsMap={this.fieldsMap[item.name]}\n              />\n            ))}\n        </div>\n      </div>\n    );\n  }\n}\n\nexport default observer(InstanceAttributes);\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}