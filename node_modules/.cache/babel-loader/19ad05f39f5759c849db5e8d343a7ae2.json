{"ast":null,"code":"import React,{useMemo,useState,useImperativeHandle}from'react';import EasyForm from'@appen-china/easy-form';import Modal from'../../common/modal/Modal';const Attributes=React.forwardRef((_ref,ref)=>{let{readonly,config,values,onValuesChange}=_ref;const[visible,setVisible]=useState(false);const[title,setTitle]=useState('');// fields with initial value\nconst fieldsWithInitialValue=useMemo(()=>((config===null||config===void 0?void 0:config.fields)||[]).map(field=>({...field,readonly:readonly||field.readonly,...(values&&values[field.name]!==undefined&&{defaultValue:values[field.name]})})),[config,values]);useImperativeHandle(ref,()=>({modalVisible:visible,showModal:tit=>{setVisible(true);setTitle(tit);}}));const handleValuesChange=v=>{setVisible(false);onValuesChange({...v});};return/*#__PURE__*/React.createElement(Modal,{className:\"attributes-form\",visible:visible,draggable:false,closable:false,dragId:\"keypoint-attributes\",onClose:()=>{handleValuesChange({});},title:title},/*#__PURE__*/React.createElement(EasyForm,{theme:\"dark\",fields:fieldsWithInitialValue,conditions:config===null||config===void 0?void 0:config.conditions,effects:config===null||config===void 0?void 0:config.effects,rules:config===null||config===void 0?void 0:config.rules,onSubmit:handleValuesChange}));});export default Attributes;","map":{"version":3,"names":["React","useMemo","useState","useImperativeHandle","EasyForm","Modal","Attributes","forwardRef","_ref","ref","readonly","config","values","onValuesChange","visible","setVisible","title","setTitle","fieldsWithInitialValue","fields","map","field","name","undefined","defaultValue","modalVisible","showModal","tit","handleValuesChange","v","createElement","className","draggable","closable","dragId","onClose","theme","conditions","effects","rules","onSubmit"],"sources":["/Users/qzheng/Documents/webroot/annotation_tools/src/components/keypoint/components/Attributes.tsx"],"sourcesContent":["import React, { useMemo, useState, useImperativeHandle } from 'react';\nimport EasyForm from '@appen-china/easy-form';\nimport { Field, Condition, Effect, Rule } from '@appen-china/easy-form/es/types';\nimport Modal from '../../common/modal/Modal';\n\ninterface AttributesProps {\n  readonly: boolean;\n  config: {\n    fields: Field[];\n    conditions?: Condition[];\n    effects?: Effect[];\n    rules?: Rule[];\n  } | null;\n  values: any;\n  onValuesChange: (values: any) => void;\n}\n\nexport interface AttributesHandle {\n  modalVisible: boolean;\n  showModal: (title: string) => void;\n}\n\nconst Attributes = React.forwardRef<AttributesHandle, AttributesProps>(({\n  readonly,\n  config,\n  values,\n  onValuesChange,\n}, ref) => {\n  const [visible, setVisible] = useState(false);\n  const [title, setTitle] = useState('');\n\n  // fields with initial value\n  const fieldsWithInitialValue = useMemo(() => (config?.fields || []).map((field) => ({\n    ...field,\n    readonly: readonly || field.readonly,\n    ...values && values[field.name] !== undefined && {\n      defaultValue: values[field.name],\n    }\n  })), [config, values]);\n\n  useImperativeHandle(ref, () => ({\n    modalVisible: visible,\n    showModal: (tit: string) => {\n      setVisible(true);\n      setTitle(tit);\n    },\n  }));\n\n  const handleValuesChange = (v: any) => {\n    setVisible(false);\n    onValuesChange({ ...v });\n  };\n\n  return (\n    <Modal\n      className=\"attributes-form\"\n      visible={visible}\n      draggable={false}\n      closable={false}\n      dragId=\"keypoint-attributes\"\n      onClose={() => {\n        handleValuesChange({});\n      }}\n      title={title}\n    >\n      <EasyForm\n        theme=\"dark\"\n        fields={fieldsWithInitialValue}\n        conditions={config?.conditions}\n        effects={config?.effects}\n        rules={config?.rules}\n        onSubmit={handleValuesChange}\n      />\n    </Modal>\n  );\n});\n\nexport default Attributes;\n"],"mappings":"AAAA,MAAO,CAAAA,KAAK,EAAIC,OAAO,CAAEC,QAAQ,CAAEC,mBAAmB,KAAQ,OAAO,CACrE,MAAO,CAAAC,QAAQ,KAAM,wBAAwB,CAE7C,MAAO,CAAAC,KAAK,KAAM,0BAA0B,CAmB5C,KAAM,CAAAC,UAAU,CAAGN,KAAK,CAACO,UAAU,CAAoC,CAAAC,IAAA,CAKpEC,GAAG,GAAK,IAL6D,CACtEC,QAAQ,CACRC,MAAM,CACNC,MAAM,CACNC,cACF,CAAC,CAAAL,IAAA,CACC,KAAM,CAACM,OAAO,CAAEC,UAAU,CAAC,CAAGb,QAAQ,CAAC,KAAK,CAAC,CAC7C,KAAM,CAACc,KAAK,CAAEC,QAAQ,CAAC,CAAGf,QAAQ,CAAC,EAAE,CAAC,CAEtC;AACA,KAAM,CAAAgB,sBAAsB,CAAGjB,OAAO,CAAC,IAAM,CAAC,CAAAU,MAAM,SAANA,MAAM,iBAANA,MAAM,CAAEQ,MAAM,GAAI,EAAE,EAAEC,GAAG,CAAEC,KAAK,GAAM,CAClF,GAAGA,KAAK,CACRX,QAAQ,CAAEA,QAAQ,EAAIW,KAAK,CAACX,QAAQ,CACpC,IAAGE,MAAM,EAAIA,MAAM,CAACS,KAAK,CAACC,IAAI,CAAC,GAAKC,SAAS,EAAI,CAC/CC,YAAY,CAAEZ,MAAM,CAACS,KAAK,CAACC,IAAI,CACjC,CAAC,CACH,CAAC,CAAC,CAAC,CAAE,CAACX,MAAM,CAAEC,MAAM,CAAC,CAAC,CAEtBT,mBAAmB,CAACM,GAAG,CAAE,KAAO,CAC9BgB,YAAY,CAAEX,OAAO,CACrBY,SAAS,CAAGC,GAAW,EAAK,CAC1BZ,UAAU,CAAC,IAAI,CAAC,CAChBE,QAAQ,CAACU,GAAG,CAAC,CACf,CACF,CAAC,CAAC,CAAC,CAEH,KAAM,CAAAC,kBAAkB,CAAIC,CAAM,EAAK,CACrCd,UAAU,CAAC,KAAK,CAAC,CACjBF,cAAc,CAAC,CAAE,GAAGgB,CAAE,CAAC,CAAC,CAC1B,CAAC,CAED,mBACE7B,KAAA,CAAA8B,aAAA,CAACzB,KAAK,EACJ0B,SAAS,CAAC,iBAAiB,CAC3BjB,OAAO,CAAEA,OAAQ,CACjBkB,SAAS,CAAE,KAAM,CACjBC,QAAQ,CAAE,KAAM,CAChBC,MAAM,CAAC,qBAAqB,CAC5BC,OAAO,CAAEA,CAAA,GAAM,CACbP,kBAAkB,CAAC,CAAC,CAAC,CAAC,CACxB,CAAE,CACFZ,KAAK,CAAEA,KAAM,eAEbhB,KAAA,CAAA8B,aAAA,CAAC1B,QAAQ,EACPgC,KAAK,CAAC,MAAM,CACZjB,MAAM,CAAED,sBAAuB,CAC/BmB,UAAU,CAAE1B,MAAM,SAANA,MAAM,iBAANA,MAAM,CAAE0B,UAAW,CAC/BC,OAAO,CAAE3B,MAAM,SAANA,MAAM,iBAANA,MAAM,CAAE2B,OAAQ,CACzBC,KAAK,CAAE5B,MAAM,SAANA,MAAM,iBAANA,MAAM,CAAE4B,KAAM,CACrBC,QAAQ,CAAEZ,kBAAmB,CAC9B,CACI,CAAC,CAEZ,CAAC,CAAC,CAEF,cAAe,CAAAtB,UAAU","ignoreList":[]},"metadata":{},"sourceType":"module"}