{"ast":null,"code":"import _applyDecoratedDescriptor from\"/Users/qzheng/Documents/webroot/annotation_tools/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/applyDecoratedDescriptor\";var _class;import{observable,action,makeObservable,computed}from'mobx';import{initOntology}from'../utils';;let OntologyStore=(_class=class OntologyStore{constructor(rootStore){this.rootStore=void 0;this.selectedOntologyGroup='';this.ontology=[];makeObservable(this,{selectedOntologyGroup:observable,ontology:observable,setOntology:action});this.rootStore=rootStore;}get ontologyMap(){const map={};this.ontology.forEach(item=>{map[item.class_name]={count:0,children:{}};item.children.forEach(_ref=>{let{count,name}=_ref;map[item.class_name].count+=count;map[item.class_name].children[name]=count;});});return map;}getOntologyInfo(ontologyName){return this.ontology&&this.ontology.find(ontology=>ontology.class_name===ontologyName);}getGroupData(ontologyName,groupName){const ontologyItem=this.getOntologyInfo(ontologyName);const groupItem=ontologyItem&&ontologyItem.children&&ontologyItem.children.find(group=>group.name===groupName);return groupItem&&{...groupItem,class_display_name:(ontologyItem===null||ontologyItem===void 0?void 0:ontologyItem.display_name)||(ontologyItem===null||ontologyItem===void 0?void 0:ontologyItem.class_name)};}getCategoryData(ontologyName,groupName,categoryName){const groupData=this.getGroupData(ontologyName,groupName);return groupData&&groupData.categories&&groupData.categories.find(v=>v.name===categoryName)||undefined;}setOntology(list){this.ontology=Array.isArray(list)?initOntology(list):[];}},(_applyDecoratedDescriptor(_class.prototype,\"ontologyMap\",[computed],Object.getOwnPropertyDescriptor(_class.prototype,\"ontologyMap\"),_class.prototype)),_class);export default OntologyStore;","map":{"version":3,"names":["observable","action","makeObservable","computed","initOntology","OntologyStore","_class","constructor","rootStore","selectedOntologyGroup","ontology","setOntology","ontologyMap","map","forEach","item","class_name","count","children","_ref","name","getOntologyInfo","ontologyName","find","getGroupData","groupName","ontologyItem","groupItem","group","class_display_name","display_name","getCategoryData","categoryName","groupData","categories","v","undefined","list","Array","isArray","_applyDecoratedDescriptor","prototype","Object","getOwnPropertyDescriptor"],"sources":["/Users/qzheng/Documents/webroot/annotation_tools/src/components/keypoint/store/OntologyStore.ts"],"sourcesContent":["import { observable, action, makeObservable, computed } from 'mobx';\nimport { initOntology } from '../utils';\nimport { RootStoreType } from './RootStore';\nimport { LandmarkEditType, CategoryItem, Line, FormConfig } from '../types';\n\nexport interface OntologyItem {\n  key?: string;\n  class_name: string;\n  display_name?: string;\n  display_color?: string;\n  description?: string;\n  children: OntologyChild[];\n};\n\nexport interface OntologyChild {\n  key?: string;\n  name: string;\n  display_name?: string;\n  class_display_name?: string;\n  count: number;\n  type: LandmarkEditType;\n  categories?: CategoryItem[] | null;\n  lines?: Line[];\n  reference?: string | null;\n  label_config: FormConfig | null;\n  point_label_config: FormConfig | null;\n}\n\nexport interface InstanceCountMap {\n  count?: number,\n  children: {\n    [groupName: string]: number\n  }\n}\nexport interface OntologyCountMap {\n  [category: string]: InstanceCountMap;\n}\n\nclass OntologyStore {\n  rootStore: RootStoreType;\n\n  selectedOntologyGroup = '';\n\n  ontology: OntologyItem[] = [];\n\n  constructor(rootStore: RootStoreType) {\n    makeObservable(this, {\n      selectedOntologyGroup: observable,\n      ontology: observable,\n      setOntology: action\n    });\n    this.rootStore = rootStore;\n  }\n\n  @computed get ontologyMap() {\n    const map: OntologyCountMap = {};\n    this.ontology.forEach((item) => {\n      map[item.class_name] = {\n        count: 0,\n        children: {}\n      };\n      item.children.forEach(({ count, name }) => {\n        map[item.class_name].count! += count;\n        map[item.class_name].children[name] = count;\n      });\n    });\n    return map;\n  }\n\n  getOntologyInfo(ontologyName: string) {\n    return this.ontology && this.ontology.find((ontology) => ontology.class_name === ontologyName);\n  }\n\n  getGroupData(ontologyName: string, groupName: string) {\n    const ontologyItem = this.getOntologyInfo(ontologyName);\n    const groupItem = ontologyItem && ontologyItem.children && ontologyItem.children.find((group) => group.name === groupName);\n    return groupItem && { ...groupItem, class_display_name: ontologyItem?.display_name || ontologyItem?.class_name };\n  }\n\n  getCategoryData(ontologyName: string, groupName: string, categoryName: string) {\n    const groupData = this.getGroupData(ontologyName, groupName);\n    return (groupData && groupData.categories && groupData.categories.find((v) => v.name === categoryName)) || undefined;\n  }\n\n  setOntology(list: OntologyItem[] | CategoryItem[]) {\n    this.ontology = Array.isArray(list) ? initOntology(list) : [];\n  }\n}\n\nexport default OntologyStore;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}