{"ast":null,"code":"import _initializerDefineProperty from \"/Users/qzheng/Documents/webroot/annotation_tools/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/initializerDefineProperty\";\nimport _applyDecoratedDescriptor from \"/Users/qzheng/Documents/webroot/annotation_tools/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/applyDecoratedDescriptor\";\nimport _initializerWarningHelper from \"/Users/qzheng/Documents/webroot/annotation_tools/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/initializerWarningHelper\";\nvar _class, _descriptor, _descriptor2;\nimport { observable, computed, action, makeObservable } from 'mobx';\nimport { v4 as uuidv4 } from 'uuid';\nimport { cloneDeep } from 'lodash';\n;\n/**\n * undo/redo store\n */\nlet UndoStore = (_class = class UndoStore {\n  constructor() {\n    /**\n     * current pointer\n     */\n    _initializerDefineProperty(this, \"pointer\", _descriptor, this);\n    /**\n     * last stored data uuid\n     */\n    _initializerDefineProperty(this, \"lastStoreId\", _descriptor2, this);\n    /**\n     * saved status\n     */\n    this.stack = [];\n    /**\n     * current data uuid\n     */\n    this.storeId = '';\n    /**\n     * saved data copy\n     */\n    this.savedData = {};\n    makeObservable(this);\n  }\n\n  /**\n   * is undo disabled\n   */\n  get undoDisabled() {\n    return this.pointer <= 0;\n  }\n\n  /**\n   * is redo disabled\n   */\n  get redoDisabled() {\n    return this.pointer >= this.stack.length;\n  }\n\n  /**\n   * preserve current data\n   */\n  preserve(data = {}) {\n    this.storeId = uuidv4();\n    this.savedData = cloneDeep(data);\n    return this.storeId;\n  }\n\n  /**\n   * save to stack\n   */\n  save(uid, data = {}) {\n    if (uid === this.storeId) {\n      // same command\n      this.stack = this.stack.slice(0, this.pointer);\n      this.stack.push({\n        before: this.savedData,\n        after: cloneDeep(data)\n      });\n      if (this.stack.length > 50) {\n        this.stack.shift();\n      } else {\n        this.pointer += 1;\n      }\n      this.lastStoreId = uid;\n    }\n    this.storeId = '';\n    this.savedData = {};\n  }\n\n  /**\n   * undo\n   */\n  undo() {\n    if (this.pointer > 0) {\n      this.pointer -= 1;\n      return this.stack[this.pointer];\n    }\n    return null;\n  }\n\n  /**\n   * redo\n   */\n  redo() {\n    if (this.pointer < this.stack.length) {\n      this.pointer += 1;\n      return this.stack[this.pointer - 1];\n    }\n    return null;\n  }\n}, _descriptor = _applyDecoratedDescriptor(_class.prototype, \"pointer\", [observable], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: function () {\n    return 0;\n  }\n}), _descriptor2 = _applyDecoratedDescriptor(_class.prototype, \"lastStoreId\", [observable], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: function () {\n    return '';\n  }\n}), _applyDecoratedDescriptor(_class.prototype, \"undoDisabled\", [computed], Object.getOwnPropertyDescriptor(_class.prototype, \"undoDisabled\"), _class.prototype), _applyDecoratedDescriptor(_class.prototype, \"redoDisabled\", [computed], Object.getOwnPropertyDescriptor(_class.prototype, \"redoDisabled\"), _class.prototype), _applyDecoratedDescriptor(_class.prototype, \"undo\", [action], Object.getOwnPropertyDescriptor(_class.prototype, \"undo\"), _class.prototype), _applyDecoratedDescriptor(_class.prototype, \"redo\", [action], Object.getOwnPropertyDescriptor(_class.prototype, \"redo\"), _class.prototype), _class);\nexport default new UndoStore();","map":{"version":3,"names":["observable","computed","action","makeObservable","v4","uuidv4","cloneDeep","UndoStore","_class","constructor","_initializerDefineProperty","_descriptor","_descriptor2","stack","storeId","savedData","undoDisabled","pointer","redoDisabled","length","preserve","data","save","uid","slice","push","before","after","shift","lastStoreId","undo","redo","_applyDecoratedDescriptor","prototype","configurable","enumerable","writable","initializer","Object","getOwnPropertyDescriptor"],"sources":["/Users/qzheng/Documents/webroot/annotation_tools/src/components/video-tracking/store/UndoStore.ts"],"sourcesContent":["import { observable, computed, action, makeObservable } from 'mobx';\nimport { v4 as uuidv4 } from 'uuid';\nimport { cloneDeep } from 'lodash';\nimport { Instance, Relationship, Review, FrameAttribute } from '../types';\n\nexport interface StoreData {\n  // for instances\n  instances?: Instance[];\n  // for relationships\n  relationships?: {\n    frameIndex: number;\n    items: Relationship[];\n  }[];\n  // for reviews\n  reviews?: Review[];\n  // for frame attributes\n  frames?: FrameAttribute[];\n};\n\ninterface StoreItem {\n  before: StoreData;\n  after: StoreData;\n}\n\n/**\n * undo/redo store\n */\nclass UndoStore {\n  /**\n   * current pointer\n   */\n  @observable pointer = 0;\n\n  /**\n   * last stored data uuid\n   */\n  @observable lastStoreId = '';\n\n  /**\n   * saved status\n   */\n  stack: StoreItem[] = [];\n\n  /**\n   * current data uuid\n   */\n  storeId = '';\n\n  /**\n   * saved data copy\n   */\n  savedData: StoreData = {};\n\n  constructor() {\n    makeObservable(this);\n  }\n\n  /**\n   * is undo disabled\n   */\n  @computed get undoDisabled() {\n    return this.pointer <= 0;\n  }\n\n  /**\n   * is redo disabled\n   */\n  @computed get redoDisabled() {\n    return this.pointer >= this.stack.length;\n  }\n\n  /**\n   * preserve current data\n   */\n  preserve(data: StoreData = {}) {\n    this.storeId = uuidv4();\n    this.savedData = cloneDeep(data);\n    return this.storeId;\n  }\n\n  /**\n   * save to stack\n   */\n  save(uid: string, data: StoreData = {}) {\n    if (uid === this.storeId) { // same command\n      this.stack = this.stack.slice(0, this.pointer);\n      this.stack.push({\n        before: this.savedData,\n        after: cloneDeep(data),\n      });\n      if (this.stack.length > 50) {\n        this.stack.shift();\n      } else {\n        this.pointer += 1;\n      }\n      this.lastStoreId = uid;\n    }\n    this.storeId = '';\n    this.savedData = {};\n  }\n\n  /**\n   * undo\n   */\n  @action\n  undo() {\n    if (this.pointer > 0) {\n      this.pointer -= 1;\n      return this.stack[this.pointer];\n    }\n    return null;\n  }\n\n  /**\n   * redo\n   */\n  @action\n  redo() {\n    if (this.pointer < this.stack.length) {\n      this.pointer += 1;\n      return this.stack[this.pointer - 1];\n    }\n    return null;\n  }\n}\n\nexport default new UndoStore();\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}