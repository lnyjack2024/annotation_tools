"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[2985],{93396:function(X,x,e){var F=e(75271),m=function(C,A){var S=(0,F.useRef)();(0,F.useEffect)(function(){S.current=C},[C]),(0,F.useEffect)(function(){var D=function(){return S.current.apply(S,arguments)};if(A!==null){var o=setInterval(D,A);return function(){return clearInterval(o)}}return function(){}},[A])};x.Z=m},44299:function(X,x,e){e.r(x),e.d(x,{default:function(){return le}});var F=e(90228),m=e.n(F),N=e(26068),C=e.n(N),A=e(87999),S=e.n(A),D=e(48305),o=e.n(D),d=e(75271),z=e(70576),Y=e(66575),K=e(66063),j=e(42400),w=e(15131),k=e(79417),B=e(11091),b=e(81399),q=e(73095),_=e(32109),ee=e(66830),H=e(90966),te=e(93396),re=function(f,v){var a=v.interval,Z=a===void 0?1e3:a,P=v.onEnd,p=v.autoStart,L=p===void 0?!0:p,I=(0,d.useState)(L?f:0),O=o()(I,2),R=O[0],c=O[1],y=(0,d.useState)(L?Z:null),U=o()(y,2),$=U[0],T=U[1];(0,te.Z)(function(){var l=R-1;c(l),l===0&&(T(null),P==null||P())},$);var s=(0,d.useCallback)(function(){c(f),T(Z)},[f,Z]);return[R,{startCountdown:s}]},ae=re,J=e(53577),G=e(99076),r=e(52676);function ne(M){var f=M.visible,v=M.emailAuthFlag,a=M.email,Z=M.fetchCurrentUser,P=(0,d.useState)(""),p=o()(P,2),L=p[0],I=p[1],O=(0,d.useState)(!1),R=o()(O,2),c=R[0],y=R[1],U=(0,d.useState)(!1),$=o()(U,2),T=$[0],s=$[1],l=ae(60,{autoStart:!1}),h=o()(l,2),u=h[0],E=h[1].startCountdown,g=(0,z.useIntl)(),t=g.formatMessage;(0,d.useEffect)(function(){f&&Q()},[f]);var Q=function(){s(!0),(0,B.lZ)().then(function(i){i.status===J.oj.OK?E():j.ZP.error((0,G.R$)(i))}).catch(function(i){j.ZP.error((0,G.R$)(i))}).finally(function(){s(!1)})},ue=function(){var V=S()(m()().mark(function i(){var W;return m()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return s(!0),n.prev=1,n.next=4,(0,B.pj)({authCode:L});case 4:if(W=n.sent,W.status!==J.oj.OK){n.next=11;break}return n.next=8,Z();case 8:j.ZP.success(t({id:"profile.security.email.verification-code.succeed"})),n.next=13;break;case 11:j.ZP.error((0,G.R$)(W)),y(!0);case 13:n.next=18;break;case 15:n.prev=15,n.t0=n.catch(1),j.ZP.error((0,G.R$)(n.t0));case 18:return n.prev=18,s(!1),n.finish(18);case 21:case"end":return n.stop()}},i,null,[[1,15,18,21]])}));return function(){return V.apply(this,arguments)}}();return(0,r.jsx)(_.Z,{visible:f,title:t({id:"menu.pending-verify"}),className:"custom-modal",maskClosable:!1,closable:!1,keyboard:!1,footer:null,style:{color:"#42526E"},children:(0,r.jsxs)(ee.Z,{spinning:T,children:[(0,r.jsx)("p",{children:v&&t({id:"profile.security.email.".concat(v)})}),(0,r.jsx)("p",{style:{fontSize:16,fontWeight:500,marginBottom:0},children:a}),(0,r.jsx)("p",{children:t({id:"profile.security.email.verification-code.sent"})}),u===0?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("span",{children:t({id:"profile.security.email.verification-code.no-received"})}),(0,r.jsx)(K.ZP,{type:"link",onClick:function(i){i.preventDefault(),Q()},children:t({id:"profile.security.email.verification-code.re-send"})})]}):(0,r.jsx)("span",{children:t({id:"profile.security.email.verification-code.countdown"},{num:u})}),(0,r.jsxs)(H.Z.Group,{style:{paddingTop:24},compact:!0,children:[(0,r.jsx)(H.Z,{placeholder:t({id:"profile.security.email.verification-code.placeholder"}),style:{width:300,marginRight:8},status:c?"error":"",onChange:function(i){I(i.target.value),c&&y(!1)}}),(0,r.jsx)(K.ZP,{type:"primary",disabled:L.length<=0,onClick:function(i){i.preventDefault(),ue()},children:t({id:"profile.security.email.verification-code"})})]}),c&&(0,r.jsx)("p",{style:{color:"#F56C6C",paddingTop:4,marginBottom:0},children:t({id:"profile.security.email.verification-code.failed"})})]})})}var ie=(0,r.jsx)(Y.ZP,{status:"403",title:"403",subTitle:"Sorry, you are not authorized to access this page.",extra:(0,r.jsx)(K.ZP,{type:"primary",children:(0,r.jsx)(z.Link,{to:"/user/login",children:"Go Login"})})}),se=function(f){var v=(0,z.useModel)("@@initialState"),a=v.initialState,Z=v.setInitialState,P=(0,d.useState)(!1),p=o()(P,2),L=p[0],I=p[1],O=f.children,R=function(){var s=S()(m()().mark(function l(h){var u,E;return m()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return I(!0),t.prev=1,t.next=4,(0,B.ze)(C()(C()({},h),{},{name:a==null||(u=a.currentUser)===null||u===void 0?void 0:u.name}));case 4:if(E=t.sent,E.status===q.o.OK){t.next=9;break}j.ZP.error((0,b.R$)(E)),t.next=11;break;case 9:return t.next=11,c();case 11:t.next=16;break;case 13:t.prev=13,t.t0=t.catch(1),j.ZP.error((0,b.R$)(t.t0));case 16:return t.prev=16,I(!1),t.finish(16);case 19:case"end":return t.stop()}},l,null,[[1,13,16,19]])}));return function(h){return s.apply(this,arguments)}}(),c=function(){var s=S()(m()().mark(function l(){var h,u;return m()().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return g.next=2,a==null||(h=a.fetchCurrentUser)===null||h===void 0?void 0:h.call(a);case 2:u=g.sent,u&&Z(C()(C()({},a),{},{currentUser:u}));case 4:case"end":return g.stop()}},l)}));return function(){return s.apply(this,arguments)}}(),y=(a==null?void 0:a.currentUser)||{},U=y.isRequiredUpdatedPassword,$=y.emailAuthFlag,T=y.email;return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(w.Z,{authority:void 0,noMatch:ie,children:(0,r.jsx)(z.Outlet,{})}),(0,r.jsx)(k.Z,{visible:U,forceModify:!0,confirmLoading:L,resetPassword:R}),(0,r.jsx)(ne,{visible:!U&&!!$&&(0,G.mC)(),emailAuthFlag:$,email:T,fetchCurrentUser:c})]})},le=se}}]);
